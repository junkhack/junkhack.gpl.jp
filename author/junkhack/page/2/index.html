<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>JunkHack &#8211; ページ 2 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; JunkHack による投稿のフィード" href="/author/junkhack/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_923a46d76606f1b43e3f3639ca289d5f.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/users/1">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> <style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
</head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged author author-junkhack author-1 paged-2 author-paged-2 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">投稿者: <span>JunkHack</span>
</h1></header><article id="post-10604" class="post-10604 post type-post status-publish format-standard has-post-thumbnail hentry category-linux"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/06/01/termux-php8-to-php7/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-06-01T06:14:55+09:00">2021年6月1日</time><time class="updated" datetime="2021-06-01T06:16:47+09:00">2021年6月1日</time></a> </span><span class="posted-on">更新日:2021年6月1日</span> <span class="categories"> <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>
</div>
<h1 class="entry-title"><a href="/2021/06/01/termux-php8-to-php7/" rel="bookmark noopener noreferrer" data-wpel-link="internal">TermuxでPHP7を使いたい！ PHP8からPHP7にして使う。</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今年の初めくらいからtermuxのPHPは7から8に上がったようですね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>何か不具合でも？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>WordPressを動かすには少々、問題ありで。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>termux はダウングレードできないですよね？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>先日、termux上でNGINXとPHP-FPMの設定記事を書いたときに気がついたんですが、termuxのPHPって7から8になってPHP7はもうPKGがなく入れられませんでした。</p>
<blockquote class="wp-block-quote">
<p>TermuxでNGINX+php-fpm+mariadbを動かす具体的な設定例</p>
<cite><a href="/2021/05/13/termux_nginx_php-fpm_mariadb/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">Link</a></cite>
</blockquote>
<p>で、一つ前の記事でPHP7を暫定配布していたのですが、ビルドしたのでその過程とビルドしたPHP7のdepパッケージをどうやって入れるのかネタにしようかと思います。</p>
<h3>ビルドしたPHP7のダウンロード先</h3>
<p>GITHUBに、ビルドしておきました。arm64bitのCPUを使っている方向けです。32bit版はありません。</p>
<blockquote class="wp-block-quote">
<p>Github: termux-php7</p>
<cite><a rel="noreferrer noopener external" href="https://github.com/take-i/termux-php7/tree/master/php7.4.12" target="_blank" data-wpel-link="external" class="wpel-icon-right">LINK<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>インストールの仕方は簡単に記載しておきます。</p>
<h4>(1) 一旦、PHP8関連を入れておく</h4>
<p>とりあえず一旦、アップデートしておきます。アップデートできない人は１つ前の記事を見てください。</p>
<pre class="wp-block-code"><code>$ pkg update $$ upgrade</code></pre>
<p>その後、php8やphp-fpm、php-apacheなど入れておきます。</p>
<pre class="wp-block-code"><code>$ pkg install php php-fpm php-apache</code></pre>
<p>今入っているバージョンを再確認しておきます。</p>
<pre class="wp-block-code"><code>$ dpkg -l | grep php</code></pre>
<p>2021/06/01現在ですと以下が最新です。</p>
<pre class="wp-block-code"><code>$ dpkg -l | grep php | cut -b 4-35
 php                8.0.6       
 php-apache         8.0.6       
 php-fpm            8.0.6 </code></pre>
<h3>PHP8関連だけ消す</h3>
<p>例えば、上の３つPHP8関連だけ消したい場合は以下のようにします。</p>
<pre class="wp-block-code"><code>$ apt purge php php-apache php-fpm</code></pre>
<p>ちゃんと消えたか、１つ上のコマンドをタイプして確認してみましょう。</p>
<h3>PHP7をダウンロードしてインストール</h3>
<p>php-pgsqlは今回入れないので、消しておきます。</p>
<pre class="wp-block-code"><code>$ wget https://github.com/take-i/termux-php7/raw/master/php7.4.12-aarch64-deb.zip
$ unzip php7.4.12-aarch64-deb.zip
$ cd php7.4.12-aarch64-deb.deb/
$ rm php-pgsql*
$ dpkg -i ./php* ./libicu_67.1_aarch64.deb</code></pre>
<p>以下のようになっていればOKです。</p>
<pre class="wp-block-code"><code>$ dpkg -l | egrep "php|libicu"
ii  libicu             67.1           aarch64
ii  php                7.4.12         aarch64
ii  php-apache         7.4.12         aarch64
ii  php-fpm            7.4.12         aarch64</code></pre>
<p>apache や、nginxの設定をしてみてphpinfo()関数が動作することを確認しておきました。libicuだけ最新の環境から下がっていますので、何かこれ関連で入れられないパッケージが出るかもしれません。何かあれば教えてください。</p>
<h3>PHP7をアップデートしないよう設定</h3>
<p>今入れたのがアップデートされないよう設定しておきます。</p>
<pre class="wp-block-code"><code>$ apt-mark hold libicu php php-apache php-fpm</code></pre>
<p>確認は以下で。</p>
<pre class="wp-block-code"><code>$ apt-mark showhold
libicu
php
php-apache
php-fpm</code></pre>
<p>ホールドを解除したい場合は、apt-mark unhold &lt;<em>package-name</em>> で解除できます。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・ビルドするときは、dockerイメージをubuntuに実機に作ってあれこれする<br>・これはまた次回に紹介<br>・termux独自のパッケージ管理のバージョンなどについては未調査<br>・とりあえず、PHP7はapacheでもnginxでも使えるようになった</p>
<h3>あとがき</h3>
<p>WordPressなんかを動かすときは、まだPHP7が安定しています。この前、PHP8で動かしてみたんですが対応していないプラグインなどもあり、またWP-CLIというコマンドラインのツールも警告を出します。ということで、PHP8はもう少し、様子見となりました。termuxでPHP7とか勉強している人もいると思うので今回のネタは少しは需要があるかもしれません。やっぱりビルドするって、面倒ですしね。いつか、その過程も紹介していきたいです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10596" class="post-10596 post type-post status-publish format-standard has-post-thumbnail hentry category-linux"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/06/01/termux-pkg-update-error/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-06-01T00:04:36+09:00">2021年6月1日</time><time class="updated" datetime="2021-06-01T00:07:59+09:00">2021年6月1日</time></a> </span><span class="posted-on">更新日:2021年6月1日</span> <span class="categories"> <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>
</div>
<h1 class="entry-title"><a href="/2021/06/01/termux-pkg-update-error/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxでpkg updateできなくなって困ってる人へ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>5/1からGoogleStoreから入れたTermuxはパッケージのアップデートできなくなっています。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>えっ！そうなの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>では、どうすればいいの？っていう記事になります。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>日本語の情報ってば、ほとんどないですね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>2021/5/1から、termux で、pkg update などできなくなてエラーになります。こんな感じ。</p>
<pre class="wp-block-code"><code>$ pkg update
Checking availability of current mirror: ok
Ign:1 https://dl.bintray.com/grimler/game-packages-24 games InRelease
Ign:2 https://dl.bintray.com/grimler/science-packages-24 science InRelease
Hit:3 https://termux.mentality.rip/termux-packages-24 stable InRelease
Err:4 https://dl.bintray.com/grimler/game-packages-24 games Release
  403  Forbidden
Err:5 https://dl.bintray.com/grimler/science-packages-24 science Release
  403  Forbidden
Reading package lists... Done
E: The repository 'https://dl.bintray.com/grimler/game-packages-24 games Release' does no longer have a Release file.
N: Metadata integrity can't be verified, repository is disabled now.
N: Possible cause: repository is under maintenance or down (wrong sources.list URL?).
E: The repository 'https://dl.bintray.com/grimler/science-packages-24 science Release' does no longer have a Release file.
N: Metadata integrity can't be verified, repository is disabled now.
N: Possible cause: repository is under maintenance or down (wrong sources.list URL?).</code></pre>
<p>これはリポジトリの参照先が閉鎖されたからです。今まで、見ていた先は上のログからもわかるように「bintray」というところでした。この対応策は以下で書かれていますが、日本語で書かれた情報がなかったので書いておくことにしますね。</p>
<blockquote class="wp-block-quote">
<p>[README] Bintray repositories are down now #6726</p>
<cite><a href="https://github.com/termux/termux-packages/issues/6726" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">Link<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>もう少し速く記事を書こうかなと思っていたのですが、ずるずると5月末になってしまいました。</p>
<h3>リポジトリの参照先を変更する</h3>
<p>GooglePlayからtermuxを入れた人が、この現象にあっていると思いますが、次のコマンドでリポジトリを変更できます。実行はリモートのsshからでもOKです。</p>
<pre class="wp-block-code"><code>termux-change-repo</code></pre>
<p>すると、以下のようにCUIインターフェイスの画面が出てきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="405" height="257" src="/wp-content/uploads/2021/05/1.png" alt="" class="wp-image-10598"></noscript>
<img width="405" height="257" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20405%20257%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/1.png" alt="" class="lazyload wp-image-10598"></figure></div>
<p>３つとも選択して、OKを押します。</p>
<div class="wp-block-image"><figure class="aligncenter size-large is-resized"><noscript><img src="/wp-content/uploads/2021/05/1-5.png" alt="" class="wp-image-10599" width="402" height="237"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20402%20237%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/1-5.png" alt="" class="lazyload wp-image-10599" width="402" height="237"></figure></div>
<p>次の画面にて、上から３つめのGrimler を選択します。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="621" height="255" src="/wp-content/uploads/2021/05/3.png" alt="" class="wp-image-10600"></noscript>
<img width="621" height="255" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20621%20255%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/3.png" alt="" class="lazyload wp-image-10600"></figure></div>
<p>OKを押すと以下のよう表示され、ターミナル入力に戻ります。</p>
<pre class="wp-block-code"><code>&#091;*] Grimler's mirrors selected
    Changing main repository
    Changing game repository
    Changing science repository
&#091;*] Running apt update
Hit:1 https://grimler.se/termux-packages-24 stable InRelease
Hit:2 https://grimler.se/game-packages-24 games InRelease
Hit:3 https://grimler.se/science-packages-24 science InRelease
Reading package lists... Done
Building dependency tree       
Reading state information... Done
62 packages can be upgraded. Run 'apt list --upgradable' to see them.</code></pre>
<p>そうしたら、以下のコマンドをパッケージのアップデートを行なっておきます。このコマンドは、インストールされている packages が最新のバージョンにアップグレードされます。</p>
<pre class="wp-block-code"><code>$ pkg upgrade</code></pre>
<p>一応、PHP7など入れている場合は、PHP8になりますので（ダウングレードはtermuxはできません）注意してくださいね。WordPressはまだphp7で動作させたほうが良いです。php8.x は、いくつかのプラグインはwp-cliでエラーや警告がでます。</p>
<p>まだ、テスト中ですが取り急ぎ php7のパッケージを作っておきました。</p>
<blockquote class="wp-block-quote">
<p>Github: termux-php7</p>
<cite><a href="https://github.com/take-i/termux-php7/tree/master/php7.4.12" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">Link<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<pre class="wp-block-code"><code>../php7.4.12/
　　　├── apache2_2.4.46-4_aarch64.deb
　　　├── libicu_67.1_aarch64.deb　★
　　　├── php-apache_7.4.12_aarch64.deb
　　　├── php-fpm_7.4.12_aarch64.deb ★
　　　├── php-pgsql_7.4.12_aarch64.deb
　　　└── php_7.4.12_aarch64.deb ★

★のは動作することを軽く確認済み。</code></pre>
<p>また、今度これらのネタについてはブログ記事にしたいと思います。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・termuxのオフィシャルは、GooglePlayより、F-Droidからインストールを進めています。<br>・これにはちゃんと理由があるようで、そのあたりも次のネタで取り上げる予定<br>・Bintray側は、告知ページで「Into the Sunset on May 1st」と表現しています。Sunsetって、つまりクローズってことです！<br>・取り急ぎ、クロスビルド環境でPHP7.4.12をビルドしましたがこれもネタにしたいです。<br>・nginxとphp-fpmの組み合わせでは軽くテストしました。</p>
<h3>あとがき</h3>
<p>今年も折り返しの月に入りましたね！　バイク関連のDIYをいろいろやりたいのですが、休みの日も急に仕事が入ってなかなか手がつけられずでした。ありがたいことなんで、仕事はやりますが趣味のDIYもやりたいので、うずうずしています。夏にはカスタム完了したバイクでツーリング行きたいですからね！</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10588" class="post-10588 post type-post status-publish format-standard has-post-thumbnail hentry category-linux category-osx"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/05/30/ryzen-5-3600-linux-unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-05-30T03:04:36+09:00">2021年5月30日</time><time class="updated" datetime="2021-05-30T03:04:39+09:00">2021年5月30日</time></a> </span><span class="posted-on">更新日:2021年5月30日</span> <span class="categories"> <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/osx/" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a></span>
</div>
<h1 class="entry-title"><a href="/2021/05/30/ryzen-5-3600-linux-unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal">備忘録：Ryzen 5 3600のLinuxでUnixBench</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>WordPressの仕事が終わったんで、今日は好きなことやるよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>WordPressの仕事もやってるのね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>だいたい、何でも頼まれたらやっちゃうよ！w</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>で、Linuxはubuntuですか？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>そういえば、だいぶ前にRyzen 5 3600をメインマシンにしたんですが、これでLinux動かしてなくて、UnixBenchのスコアが気になっていました。Diskはさくっと入れ替えられるよう、2.5inchの脱着ベイをつけてありますので今回はこのマシンにUbuntuを入れてUnixBenchを計測してみようと思います。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="522" height="577" src="/wp-content/uploads/2021/05/ryzen5.png" alt="" class="wp-image-10589"></noscript>
<img width="522" height="577" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20522%20577%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/ryzen5.png" alt="" class="lazyload wp-image-10589"></figure></div>
<blockquote class="wp-block-quote">
<p>Intelチップ、2022年までしばらくさようなら！<br><em>投稿日: <a href="/2020/03/13/goodby-intel/" data-wpel-link="internal" rel="noopener noreferrer"><time datetime="2020-03-13T06:20:53+09:00">2020年3月13日</time></a> 更新日:2020年11月13日</em></p>
<cite><a href="/2020/03/13/goodby-intel/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">Link</a></cite>
</blockquote>
<p>もう１年以上使っていますね。intelがRyzenを盛り返すまで繋ぎで使っているんですが、なかなかintelは画期的なのを出しませんね。AppleはM1のオリジナルCPU出してきたし、５年後はintelが昔のAMDみたいになっていなければいいんですが。</p>
<h3>Ubuntu 20.04.1 LTSでUnixBench</h3>
<p>MacOS10.14.x でUnixBenchを計測した時は、マルチCPUで2323.1でした。Ubuntu 20.04.1 LTSで、Ryzen 5 3600は以下のスコアです。</p>
<blockquote class="wp-block-quote"><p>UNIX Benchmarks (Version 5.1.3) on AMD Ryzen 5 3600<br><br>Single-Core Score：2422.6<br>Multi-Core Score：7919.0</p></blockquote>
<p>詳細は以下です。SSDは、SLCのsata2 64GBです。</p>
<pre class="wp-block-code"><code>   BYTE UNIX Benchmarks (Version 5.1.3)

   System: mone: GNU/Linux
   OS: GNU/Linux -- 5.4.0-42-generic -- #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020
   Machine: x86_64 (x86_64)
   Language: en_US.utf8 (charmap="UTF-8", collate="UTF-8")
------------------------------------------------------------------------
Benchmark Run: 日  5月 30 2021 00:29:08 - 00:57:06
12 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       50630225.0 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     9059.2 MWIPS (9.9 s, 7 samples)
Execl Throughput                               7946.0 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks       1256459.1 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          338174.5 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       3192098.2 KBps  (30.0 s, 2 samples)
Pipe Throughput                             2633467.7 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 364452.5 lps   (10.0 s, 7 samples)
Process Creation                              10672.3 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                  10448.3 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                   5218.2 lpm   (60.0 s, 2 samples)
System Call Overhead                        3716288.0 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   50630225.0   4338.5
Double-Precision Whetstone                       55.0       9059.2   1647.1
Execl Throughput                                 43.0       7946.0   1847.9
File Copy 1024 bufsize 2000 maxblocks          3960.0    1256459.1   3172.9
File Copy 256 bufsize 500 maxblocks            1655.0     338174.5   2043.4
File Copy 4096 bufsize 8000 maxblocks          5800.0    3192098.2   5503.6
Pipe Throughput                               12440.0    2633467.7   2116.9
Pipe-based Context Switching                   4000.0     364452.5    911.1
Process Creation                                126.0      10672.3    847.0
Shell Scripts (1 concurrent)                     42.4      10448.3   2464.2
Shell Scripts (8 concurrent)                      6.0       5218.2   8697.0
System Call Overhead                          15000.0    3716288.0   2477.5
                                                                   ========
System Benchmarks Index Score                                        2422.6

------------------------------------------------------------------------
Benchmark Run: 日  5月 30 2021 00:57:06 - 01:25:17
12 CPUs in system; running 12 parallel copies of tests

Dhrystone 2 using register variables      377415057.2 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    85109.8 MWIPS (9.8 s, 7 samples)
Execl Throughput                              38242.8 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        870656.3 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          231207.7 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       2754722.9 KBps  (30.0 s, 2 samples)
Pipe Throughput                            17510677.3 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                1622682.3 lps   (10.0 s, 7 samples)
Process Creation                              70024.7 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                  67019.5 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                  10011.7 lpm   (60.0 s, 2 samples)
System Call Overhead                       16785255.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0  377415057.2  32340.6
Double-Precision Whetstone                       55.0      85109.8  15474.5
Execl Throughput                                 43.0      38242.8   8893.7
File Copy 1024 bufsize 2000 maxblocks          3960.0     870656.3   2198.6
File Copy 256 bufsize 500 maxblocks            1655.0     231207.7   1397.0
File Copy 4096 bufsize 8000 maxblocks          5800.0    2754722.9   4749.5
Pipe Throughput                               12440.0   17510677.3  14076.1
Pipe-based Context Switching                   4000.0    1622682.3   4056.7
Process Creation                                126.0      70024.7   5557.5
Shell Scripts (1 concurrent)                     42.4      67019.5  15806.5
Shell Scripts (8 concurrent)                      6.0      10011.7  16686.2
System Call Overhead                          15000.0   16785255.3  11190.2
                                                                   ========
System Benchmarks Index Score                                        7919.0</code></pre>
<p>同じRyzenだと、<em>ThinkCentre M75q-1 Tiny</em>　の<em>Ryzen 5 Pro 3400GE (3.30GHz, 2MB)</em>　が以下のスコアです。</p>
<blockquote class="wp-block-quote"><p>UNIX Benchmarks (Version 5.1.3) on <em>Ryzen 5 Pro 3400GE (3.30GHz, 2MB)</em><br><br>Single-Core Score：2151.7<br>Multi-Core Score：6552.1</p></blockquote>
<p>Ryzen 5 3600のが速いですが、このマシンも頑張っていますね。これは以下で紹介しています。</p>
<blockquote class="wp-block-quote">
<p>130W電源でThinkCentre M75q-1 Tinyのベンチマーク</p>
<cite><a href="/2020/07/02/130wm75q-1-tinybench/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">URL</a></cite>
</blockquote>
<p>ちなみに、このマシンはWEBサーバにしようと思いっていたのですがフォートナイトやるっていうんで息子に持っていかれてしまいました。。。なので、このブログはスマホPixel3のWEBサーバでがんばっています！</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・Ryzen 5 3600 は、シングル2422.6　マルチ7919.0　のUnixbenchスコア<br>・2021/05/30時点でintelの次のCPUは、「Alder Lake」を2021年後半に発売予定<br>・これは10nmのようです<br>・特に困っていないので、7nmとか5nmのintelが出るまでじっくり待ちます</p>
<h3>あとがき</h3>
<p>Intelがこのまま、黙ってAMDを先行させるだけではないと思っていますが、苦戦しているようです。まぁ、しかし、普通の作業をしているだけであれば、Core i7 3770; (Ivy Bridge)でもぜんぜん十分で、いまだにサブマシン（メインマシンに近い存在）で頑張っています。このCPUは、第3世代のもので、今から約10年前にリリースされました。macosも10.8くらいから10.15（現在）でずっと使っています。重い作業するのは、ビルドするときくらいでしょうか。あとはアプリケーションを同時に30個くらい開いたりしながら作業するとき、少しもたつくくらいです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10506" class="post-10506 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/05/20/isbn-10_4777521494/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-05-20T17:05:40+09:00">2021年5月20日</time><time class="updated" datetime="2021-07-04T21:16:44+09:00">2021年7月4日</time></a> </span><span class="posted-on">更新日:2021年7月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/05/20/isbn-10_4777521494/" rel="bookmark noopener noreferrer" data-wpel-link="internal">工学社 の本、androidの改造　に掲載されたよ！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>なんと、このブログの記事が工学社の本に掲載されましたよ！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>なにぃー！　こんなふざけたブログが本に載っただと！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>よかったら、本屋さんまたはネットでポチってね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ネタは「Pixel3のroot化」の件です。</p></div></div></div></div>
</div>
</div></div></div>
<p>工学社&nbsp;出版のI/O編集部さんが、「<strong>Androidスマホの改造</strong>」っていうタイトルの本を出されたのですがその中で、なんと、このブログの記事の一部が載っていますよ。ただいま、絶賛予約中です！ 5/27発売です。</p>
<figure class="wp-block-table aligncenter"><table><tbody>
<tr><td><a href="https://amzn.to/3f0Hmpm" target="_blank" rel="noreferrer noopener external" data-wpel-link="external"><noscript><img src="/wp-content/uploads/2021/05/Amazon_co_jp.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/Amazon_co_jp.png" alt=""></a></td></tr>
<tr><td>
<strong>出版社 :&nbsp;</strong>工学社 (2021/5/27)<br><strong>発売日 :&nbsp;</strong>2021/5/27<br><strong>言語 :&nbsp;</strong>日本語<br><strong>単行本 :&nbsp;</strong>112ページ<br><strong>ISBN-10 :&nbsp;</strong>4777521494<br><strong>ISBN-13 :&nbsp;</strong>978-4777521494<br><strong>寸法 :&nbsp;</strong>14.8 x 1 x 21 cm</td></tr>
</tbody></table></figure><p>元ネタとなった当ブログの記事はこれです。</p>
<div class="wp-block-columns">
<div class="wp-block-column" style="flex-basis:33.33%"><div class="wp-block-image"><figure class="alignright size-large is-resized"><noscript><img src="/wp-content/uploads/2021/05/58b37a198180ea688f088b84daff52e6.png" alt="" class="wp-image-10571" width="85" height="85"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2085%2085%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/58b37a198180ea688f088b84daff52e6.png" alt="" class="lazyload wp-image-10571" width="85" height="85"></figure></div></div>
<div class="wp-block-column" style="flex-basis:66.66%"><blockquote class="wp-block-quote">
<p>Pixel3・android11(R)正式リリース版でroot化！</p>
<cite><a rel="noreferrer noopener" href="/2020/10/05/pixel3android11rroot/" target="_blank" data-wpel-link="internal">LINK</a></cite>
</blockquote></div>
</div>
<h3>内容抜粋</h3>
<p>工学社さんの<a rel="noreferrer noopener external" href="http://www.kohgakusha.co.jp/books/detail/978-4-7775-2149-4" target="_blank" data-wpel-link="external" class="wpel-icon-right">サイト<span class="wpel-icon wpel-image wpel-icon-1"></span></a>に抜粋がありましたので引用しておきます。第一章に、赤文字部分が掲載された部分です。</p>
<p>■非公式アプリを入れる―root化<br>　機械オンチでも出来る！Androidをroot化する方法<br>　<span class="has-inline-color has-vivid-red-color">Pixel3・android11(R)正式リリース版でroot化</span></p>
<p>■“スクショ”禁止のアプリで画像を保存 ―「Xposed」導入<br>　Androidに「Xposed」を導入する方法<br>　「Xposed」の使い方に関するアレコレ</p>
<p>■有志が作った最新OSでセキュリティ向上　―ROM焼き<br>　「Xperia XZs」のROM焼き<br>　ROM焼き手順</p>
<p>■キャリア以外のSIMカードを入れる―「SIMロック解除」<br>　「SIMロック解除」とは<br>　「SIMロック解除」の条件と手順について</p>
<p>■高度なカスタマイズを可能に―adbコマンド<br>　「Windows」で「adbコマンド」を使う方法<br>　「Mac」で「adbコマンド」を使う方法</p>
<h3>あとがき</h3>
<p>こんなブログの記事が、まさか本になるとは思っていませんでした。依頼が来た時は、びっくりです！　汎用性がある記事っていうのは、目に止まるっていうことですかね。root化の記事もそれなりに需要があるということですね。</p>
<p>　今度は root化したらこんなことができるよっていう記事も書いていこうと思いました。今回の本にも載っている「あっとはっく」さんのサイトは面白い記事がたくさんありますね。見習いたいと思います。</p>
<blockquote class="wp-block-quote">
<p>日々をハックする記事をお届け：あっとはっく</p>
<cite><a href="https://sp7pc.com/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">LINK<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10507" class="post-10507 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/05/13/termux_nginx_php-fpm_mariadb/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-05-13T11:04:18+09:00">2021年5月13日</time><time class="updated" datetime="2021-07-04T21:16:53+09:00">2021年7月4日</time></a> </span><span class="posted-on">更新日:2021年7月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/05/13/termux_nginx_php-fpm_mariadb/" rel="bookmark noopener noreferrer" data-wpel-link="internal">TermuxでNGINX+php-fpm+mariadbを動かす具体的な設定例</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今日もTermuxとWordPress触っていくよ〜！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今日は何するんですか〜？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>一時的にPixel3からUmidigiF2へスマホサーバを移動しようと思って設定を纏めておいた！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>設定の備忘録ですね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>さて、最近記事をサボりがちでしたがコメントにて、「TermuxでWordPressを動かす具体的な設定例」が見たいとご意見をいただきましたので、自分のメモがてら纏めておきます。</p>
<h3>まずはUmidigiF2の電池交換</h3>
<blockquote class="wp-block-quote">
<p>アリエク：UmidigiF2 バッテリー（購入時は1,283円）</p>
<cite><a href="https://s.click.aliexpress.com/e/_A0Y07r" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">Link<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>UmidigiF2の電池が膨らんできましたので、アリエクで買ったUmidigiF2の電池に交換します。裏蓋は粘着テープで貼り付けられているだけなので、カードとかピックで分離します。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="549" height="393" src="/wp-content/uploads/2021/05/S20210511_001_jpg.png" alt="" class="wp-image-10508"></noscript>
<img width="549" height="393" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20549%20393%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/S20210511_001_jpg.png" alt="" class="lazyload wp-image-10508"></figure></div>
<p>NFCやカメラ部分がプラスティック部品で固定されているので、周りのネジ１１本を外してバッテリーコネクタを外せるようにします。</p>
<div class="wp-block-image"><figure class="aligncenter size-large is-resized"><noscript><img src="/wp-content/uploads/2021/05/2.png" alt="" class="wp-image-10509" width="549" height="411"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20549%20411%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/2.png" alt="" class="lazyload wp-image-10509" width="549" height="411"></figure></div>
<p>バッテリーの裏は透明なフィルムで剥がせるよう工夫されています。よく切れるテープとかは使われていませんでした。交換自体はPixel3とかと比べると非常に楽ですね。メンテナンス性は良いです。あとは両面テープを貼り直して裏フタを固定するだけです。</p>
<p>　さてと、では面倒な設定まとめを書いておきます。</p>
<h3>Termuxを入れてアプリを設定</h3>
<p>Termuxについては、Google Play Storeから入れます。root化していなくても大丈夫ですが、ポート制限があるので1024ポート以上でないとWEBサーバは公開できない仕様です。</p>
<blockquote class="wp-block-quote">
<p>Termux：Google Play Store</p>
<cite><a href="https://play.google.com/store/apps/details?id=com.termux&amp;hl=ja&amp;gl=US" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">URL<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>リモートから設定したほうが楽なので、最低限SSHを入れて起動しておきます。パスワードを設定しておきます。</p>
<pre class="wp-block-code"><code>pkg update 
pkg install openssh
sshd
passwd</code></pre>
<p>あとはリモートからSSH接続して設定していきます。面倒でなければSSH鍵認証の設定をしておいてもOKです。</p>
<pre class="wp-block-code"><code>ssh <em>termux_host_ip</em> -p 8022</code></pre>
<p>他、アプリNGINX+php-fpm+mariadbも入れておきます。</p>
<pre class="wp-block-code"><code>pkg install nginx php-fpm mariadb</code></pre>
<p>どんなバージョンが入っているか確認しておきます。</p>
<pre class="wp-block-code"><code>dpkg -l | egrep 'nginx|php|mariadb'</code></pre>
<p>現時点、2021/05/11　時点では以下のバージョンになりました</p>
<pre class="wp-block-code"><code>$ dpkg -l | egrep 'nginx|php|mariadb'
ii  mariadb                    2:10.5.8       aarch64      A drop-in replacement for mysql server
ii  nginx                      1.20.0         aarch64      Lightweight HTTP server
ii  php                        8.0.6          aarch64      Server-side, HTML-embedded scripting language
ii  php-fpm                    8.0.6          aarch64      FastCGI Process Manager for PHP</code></pre>
<p>2020/10頃は、PHPが7.4.xだったのでver8系になったようです。PHP8の新機能は<a rel="noreferrer noopener external" href="https://qiita.com/rana_kualu/items/fe7998fbe773544d5d25" target="_blank" data-wpel-link="external" class="wpel-icon-right">ここ<span class="wpel-icon wpel-image wpel-icon-1"></span></a>参照。</p>
<p>PHP7が良い場合は、<a rel="noreferrer noopener external" href="https://github.com/Termux-pod/termux-pod" target="_blank" data-wpel-link="external" class="wpel-icon-right">ここ<span class="wpel-icon wpel-image wpel-icon-1"></span></a>にdebfileがあるようです。Wordpressを動かす場合はPHP7.4.12のほうが無難かも。あとで検証してみます。</p>
<p>　※追記</p>
<p>上記のdebfile だとエラーになって動作しないようでしたので、ビルドしなおしました。<a href="/2021/06/01/termux-php8-to-php7/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">ここ</a>参照</p>
<h3>NGINXの設定</h3>
<p>ホームディレクトリ以下にWEBのドキュメントROOTを作ります。どこでもいいのですが、termuxの$HOMEに作ります。自分の場合は、デフォルトのWEB ROOT（htdocs_default）と、hack.gpl.jp　ドメインのWEB ROOT（htdocs_nginx）を分離しています。</p>
<pre class="wp-block-code"><code>$ echo $HOME
/data/data/com.termux/files/home
$ cd
$pwd
/data/data/com.termux/files/home
$ mkdir htdocs_nginx
$ mkdir htdocs_default</code></pre>
<p>あと、SSL関連のファイルを格納しておくのでそれ専用のディレクトリも作っておきます。SSL関連は以下を参照</p>
<blockquote class="wp-block-quote">
<p>Termuxネイティブ環境でacme-nginxを使いワイルドカード証明書を自動取得！</p>
<cite><a href="/2020/09/13/termux%e3%83%8d%e3%82%a4%e3%83%86%e3%82%a3%e3%83%96%e7%92%b0%e5%a2%83%e3%81%a7acme-nginx%e3%82%92%e4%bd%bf%e3%81%84%e3%83%af%e3%82%a4%e3%83%ab%e3%83%89%e3%82%ab%e3%83%bc%e3%83%89%e8%a8%bc%e6%98%8e/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<pre class="wp-block-code"><code>$ cd
$ mkdir -p ssl/gpl.jp/ 
$ tree ssl
ssl
└── gpl.jp</code></pre>
<p>NGINXの設定ファイルを作ります。conf.dディレクトリに分離して設定ファイルを保存するのでディレクトリも作っておきます。</p>
<pre class="wp-block-code"><code>$ cd
$ cd ../usr/etc/nginx/
$ mkdir conf.d</code></pre>
<p>オリジナルファイルをバックアップしておきます。UNIX系ではDiff取ったりして確認したりすることもあり、設定ファイルは消すより待避する癖をつけておいたほうが無難です。自分の場合は、_org　が元あったファイルという意味にしています。</p>
<pre class="wp-block-code"><code>$ cp -p nginx.conf nginx.conf_org</code></pre>
<p>今回の設定例では、root化してある端末なので、ポートは80と443にしています。root化していない場合は程よく読み替えてください。<br>nginx.conf　ファイルは以下のように設定しています。userは、termuxを入れた環境によって違いますので whoamiやidコマンドで確認しておきます。</p>
<pre class="wp-block-code"><code>user  u0_a143;
worker_processes  auto;
worker_rlimit_nofile 4096;

error_log  /data/data/com.termux/files/usr/var/log/nginx/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    use epoll;
    multi_accept on;
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type text/plain;

    charset            utf-8;
    sendfile           on;
    tcp_nopush         on;
    tcp_nodelay        on;
    server_tokens      off;
    keepalive_requests 100;
    keepalive_timeout  3;

    server_names_hash_bucket_size 64;
    types_hash_max_size 2048;
    client_body_buffer_size 64k;
    client_body_temp_path /data/data/com.termux/files/home/htdocs_default/tmp/client_body_temp 1 2;
	
    log_format  main  '$remote_addr - $remote_user &#091;$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /data/data/com.termux/files/usr/var/log/nginx/access.log  main;

    gzip  on;
    gzip_vary       on;
    gzip_proxied    any;
    gzip_comp_level 6;
    gzip_types      text/plain text/css text/xml text/javascript
                    application/json application/javascript application/x-javascript
                    application/xml application/rss+xml application/atom+xml
                    image/svg+xml image/x-icon;

    ssl_session_timeout 30m;
    ssl_session_cache   shared:SSL:10m;
    ssl_session_tickets off;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_dhparam /data/data/com.termux/files/usr/etc/nginx/dhparam.pem;
    ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256;

    fastcgi_buffers         8 64k;
    fastcgi_buffer_size     64k;
    fastcgi_connect_timeout 60;
    fastcgi_send_timeout    60;
    fastcgi_read_timeout    300;

    proxy_connect_timeout 60;
    proxy_send_timeout    60;
    proxy_read_timeout    120;
    proxy_http_version    1.1;
    proxy_cache_bypass    $http_upgrade;
    proxy_set_header      Upgrade            $http_upgrade;
    proxy_set_header      Connection         "upgrade";
    proxy_set_header      Host               $host;
    proxy_set_header      X-Real-IP          $remote_addr;
    proxy_set_header      X-Forwarded-Host   $host;
    proxy_set_header      X-Forwarded-Server $host;
    proxy_set_header      X-Forwarded-For    $proxy_add_x_forwarded_for;
    proxy_set_header      X-Forwarded-Proto  $scheme;
    #proxy_set_header      X-Forwarded-Port   $server_port;
    proxy_set_header      X-Forwarded-Port   443;
    proxy_temp_path       /data/data/com.termux/files/usr/var/log/nginx/tmp;
	
    ## cache_pathについては別ファイルで設定する
    include /data/data/com.termux/files/usr/etc/nginx/conf.d/cache_path.conf;
		
    server {
        listen *:80 default_server;
        server_name  _;
		root   /data/data/com.termux/files/home/htdocs_default;

		charset utf-8;

		access_log  /data/data/com.termux/files/usr/var/log/nginx/host.access.log  combined;
		error_log  /data/data/com.termux/files/usr/var/log/nginx/host.error.log warn;

	    index index.html;
	    include /data/data/com.termux/files/usr/etc/nginx/conf.d/common.conf;

	}

	include /data/data/com.termux/files/usr/etc/nginx/conf.d/hack.gpl.jp.conf;
	include /data/data/com.termux/files/usr/etc/nginx/conf.d/gpl.jp.conf;
	
}</code></pre>
<p>SSLのdhparamは、以下で出しておきます。この意味については<a href="https://qiita.com/r-ytakada/items/7ac9ce32c1ed4d01d505" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">ここ参照<span class="wpel-icon wpel-image wpel-icon-1"></span></a>。</p>
<pre class="wp-block-code"><code>openssl dhparam -out /data/data/com.termux/files/usr/etc/nginx/dhparam.pem 2048</code></pre>
<p>設定ファイルはインクルードしてあります。</p>
<blockquote class="wp-block-quote"><p>conf.d/cache_path.conf<br>conf.d/common.conf<br>conf.d/hack.gpl.jp.conf<br>conf.d/gpl.jp.conf</p></blockquote>
<p>まず、cache_path.conf の設定です。キャッシュディレクトリも作成しておきます。</p>
<pre class="wp-block-code"><code>mkdir -p /data/data/com.termux/files/home/cache/hackgpljp
mkdir -p /data/data/com.termux/files/home/cache/proxy.gpljp
mkdir -p /data/data/com.termux/files/home/cache/wwwgpljp</code></pre>
<p>cache_path.conf</p>
<pre class="wp-block-code"><code>location ~ /. {

## php-fpmでキャッシュを作る時
fastcgi_cache_path /data/data/com.termux/files/home/cache/hackgpljp levels=1:2 keys_zone=gpljp:30m inactive=600m max_size=10g;
## proxy経由でキャッシュを作る時
proxy_cache_path /data/data/com.termux/files/home/cache/proxy.gpljp levels=1:2 keys_zone=proxy_gpljp:30m inactive=600m max_size=10g;

# www.gpl.jp or gpl.jp
fastcgi_cache_path /data/data/com.termux/files/home/cache/wwwgpljp levels=1:2 keys_zone=wwwgpljp:18m inactive=5m max_size=10g;</code></pre>
<p>common.conf　は以下です。</p>
<pre class="wp-block-code"><code>## .htpasswdとか . から始まるファイルへのアクセスは404で応答
## 403だとそのファイルがあるのが外からわかってしまう
location ~ /. {
    return 404;
}
 
## ファイルが無くてもエラーログを出さない
location ~ /(favicon.ico|apple-touch-icon-*) {
    log_not_found  off;
    access_log  off;
}</code></pre>
<p>このサイトのメイン設定 hack.gpl.jp.conf は以下です。</p>
<pre class="wp-block-code"><code>server {
    listen      80;
    server_name jh.gpl.jp hack.gpl.jp hack.gpl.jp;

    root   /data/data/com.termux/files/home/htdocs_nginx;

    access_log  /data/data/com.termux/files/usr/var/log/nginx/hackgpljp.access.log  combined;
    error_log  /data/data/com.termux/files/usr/var/log/nginx/hackgpljp.error.log warn;

    client_max_body_size 20M;
    ## キャッシュの設定：有効 -&gt; 0 無効 -&gt; 1
    set $do_not_cache 0;
    ## キーゾーン名
    set $keys_zone gpljp;
	
    include /data/data/com.termux/files/usr/etc/nginx/conf.d/common.conf;
    include /data/data/com.termux/files/usr/etc/nginx/conf.d/hackgpljp_wp.conf;
    include /data/data/com.termux/files/usr/etc/nginx/conf.d/add_header.conf;
}
 
server {
     listen      443 ssl http2;
     server_name jh.gpl.jp hack.gpl.jp hack.gpl.jp;
     root   /data/data/com.termux/files/home/htdocs_nginx;

     access_log  /data/data/com.termux/files/usr/var/log/nginx/ssl_hackgpljp.access.log  combined;
     error_log  /data/data/com.termux/files/usr/var/log/nginx/ssl_hackgpljp.error.log warn;

     client_max_body_size 20M;
     ## サイトのSSL証明書
     ssl_certificate     /data/data/com.termux/files/home/ssl/gpl.jp/gpl.jp.crt;
     ssl_certificate_key /data/data/com.termux/files/home/ssl/gpl.jp/gpl.jp.key;

     ## キャッシュの設定：有効 -&gt; 0 無効 -&gt; 1
     set $do_not_cache 0;

     ## キーゾーン名
     set $keys_zone gpljp;

     ## 必要な設定ファイルを読み込み
     include /data/data/com.termux/files/usr/etc/nginx/conf.d/common.conf;
     include /data/data/com.termux/files/usr/etc/nginx/conf.d/hackgpljp_wp.conf;
     include /data/data/com.termux/files/usr/etc/nginx/conf.d/add_header.conf;
}</code></pre>
<p>ここで、インクルードしている設定は以下です。</p>
<blockquote class="wp-block-quote"><p>conf.d/hackgpljp_wp.conf<br>conf.d/add_header.conf</p></blockquote>
<p>hackgpljp_wp.conf</p>
<pre class="wp-block-code"><code>index index.php index.html;
error_page 404 /index.php?error=404;
 
# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
# Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
location ~ /. {
    deny all;
}
 
# Deny access to any files with a .php extension in the uploads directory
# Works in sub-directory installs and also in multisite network
# Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
location ~* /(?:uploads|files)/.*.php$ {
    deny all;
}

set $is_mobile '';
 
## スマートフォン用のキャッシュを作る為の判定処理
## WordPress標準の wp_is_mobile() 関数と同じ判定処理
if ($http_user_agent ~* '(Mobile|Android|Silk/|Kindle|BlackBerry|OperasMini|OperasMobi)') {
    set $is_mobile 'mobile.';
}

set $do_not_cache 0;

## GET メソッド以外はキャッシュを作成しない
if ($request_method != GET) {
    set $do_not_cache 1;
}

if ($query_string != "") {
	set $do_not_cache 1;
} 

## キャッシュして欲しくないファイルは除外
if ($request_uri ~* '/(wp-admin/|wp-login.php|wp-cron.php|xmlrpc.php|wp-json/|??feed|wp-json|sitemap.xml)') {
    set $do_not_cache 1;
}
 
## ログイン済みのユーザー等、Cookie を持っていたらキャッシュを使わない
if ($http_cookie ~* 'comment_author|wordpress_&#091;a-f0-9]+|wp-postpass|wordpress_no_cache|wordpress_logged_in') {
    set $do_not_cache 1;
}
 
## 画像ファイル等はブラウザキャッシュを効かせる (60日)
location ~* .(jpg|jpeg|gif|png|css|js|swf|ico|pdf|svg|eot|ttf|woff)$ {
    expires 60d;
    add_header Cache-Control "public, no-transform";
    access_log off;
}
 
## リクエストは index.php に投げる
location / {
    try_files $uri $uri/ /index.php?$args;
}
 
## NginxとPHP-FPMはソケットで繋ぐ
## HTTPステータスコードによって各キャッシュの有効期限を制御する
location ~ .php {
 
    try_files $uri /index.php;
 
    include fastcgi_params;
    fastcgi_pass  unix:/data/data/com.termux/files/usr/var/run/php-fpm.sock;
    fastcgi_param SCRIPT_FILENAME  /data/data/com.termux/files/home/htdocs_nginx$fastcgi_script_name;
 
    fastcgi_no_cache     $do_not_cache;
    fastcgi_cache_bypass $do_not_cache;
    fastcgi_cache        $keys_zone;
    fastcgi_cache_key    $is_mobile$scheme://$host$request_uri;
    fastcgi_cache_valid  200 5m;
    fastcgi_cache_valid  301 302 1h;
    fastcgi_cache_valid  404 1m;
    fastcgi_cache_valid  any 1s;
 
    fastcgi_hide_header X-Powered-By;
}</code></pre>
<p>add_header.conf は以下です。</p>
<pre class="wp-block-code"><code>add_header Strict-Transport-Security "max-age=15552000"; 
add_header X-XSS-Protection "1; mode=block";
add_header X-Frame-Options SAMEORIGIN;

add_header X-Content-Type-Options nosniff;
add_header Content-Security-Policy "default-src * 'self' data: 'unsafe-inline' 'unsafe-eval' ;";
add_header Referrer-Policy strict-origin always;
add_header Permissions-Policy "fullscreen=() geolocation=()";
add_header X-hacker "Hello. :-)";</code></pre>
<h3>PHPの設定</h3>
<p>WordPressを動かすなら、少しPHPの上限を上げておくほうが無難です。termuxパッケージのPHPは、デフォルトファイルがないので、php.iniは以下に作ります。</p>
<pre class="wp-block-code"><code>vi /data/data/com.termux/files/usr/lib/php.ini</code></pre>
<pre class="wp-block-code"><code>&#091;PHP]
upload_max_filesize = 64M
post_max_size = 64M
memory_limit = 128M

&#091;mail function]
sendmail_path = "/data/data/com.termux/files/usr/bin/msmtp -C /data/data/com.termux/files/home/.msmtprc -t"</code></pre>
<p>iniで指定してある、phpからのメール送信設定は、msmtpを使っています。これは以下を参照。</p>
<blockquote class="wp-block-quote">
<p>Termuxからメールを送れるようにするには？</p>
<cite>/2020/09/30/termux-smtp-client/</cite>
</blockquote>
<h3>NGINX+php-fpmの動作確認</h3>
<p>たくさんインクルードファイルがあって、わかり辛いかもですね。うまく動作しているか動作確認です。</p>
<pre class="wp-block-code"><code>sudo nginx</code></pre>
<p>root化してある場合は、nginxはroot で動作させないとポート80,443にバインドできません。1024以上であればtermuxの一般ユーザで起動させます。</p>
<p>　起動時に何かエラーメッセージが出たらその対応をしていきます。</p>
<h3>mariaDBの設定</h3>
<p>冒頭でmariaDBのパッケージはインストールしています。ここでは初期設定をします。基本的には以下でいけるはずです。</p>
<blockquote class="wp-block-quote">
<p>Termux Wiki : MariaDB</p>
<cite><a href="https://wiki.termux.com/wiki/MariaDB" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://wiki.termux.com/wiki/MariaDB<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>mysqlに接続するコマンドは、リモートからではなくtermuxのスマホ本体から行ってください。リモートからだと、権限がらみでtermuxユーザでmysql接続、use mysql; ができません。</p>
<p>mariadb を起動します。</p>
<pre class="wp-block-code"><code>$ mysqld_safe &amp;</code></pre>
<p>以下はリモートからではなくtermuxのスマホ本体から行ってください。</p>
<pre class="wp-block-code"><code>mysql -u $(whoami)</code></pre>
<p>リモートからDB Toolを使いたいので権限をつけておきます。<strong>リモートホストIP</strong>や、<strong>password</strong>などは程よく読み替えてください。</p>
<pre class="wp-block-code"><code>use mysql;
set password for 'root'@'localhost' = password('<span class="has-inline-color has-vivid-red-color">YOUR_ROOT_PASSWORD_HERE</span>');
GRANT ALL PRIVILEGES ON *.* TO 'root'@'<span class="has-inline-color has-vivid-red-color">192.168.1</span>.%' IDENTIFIED BY '<span class="has-inline-color has-vivid-red-color">YOUR_ROOT_PASSWORD_HERE</span>';
flush privileges;
quit;</code></pre>
<p>リモートのGUIツールから接続テストをしておきます。以下は、macのTablePlusというツールの画面です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="500" height="644" src="/wp-content/uploads/2021/05/Connection___.png" alt="" class="wp-image-10515"></noscript>
<img width="500" height="644" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20500%20644%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/05/Connection___.png" alt="" class="lazyload wp-image-10515"></figure></div>
<p>termuxのsshユーザー名はなんでも良いです。ここでは無指定です。</p>
<p>あと、デフォルトのcharacter-setを指定しておきたい場合は以下のようにします。</p>
<pre class="wp-block-code"><code>vi /data/data/com.termux/files/usr/etc/my.cnf.d/server.cnf</code></pre>
<pre class="wp-block-code"><code>$ cd
&#091;client]
default-character-set = utf8mb4
&#091;mysqld]
character-set-server = utf8mb4</code></pre>
<p>utf8mb4は文字を1〜4byteで取り扱うので、こっちがよろしいかと。</p>
<p>mariadbを再起動しておきます。</p>
<pre class="wp-block-code"><code>$ ps axu | grep mariadb
　※PIDを確認
$ kill 30563
$ mysqld_safe&amp;</code></pre>
<h3>WordPressを動かしてみる</h3>
<p>ほどよくDBを作成して、WEB ROOTにWordpressを展開します。</p>
<pre class="wp-block-code"><code>$ cd
$ wget https://ja.wordpress.org/wordpress-5.7.1-ja.zip
$ unzip wordpress-5.7.1-ja.zip
$ mv wordpress/* htdocs_nginx/
〜省略〜</code></pre>
<p>以下、省略。PHP8環境でのWordPress動作確認は何か気がつけばネタにしたいと思います。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・現状の設定だとコメント投稿がうまく動作しない<br>・ジェットパックのいいね　も動く時と動かない時がある<br>・TermuxのPHPパッケージが8になっていた<br>・WordPressがPHP8で問題ないか確認する<br>・とりあえず、wp5.7.1でプラグインが何もない状態であれば動いているように見える<br>・今、使っているプラグインやテーマを全部突っ込んでみて確認してみる</p>
<h3>あとがき</h3>
<p>サーバ設定とか、ほんとダルいですねー！　最近はインスタンスも１から作る機会なんてだいぶ減ってきているんで、こういう設定とかめんどくさいなーって感じました。AWSもGCCも、ずいぶん楽できる環境が整っているからそう感じるわけで。なんでもリモートできる、良い時代ですね。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p></p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10457" class="post-10457 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/04/22/2021-03-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-04-22T12:55:48+09:00">2021年4月22日</time><time class="updated" datetime="2021-05-18T12:25:41+09:00">2021年5月18日</time></a> </span><span class="posted-on">更新日:2021年5月18日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/04/22/2021-03-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2021/03 site24x7 でのSLA状況・統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>新年度、始まりましたね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>この季節、あったかくて好きだわー</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>リモートで自宅で仕事してるときが一番つらいねw</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>せめて散歩でもして気晴らししないとね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>春ですねー！　めちゃくちゃ暖かくなって外出したいんですが、なかなか世間の事情で旅行とまでは行きませんよね。せめて、散歩くらいはしたいものです。仕事の用事で、東京ー名古屋間をバイクで走ったのですがまだ夜は寒かったです。昼はちょうどいい天気で、めちゃくちゃ気持ちよかったです。</p>
<p>　さて、ちょっと遅れましたが今回も３月のSLA統計データを出しておきます。</p>
<h3>何を目指しているの？</h3>
<blockquote class="wp-block-quote">
<p><em>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</em></p>
<cite><a rel="noreferrer noopener" href="/2020/09/11/wildcard-domain-acme/" target="_blank" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>site24x7の<strong>スターターパック</strong>を2020の10月から始めています。監視サービスでSLAを99.95%目指しています。99.95%とは１ヶ月にダウンタイムが21.6分以内であればOKということですが、１０月から初めて１回しかクリアしていません。今年の２月に達成できたのですが、それ以外はNGINXか、PHPか、何かがメモリーリークしているような現象になります。</p>
<h3>２０２１・０３のSLA</h3>
<p>今月の結果です。障害時間の合計は7 時間 39 分あって、SLAは98.972%となり目標の99.95%には届きませんでした。今月からなのか、site24x7のレポート画面が少し進化したようです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="848" height="669" src="/wp-content/uploads/2021/04/Site24x7.png" alt="" class="wp-image-10458" srcset="/wp-content/uploads/2021/04/Site24x7.png 848w, /wp-content/uploads/2021/04/Site24x7-768x606.png 768w" sizes="(max-width: 848px) 100vw, 848px"></noscript>
<img width="848" height="669" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20848%20669%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/04/Site24x7.png" alt="" class="lazyload wp-image-10458" data-srcset="/wp-content/uploads/2021/04/Site24x7.png 848w, /wp-content/uploads/2021/04/Site24x7-768x606.png 768w" data-sizes="(max-width: 848px) 100vw, 848px"></figure></div>
<p>主な内容はNGINXの「Bad Gateway」問題です。この事象は不定期に発生しますが、必ずOSがフリーズしたような現象になります。おそらくメモリーリークしている感じです。完全にOSが死んでいるわけではなく、かろうじて動作はしています。なぜなら、NGINXはBad Gatewayの応答を出しています。また、thingspeakで、CPU温度や、バッテリー温度をpythonで投げているのですがこれは動作しています。再起動するときに AndroidOSのホームを開こうしても開ません。仕方なく、電源ボタン長押しで強制再起動という感じです。</p>
<h3>どのくらいのアクセス数なの？</h3>
<p>去年の１０月くらいから、pixel3のスマホサーバに引越ししたのですが、アクセス状況はこんな感じです。引越し以前のデータもそれほどかわりません。横ばいといった感じです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="1024" height="411" src="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png" alt="" class="wp-image-10461" srcset="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png 1024w, /wp-content/uploads/2021/04/JunkHack__view-768x308.png 768w, /wp-content/uploads/2021/04/JunkHack__view-984x395.png 984w, /wp-content/uploads/2021/04/JunkHack__view.png 1056w" sizes="(max-width: 1024px) 100vw, 1024px"></noscript>
<img width="1024" height="411" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%201024%20411%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png" alt="" class="lazyload wp-image-10461" data-srcset="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png 1024w, /wp-content/uploads/2021/04/JunkHack__view-768x308.png 768w, /wp-content/uploads/2021/04/JunkHack__view-984x395.png 984w, /wp-content/uploads/2021/04/JunkHack__view.png 1056w" data-sizes="(max-width: 1024px) 100vw, 1024px"></figure></div>
<p>こんなサイトでも3000人くらいのユーザさんが見ているのには驚きです。見ていてくださってる読者さんには感謝ですね。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・時間をなんとか作って、NGINXを新システムに載せ替える<br>・メモリ使用量などOS情報を外部に投げる仕組みを考える</p>
<h3>あとがき</h3>
<p>課題はわかっていて、その調査をするか、代替え策を実行するか、やるべきことはわかっているのですが、腰が重いです。やることが退屈なので、違う面白いことに目がいってしまい、そのうち手をつけたいなと数ヶ月ずっと思っています。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/author/junkhack/page/3/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/author/junkhack/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><link rel="stylesheet" id="word_balloon_user_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_user.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_skin_talk-css" href="/wp-content/plugins/word-balloon/css/skin/word_balloon_talk.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_inview_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_inview.min.css?ver=4.18.4" type="text/css" media="all"> <script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver" id="polyfill_IntersectionObserver-js"></script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_28a76201e8c516d37ffc311e7dc1a025.js"></script>
</body>
</html>