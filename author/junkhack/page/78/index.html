<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>JunkHack &#8211; ページ 78 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; JunkHack による投稿のフィード" href="/author/junkhack/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_923a46d76606f1b43e3f3639ca289d5f.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/users/1">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> </head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged author author-junkhack author-1 paged-78 author-paged-78 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">投稿者: <span>JunkHack</span>
</h1></header><article id="post-891" class="post-891 post type-post status-publish format-standard hentry category-linux category-osx category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/25/nfs-boot/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-25T17:09:06+09:00">2015年7月25日</time></a> </span><span class="posted-on">更新日:2015年7月25日</span> <span class="categories"> <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/osx/" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a>, <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/25/nfs-boot/" rel="bookmark noopener noreferrer" data-wpel-link="internal">NFS Boot に成功した</a></h1></header><div class="entry-content">
<p>とりあえず、NFS Boot は本当にできるのか試してみました。結果、できました。 <br>実際やってみると、いろいろとはまるところがありましたが、おおむね以下の手順。忘れないうちにメモしておきます。</p>
<p>▼環境</p>
<p>NFS Server・・・・osx 10.9.5</p>
<p>Boot OS・・・・・ 2015-05-05-raspbian-wheezy</p>
<p>&#160;</p>
<p>▼操作の流れ</p>
<p>・NFS サーバでシェアする用意</p>
<p>・arm 用の img のルートファイルシステムを NFS へコピー（大体は第２パーティションにあり。Fedora とは3番目）</p>
<p>・SDCard の FATフォーマットの boot の cmdline.txt へ nfs boot する設定と、IP の設定</p>
<p>&#160;</p>
<p>▼osx の NFS Server 側</p>
<p>NFSの設定を入れて、nfsd を再起動。操作はroot でやっています。オンラインマニュアルは<a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man8/nfsd.8.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">ここ<span class="wpel-icon wpel-image wpel-icon-1"></span></a>。</p>
<blockquote><p>&#8212;- /etc/exports <br>/nfs/fedora22 -rw -mapall=root:wheel -network 192.168.1.0 -mask 255.255.255.0</p></blockquote>
<p>exports ファイルがあればnfsd が起動しますが、手動で操作したい場合は</p>
<blockquote><p># nfsd start | stop</p></blockquote>
<p>NFS で提供しているパスの確認。</p>
<blockquote><p># showmount -e localhost <br>Exports list on localhost: <br>/nfs/fedora22&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 192.168.1.0 <br>::</p></blockquote>
<p>最初fedora22 入れようとして、失敗して、RASPIAN 入れたので名前があれですが。</p>
<p>それで、boot したい img をコピー。以下は、centos6.x で、osx の NFS をマウントして、rsync しています。centos6はバーチャルボックスでosx を同じネットワークセグメントにいます。</p>
<blockquote><p>[root@cent66 etc]# df -hT <br>Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Type&#160;&#160;&#160;&#160; Size&#160; Used Avail Use% Mounted on <br>:: <br>hope.junkhack:/exports&#160;&#160;&#160;&#160;&#160;&#160; nfs&#160;&#160;&#160;&#160;&#160; 466G&#160; 390G&#160;&#160; 76G&#160; 84% /nfs <br>hope.junkhack:/nfs/fedora22&#160; nfs&#160;&#160;&#160;&#160;&#160; 466G&#160; 390G&#160;&#160; 76G&#160; 84% /mnt/fedora22</p></blockquote>
<p>hope.junkhack は名前解決できるようにしてあります。ちなみに、fstab はこんな感じのデフォルト。</p>
<blockquote><p>&#8212;- /etc/fstab <br>:: <br>hope.junkhack:/exports&#160;&#160;&#160; /nfs&#160;&#160;&#160;&#160;&#160;&#160;&#160; nfs&#160;&#160;&#160;&#160;&#160;&#160;&#160; defaults&#160;&#160;&#160; 0 0 <br>hope.junkhack:/nfs/fedora22&#160;&#160;&#160; /mnt/fedora22&#160;&#160;&#160; nfs&#160;&#160;&#160;&#160;&#160;&#160;&#160; defaults&#160;&#160;&#160; 0 0</p></blockquote>
<p>で、RASPIAN のイメージをマウント。</p>
<blockquote>
<p>[root@cent66 RASPBIAN]# kpartx -av 2015-05-05-raspbian-wheezy.img <br>add map loop0p1 (253:2): 0 114688 linear /dev/loop0 8192 <br>add map loop0p2 (253:3): 0 6277120 linear /dev/loop0 122880</p>
<p>[root@cent66 RASPBIAN]# mount /dev/mapper/loop0p2 /mnt/raspi/</p>
<p>[root@cent66 RASPBIAN]# df -h <br>Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Size&#160; Used Avail Use% Mounted on <br>:: <br>hope.junkhack:/exports&#160;&#160;&#160;&#160;&#160;&#160;&#160; 466G&#160; 388G&#160;&#160; 78G&#160; 84% /nfs <br>hope.junkhack:/nfs/fedora22&#160;&#160; 466G&#160; 388G&#160;&#160; 78G&#160; 84% /mnt/fedora22 <br>/dev/mapper/loop0p2&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 3.0G&#160; 2.4G&#160; 451M&#160; 85% /mnt/raspi <br>[root@cent66 RASPBIAN]#</p>
</blockquote>
<p>で、コピー。</p>
<blockquote>
<p>[root@cent66 RASPBIAN]# rsync -av /mnt/raspi/ /mnt/fedora22/ <br>sending incremental file list <br>./ <br>bin/ <br>bin/bash <br>bin/bunzip2</p>
<p>::</p>
<p>var/spool/cron/crontabs/ <br>var/spool/rsyslog/ <br>var/tmp/</p>
<p>sent 2304687346 bytes&#160; received 1293752 bytes&#160; 4274293.05 bytes/sec <br>total size is 2299569061&#160; speedup is 1.00 <br>[root@cent66 RASPBIAN]#</p>
<p>&#160;</p>
</blockquote>
<p>で、NFS でブートするときに fstab の中がそのままだと、SD カードのパーティションをchroot してしまうのでコメントアウト。</p>
<blockquote>
<p>[root@cent66 etc]# vim fstab</p>
<p>proc&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /proc&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; proc&#160;&#160;&#160; defaults&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 0 <br>/dev/mmcblk0p1&#160; /boot&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vfat&#160;&#160;&#160; defaults&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 2 <br>#/dev/mmcblk0p2&#160; /&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ext4&#160;&#160;&#160; defaults,noatime&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 1</p>
</blockquote>
<p>NFS側のイメージ展開は以上で終わり。</p>
<p>&#160;</p>
<p>▼Boot するcmdline.txt の中に以下を追加</p>
<blockquote><p>root=/dev/nfs rootfstype=nfs nfsroot=192.168.1.17:/nfs/fedora22,udp,vers=3,nolock ip=192.168.1.24:192.168.1.17:192.168.1.1:255.255.255.0:rpi:eth0:off</p></blockquote>
<p>nolock のオプションは必要ないかもしれません。とりあえず、これで動いてはいます。IPのところは以下の書式。</p>
<blockquote><p>ip=&lt;raspberrypi_ip&gt;:&lt;nfs_server_ip&gt;:&lt;default_gateway&gt;:&lt;mask&gt;:rpi:eth0:off</p></blockquote>
<p>シリアルコンソールのブートログは、</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">[    4.638898] smsc95xx 1-1.1:1.0 eth0: link up, 100Mbps, full-duplex, lpa 0xC5E1

[    4.674857] IP-Config: Complete:

[    4.680180]      device=eth0, hwaddr=b8:27:eb:97:45:fb, ipaddr=192.168.1.24, mask=255.255.255.0, gw=192.168.1.1

[    4.694694]      host=rpi, domain=, nis-domain=(none)

[    4.701878]      bootserver=192.168.1.17, rootserver=192.168.1.17, rootpath=

[    4.719859] VFS: Mounted root (nfs filesystem) readonly on device 0:14.

[    4.729328] devtmpfs: mounted

[    4.735147] Freeing unused kernel memory: 400K (80786000 - 807ea000)

[    5.132474] random: nonblocking pool is initialized

[    6.228285] udevd[177]: starting version 175



Raspbian GNU/Linux 7 pi ttyAMA0



pi login: </pre>
<p>となっています。</p>
<p>NFS Boot させたあと、uname したら、</p>
<blockquote>
<p>root@pi:~# uname -a<br> <br>Linux pi 4.0.7-v7+ #801 SMP PREEMPT Tue Jun 30 18:38:23 BST 2015 armv7l GNU/Linux</p>
<p>root@pi:~#</p>
</blockquote>
<p>げ、fedora の initramfs からブートしてます。SDCard の boot は、初回にスクリプトで作ったやつだった。。。。</p>
<blockquote>
<p>root@pi:/boot# ll *.img<br> <br>-rwxr-xr-x 1 root root 39176850 Jul&#160; 4 17:40 initramfs-0-rescue-18b4f0b4546f49828e1ef5e652cc7b9a.img</p>
<p>-rwxr-xr-x 1 root root 16475761 Jul&#160; 4 17:36 initramfs-4.0.6-300.fc22.armv7hl+lpae.img</p>
<p>-rwxr-xr-x 1 root root&#160; 3987856 Jul&#160; 2 23:35 kernel7.img</p>
<p>-rwxr-xr-x 1 root root&#160; 4016696 Jul&#160; 2 23:35 kernel.img</p>
<p>root@pi:/boot#</p>
</blockquote>
<p>たぶん、RASPIAN のimg の boot からやれば、良いはず。まだ試していませんが。</p>
<p>df はこんな感じで、ルートがnfs になっています。76Gも空きがあるー（osx 側のディスクですが）</p>
<blockquote>
<p>root@pi:~# df -hT<br> <br>Filesystem&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Type&#160;&#160;&#160;&#160;&#160; Size&#160; Used Avail Use% Mounted on</p>
<p>192.168.1.17:/nfs/fedora22 nfs&#160;&#160;&#160;&#160;&#160;&#160; 466G&#160; 390G&#160;&#160; 76G&#160; 84% /</p>
<p>devtmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; devtmpfs&#160; 459M&#160;&#160;&#160;&#160; 0&#160; 459M&#160;&#160; 0% /dev</p>
<p>tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmpfs&#160;&#160;&#160;&#160;&#160; 93M&#160; 216K&#160;&#160; 93M&#160;&#160; 1% /run</p>
<p>tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmpfs&#160;&#160;&#160;&#160; 5.0M&#160;&#160;&#160;&#160; 0&#160; 5.0M&#160;&#160; 0% /run/lock</p>
<p>tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; tmpfs&#160;&#160;&#160;&#160; 186M&#160;&#160;&#160;&#160; 0&#160; 186M&#160;&#160; 0% /run/shm</p>
<p>/dev/mmcblk0p1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; vfat&#160;&#160;&#160;&#160;&#160; 200M&#160;&#160; 98M&#160; 102M&#160; 50% /boot</p>
</blockquote>
<p>このままだと、モジュールを読み込んでいないので使えませんが、、、</p>
<blockquote>
<p>root@pi:~# lsmod<br> <br>Module&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Size&#160; Used by</p>
<p>root@pi:~# ll /lib/modules/</p>
<p>total 8</p>
<p>drwxr-xr-x 14 root root 476 May&#160; 6 22:22 3.18.11+</p>
<p>drwxr-xr-x 14 root root 476 May&#160; 6 22:22 3.18.11-v7+</p>
<p>root@pi:~#</p>
</blockquote>
<p>Boot の img を RASPBIAN のに入れ替えて、リブート</p>
<blockquote>
<p>[root@pi ~ 07/25 20:40:51]# ll /boot/*.img<br> <br>-rwxr-xr-x 1 root root 3930004 Apr 27 13:40 /boot/kernel7.img</p>
<p>-rwxr-xr-x 1 root root 3974884 Apr 27 13:40 /boot/kernel.img</p>
</blockquote>
<p>これでkernel も ローダブルモジュールもOK な感じ。</p>
<blockquote>
<p>[root@pi ~ 07/25 20:41:40]# uname -a<br> <br>Linux pi 3.18.11-v7+ #781 SMP PREEMPT Tue Apr 21 18:07:59 BST 2015 armv7l GNU/Linux</p>
<p>[root@pi ~ 07/25 20:44:14]# lsmod</p>
<p>Module&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Size&#160; Used by</p>
<p>cfg80211&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 386508&#160; 0</p>
<p>rfkill&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16651&#160; 1 cfg80211</p>
<p>rpcsec_gss_krb5&#160;&#160;&#160;&#160;&#160;&#160;&#160; 20958&#160; 0</p>
<p>nfsd&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 263569&#160; 2</p>
<p>snd_bcm2835&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 18649&#160; 0</p>
<p>snd_pcm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 73475&#160; 1 snd_bcm2835</p>
<p>snd_seq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 53078&#160; 0</p>
<p>snd_seq_device&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5628&#160; 1 snd_seq</p>
<p>snd_timer&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 17784&#160; 2 snd_pcm,snd_seq</p>
<p>snd&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 51038&#160; 5 snd_bcm2835,snd_timer,snd_pcm,snd_seq,snd_seq_device</p>
<p>8192cu&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 528365&#160; 0</p>
<p>joydev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8879&#160; 0</p>
<p>evdev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 9950&#160; 2</p>
<p>uio_pdrv_genirq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2958&#160; 0</p>
<p>uio&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8119&#160; 1 uio_pdrv_genirq</p>
</blockquote>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-886" class="post-886 post type-post status-publish format-standard hentry category-filesystem category-linux"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/24/aufse381a8e3818b/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-24T06:49:46+09:00">2015年7月24日</time></a> </span><span class="posted-on">更新日:2015年7月24日</span> <span class="categories"> <a href="/category/filesystem/" rel="category tag noopener noreferrer" data-wpel-link="internal">FileSystem</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/24/aufse381a8e3818b/" rel="bookmark noopener noreferrer" data-wpel-link="internal">AUFSとか</a></h1></header><div class="entry-content">
<p>正式名称は、<a href="https://ja.wikipedia.org/wiki/Aufs" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">wiki<span class="wpel-icon wpel-image wpel-icon-1"></span></a> によるとAnotherUnionFSというのだそうな。</p>
<p>Docker とかにも使われているそうで、こんなわかりやすいページがあった。</p>
<blockquote>
<p>Dockerイメージの差分管理についてまとめてみた</p>
<p><a title="http://tanksuzuki.com/post/docker-image-filesystem/" href="http://tanksuzuki.com/post/docker-image-filesystem/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://tanksuzuki.com/post/docker-image-filesystem/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>Docker とかは、見聞きしたことはあるんだけども、実際に使ったことはなくどんなものなのかはよく知りません。</p>
<p>一言でいえば、</p>
<blockquote><p>異なるファイルシステムのファイルやディレクトリを透過的に重ねて、ひとつのファイルツリーを構成できるファイルシステム</p></blockquote>
<p>ということのようです。BerryBoot のファイルシステムはまさにこれのようですね。このカーネルをあげてchroot すれば最新に追随できそうな感じです。この週末はそんなことにチャレンジしてみるか、気分一新、工作に手を出すかですね。</p>
<p>ほんと、知らないことがたくさんがたくさんありますね。奥が深いというか、知れば知るほど、深みにはまるというか。</p>
<p>NFS でルートファイルシステムをブートさせる記事があったので、</p>
<blockquote>
<p>raspberryPiをNFSで起動する</p>
<p><a title="http://takuya-1st.hatenablog.jp/entry/2014/10/14/002617" href="http://takuya-1st.hatenablog.jp/entry/2014/10/14/002617" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://takuya-1st.hatenablog.jp/entry/2014/10/14/002617<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<blockquote>
<p>Boot Raspberry Pi over NFS</p>
<p><a title="http://www.whaleblubber.ca/boot-raspberry-pi-nfs/" href="http://www.whaleblubber.ca/boot-raspberry-pi-nfs/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://www.whaleblubber.ca/boot-raspberry-pi-nfs/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>とりあえず、これを週末に実験してみますか。</p>
<p>&#160;</p>
<p>ちょっとづつこのあたりは、永続的に押さえていこうかと思います。RasPi をゲットしなければこういうことも、ずっと知らないままだったのかもしれないことを考えると、価値があったと思います。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-883" class="post-883 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/berryboot-e381ae-kernel/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T22:28:52+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/berryboot-e381ae-kernel/" rel="bookmark noopener noreferrer" data-wpel-link="internal">BerryBoot の kernel で起動してるってこと？</a></h1></header><div class="entry-content">
<p>ここのところ、Fedora21 – 22 ばっかりを触っていまして、オフィシャルのRaspbian からちょっと離れていました。</p>
<p>で、Raspbian の image も BerryBoot 用に変換しようと思い、見てみると BerryBoot でインストールするオフィシャルの Raspbian は、2015 年の2 月に作成されています。</p>
<p>&#160;</p>
<p> ん？ これはちょっと古いやつですかね？オフィシャルの最新は、リリースノートを見ると、</p>
<blockquote>
<p><a title="http://downloads.raspberrypi.org/raspbian/release_notes.txt" href="http://downloads.raspberrypi.org/raspbian/release_notes.txt" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://downloads.raspberrypi.org/raspbian/release_notes.txt<span class="wpel-icon wpel-image wpel-icon-1"></span></a> <br>2015-05-05: <br>&#160; * Updated UI changes <br>&#160; * Updated firmware <br>&#160; * Install raspberrypi-net-mods <br>&#160; * Install avahi-daemon <br>&#160; * Add user pi to new i2c and spi groups <br>&#160; * Modified udev rules for i2c and spi devices <br>2015-02-16: <br>&#160; * Newer firmware with various fixes <br>&#160; * New Sonic Pi release <br>&#160; * Pi2 compatible RPi.GPIO <br>&#160; * Updated Wolfram Mathematica <br>2015-01-31: <br>&#160; * Support for Pi2 <br>&#160; * Newer firmware <br>&#160; * New Sonic Pi release <br>&#160; * Updated Scratch <br>&#160; * New Wolfram Mathematica release <br>&#160; * Updated Epiphany</p>
<p>：：</p>
</blockquote>
<p>とやっているようです。なので、変換してiscsi boot に入れてみました。いろんなバージョンを入れ替えできるので、便利です。(と、このときは思っていまいたが、、、）</p>
<p>img 変換の手順はメモしたのを見ながら、やればあんなに苦労したのに、あっさり。手順書っていうのは大切ですね。</p>
<p>&#160;</p>
<p>恒例のUnixBench は以下のようでした。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: pi: GNU/Linux
   OS: GNU/Linux -- 3.18.10v7-aufs -- #1 SMP PREEMPT Wed Apr 1 00:07:44 CEST 2015
   Machine: armv7l (unknown)
   Language: en_US.utf8 (charmap=&quot;ANSI_X3.4-1968&quot;, collate=&quot;ANSI_X3.4-1968&quot;)
   CPU 0: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 1: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 2: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 3: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   20:41:56 up 7 min,  2 users,  load average: 0.61, 0.18, 0.07; runlevel 2

------------------------------------------------------------------------
Benchmark Run: 月  7月 20 2015 20:41:56 - 21:10:14
4 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables        3316993.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                      554.5 MWIPS (10.0 s, 7 samples)
Execl Throughput                                491.3 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks         49985.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           13538.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        149986.5 KBps  (30.0 s, 2 samples)
Pipe Throughput                              207549.3 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  37800.2 lps   (10.0 s, 7 samples)
Process Creation                               1425.8 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1298.1 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    332.3 lpm   (60.1 s, 2 samples)
System Call Overhead                         459612.1 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0    3316993.9    284.2
Double-Precision Whetstone                       55.0        554.5    100.8
Execl Throughput                                 43.0        491.3    114.2
File Copy 1024 bufsize 2000 maxblocks          3960.0      49985.5    126.2
File Copy 256 bufsize 500 maxblocks            1655.0      13538.4     81.8
File Copy 4096 bufsize 8000 maxblocks          5800.0     149986.5    258.6
Pipe Throughput                               12440.0     207549.3    166.8
Pipe-based Context Switching                   4000.0      37800.2     94.5
Process Creation                                126.0       1425.8    113.2
Shell Scripts (1 concurrent)                     42.4       1298.1    306.1
Shell Scripts (8 concurrent)                      6.0        332.3    553.8
System Call Overhead                          15000.0     459612.1    306.4
                                                                   ========
System Benchmarks Index Score                                         174.7

------------------------------------------------------------------------
Benchmark Run: 月  7月 20 2015 21:10:14 - 21:39:00
4 CPUs in system; running 4 parallel copies of tests

Dhrystone 2 using register variables       12869914.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     2212.6 MWIPS (10.0 s, 7 samples)
Execl Throughput                               1143.7 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks         69133.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           18287.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        220513.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                              802846.4 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 139871.0 lps   (10.0 s, 7 samples)
Process Creation                               3197.1 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   2636.1 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    347.5 lpm   (60.3 s, 2 samples)
System Call Overhead                        1719885.8 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   12869914.9   1102.8
Double-Precision Whetstone                       55.0       2212.6    402.3
Execl Throughput                                 43.0       1143.7    266.0
File Copy 1024 bufsize 2000 maxblocks          3960.0      69133.5    174.6
File Copy 256 bufsize 500 maxblocks            1655.0      18287.4    110.5
File Copy 4096 bufsize 8000 maxblocks          5800.0     220513.0    380.2
Pipe Throughput                               12440.0     802846.4    645.4
Pipe-based Context Switching                   4000.0     139871.0    349.7
Process Creation                                126.0       3197.1    253.7
Shell Scripts (1 concurrent)                     42.4       2636.1    621.7
Shell Scripts (8 concurrent)                      6.0        347.5    579.2
System Call Overhead                          15000.0    1719885.8   1146.6
                                                                   ========
System Benchmarks Index Score                                         406.7</pre>
<p>&#160;</p>
<p>まぁ、OS が変わったからといって劇的に変化があるわけじゃないんですが。</p>
<p>CPUのFREQは、</p>
<blockquote>
<p>root@pi:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq<br> <br>1000000★</p>
<p>root@pi:~# uname -a</p>
<p>Linux pi 3.18.10v7-aufs #1 SMP PREEMPT Wed Apr 1 00:07:44 CEST 2015 armv7l GNU/Linux</p>
<p>root@pi:~#</p>
</blockquote>
<p>ん？ 今気が付いたんですが、kernel が、BerryBoot のaufs のなんですが？</p>
<blockquote>
<p>root@pi:/mnt# lsmod<br> <br>Module&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Size&#160; Used by</p>
<p>cfg80211&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 366024&#160; 0</p>
<p>rfkill&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14438&#160; 1 cfg80211</p>
<p>snd_bcm2835&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 17419&#160; 0</p>
<p>snd_pcm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 68808&#160; 1 snd_bcm2835</p>
<p>snd_seq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 49800&#160; 0</p>
<p>snd_seq_device&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4906&#160; 1 snd_seq</p>
<p>snd_timer&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16630&#160; 2 snd_pcm,snd_seq</p>
<p>snd&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 47011&#160; 5 snd_bcm2835,snd_timer,snd_pcm,snd_seq,snd_seq_device</p>
<p>evdev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 9303&#160; 2</p>
<p>joydev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8397&#160; 0</p>
<p>uio_pdrv_genirq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2865&#160; 0</p>
<p>uio&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 7319&#160; 1 uio_pdrv_genirq</p>
<p>iscsi_tcp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8496&#160; 2</p>
<p>libiscsi_tcp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11808&#160; 1 iscsi_tcp</p>
<p>libiscsi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 33727&#160; 2 libiscsi_tcp,iscsi_tcp</p>
<p>root@pi:/mnt#</p>
<p>root@pi:/mnt#</p>
<p>root@pi:/mnt# cat /proc/modules</p>
<p>cfg80211 366024 0 &#8211; Live 0x7f095000</p>
<p>rfkill 14438 1 cfg80211, Live 0x7f08d000</p>
<p>snd_bcm2835 17419 0 &#8211; Live 0x7f084000</p>
<p>snd_pcm 68808 1 snd_bcm2835, Live 0x7f06b000</p>
<p>snd_seq 49800 0 &#8211; Live 0x7f058000</p>
<p>snd_seq_device 4906 1 snd_seq, Live 0x7f053000</p>
<p>snd_timer 16630 2 snd_pcm,snd_seq, Live 0x7f04a000</p>
<p>snd 47011 5 snd_bcm2835,snd_pcm,snd_seq,snd_seq_device,snd_timer, Live 0x7f037000</p>
<p>evdev 9303 2 &#8211; Live 0x7f02b000</p>
<p>joydev 8397 0 &#8211; Live 0x7f025000</p>
<p>uio_pdrv_genirq 2865 0 &#8211; Live 0x7f021000</p>
<p>uio 7319 1 uio_pdrv_genirq, Live 0x7f01c000</p>
<p>iscsi_tcp 8496 2 &#8211; Live 0x7f015000</p>
<p>libiscsi_tcp 11808 1 iscsi_tcp, Live 0x7f00e000</p>
<p>libiscsi 33727 2 iscsi_tcp,libiscsi_tcp, Live 0x7f000000</p>
<p>root@pi:/mnt#</p>
</blockquote>
<p>uBoot で BerryBoot のiSCSIが有効になっているカーネルからchrootするときにこれって変えれるんだろうか？</p>
<p>FATフォーマットのconfig.txt は次のようになっています。</p>
<blockquote>
<p>disable_overscan=1<br> <br>start_x=1</p>
<p>gpu_mem=128</p>
<p># Berryboot settings, do not change<br> <br>initramfs berryboot.img</p>
<p>[pi2]<br> <br>kernel=kernel_rpi2_aufs.img</p>
<p>arm_freq_min=900</p>
<p>arm_freq=1000</p>
<p>core_freq_min=450</p>
<p>core_freq=500</p>
<p>sdram_freq=500</p>
<p>over_voltage=2</p>
<p>[pi1]<br> <br>kernel=kernel_rpi_aufs.img</p>
<p>cma_lwm=16</p>
<p>cma_hwm=32</p>
<p>cma_offline_start=16</p>
</blockquote>
<p>起動しているカーネルは、kernel_rpi2_aufs.img っていうことですね。そのカーネルからルートファイルシステムにchroot する感じだと思うのですが、img 作るときに、/lib/modules/ 配下を入れていないので、こうなるんですかね？</p>
<p>kernel_rpi2_aufs.img の中がどうなっているのか気になりますね。そもそも、raspai がブートする仕組みっていうのがどうゆう流れになっているかを把握しないとだめですね。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-881" class="post-881 post type-post status-publish format-standard hentry category-blog"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/fedora22-lxde-e38292-pi2/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T06:24:25+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/blog/" rel="category tag noopener noreferrer" data-wpel-link="internal">Blog</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/fedora22-lxde-e38292-pi2/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Fedora22 LXDE を Pi2 で動かして納得</a></h1></header><div class="entry-content">
<p>ログイン出来ない対処を、img ファイルを作成するときにroot の初期パスワードを埋めたものを作成し、ログインできました。</p>
<p>LXDE は軽くていいですね。Pi で動かすのは、このくらいの動きじゃないと使えないです。一番初めに入れたFedora22 Workstation は重過ぎて無謀でした。Pi には荷が重過ぎる感じ。</p>
<p></p>
<noscript><img title="panel_と_lxsession_と_タスクマネージャ" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="panel_と_lxsession_と_タスクマネージャ" src="/wp-content/uploads/2015/07/panel__lxsession__.png" width="581" height="480"></noscript>
<img class="lazyload" title="panel_と_lxsession_と_タスクマネージャ" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="panel_と_lxsession_と_タスクマネージャ" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20581%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/07/panel__lxsession__.png" width="581" height="480"><p>とりあえず、野良ビルドのimg じゃなく、オフィシャルのイメージから作成して動作させる手順はわかったので、これから本来のPi いじりに励みます。まぁ、これもPiいじりですがね。</p>
<p>&#160;</p>
<p>ちょっと自分にはまだ難しい分野ですが、BerryBoot の作りを参考に、組み込み用のKernel と GUI 画面を使った GPIO いじりの工作を今後考えていこうと思います。いろいろと覚えることがたくさんあるとは思いますが、少しづつ理解に励むようがんばりますか。</p>
<p>今回作り方の参考になったのは、SquashFS をルートファイルとして読み出して、それをなんらかの方法で、書き込みするルートファイルシステムを作り出している部分です。こんな実装方法があるとは夢にも思いませんでした。あと、モジュールもBerryboot が持っているのを使ってchroot している感じです。</p>
<p>&#160;</p>
<p> BerryBoot を１からビルドしてみることで、また新たな発見があるかもしれません。LinuxOS を読み込まず（ramには展開していますが）GUI 画面を表示している良い参考例です。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-875" class="post-875 post type-post status-publish format-standard hentry category-osx"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/extfs/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T03:54:17+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/osx/" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/extfs/" rel="bookmark noopener noreferrer" data-wpel-link="internal">ExtFSのマウント指定</a></h1></header><div class="entry-content">
<p>osx に、Pragon ExtFS を入れている場合、マウントのタイプに指定するオプションは、以下のようです。</p>
<p>iSCSI デバイスをReadOnly でマウントしたかった時にタイプ指定が不明だったのでめも。ext2,3,4 の判別は Pragon ExtFS がやってくれる模様。</p>
<blockquote>
<p>$ sudo mkdir /Volumes/berryboot <br>$ sudo mount -r -t ufsd_ExtFS /dev/disk3s1 /Volumes/berryboot</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^^^^^^^</p>
</blockquote>
<p></p>
<noscript><img title="osxreadonly" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="osxreadonly" src="/wp-content/uploads/2015/07/osxreadonly.png" width="266" height="546"></noscript>
<img class="lazyload" title="osxreadonly" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="osxreadonly" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20266%20546%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/07/osxreadonly.png" width="266" height="546"><p>扱えるタイプは、以下。NTFS や ext2,3,4 は Paragon のに依存しています。osx 標準じゃありませんので。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ ll /System/Library/Filesystems/
total 8
drwxr-xr-x  6 root  wheel  204 12 20  2014 AppleShare
drwxr-xr-x  7 root  wheel  238 12 20  2014 NetFSPlugins
drwxr-xr-x  4 root  wheel  136  5 30  2014 acfs.fs
lrwxr-xr-x  1 root  wheel   49 12 20  2014 afpfs.fs -&gt; /System/Library/Filesystems/AppleShare/afpfs.kext
drwxr-xr-x  3 root  wheel  102  6  4  2014 cd9660.fs
drwxr-xr-x  3 root  wheel  102  6  4  2014 cddafs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 exfat.fs
drwxr-xr-x  5 root  wheel  170  8 25  2013 ftp.fs
drwxr-xr-x  5 root  wheel  170 12 20  2014 hfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 msdos.fs
drwxr-xr-x  3 root  wheel  102  8 25  2013 nfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 ntfs.fs
drwxr-xr-x  3 root  wheel  102  6  4  2014 smbfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 udf.fs
drwxr-xr-x  3 root  wheel  102 11 12  2014 ufsd_ExtFS.fs
drwxr-xr-x  3 root  wheel  102  9  9  2013 ufsd_NTFS.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 webdav.fs</pre>
<p>&#160;</p>
<p>ちなみに、Finderがマウント解除するときに、/Volumes/以下に作ったディレクトリも削除してくれるようです。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-873" class="post-873 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/fedora22/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T01:08:37+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/fedora22/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Fedora22-LXDEのインストール後ログイン不可</a></h1></header><div class="entry-content">
<p>以前、Fedora22 の minimam を SDCard に入れて動かしたとき、初期に出るウィザードがうまく動作していない挙動があって、SDCard の中を Linux マシンでマウントさせ shadow や sudo設定や、passwd 、ホームディレクトリとbash設定をしてやっとログインできたのを思い出しました。</p>
<p>&#160;</p>
<p> 詳細は追っていないので、どこに問題があるのかわかりませんが、挙動から初期ウィザードがうまく動作していない様子です。今回、Fedora22-LXDEを BerryBoot の img に変換したわけですが、うまくログインできたFedora22-Workstationの中と比べてみました。</p>
<p>&#160;</p>
<p>以下は、iSCSI Boot しているディスクのトップディレクトリ以下の構造です。</p>
<blockquote><p>▼Fedora22-Workstation インストール後の boot disk の中身 <br>$ tree -L 4 &#8211;filelimit 30 <br>. <br>├── data <br>│&#160;&#160; └── Fedora22-Workstation-berryboot.img <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── etc <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.keys <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── cups <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── group <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── group- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── gshadow <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── gshadow- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ld.so.cache <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── locale.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── localtime -&gt; ../usr/share/zoneinfo/Asia/Tokyo <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── passwd <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── passwd- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── pki <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── resolv.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── shadow <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── shadow- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── udev <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── home <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── pi <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── tmp <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── tracker-extract-files.1000 <br>│&#160;&#160;&#160;&#160;&#160;&#160; └── var <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── cache <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── log <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── spool <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; └── tmp <br>├── images <br>│&#160;&#160; └── Fedora22-Workstation-berryboot.img <br>::</p></blockquote>
<blockquote><p>▼Fedora22-LXDE インストール後の boot disk の中身 <br>$ tree -L 4 &#8211;filelimit 30 <br>. <br>├── data <br>│&#160;&#160; └── Fedora22-LXDE-berryboot.img <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── etc <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.keys <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── hostname <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ld.so.cache <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── pki <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── resolv.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ssh <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── systemd <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── udev <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── python2.7 <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── systemd <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── root <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── tmp <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── anaconda.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ifcfg.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── packaging.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── program.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── sensitive-info.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── storage.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; └── var <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── cache <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── log <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── spool <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; └── tmp <br>├── images <br>│&#160;&#160; └── Fedora22-LXDE-berryboot.img <br>::</p></blockquote>
<p>data ディレクトリ配下に、img にはないものが書き出されているようです。両者を比較してみますと、初期ウィザードで作られてもおかしくないファイルがごっそりありません。</p>
<p> 試しに、必要なものをコピーして起動してみましが、元の状態に書き換わってしまいます。BerryBoot がルートファイルシステムにchroot するときか、それ以前かわかりませんが、何かチェックサムか何か見ているのでしょう。</p>
<p>&#160;</p>
<p> さて、どうしますかね。シングルユーザモードで起動する方法も試してみましたが、BerryBoot.img の 中のinitを追わないと、kernel に渡す引数がどうなっているのかわかりません。前回、<a href="/2015/07/18/berryboot-img-%E3%81%AE%E4%B8%AD%E3%82%92%E3%81%AE%E3%81%9E%E3%81%84%E3%81%A6%E3%81%BF%E3%81%9F/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">berryboot.img の中をのぞいてみた</a> ではちょっと見ただけで処理を追ったわけじゃないので。</p>
<p>&#160;</p>
<p>・・・・・・・・さて、方法は以下のような対処が考えられそうです。</p>
<p>１）berryboot.img の処理を追って、シングルユーザモードで起動させる方法があるか見極める。なければ、作る。</p>
<p>２）Fedora22 のimg を作る段階で、初期ユーザなどの設定を入れてしまう。</p>
<p>３）Fedora22 の minimam や LXDE などの配布イメージの初期ウィザードがなぜ動作しないか追う</p>
<p>&#160;</p>
<p>３が正等な方法ですが、気力がわいてこないので、１か、２で対応しようと思っていますが、これも気力がわいてこない。一番お手軽なのは、２なので、やる気が沸いてくるまで、他のことを考えようかと思います。</p>
<p>&#160;</p>
<p>ふぅ。いろいろありますね～。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/author/junkhack/page/79/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/author/junkhack/page/77/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_b6c6c7d2c47bd5f86199fb6f5207fc2e.js"></script>
</body>
</html>