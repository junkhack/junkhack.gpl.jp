<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="//feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; Yahoo フィード" href="//feed/yahoo/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; SmartNews フィード" href="//feed/smartnews/">
<link rel="manifest" href="/wp-content/themes/jh-hew/manifest.json">
<link rel="apple-touch-icon" href="/wp-content/themes/jh-hew/img/apple-touch-icon180.png" sizes="180x180">
<meta name="theme-color" content="#FAD641">
<meta name="apple-mobile-web-app-title" content="JunkHack">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default"> <script>if ('serviceWorker' in navigator) {
	window.addEventListener('load', function () {
		navigator.serviceWorker.register('/sw.js').then(
			function (registration) {
				console.log('ServiceWorker registration successful with scope: ', registration.scope);
			},
			function (err) {
				console.log('ServiceWorker registration failed: ', err);
			}
		);
	});
}</script> <title>JunkHack &#8211; ページ 79 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; JunkHack による投稿のフィード" href="/author/junkhack/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.9.3" type="text/css" media="all">
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}</style>
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/plugins/wp-external-links/public/css/wpel.css?ver=2.51" type="text/css" media="all">
<link rel="stylesheet" id="mouse-css" href="/wp-content/plugins/wp-keypopup-algolia/mouse.css?ver=5.9.3" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/plugins/ccrw_related/css/frontend-style.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="JankHack-Hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/themes/jh-hew/genericons/genericons.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="JankHack-Hew-style-css" href="/wp-content/themes/jh-hew/style.css?ver=5.9.3" type="text/css" media="all">
<link rel="stylesheet" id="algolia-autocomplete-css" href="/wp-content/plugins/wp-search-with-algolia/css/algolia-autocomplete.css?ver=2.2.0" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script> <script type="text/javascript" src="/wp-content/plugins/wp-keypopup-algolia/mousetrap.min.js?ver=5.9.3" id="mice-js"></script> <script type="text/javascript" id="mouse-js-extra">var mouse = {"home":"\/","list":"\/list\/","search":"\/s\/"};</script> <script type="text/javascript" src="/wp-content/plugins/wp-keypopup-algolia/mouse.js?ver=5.9.3" id="mouse-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/users/1">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.9.3">
<meta name="generator" content="Site Kit by Google 1.75.0">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com"> <style>.algolia-search-highlight {
				background-color: #fffbcc;
				border-radius: 2px;
				font-style: normal;
			}</style> <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> </head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged author author-junkhack author-1 paged-79 author-paged-79 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-9" class="widget widget_block"><p><script async="" src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script></p>
<div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">投稿者: <span>JunkHack</span>
</h1></header><article id="post-883" class="post-883 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/berryboot-e381ae-kernel/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T22:28:52+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/berryboot-e381ae-kernel/" rel="bookmark noopener noreferrer" data-wpel-link="internal">BerryBoot の kernel で起動してるってこと？</a></h1></header><div class="entry-content">
<p>ここのところ、Fedora21 – 22 ばっかりを触っていまして、オフィシャルのRaspbian からちょっと離れていました。</p>
<p>で、Raspbian の image も BerryBoot 用に変換しようと思い、見てみると BerryBoot でインストールするオフィシャルの Raspbian は、2015 年の2 月に作成されています。</p>
<p>&#160;</p>
<p> ん？ これはちょっと古いやつですかね？オフィシャルの最新は、リリースノートを見ると、</p>
<blockquote>
<p><a title="http://downloads.raspberrypi.org/raspbian/release_notes.txt" href="http://downloads.raspberrypi.org/raspbian/release_notes.txt" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://downloads.raspberrypi.org/raspbian/release_notes.txt<span class="wpel-icon wpel-image wpel-icon-1"></span></a> <br>2015-05-05: <br>&#160; * Updated UI changes <br>&#160; * Updated firmware <br>&#160; * Install raspberrypi-net-mods <br>&#160; * Install avahi-daemon <br>&#160; * Add user pi to new i2c and spi groups <br>&#160; * Modified udev rules for i2c and spi devices <br>2015-02-16: <br>&#160; * Newer firmware with various fixes <br>&#160; * New Sonic Pi release <br>&#160; * Pi2 compatible RPi.GPIO <br>&#160; * Updated Wolfram Mathematica <br>2015-01-31: <br>&#160; * Support for Pi2 <br>&#160; * Newer firmware <br>&#160; * New Sonic Pi release <br>&#160; * Updated Scratch <br>&#160; * New Wolfram Mathematica release <br>&#160; * Updated Epiphany</p>
<p>：：</p>
</blockquote>
<p>とやっているようです。なので、変換してiscsi boot に入れてみました。いろんなバージョンを入れ替えできるので、便利です。(と、このときは思っていまいたが、、、）</p>
<p>img 変換の手順はメモしたのを見ながら、やればあんなに苦労したのに、あっさり。手順書っていうのは大切ですね。</p>
<p>&#160;</p>
<p>恒例のUnixBench は以下のようでした。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: pi: GNU/Linux
   OS: GNU/Linux -- 3.18.10v7-aufs -- #1 SMP PREEMPT Wed Apr 1 00:07:44 CEST 2015
   Machine: armv7l (unknown)
   Language: en_US.utf8 (charmap=&quot;ANSI_X3.4-1968&quot;, collate=&quot;ANSI_X3.4-1968&quot;)
   CPU 0: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 1: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 2: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   CPU 3: ARMv7 Processor rev 5 (v7l) (0.0 bogomips)
          
   20:41:56 up 7 min,  2 users,  load average: 0.61, 0.18, 0.07; runlevel 2

------------------------------------------------------------------------
Benchmark Run: 月  7月 20 2015 20:41:56 - 21:10:14
4 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables        3316993.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                      554.5 MWIPS (10.0 s, 7 samples)
Execl Throughput                                491.3 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks         49985.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           13538.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        149986.5 KBps  (30.0 s, 2 samples)
Pipe Throughput                              207549.3 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  37800.2 lps   (10.0 s, 7 samples)
Process Creation                               1425.8 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1298.1 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    332.3 lpm   (60.1 s, 2 samples)
System Call Overhead                         459612.1 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0    3316993.9    284.2
Double-Precision Whetstone                       55.0        554.5    100.8
Execl Throughput                                 43.0        491.3    114.2
File Copy 1024 bufsize 2000 maxblocks          3960.0      49985.5    126.2
File Copy 256 bufsize 500 maxblocks            1655.0      13538.4     81.8
File Copy 4096 bufsize 8000 maxblocks          5800.0     149986.5    258.6
Pipe Throughput                               12440.0     207549.3    166.8
Pipe-based Context Switching                   4000.0      37800.2     94.5
Process Creation                                126.0       1425.8    113.2
Shell Scripts (1 concurrent)                     42.4       1298.1    306.1
Shell Scripts (8 concurrent)                      6.0        332.3    553.8
System Call Overhead                          15000.0     459612.1    306.4
                                                                   ========
System Benchmarks Index Score                                         174.7

------------------------------------------------------------------------
Benchmark Run: 月  7月 20 2015 21:10:14 - 21:39:00
4 CPUs in system; running 4 parallel copies of tests

Dhrystone 2 using register variables       12869914.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     2212.6 MWIPS (10.0 s, 7 samples)
Execl Throughput                               1143.7 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks         69133.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           18287.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        220513.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                              802846.4 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 139871.0 lps   (10.0 s, 7 samples)
Process Creation                               3197.1 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   2636.1 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    347.5 lpm   (60.3 s, 2 samples)
System Call Overhead                        1719885.8 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   12869914.9   1102.8
Double-Precision Whetstone                       55.0       2212.6    402.3
Execl Throughput                                 43.0       1143.7    266.0
File Copy 1024 bufsize 2000 maxblocks          3960.0      69133.5    174.6
File Copy 256 bufsize 500 maxblocks            1655.0      18287.4    110.5
File Copy 4096 bufsize 8000 maxblocks          5800.0     220513.0    380.2
Pipe Throughput                               12440.0     802846.4    645.4
Pipe-based Context Switching                   4000.0     139871.0    349.7
Process Creation                                126.0       3197.1    253.7
Shell Scripts (1 concurrent)                     42.4       2636.1    621.7
Shell Scripts (8 concurrent)                      6.0        347.5    579.2
System Call Overhead                          15000.0    1719885.8   1146.6
                                                                   ========
System Benchmarks Index Score                                         406.7</pre>
<p>&#160;</p>
<p>まぁ、OS が変わったからといって劇的に変化があるわけじゃないんですが。</p>
<p>CPUのFREQは、</p>
<blockquote>
<p>root@pi:~# cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq<br> <br>1000000★</p>
<p>root@pi:~# uname -a</p>
<p>Linux pi 3.18.10v7-aufs #1 SMP PREEMPT Wed Apr 1 00:07:44 CEST 2015 armv7l GNU/Linux</p>
<p>root@pi:~#</p>
</blockquote>
<p>ん？ 今気が付いたんですが、kernel が、BerryBoot のaufs のなんですが？</p>
<blockquote>
<p>root@pi:/mnt# lsmod<br> <br>Module&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Size&#160; Used by</p>
<p>cfg80211&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 366024&#160; 0</p>
<p>rfkill&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14438&#160; 1 cfg80211</p>
<p>snd_bcm2835&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 17419&#160; 0</p>
<p>snd_pcm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 68808&#160; 1 snd_bcm2835</p>
<p>snd_seq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 49800&#160; 0</p>
<p>snd_seq_device&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4906&#160; 1 snd_seq</p>
<p>snd_timer&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 16630&#160; 2 snd_pcm,snd_seq</p>
<p>snd&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 47011&#160; 5 snd_bcm2835,snd_timer,snd_pcm,snd_seq,snd_seq_device</p>
<p>evdev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 9303&#160; 2</p>
<p>joydev&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8397&#160; 0</p>
<p>uio_pdrv_genirq&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2865&#160; 0</p>
<p>uio&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 7319&#160; 1 uio_pdrv_genirq</p>
<p>iscsi_tcp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8496&#160; 2</p>
<p>libiscsi_tcp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11808&#160; 1 iscsi_tcp</p>
<p>libiscsi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 33727&#160; 2 libiscsi_tcp,iscsi_tcp</p>
<p>root@pi:/mnt#</p>
<p>root@pi:/mnt#</p>
<p>root@pi:/mnt# cat /proc/modules</p>
<p>cfg80211 366024 0 &#8211; Live 0x7f095000</p>
<p>rfkill 14438 1 cfg80211, Live 0x7f08d000</p>
<p>snd_bcm2835 17419 0 &#8211; Live 0x7f084000</p>
<p>snd_pcm 68808 1 snd_bcm2835, Live 0x7f06b000</p>
<p>snd_seq 49800 0 &#8211; Live 0x7f058000</p>
<p>snd_seq_device 4906 1 snd_seq, Live 0x7f053000</p>
<p>snd_timer 16630 2 snd_pcm,snd_seq, Live 0x7f04a000</p>
<p>snd 47011 5 snd_bcm2835,snd_pcm,snd_seq,snd_seq_device,snd_timer, Live 0x7f037000</p>
<p>evdev 9303 2 &#8211; Live 0x7f02b000</p>
<p>joydev 8397 0 &#8211; Live 0x7f025000</p>
<p>uio_pdrv_genirq 2865 0 &#8211; Live 0x7f021000</p>
<p>uio 7319 1 uio_pdrv_genirq, Live 0x7f01c000</p>
<p>iscsi_tcp 8496 2 &#8211; Live 0x7f015000</p>
<p>libiscsi_tcp 11808 1 iscsi_tcp, Live 0x7f00e000</p>
<p>libiscsi 33727 2 iscsi_tcp,libiscsi_tcp, Live 0x7f000000</p>
<p>root@pi:/mnt#</p>
</blockquote>
<p>uBoot で BerryBoot のiSCSIが有効になっているカーネルからchrootするときにこれって変えれるんだろうか？</p>
<p>FATフォーマットのconfig.txt は次のようになっています。</p>
<blockquote>
<p>disable_overscan=1<br> <br>start_x=1</p>
<p>gpu_mem=128</p>
<p># Berryboot settings, do not change<br> <br>initramfs berryboot.img</p>
<p>[pi2]<br> <br>kernel=kernel_rpi2_aufs.img</p>
<p>arm_freq_min=900</p>
<p>arm_freq=1000</p>
<p>core_freq_min=450</p>
<p>core_freq=500</p>
<p>sdram_freq=500</p>
<p>over_voltage=2</p>
<p>[pi1]<br> <br>kernel=kernel_rpi_aufs.img</p>
<p>cma_lwm=16</p>
<p>cma_hwm=32</p>
<p>cma_offline_start=16</p>
</blockquote>
<p>起動しているカーネルは、kernel_rpi2_aufs.img っていうことですね。そのカーネルからルートファイルシステムにchroot する感じだと思うのですが、img 作るときに、/lib/modules/ 配下を入れていないので、こうなるんですかね？</p>
<p>kernel_rpi2_aufs.img の中がどうなっているのか気になりますね。そもそも、raspai がブートする仕組みっていうのがどうゆう流れになっているかを把握しないとだめですね。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-881" class="post-881 post type-post status-publish format-standard hentry category-blog"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/fedora22-lxde-e38292-pi2/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T06:24:25+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/blog/" rel="category tag noopener noreferrer" data-wpel-link="internal">Blog</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/fedora22-lxde-e38292-pi2/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Fedora22 LXDE を Pi2 で動かして納得</a></h1></header><div class="entry-content">
<p>ログイン出来ない対処を、img ファイルを作成するときにroot の初期パスワードを埋めたものを作成し、ログインできました。</p>
<p>LXDE は軽くていいですね。Pi で動かすのは、このくらいの動きじゃないと使えないです。一番初めに入れたFedora22 Workstation は重過ぎて無謀でした。Pi には荷が重過ぎる感じ。</p>
<p><img title="panel_と_lxsession_と_タスクマネージャ" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="panel_と_lxsession_と_タスクマネージャ" src="/wp-content/uploads/2015/07/panel__lxsession__.png" width="581" height="480"></p>
<p>とりあえず、野良ビルドのimg じゃなく、オフィシャルのイメージから作成して動作させる手順はわかったので、これから本来のPi いじりに励みます。まぁ、これもPiいじりですがね。</p>
<p>&#160;</p>
<p>ちょっと自分にはまだ難しい分野ですが、BerryBoot の作りを参考に、組み込み用のKernel と GUI 画面を使った GPIO いじりの工作を今後考えていこうと思います。いろいろと覚えることがたくさんあるとは思いますが、少しづつ理解に励むようがんばりますか。</p>
<p>今回作り方の参考になったのは、SquashFS をルートファイルとして読み出して、それをなんらかの方法で、書き込みするルートファイルシステムを作り出している部分です。こんな実装方法があるとは夢にも思いませんでした。あと、モジュールもBerryboot が持っているのを使ってchroot している感じです。</p>
<p>&#160;</p>
<p> BerryBoot を１からビルドしてみることで、また新たな発見があるかもしれません。LinuxOS を読み込まず（ramには展開していますが）GUI 画面を表示している良い参考例です。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-875" class="post-875 post type-post status-publish format-standard hentry category-osx"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/extfs/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T03:54:17+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/osx/" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/extfs/" rel="bookmark noopener noreferrer" data-wpel-link="internal">ExtFSのマウント指定</a></h1></header><div class="entry-content">
<p>osx に、Pragon ExtFS を入れている場合、マウントのタイプに指定するオプションは、以下のようです。</p>
<p>iSCSI デバイスをReadOnly でマウントしたかった時にタイプ指定が不明だったのでめも。ext2,3,4 の判別は Pragon ExtFS がやってくれる模様。</p>
<blockquote>
<p>$ sudo mkdir /Volumes/berryboot <br>$ sudo mount -r -t ufsd_ExtFS /dev/disk3s1 /Volumes/berryboot</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^^^^^^^</p>
</blockquote>
<p><img loading="lazy" title="osxreadonly" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="osxreadonly" src="/wp-content/uploads/2015/07/osxreadonly.png" width="266" height="546"></p>
<p>扱えるタイプは、以下。NTFS や ext2,3,4 は Paragon のに依存しています。osx 標準じゃありませんので。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ ll /System/Library/Filesystems/
total 8
drwxr-xr-x  6 root  wheel  204 12 20  2014 AppleShare
drwxr-xr-x  7 root  wheel  238 12 20  2014 NetFSPlugins
drwxr-xr-x  4 root  wheel  136  5 30  2014 acfs.fs
lrwxr-xr-x  1 root  wheel   49 12 20  2014 afpfs.fs -&gt; /System/Library/Filesystems/AppleShare/afpfs.kext
drwxr-xr-x  3 root  wheel  102  6  4  2014 cd9660.fs
drwxr-xr-x  3 root  wheel  102  6  4  2014 cddafs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 exfat.fs
drwxr-xr-x  5 root  wheel  170  8 25  2013 ftp.fs
drwxr-xr-x  5 root  wheel  170 12 20  2014 hfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 msdos.fs
drwxr-xr-x  3 root  wheel  102  8 25  2013 nfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 ntfs.fs
drwxr-xr-x  3 root  wheel  102  6  4  2014 smbfs.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 udf.fs
drwxr-xr-x  3 root  wheel  102 11 12  2014 ufsd_ExtFS.fs
drwxr-xr-x  3 root  wheel  102  9  9  2013 ufsd_NTFS.fs
drwxr-xr-x  4 root  wheel  136 12 20  2014 webdav.fs</pre>
<p>&#160;</p>
<p>ちなみに、Finderがマウント解除するときに、/Volumes/以下に作ったディレクトリも削除してくれるようです。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-873" class="post-873 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/20/fedora22/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-20T01:08:37+09:00">2015年7月20日</time></a> </span><span class="posted-on">更新日:2015年7月20日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/20/fedora22/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Fedora22-LXDEのインストール後ログイン不可</a></h1></header><div class="entry-content">
<p>以前、Fedora22 の minimam を SDCard に入れて動かしたとき、初期に出るウィザードがうまく動作していない挙動があって、SDCard の中を Linux マシンでマウントさせ shadow や sudo設定や、passwd 、ホームディレクトリとbash設定をしてやっとログインできたのを思い出しました。</p>
<p>&#160;</p>
<p> 詳細は追っていないので、どこに問題があるのかわかりませんが、挙動から初期ウィザードがうまく動作していない様子です。今回、Fedora22-LXDEを BerryBoot の img に変換したわけですが、うまくログインできたFedora22-Workstationの中と比べてみました。</p>
<p>&#160;</p>
<p>以下は、iSCSI Boot しているディスクのトップディレクトリ以下の構造です。</p>
<blockquote><p>▼Fedora22-Workstation インストール後の boot disk の中身 <br>$ tree -L 4 &#8211;filelimit 30 <br>. <br>├── data <br>│&#160;&#160; └── Fedora22-Workstation-berryboot.img <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── etc <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.keys <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── cups <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── group <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── group- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── gshadow <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── gshadow- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ld.so.cache <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── locale.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── localtime -&gt; ../usr/share/zoneinfo/Asia/Tokyo <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── passwd <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── passwd- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── pki <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── resolv.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── shadow <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── shadow- <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── udev <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── home <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── pi <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── tmp <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── tracker-extract-files.1000 <br>│&#160;&#160;&#160;&#160;&#160;&#160; └── var <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── cache <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── log <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── spool <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; └── tmp <br>├── images <br>│&#160;&#160; └── Fedora22-Workstation-berryboot.img <br>::</p></blockquote>
<blockquote><p>▼Fedora22-LXDE インストール後の boot disk の中身 <br>$ tree -L 4 &#8211;filelimit 30 <br>. <br>├── data <br>│&#160;&#160; └── Fedora22-LXDE-berryboot.img <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── etc <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── chrony.keys <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── hostname <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ld.so.cache <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── pki <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── resolv.conf <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ssh <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── systemd <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── udev <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── python2.7 <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── systemd <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── root <br>│&#160;&#160;&#160;&#160;&#160;&#160; ├── tmp <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── anaconda.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── ifcfg.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── packaging.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── program.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; ├── sensitive-info.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; │&#160;&#160; └── storage.log <br>│&#160;&#160;&#160;&#160;&#160;&#160; └── var <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── cache <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── lib <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── log <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ├── spool <br>│&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; └── tmp <br>├── images <br>│&#160;&#160; └── Fedora22-LXDE-berryboot.img <br>::</p></blockquote>
<p>data ディレクトリ配下に、img にはないものが書き出されているようです。両者を比較してみますと、初期ウィザードで作られてもおかしくないファイルがごっそりありません。</p>
<p> 試しに、必要なものをコピーして起動してみましが、元の状態に書き換わってしまいます。BerryBoot がルートファイルシステムにchroot するときか、それ以前かわかりませんが、何かチェックサムか何か見ているのでしょう。</p>
<p>&#160;</p>
<p> さて、どうしますかね。シングルユーザモードで起動する方法も試してみましたが、BerryBoot.img の 中のinitを追わないと、kernel に渡す引数がどうなっているのかわかりません。前回、<a href="/2015/07/18/berryboot-img-%E3%81%AE%E4%B8%AD%E3%82%92%E3%81%AE%E3%81%9E%E3%81%84%E3%81%A6%E3%81%BF%E3%81%9F/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">berryboot.img の中をのぞいてみた</a> ではちょっと見ただけで処理を追ったわけじゃないので。</p>
<p>&#160;</p>
<p>・・・・・・・・さて、方法は以下のような対処が考えられそうです。</p>
<p>１）berryboot.img の処理を追って、シングルユーザモードで起動させる方法があるか見極める。なければ、作る。</p>
<p>２）Fedora22 のimg を作る段階で、初期ユーザなどの設定を入れてしまう。</p>
<p>３）Fedora22 の minimam や LXDE などの配布イメージの初期ウィザードがなぜ動作しないか追う</p>
<p>&#160;</p>
<p>３が正等な方法ですが、気力がわいてこないので、１か、２で対応しようと思っていますが、これも気力がわいてこない。一番お手軽なのは、２なので、やる気が沸いてくるまで、他のことを考えようかと思います。</p>
<p>&#160;</p>
<p>ふぅ。いろいろありますね～。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-864" class="post-864 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/19/berryboot-e794a8e381aeboot-img/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-19T05:48:24+09:00">2015年7月19日</time></a> </span><span class="posted-on">更新日:2015年7月19日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/19/berryboot-e794a8e381aeboot-img/" rel="bookmark noopener noreferrer" data-wpel-link="internal">BerryBoot 用のBoot img 作成でドはまり</a></h1></header><div class="entry-content">
<p>かなり、ハマッてしまったのでポイントを後ほど、メモしておくことにします。</p>
<p>何にはまったかっていうと、Fedora21 ～ 22 の各種ARM 用のイメージファイルを BerryBoot の img にする手順がうまくいかなくて、以下のようになって、Kernel panic でBoot しないわけで。くじけそうになった最後にやっとできました。</p>
<p>&#160;</p>
<p>オフィシャルの手順は、以下のように紹介されています。</p>
<blockquote>
<p><a href="http://www.berryterminal.com/doku.php/berryboot/adding_custom_distributions" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">Adding your own custom operating systems to the menu<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>$ sudo kpartx -av image_you_want_to_convert.img <br>add map loop0p1 (252:5): 0 117187 linear /dev/loop0 1 <br>add map loop0p2 (252:6): 0 3493888 linear /dev/loop0 118784 <br>$ sudo mount /dev/mapper/loop0p2 /mnt <br>$ sudo sed -i &#8216;s/^\/dev\/mmcblk/#/g&#8217; /mnt/etc/fstab <br>$ sudo mksquashfs /mnt converted_image_for_berryboot.img -comp lzo -e lib/modules <br>$ sudo umount /mnt <br>$ sudo kpartx -d image_you_want_to_convert.img</p>
</blockquote>
<p>実際にやってみると、まぁ、いろいろあるのはいつものこと。</p>
<p>ポイントは、<strong>ルートファイルシステム直下のシンボリックリンクを実態にして、逆側から張りなおすこと！</strong>そうしないと、以下のようになって、RAM ディスクの kernel から、動かす img の ファイルシステムがマウントできません。後ほど、手順をつけておきます。次やるとき、絶対忘れる自信があるので。</p>
<p><img loading="lazy" title="写真" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="写真" src="/wp-content/uploads/2015/07/c1ed947c41a8.jpg" width="640" height="480"></p>
<p>とりあえず出来たので画像メモを貼り付け。</p>
<p><img loading="lazy" title="写真_2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="写真_2" src="/wp-content/uploads/2015/07/22.jpg" width="640" height="480"></p>
<p>で、各種初期設定をすればOK</p>
<p><img loading="lazy" title="写真_1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="写真_1" src="/wp-content/uploads/2015/07/12.jpg" width="640" height="480"></p>
<p>もうね、疲れました。が、ARM の IoT デバイスのノウハウが貯まったということで、少し前進。各ディストリビューションも ARM 用のオフィシャルイメージの準備もしてきているわけですし。野良イメージは怖いので、とりあえずはオフィシャルのを使えるようになったということで、満足。</p>
<p><a href="https://arm.fedoraproject.org/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external"><img loading="lazy" title="Fedora_ARM" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="Fedora_ARM" src="/wp-content/uploads/2015/07/fedora_arm2.png" width="644" height="700"></a> さて、QKして気力、体力も復活したので、忘れないうちにメモしておきます。</p>
<p>オフィシャルの ARM イメージは上のリンクから辿って、以下のようなファイルが落とせます。ファイルサイズの大きい順では、</p>
<blockquote><p>Size byte&#160;&#160; M,GB&#160; FineName <br>&#8212;&#8212;&#8212;-&#160; &#8212;-&#160; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; <br>1194022996&#160; 1.1G&#160; Fedora-Workstation-armhfp-22-3-sda.raw.xz <br>1129186356&#160; 1.1G&#160; Fedora-KDE-armhfp-22-3-sda.raw.xz <br> 837507064&#160; 799M&#160; Fedora-Xfce-armhfp-22-3-sda.raw.xz <br> 761534064&#160; 726M&#160; Fedora-LXDE-armhfp-22-3-sda.raw.xz <br> 552451864&#160; 527M&#160; Fedora-SoaS-armhfp-22-3-sda.raw.xz <br> 427291172&#160; 407M&#160; Fedora-Server-armhfp-22-3-sda.raw.xz <br> 301285980&#160; 287M&#160; Fedora-Minimal-armhfp-22-3-sda.raw.xz</p></blockquote>
<p>となります。</p>
<p>今までは、GUI環境などはまったく無視してきたので、どの環境がよいのかはわかりませんが、下２つはサーバ用途ですので、今回はFedora の代表的な顔である、Workstation を入れてみたいと思います。まぁ、最後は結局全部入れることになるわけですが。</p>
<p>&#160;</p>
<p>さて、今回の手順は、BerryBoot の インストールできる状態のイメージの作成ということですが、今回は、さらに iscsi boot する環境でそれをテストしてみたいと思います。とは、言っても通常のSDカードやUSBデバイス（USBメモリやUSB HDD）に入れるのとそれほど変わりはありません。</p>
<p>前提条件をまとめますと以下のようになります。</p>
<blockquote>
<p>今回の環境</p>
<p>・BerryBoot で、ISCSI Bootの SCSI デバイスにルートを入れる</p>
<p>・BerryBoot 用のimg があれば、インストールはBerryBoot のインスーラーがいれてくれる</p>
<p>・ARM 物理環境は、RasPi2 + 2GB SDCard (実際は250Mもあれば足ります）＋ LAN (WiFi でもいけるようです）</p>
<p>・iSCSI のターゲットは、FreeNAS （この説明は除外）で、仮想環境で提供。本体はosx</p>
<p>・img 作成には、ubuntu 12 を使用</p>
</blockquote>
<p>作業の流れは、以下のようになります。</p>
<blockquote>
<p>1) FedoraのARMオフィシャルサイトより、イメージを取得</p>
<p>2) 圧縮されているので展開し、img の状態に。</p>
<p>3) img の中にあるルートパーティションをマウント</p>
<p>4) ルート直下のシンボリックリンクを修正</p>
<p>5) fstab をコメントアウト</p>
<p>6) lzo 圧縮した BerryBoot 用の img を作成</p>
<p>7) 後処理</p>
</blockquote>
<p><strong>手順 1</strong></p>
<p>ubuntu上で、作業します。</p>
<p>オフィシャルサイトより、イメージをゲット。全部 root でやってますので、sudo は付けていません。</p>
<blockquote>
<p># wget https://download.fedoraproject.org/pub/fedora/linux/releases/22/Workstation/armhfp/Images/Fedora-Workstation-armhfp-22-3-sda.raw.xz</p>
<p><a href="http://ftp.iij.ad.jp/pub/linux/fedora/releases/22/Workstation/armhfp/Images/Fedora-Workstation-Images-armhfp-22-CHECKSUM" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">CHECKSUM<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p># sha256sum Fedora-Workstation-armhfp-22-3-sda.raw.xz</p>
<p> ※sum を確認</p>
</blockquote>
<p><strong>手順 2</strong></p>
<p>ファイルは何なのか確認。</p>
<blockquote><p># file Fedora-Workstation-armhfp-22-3-sda.raw.xz <br>Fedora-Workstation-armhfp-22-3-sda.raw.xz: XZ compressed data</p></blockquote>
<p>XZ 圧縮なので、xzcat で展開して、img とします。</p>
<blockquote><p># xzcat -v Fedora-Workstation-armhfp-22-3-sda.raw.xz &gt; Fedora-Workstation-armhfp-22-3-sda.img</p></blockquote>
<p>速ければ、1分ちょいくらいです。</p>
<p><strong>手順 3</strong></p>
<p>img ファイルの中のルートファイルシステムをマウントします。kpartx だと簡単ですが、無い環境用に、手動でやる方法も書いておきます。kpartx -a で、イメージファイルの中のパーティションをブロックデバイスに割付ます。</p>
<blockquote><p># kpartx -av Fedora-Workstation-armhfp-22-3-sda.img <br>add map loop0p1 (252:0): 0 999424 linear /dev/loop0 2048 <br>add map loop0p2 (252:1): 0 1000482 linear /dev/loop0 1001472 <br>add map loop0p3 (252:2): 0 9765625 linear /dev/loop0 2001954★ここをマウント</p></blockquote>
<blockquote><p># mkdir /mnt/fedora22 <br># mount /dev/mapper/loop0p3 /mnt/fedora22/</p></blockquote>
<p>確認します。</p>
<blockquote><p># ll /mnt/fedora22/ <br>合計 92 <br>dr-xr-xr-x.&#160; 18 root root&#160; 4096&#160; 5月 22 04:00 ./ <br>drwxr-xr-x&#160;&#160;&#160; 3 root root&#160; 4096&#160; 7月 19 09:39 ../ <br>lrwxrwxrwx.&#160;&#160; 1 root root&#160;&#160;&#160;&#160; 7&#160; 8月 16&#160; 2014 bin -&gt; usr/bin/ <br>drwxrwxr-x.&#160;&#160; 2 root root&#160; 4096&#160; 5月 22 03:58 boot/ <br>drwxr-xr-x.&#160;&#160; 4 root root&#160; 4096&#160; 5月 22 04:14 dev/ <br>drwxr-xr-x. 126 root root 12288&#160; 5月 22 04:28 etc/ <br>drwxr-xr-x.&#160;&#160; 2 root root&#160; 4096&#160; 8月 16&#160; 2014 home/ <br>lrwxrwxrwx.&#160;&#160; 1 root root&#160;&#160;&#160;&#160; 7&#160; 8月 16&#160; 2014 lib -&gt; usr/lib/ <br>drwx&#8212;&#8212;.&#160;&#160; 2 root root 16384&#160; 5月 22 03:58 lost+found/ <br>drwxr-xr-x.&#160;&#160; 2 root root&#160; 4096&#160; 8月 16&#160; 2014 media/ <br>drwxr-xr-x.&#160;&#160; 2 root root&#160; 4096&#160; 8月 16&#160; 2014 mnt/ <br>drwxr-xr-x.&#160;&#160; 2 root root&#160; 4096&#160; 8月 16&#160; 2014 opt/ <br>drwxrwxr-x.&#160;&#160; 2 root root&#160; 4096&#160; 5月 22 03:58 proc/ <br>dr-xr-x&#8212;.&#160;&#160; 2 root root&#160; 4096&#160; 5月 22 04:28 root/ <br>drwxr-xr-x.&#160; 32 root root&#160; 4096&#160; 5月 22 04:12 run/ <br>lrwxrwxrwx.&#160;&#160; 1 root root&#160;&#160;&#160;&#160; 8&#160; 8月 16&#160; 2014 sbin -&gt; usr/sbin/ <br>drwxr-xr-x.&#160;&#160; 2 root root&#160; 4096&#160; 8月 16&#160; 2014 srv/ <br>drwxrwxr-x.&#160;&#160; 2 root root&#160; 4096&#160; 5月 22 03:58 sys/ <br>drwxrwxrwt.&#160;&#160; 7 root root&#160; 4096&#160; 5月 22 04:28 tmp/ <br>drwxr-xr-x.&#160; 11 root root&#160; 4096&#160; 5月 22 04:00 usr/ <br>drwxr-xr-x.&#160; 21 root root&#160; 4096&#160; 5月 22 04:12 var/</p></blockquote>
<p>kpartx が無い場合は、以下で。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">        ▼パーティションのサイズを調べて、個別にマウントさせる
        # parted Fedora-Xfce-armhfp-22-3-sda.img 
        GNU Parted 2.3
        /nfs/Fedora-Xfce-armhfp-22-3-sda.img を使用
        GNU Parted へようこそ！ コマンド一覧を見るには 'help' と入力してください。
        (parted) u★
        単位は?  [compact]? b★
        (parted) print★
        モデル:  (file)
        ディスク /nfs/Fedora-Xfce-armhfp-22-3-sda.img: 4743757824B
        セクタサイズ (論理/物理): 512B/512B
        パーティションテーブル: msdos
        
        番号  開始         終了         サイズ       タイプ   ファイルシステム  フラグ
         1    1048576B     512753663B   511705088B   primary  ext3
         2    512753664B   1025000447B  512246784B   primary  linux-swap(v1)
         3    1025000448B  4525000191B  3499999744B  primary  ext4
              ^^^^^^^^^^
        (parted) q★
        root@ubu:/nfs# 
        
        # mount -o loop,offset=1025000448 Fedora-Xfce-armhfp-22-3-sda.img /mnt/fedora22
                               ^^^^^^^^^^※ B は取ってね
        # df -h
        Filesystem              Size  Used Avail Use% Mounted on
        ::
        /dev/loop1              3.2G  2.3G  843M  74% /mnt/fedora22</pre>
<p><strong>手順 4</strong></p>
<p>ルート直下のシンボリックリンクを修正します。理屈はよくわかっていませんが、逆から張りなおすことでとりあえずブートしています。lib と bin と sbin を消して、実体を移動させ、逆からシンボリックを張っています。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">cd /mnt/fedora22
rm lib
mv usr/lib lib
cd usr
ln -s ../lib lib
cd ../

rm bin
mv usr/bin bin
cd usr
ln -s ../bin bin
cd ../

rm sbin
mv usr/sbin sbin
cd usr
ln -s ../sbin sbin
cd ../</pre>
<p>以下のような感じになっているはずです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;"># ll
合計 240
dr-xr-xr-x.  21 root root  4096  7月 19 09:53 ./
drwxr-xr-x    3 root root  4096  7月 19 09:39 ../
dr-xr-xr-x.   2 root root 36864  5月 22 04:12 bin/
drwxrwxr-x.   2 root root  4096  5月 22 03:58 boot/
drwxr-xr-x.   4 root root  4096  5月 22 04:14 dev/
drwxr-xr-x. 126 root root 12288  5月 22 04:28 etc/
drwxr-xr-x.   2 root root  4096  8月 16  2014 home/
dr-xr-xr-x. 181 root root 86016  5月 22 04:14 lib/
drwx------.   2 root root 16384  5月 22 03:58 lost+found/
drwxr-xr-x.   2 root root  4096  8月 16  2014 media/
drwxr-xr-x.   2 root root  4096  8月 16  2014 mnt/
drwxr-xr-x.   2 root root  4096  8月 16  2014 opt/
drwxrwxr-x.   2 root root  4096  5月 22 03:58 proc/
dr-xr-x---.   2 root root  4096  5月 22 04:28 root/
drwxr-xr-x.  32 root root  4096  5月 22 04:12 run/
dr-xr-xr-x.   2 root root 20480  5月 22 04:12 sbin/
drwxr-xr-x.   2 root root  4096  8月 16  2014 srv/
drwxrwxr-x.   2 root root  4096  5月 22 03:58 sys/
drwxrwxrwt.   7 root root  4096  5月 22 04:28 tmp/
drwxr-xr-x.   8 root root  4096  7月 19 09:53 usr/
drwxr-xr-x.  21 root root  4096  5月 22 04:12 var/</pre>
<p>&#160;</p>
<p>手順 5</p>
<p>fstab をコメントアウトします。</p>
<p>以下のような感じで、UUID で記載されていますが、全部コメントアウト。</p>
<blockquote>
<p># cat /mnt/fedora22/etc/fstab<br> <br>UUID=81bc2e15-c125-40c0-94fd-33550a50db1b&#160; / ext4&#160;&#160;&#160; defaults,noatime 0 0</p>
<p>UUID=5dd5c069-20ed-421c-a521-d7fc71746def&#160; /boot ext3&#160;&#160;&#160; defaults,noatime 0 0</p>
<p>UUID=2d570411-d640-491b-9b38-4ba9d8ed6ada&#160; swap swap&#160;&#160;&#160; defaults,noatime 0 0</p>
</blockquote>
<p>vi でもいいです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">sed -i 's/^UUID/#UUID/g' /mnt/fedora22/etc/fstab</pre>
<p>確認。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;"># cat /mnt/fedora22/etc/fstab
#UUID=81bc2e15-c125-40c0-94fd-33550a50db1b  / ext4    defaults,noatime 0 0
#UUID=5dd5c069-20ed-421c-a521-d7fc71746def  /boot ext3    defaults,noatime 0 0
#UUID=2d570411-d640-491b-9b38-4ba9d8ed6ada  swap swap    defaults,noatime 0 0</pre>
<p>&#160;</p>
<p><strong>手順 6</strong></p>
<p>mksquashfs を使って lzo 圧縮した BerryBoot 用の img を作成します。</p>
<p># cd /tmp</p>
<p># mksquashfs /mnt/fedora22/ _berryboot.img -comp lzo -e lib/modules</p>
<p># mv _berryboot.img Fedora22-Workstation-berryboot.img</p>
<p>このイメージをFAT16 フォーマットのUSBメモリに入れて、BerryBoot を起動。インターネットインストールをキャンセルして、Add OS を長押しクリックするとサブメニューからUSB を選択できます。</p>
<p>&#160;</p>
<p>手順 7</p>
<p>マウント解除し、kpartxで作ったデバイスを削除し、基のイメージファイルも削除。</p>
<blockquote>
<p># umount /mnt/fedora22<br> <br># kpartx -d Fedora-Workstation-armhfp-22-3-sda.img</p>
<p>loop deleted : /dev/loop0</p>
<p>&#160;</p>
<p># rm Fedora-Workstation-armhfp-22-3-sda.*</p>
</blockquote>
<p>おつかれさまです。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-857" class="post-857 post type-post status-publish format-standard hentry category-raspberry-pi"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/07/18/berryboot-img/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-07-18T16:02:38+09:00">2015年7月18日</time></a> </span><span class="posted-on">更新日:2015年7月18日</span> <span class="categories"> <a href="/category/raspberry-pi/" rel="category tag noopener noreferrer" data-wpel-link="internal">Raspberry Pi</a></span>
</div>
<h1 class="entry-title"><a href="/2015/07/18/berryboot-img/" rel="bookmark noopener noreferrer" data-wpel-link="internal">berryboot.img の中をのぞいてみた</a></h1></header><div class="entry-content">
<p>berryboot の作りをもう少し見たかったので、起動するboot img をばらして覗いてみました。手順は絶対忘れるのでメモしておきます。</p>
<p>&#160;</p>
<p>作業は、osx でやっています。 <br>とりあえず、作業用にRAMディスクを作っておきます。 <br>作業は、RAMディスクの中じゃなくてもいいんですが、何かと速くて間違えなくて便利なので、自分用のメモの意味をあって書いています。独立したファイルシステムにフォーマットすることも簡単ですしね。</p>
<p>osx でRAMディスクを作成するには、</p>
<blockquote><p>$ diskutil eraseDisk HFS+ RAMDISK `hdiutil attach -nomount ram://8388608`</p></blockquote>
<p>この例では、ディスクサイズは8388608（4096 * 2048）で4GB のRAMディスクとしています。</p>
<p>コマンドラインがいやな場合は、RAMDiskCreator というツールをFlorian Bognerさんが公開しているので使ってみてください。</p>
<p><img loading="lazy" title="a" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="a" src="/wp-content/uploads/2015/07/a1.png" width="386" height="254"></p>
<p> <img loading="lazy" title="_Applications" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="_Applications" src="/wp-content/uploads/2015/07/applications.png" width="355" height="307"></p>
<p align="center"><a href="https://bogner.sh/2012/12/os-x-create-a-ram-disk-the-easy-way/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">RAMDiskCreator 1.2<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>&#160;</p>
<p><img loading="lazy" title="aa" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="aa" src="/wp-content/uploads/2015/07/aa.png" width="171" height="138"></p>
<p>これ以下は、Linux でも同じなはずです。</p>
<p>file で berriboot.img を見ると、u-boot の uImage のようです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ file berryboot.img 
berryboot.img: u-boot legacy uImage, , Linux/ARM, RAMDisk Image (Not compressed), 10112736 bytes, Wed Apr  1 07:32:40 2015, Load Address: 0x00000000, Entry Point: 0x00000000, Header CRC: 0xAB28A904, Data CRC: 0x6870C48E</pre>
<p>これは調べてみると、以下のようにすることで展開できるようです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ dd if=berryboot.img bs=64 skip=1 of=berryboot_initrd
158011+1 records in
158011+1 records out
10112736 bytes transferred in 0.315515 secs (32051518 bytes/sec)</pre>
<p>先頭64bite に属性情報があるようで、それを飛ばして DD してやればよいようです。再度、file で見てみると、</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ file berryboot_initrd 
berryboot_initrd: gzip compressed data, was &quot;rootfs.cpio&quot;, from Unix, last modified: Wed Apr  1 07:32:37 2015, max compression</pre>
<p>cpio のようです。tmp ディレクトリを作成後、そこに展開してみます。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ mkdir tmp
$ cd tmp/
$ cpio -idm &lt; ../berryboot_initrd</pre>
<p>うまく展開されたようです。</p>
<p>init では以下のようなことをしているようです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">---- /init
#!/bin/sh
#
# BerryBoot, ugly but functional image chooser thingy
#
# Author: Floris Bos
#

# Standard busybox init
/bin/mount -t proc proc /proc
/bin/mount -o remount,rw,noatime / 
/bin/mount -t sysfs sysfs /sys
/bin/mount -t devtmpfs dev /dev
/bin/hostname -F /etc/hostname

if grep -q debugconsole /proc/cmdline; then
    /sbin/getty -L tty2 0 vt100 &amp;
fi

if grep -q &quot;mmc0_led&quot; /proc/cmdline; then
    if [ -e /sys/class/leds/ph20:green:led1 ]; then
        echo mmc0 &gt; /sys/class/leds/ph20:green:led1/trigger
    fi
fi

if grep -q vncinstall /proc/cmdline; then
    export QWS_DISPLAY=&quot;VNC:size=800x600:depth=32:0&quot;
    echo
    echo Connect with your VNC client
    echo If you wish to disable VNC mode: remove 'vncinstall' from cmdline.txt
    echo
fi

# Show GUI, it will write the OS choosen to /tmp/answer
/usr/bin/BerrybootGUI -qws 2&gt;/tmp/debug 

# Clear screen
clear

IMAGE=`cat /tmp/answer`
DATADIR=&quot;/mnt/data/$IMAGE&quot;
rm /tmp/answer

#
# Set CPU governor to &quot;ondemand&quot; when booting an OS on the Pi
# Set it to &quot;performance&quot; for other devices
#
if grep -q &quot;BCM2708&quot; /proc/cpuinfo; then
    GOVERNOR=ondemand
else
    GOVERNOR=performance
fi

if [ &quot;$IMAGE&quot; != &quot;&quot; ]; then
    mkdir -p /squashfs /aufs $DATADIR
    clear
    echo Mounting image ${IMAGE}...
    mount -o loop &quot;/mnt/images/$IMAGE&quot; /squashfs
    cd /squashfs

    if [ -e berryboot-init ]; then
        echo Executing init script
        . berryboot-init
    fi

    if [ -L lib -o -L sbin ]; then
        echo
        echo Error: having a symlink for /lib and/or /sbin inside your image is not allowed!
        echo This conflicts with the shared AUFS folders
        echo
        sleep 5
    fi

    for initfile in sbin/init usr/lib/systemd/systemd init
    do
        if [ -e $initfile ]; then
            echo Mounting RW data directory on top
            mount -t aufs -o br:${DATADIR}:/mnt/shared:/squashfs none /aufs
            cd /aufs
            mount -o move /dev dev
            mount -o move /sys sys
            mount -o move /proc proc
            echo Setting CPU governor to $GOVERNOR
            echo &quot;$GOVERNOR&quot; &gt; sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
            echo Starting operating system ${IMAGE}...
            exec switch_root . $initfile
        fi
    done

    echo
    echo Error: unable to locate or execute /sbin/init /usr/lib/systemd/systemd /init inside $IMAGE
    echo
    sleep 5
fi

# In case the user pressed cancel or something went wrong, show an emergency recovery shell
clear
echo
echo Emergency recovery shell activated
echo

/bin/sh</pre>
<p>cmdline に mmc0_led があると、何か green にしているようですね。筐体のLED を緑にしているんですかね？ あとで試してみます。vncinstall があると、環境変数QWS_DISPLAYにVNC のパラメータがセットされるようです。VNC インストールができるということですかね。あとで、試してみることに。</p>
<p>ちょっと勉強になりました。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/author/junkhack/page/80/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/author/junkhack/page/78/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="mouse"><div class="inner">
<h1>Search</h1>
<form class="uagb-search-wrapper" role="search" action="/" method="get"><div class="uagb-search-form__container" role="tablist"> <input placeholder="Search" class="uagb-search-form__input aa-input" id="searchbox" type="search" name="s" title="Search" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="width: 80%;"><pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: &quot;Open Sans&quot;, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: 400; word-spacing: 0px; letter-spacing: normal; text-indent: 0px; text-rendering: auto; text-transform: none;">
                            </pre>
</div></form>
<table><tr>
<td class="divide"><table>
<tr>
<td>
<span class="cmd">g</span> <span class="thn">then</span> <span class="cmd">h</span>
</td>
<td><span class="help">&rarr; home</span></td>
<td>Go to front page</td>
</tr>
<tr>
<td>
<span class="cmd">g</span> <span class="thn">then</span> <span class="cmd">l</span>
</td>
<td><span class="help">&rarr; list</span></td>
<td>Go to List page</td>
</tr>
<tr>
<td>
<span class="cmd">g</span> <span class="thn">then</span> <span class="cmd">s</span>
</td>
<td><span class="help">&rarr; search</span></td>
<td>Go to Search page</td>
</tr>
</table></td>
<td class="divide"><table>
<tr>
<td><span class="cmd">/ or esc</span></td>
<td><span class="help">&rarr; search</span></td>
<td>Toggle , Close the search box</td>
</tr>
<tr>
<td><span class="cmd">.</span></td>
<td><span class="help">&rarr; Focus</span></td>
<td>Focus the search box</td>
</tr>
<tr>
<td><span class="cmd">Mouse Click</span></td>
<td><span class="help">&rarr; unFocus</span></td>
<td>unFocus the search box</td>
</tr>
</table></td>
</tr></table>
</div></div>
<div id="wpfront-scroll-top-container"> <img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <script type="text/javascript">var algolia = {"debug":false,"application_id":"8DCPU3VRUU","search_api_key":"052e9cca1df4182ec607663dc893c235","powered_by_enabled":true,"query":"","autocomplete":{"sources":[{"index_id":"posts_post","index_name":"wp_posts_post","label":"投稿","admin_name":"投稿","position":10,"max_suggestions":10,"tmpl_suggestion":"autocomplete-post-suggestion","enabled":true}],"input_selector":"input[name='s']:not('.no-autocomplete')"},"indices":{"searchable_posts":{"name":"wp_searchable_posts","id":"searchable_posts","enabled":true,"replicas":[]},"posts_post":{"name":"wp_posts_post","id":"posts_post","enabled":true,"replicas":[]}}};</script> <script type="text/html" id="tmpl-autocomplete-header"><div class="autocomplete-header">
		<div class="autocomplete-header-title">{{{ data.label }}}</div>
		<div class="clear"></div>
	</div></script> <script type="text/html" id="tmpl-autocomplete-post-suggestion"><a class="suggestion-link" href="{{ data.permalink }}" title="{{ data.post_title }}">
		<# if ( data.images.thumbnail ) { #>
			<img class="suggestion-post-thumbnail" src="{{ data.images.thumbnail.url }}" alt="{{ data.post_title }}">
		<# } #>
		<div class="suggestion-post-attributes">
			<span class="suggestion-post-title">{{{ data._highlightResult.post_title.value }}}</span>
			<# if ( data._snippetResult['content'] ) { #>
				<span class="suggestion-post-content">{{{ data._snippetResult['content'].value }}}</span>
			<# } #>
		</div>
	</a></script> <script type="text/html" id="tmpl-autocomplete-term-suggestion"><a class="suggestion-link" href="{{ data.permalink }}" title="{{ data.name }}">
		<svg viewBox="0 0 21 21" width="21" height="21">
			<svg width="21" height="21" viewBox="0 0 21 21">
				<path
					d="M4.662 8.72l-1.23 1.23c-.682.682-.68 1.792.004 2.477l5.135 5.135c.7.693 1.8.688 2.48.005l1.23-1.23 5.35-5.346c.31-.31.54-.92.51-1.36l-.32-4.29c-.09-1.09-1.05-2.06-2.15-2.14l-4.3-.33c-.43-.03-1.05.2-1.36.51l-.79.8-2.27 2.28-2.28 2.27zm9.826-.98c.69 0 1.25-.56 1.25-1.25s-.56-1.25-1.25-1.25-1.25.56-1.25 1.25.56 1.25 1.25 1.25z"
					fill-rule="evenodd"></path>
			</svg>
		</svg>
		<span class="suggestion-post-title">{{{ data._highlightResult.name.value }}}</span>
	</a></script> <script type="text/html" id="tmpl-autocomplete-user-suggestion"><a class="suggestion-link user-suggestion-link" href="{{ data.posts_url }}" title="{{ data.display_name }}">
		<# if ( data.avatar_url ) { #>
			<img class="suggestion-user-thumbnail" src="{{ data.avatar_url }}" alt="{{ data.display_name }}">
		<# } #>
		<span class="suggestion-post-title">{{{ data._highlightResult.display_name.value }}}</span>
	</a></script> <script type="text/html" id="tmpl-autocomplete-footer"><div class="autocomplete-footer">
		<div class="autocomplete-footer-branding">
			<a href="#" class="algolia-powered-by-link" title="Algolia">
				<svg width="130" viewbox="0 0 130 18" xmlns="http://www.w3.org/2000/svg">
					<title>Search by Algolia</title>
					<defs>
						<lineargradient x1="-36.868%" y1="134.936%" x2="129.432%" y2="-27.7%" id="a">
							<stop stop-color="#00AEFF" offset="0%"></stop>
							<stop stop-color="#3369E7" offset="100%"></stop>
						</lineargradient>
					</defs>
					<g fill="none" fill-rule="evenodd">
						<path d="M59.399.022h13.299a2.372 2.372 0 0 1 2.377 2.364V15.62a2.372 2.372 0 0 1-2.377 2.364H59.399a2.372 2.372 0 0 1-2.377-2.364V2.381A2.368 2.368 0 0 1 59.399.022z" fill="url(#a)"></path>
						<path d="M66.257 4.56c-2.815 0-5.1 2.272-5.1 5.078 0 2.806 2.284 5.072 5.1 5.072 2.815 0 5.1-2.272 5.1-5.078 0-2.806-2.279-5.072-5.1-5.072zm0 8.652c-1.983 0-3.593-1.602-3.593-3.574 0-1.972 1.61-3.574 3.593-3.574 1.983 0 3.593 1.602 3.593 3.574a3.582 3.582 0 0 1-3.593 3.574zm0-6.418v2.664c0 .076.082.131.153.093l2.377-1.226c.055-.027.071-.093.044-.147a2.96 2.96 0 0 0-2.465-1.487c-.055 0-.11.044-.11.104l.001-.001zm-3.33-1.956l-.312-.311a.783.783 0 0 0-1.106 0l-.372.37a.773.773 0 0 0 0 1.101l.307.305c.049.049.121.038.164-.011.181-.245.378-.479.597-.697.225-.223.455-.42.707-.599.055-.033.06-.109.016-.158h-.001zm5.001-.806v-.616a.781.781 0 0 0-.783-.779h-1.824a.78.78 0 0 0-.783.779v.632c0 .071.066.12.137.104a5.736 5.736 0 0 1 1.588-.223c.52 0 1.035.071 1.534.207a.106.106 0 0 0 .131-.104z" fill="#FFF"></path>
						<path d="M102.162 13.762c0 1.455-.372 2.517-1.123 3.193-.75.676-1.895 1.013-3.44 1.013-.564 0-1.736-.109-2.673-.316l.345-1.689c.783.163 1.819.207 2.361.207.86 0 1.473-.174 1.84-.523.367-.349.548-.866.548-1.553v-.349a6.374 6.374 0 0 1-.838.316 4.151 4.151 0 0 1-1.194.158 4.515 4.515 0 0 1-1.616-.278 3.385 3.385 0 0 1-1.254-.817 3.744 3.744 0 0 1-.811-1.351c-.192-.539-.29-1.504-.29-2.212 0-.665.104-1.498.307-2.054a3.925 3.925 0 0 1 .904-1.433 4.124 4.124 0 0 1 1.441-.926 5.31 5.31 0 0 1 1.945-.365c.696 0 1.337.087 1.961.191a15.86 15.86 0 0 1 1.588.332v8.456h-.001zm-5.954-4.206c0 .893.197 1.885.592 2.299.394.414.904.621 1.528.621.34 0 .663-.049.964-.142a2.75 2.75 0 0 0 .734-.332v-5.29a8.531 8.531 0 0 0-1.413-.18c-.778-.022-1.369.294-1.786.801-.411.507-.619 1.395-.619 2.223zm16.12 0c0 .719-.104 1.264-.318 1.858a4.389 4.389 0 0 1-.904 1.52c-.389.42-.854.746-1.402.975-.548.229-1.391.36-1.813.36-.422-.005-1.26-.125-1.802-.36a4.088 4.088 0 0 1-1.397-.975 4.486 4.486 0 0 1-.909-1.52 5.037 5.037 0 0 1-.329-1.858c0-.719.099-1.411.318-1.999.219-.588.526-1.09.92-1.509.394-.42.865-.741 1.402-.97a4.547 4.547 0 0 1 1.786-.338 4.69 4.69 0 0 1 1.791.338c.548.229 1.019.55 1.402.97.389.42.69.921.909 1.509.23.588.345 1.28.345 1.999h.001zm-2.191.005c0-.921-.203-1.689-.597-2.223-.394-.539-.948-.806-1.654-.806-.707 0-1.26.267-1.654.806-.394.539-.586 1.302-.586 2.223 0 .932.197 1.558.592 2.098.394.545.948.812 1.654.812.707 0 1.26-.272 1.654-.812.394-.545.592-1.166.592-2.098h-.001zm6.962 4.707c-3.511.016-3.511-2.822-3.511-3.274L113.583.926l2.142-.338v10.003c0 .256 0 1.88 1.375 1.885v1.792h-.001zm3.774 0h-2.153V5.072l2.153-.338v9.534zm-1.079-10.542c.718 0 1.304-.578 1.304-1.291 0-.714-.581-1.291-1.304-1.291-.723 0-1.304.578-1.304 1.291 0 .714.586 1.291 1.304 1.291zm6.431 1.013c.707 0 1.304.087 1.786.262.482.174.871.42 1.156.73.285.311.488.735.608 1.182.126.447.186.937.186 1.476v5.481a25.24 25.24 0 0 1-1.495.251c-.668.098-1.419.147-2.251.147a6.829 6.829 0 0 1-1.517-.158 3.213 3.213 0 0 1-1.178-.507 2.455 2.455 0 0 1-.761-.904c-.181-.37-.274-.893-.274-1.438 0-.523.104-.855.307-1.215.208-.36.487-.654.838-.883a3.609 3.609 0 0 1 1.227-.49 7.073 7.073 0 0 1 2.202-.103c.263.027.537.076.833.147v-.349c0-.245-.027-.479-.088-.697a1.486 1.486 0 0 0-.307-.583c-.148-.169-.34-.3-.581-.392a2.536 2.536 0 0 0-.915-.163c-.493 0-.942.06-1.353.131-.411.071-.75.153-1.008.245l-.257-1.749c.268-.093.668-.185 1.183-.278a9.335 9.335 0 0 1 1.66-.142l-.001-.001zm.181 7.731c.657 0 1.145-.038 1.484-.104v-2.168a5.097 5.097 0 0 0-1.978-.104c-.241.033-.46.098-.652.191a1.167 1.167 0 0 0-.466.392c-.121.169-.175.267-.175.523 0 .501.175.79.493.981.323.196.75.289 1.293.289h.001zM84.109 4.794c.707 0 1.304.087 1.786.262.482.174.871.42 1.156.73.29.316.487.735.608 1.182.126.447.186.937.186 1.476v5.481a25.24 25.24 0 0 1-1.495.251c-.668.098-1.419.147-2.251.147a6.829 6.829 0 0 1-1.517-.158 3.213 3.213 0 0 1-1.178-.507 2.455 2.455 0 0 1-.761-.904c-.181-.37-.274-.893-.274-1.438 0-.523.104-.855.307-1.215.208-.36.487-.654.838-.883a3.609 3.609 0 0 1 1.227-.49 7.073 7.073 0 0 1 2.202-.103c.257.027.537.076.833.147v-.349c0-.245-.027-.479-.088-.697a1.486 1.486 0 0 0-.307-.583c-.148-.169-.34-.3-.581-.392a2.536 2.536 0 0 0-.915-.163c-.493 0-.942.06-1.353.131-.411.071-.75.153-1.008.245l-.257-1.749c.268-.093.668-.185 1.183-.278a8.89 8.89 0 0 1 1.66-.142l-.001-.001zm.186 7.736c.657 0 1.145-.038 1.484-.104v-2.168a5.097 5.097 0 0 0-1.978-.104c-.241.033-.46.098-.652.191a1.167 1.167 0 0 0-.466.392c-.121.169-.175.267-.175.523 0 .501.175.79.493.981.318.191.75.289 1.293.289h.001zm8.682 1.738c-3.511.016-3.511-2.822-3.511-3.274L89.461.926l2.142-.338v10.003c0 .256 0 1.88 1.375 1.885v1.792h-.001z" fill="#182359"></path>
						<path d="M5.027 11.025c0 .698-.252 1.246-.757 1.644-.505.397-1.201.596-2.089.596-.888 0-1.615-.138-2.181-.414v-1.214c.358.168.739.301 1.141.397.403.097.778.145 1.125.145.508 0 .884-.097 1.125-.29a.945.945 0 0 0 .363-.779.978.978 0 0 0-.333-.747c-.222-.204-.68-.446-1.375-.725-.716-.29-1.221-.621-1.515-.994-.294-.372-.44-.82-.44-1.343 0-.655.233-1.171.698-1.547.466-.376 1.09-.564 1.875-.564.752 0 1.5.165 2.245.494l-.408 1.047c-.698-.294-1.321-.44-1.869-.44-.415 0-.73.09-.945.271a.89.89 0 0 0-.322.717c0 .204.043.379.129.524.086.145.227.282.424.411.197.129.551.299 1.063.51.577.24.999.464 1.268.671.269.208.466.442.591.704.125.261.188.569.188.924l-.001.002zm3.98 2.24c-.924 0-1.646-.269-2.167-.808-.521-.539-.782-1.281-.782-2.226 0-.97.242-1.733.725-2.288.483-.555 1.148-.833 1.993-.833.784 0 1.404.238 1.858.714.455.476.682 1.132.682 1.966v.682H7.357c.018.577.174 1.02.467 1.329.294.31.707.465 1.241.465.351 0 .678-.033.98-.099a5.1 5.1 0 0 0 .975-.33v1.026a3.865 3.865 0 0 1-.935.312 5.723 5.723 0 0 1-1.08.091l.002-.001zm-.231-5.199c-.401 0-.722.127-.964.381s-.386.625-.432 1.112h2.696c-.007-.491-.125-.862-.354-1.115-.229-.252-.544-.379-.945-.379l-.001.001zm7.692 5.092l-.252-.827h-.043c-.286.362-.575.608-.865.739-.29.131-.662.196-1.117.196-.584 0-1.039-.158-1.367-.473-.328-.315-.491-.761-.491-1.337 0-.612.227-1.074.682-1.386.455-.312 1.148-.482 2.079-.51l1.026-.032v-.317c0-.38-.089-.663-.266-.851-.177-.188-.452-.282-.824-.282-.304 0-.596.045-.876.134a6.68 6.68 0 0 0-.806.317l-.408-.902a4.414 4.414 0 0 1 1.058-.384 4.856 4.856 0 0 1 1.085-.132c.756 0 1.326.165 1.711.494.385.329.577.847.577 1.552v4.002h-.902l-.001-.001zm-1.88-.859c.458 0 .826-.128 1.104-.384.278-.256.416-.615.416-1.077v-.516l-.763.032c-.594.021-1.027.121-1.297.298s-.406.448-.406.814c0 .265.079.47.236.615.158.145.394.218.709.218h.001zm7.557-5.189c.254 0 .464.018.628.054l-.124 1.176a2.383 2.383 0 0 0-.559-.064c-.505 0-.914.165-1.227.494-.313.329-.47.757-.47 1.284v3.105h-1.262V7.218h.988l.167 1.047h.064c.197-.354.454-.636.771-.843a1.83 1.83 0 0 1 1.023-.312h.001zm4.125 6.155c-.899 0-1.582-.262-2.049-.787-.467-.525-.701-1.277-.701-2.259 0-.999.244-1.767.733-2.304.489-.537 1.195-.806 2.119-.806.627 0 1.191.116 1.692.349l-.381 1.015c-.534-.208-.974-.312-1.321-.312-1.028 0-1.542.682-1.542 2.046 0 .666.128 1.166.384 1.501.256.335.631.502 1.125.502a3.23 3.23 0 0 0 1.595-.419v1.101a2.53 2.53 0 0 1-.722.285 4.356 4.356 0 0 1-.932.086v.002zm8.277-.107h-1.268V9.506c0-.458-.092-.8-.277-1.026-.184-.226-.477-.338-.878-.338-.53 0-.919.158-1.168.475-.249.317-.373.848-.373 1.593v2.949h-1.262V4.801h1.262v2.122c0 .34-.021.704-.064 1.09h.081a1.76 1.76 0 0 1 .717-.666c.306-.158.663-.236 1.072-.236 1.439 0 2.159.725 2.159 2.175v3.873l-.001-.001zm7.649-6.048c.741 0 1.319.269 1.732.806.414.537.62 1.291.62 2.261 0 .974-.209 1.732-.628 2.275-.419.542-1.001.814-1.746.814-.752 0-1.336-.27-1.751-.811h-.086l-.231.704h-.945V4.801h1.262v1.987l-.021.655-.032.553h.054c.401-.591.992-.886 1.772-.886zm-.328 1.031c-.508 0-.875.149-1.098.448-.224.299-.339.799-.346 1.501v.086c0 .723.115 1.247.344 1.571.229.324.603.486 1.123.486.448 0 .787-.177 1.018-.532.231-.354.346-.867.346-1.536 0-1.35-.462-2.025-1.386-2.025l-.001.001zm3.244-.924h1.375l1.209 3.368c.183.48.304.931.365 1.354h.043c.032-.197.091-.436.177-.717.086-.281.541-1.616 1.364-4.004h1.364l-2.541 6.73c-.462 1.235-1.232 1.853-2.31 1.853-.279 0-.551-.03-.816-.091v-.999c.19.043.406.064.65.064.609 0 1.037-.353 1.284-1.058l.22-.559-2.385-5.941h.001z" fill="#1D3657"></path>
					</g>
				</svg>
			</a>
		</div>
	</div></script> <script type="text/html" id="tmpl-autocomplete-empty"><div class="autocomplete-empty">
		No results matched your query 		<span class="empty-query">"{{ data.query }}"</span>
	</div></script> <script type="text/javascript">jQuery( function () {
		/* Initialize Algolia client */
		var client = algoliasearch( algolia.application_id, algolia.search_api_key );

		/**
		 * Algolia hits source method.
		 *
		 * This method defines a custom source to use with autocomplete.js.
		 *
		 * @param object $index Algolia index object.
		 * @param object $params Options object to use in search.
		 */
		var algoliaHitsSource = function( index, params ) {
			return function( query, callback ) {
				index
					.search( query, params )
					.then( function( response ) {
						callback( response.hits, response );
					})
					.catch( function( error ) {
						callback( [] );
					});
			}
		}

		/* Setup autocomplete.js sources */
		var sources = [];
		jQuery.each( algolia.autocomplete.sources, function ( i, config ) {
			var suggestion_template = wp.template( config[ 'tmpl_suggestion' ] );
			sources.push( {
				source: algoliaHitsSource( client.initIndex( config[ 'index_name' ] ), {
					hitsPerPage: config[ 'max_suggestions' ],
					attributesToSnippet: [
						'content:10'
					],
					highlightPreTag: '__ais-highlight__',
					highlightPostTag: '__/ais-highlight__'
				} ),
				templates: {
					header: function () {
						return wp.template( 'autocomplete-header' )( {
							label: _.escape( config[ 'label' ] )
						} );
					},
					suggestion: function ( hit ) {
						if ( hit.escaped === true ) {
							return suggestion_template( hit );
						}
						hit.escaped = true;

						for ( var key in hit._highlightResult ) {
							/* We do not deal with arrays. */
							if ( typeof hit._highlightResult[ key ].value !== 'string' ) {
								continue;
							}
							hit._highlightResult[ key ].value = _.escape( hit._highlightResult[ key ].value );
							hit._highlightResult[ key ].value = hit._highlightResult[ key ].value.replace( /__ais-highlight__/g, '<em>' ).replace( /__\/ais-highlight__/g, '<\/em>' );
						}

						for ( var key in hit._snippetResult ) {
							/* We do not deal with arrays. */
							if ( typeof hit._snippetResult[ key ].value !== 'string' ) {
								continue;
							}

							hit._snippetResult[ key ].value = _.escape( hit._snippetResult[ key ].value );
							hit._snippetResult[ key ].value = hit._snippetResult[ key ].value.replace( /__ais-highlight__/g, '<em>' ).replace( /__\/ais-highlight__/g, '<\/em>' );
						}

						return suggestion_template( hit );
					}
				}
			} );

		} );

		/* Setup dropdown menus */
		jQuery( algolia.autocomplete.input_selector ).each( function ( i ) {
			var $searchInput = jQuery( this );

			var config = {
				debug: algolia.debug,
				hint: false,
				openOnFocus: true,
				appendTo: 'body',
				templates: {
					empty: wp.template( 'autocomplete-empty' )
				}
			};

			if ( algolia.powered_by_enabled ) {
				config.templates.footer = wp.template( 'autocomplete-footer' );
			}

			/* Instantiate autocomplete.js */
			var autocomplete = algoliaAutocomplete( $searchInput[ 0 ], config, sources )
				.on( 'autocomplete:selected', function ( e, suggestion ) {
					/* Redirect the user when we detect a suggestion selection. */
					window.location.href = suggestion.permalink;
				} );

			/* Force the dropdown to be re-drawn on scroll to handle fixed containers. */
			jQuery( window ).on( 'scroll', function() {
				if ( autocomplete.autocomplete.getWrapper().style.display === "block" ) {
					autocomplete.autocomplete.close();
					autocomplete.autocomplete.open();
				}
			} );
		} );

		jQuery( document ).on( "click", ".algolia-powered-by-link", function ( e ) {
			e.preventDefault();
			window.location = "https://www.algolia.com/?utm_source=WordPress&utm_medium=extension&utm_content=" + window.location.hostname + "&utm_campaign=poweredby";
		} );
	} );</script> <script type="text/javascript" src="/wp-content/plugins/wpfront-scroll-top/js/wpfront-scroll-top.min.js?ver=2.0.7.08086" id="wpfront-scroll-top-js"></script> <script type="text/javascript" src="/wp-content/themes/jh-hew/js/JankHack-Hew.js?ver=20140909" id="JankHack-Hew-scripts-js"></script> <script type="text/javascript" src="/wp-content/themes/jh-hew/js/navigation.js?ver=20120206" id="JankHack-Hew-navigation-js"></script> <script type="text/javascript" src="/wp-content/themes/jh-hew/js/skip-link-focus-fix.js?ver=20130115" id="JankHack-Hew-skip-link-focus-fix-js"></script> <script type="text/javascript" src="/wp-content/themes/jh-hew/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="/wp-includes/js/underscore.min.js?ver=1.13.1" id="underscore-js"></script> <script type="text/javascript" id="wp-util-js-extra">var _wpUtilSettings = {"ajax":{"url":"\/wp-admin\/admin-ajax.php"}};</script> <script type="text/javascript" src="/wp-includes/js/wp-util.min.js?ver=5.9.3" id="wp-util-js"></script> <script type="text/javascript" src="/wp-content/plugins/wp-search-with-algolia/js/algoliasearch/dist/algoliasearch-lite.umd.js?ver=2.2.0" id="algolia-search-js"></script> <script type="text/javascript" src="/wp-content/plugins/wp-search-with-algolia/js/autocomplete.js/dist/autocomplete.min.js?ver=2.2.0" id="algolia-autocomplete-js"></script> <script type="text/javascript" src="/wp-content/plugins/wp-search-with-algolia/js/autocomplete-noconflict.js?ver=2.2.0" id="algolia-autocomplete-noconflict-js"></script> </body>
</html>