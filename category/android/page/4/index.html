<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>Android &#8211; ページ 4 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; Android カテゴリーのフィード" href="/category/android/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_923a46d76606f1b43e3f3639ca289d5f.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/8">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> <style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
</head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged category category-android category-8 paged-4 category-paged-4 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">カテゴリー: <span>Android</span>
</h1></header><article id="post-9778" class="post-9778 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/06/nextdns/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-06T10:44:09+09:00">2020年10月6日</time><time class="updated" datetime="2020-10-06T16:11:54+09:00">2020年10月6日</time></a> </span><span class="posted-on">更新日:2020年10月6日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/06/nextdns/" rel="bookmark noopener noreferrer" data-wpel-link="internal">まだ広告で消費してるの？　知らないと損!!　NextDNSを今すぐ設定して楽になろう！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今日はあまりマニアックなネタじゃないので、皆が有益になれると思うよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ちょっとタイトル煽ってますね？w</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>そう？w　今回のネタは、広告を消す方法です！　これだったらみんなメリットあるよね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>でも、簡単じゃないとだめですよ！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>さて、今日のネタは「広告を消す！」です。しかも設定は簡単で、androidもiosもPC（mac・windows・Linuxも）でもぜーんぶ、簡単に設定できます。ぴーちゃんのご要望通り、設定は簡単なんで記事自体もすぐ終わっちゃいそうですが・・・</p>
<h3>さっそく設定！</h3>
<blockquote class="wp-block-quote">
<p>NextDNS</p>
<cite><a href="https://nextdns.io/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://nextdns.io<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>まず、ここにアクセスして設定をゲットしましょう。以下のように説明が出ますのでその通りにするだけです。例えばandroidの場合は以下です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="913" height="391" src="/wp-content/uploads/2020/10/NextDNS-setting.png" alt="" class="wp-image-9781" srcset="/wp-content/uploads/2020/10/NextDNS-setting.png 913w, /wp-content/uploads/2020/10/NextDNS-setting-768x329.png 768w" sizes="(max-width: 913px) 100vw, 913px"></noscript>
<img width="913" height="391" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20913%20391%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/NextDNS-setting.png" alt="" class="lazyload wp-image-9781" data-srcset="/wp-content/uploads/2020/10/NextDNS-setting.png 913w, /wp-content/uploads/2020/10/NextDNS-setting-768x329.png 768w" data-sizes="(max-width: 913px) 100vw, 913px"></figure></div>
<p>****.dns.nextdns.io をコピペします。そして、説明の通りスマホの設定からプライベートDNSをコピペして保存するだけOKです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="432" height="864" src="/wp-content/uploads/2020/10/nextdns.png" alt="" class="wp-image-9780"></noscript>
<img width="432" height="864" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20432%20864%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/nextdns.png" alt="" class="lazyload wp-image-9780"></figure></div>
<p>実際に広告が消えたか確認してみましょう。あと、NextDNSはアカウント作っておいたほうがいいです。以下、確認できて気に入ったら登録して使ってみましょうね！</p>
<h3>広告が消える！！！</h3>
<p>さて、今回は説明するために、まださっきの「保存」ボタンは押していません。この状態で、例えば smartnewsのアプリを開きます。ブラウザでどこか広告が表示されるページを開いてもいいのですが、アプリ上の広告も消えますのでその一例です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="431" height="864" src="/wp-content/uploads/2020/10/smartnews.png" alt="" class="wp-image-9782"></noscript>
<img width="431" height="864" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20431%20864%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/smartnews.png" alt="" class="lazyload wp-image-9782"></figure></div>
<p>ご覧のように中央にがっつりと、広告が表示されていますよね。smartnewsは好きなんすが、この広告が非常にうっとうしい！んですよね。これは見るべき情報なのか、広告なのかいちいち判断しないといけません。</p>
<p>　で、さきほどの保存（設定）ボタンを押して、NextDNSの設定をイキにさせます。SmartNewsは、↓下に引っ張り情報をリロードします。キャッシュが効いてうまく情報が更新されない場合は、一度アプリをタスクから終了して起動しなおしてみてください。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="431" height="864" src="/wp-content/uploads/2020/10/smartnews-1.png" alt="" class="wp-image-9783"></noscript>
<img width="431" height="864" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20431%20864%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/smartnews-1.png" alt="" class="lazyload wp-image-9783"></figure></div>
<p>なんということでしょう！　中央にデカデカと表示されていた広告はもうありません。それに、どのタブに行っても、もう紛らわしい広告が表示されていません！</p>
<h3>仕組みの概略</h3>
<p>広告を表示するためには、そのURLにアクセスする必要があります。URLにアクセスするためには、そのURLに含まれるドメイン名をIPに変換する必要があります。それを解決するのは通常、DNSのポート53応答によって行われます。プライベートDNSは、DNS問い合わせをどこか違うポートで暗号化通信しているようです。そしてNextDNSに名前解決を問い合わせ、広告関連のURLは全部、名前解決されなずブロックされる・したがって広告は表示できない・という事が原理の概要です。</p>
<p>　つまり、この仕組みなのでブラウザ上でもアプリ上でも広告が消えるというわけです。</p>
<h3>スマホ上でDNSのパケット採取</h3>
<p>上記の推論の一部を実際に確認してみたいと思います。まず、さきほど設定したプレイベートDNSの設定をOffにします。そして、スマホ側でDNS関連のポート53応答をキャプチャー（tcpdump）します。そして、smartnewsを起動してみます。</p>
<pre class="wp-block-code"><code>$ sudo tcpdump -i wlan0 -nn port 53
：：
09:48:34.548342 IP 192.168.1.47.59746 > 192.168.1.1.53: 8385+ A? conf.smartnews-ads.com. (40)
09:48:34.766102 IP 192.168.1.1.53 > 192.168.1.47.59746: 8385 3/0/0 CNAME conf.smartnews-ads.com.edgekey.net., CNAME e802.g.akamaiedge.net., A 23.41.23.121 (136)
09:48:35.137376 IP 192.168.1.47.58770 > 192.168.1.1.53: 34097+ AAAA? web.facebook.com. (34)
09:48:35.166724 IP 192.168.1.1.53 > 192.168.1.47.58770: 34097 3/0/0 CNAME star.facebook.com., CNAME star.c10r.facebook.com., AAAA 2a03:2880:f00f:1:face:b00c:0:1 (105)
09:48:35.167288 IP 192.168.1.47.50930 > 192.168.1.1.53: 56757+ A? web.facebook.com. (34)
09:48:35.370994 IP 192.168.1.1.53 > 192.168.1.47.50930: 56757 3/0/0 CNAME star.facebook.com., CNAME star.c10r.facebook.com., A 31.13.82.1 (93)
09:48:36.332043 IP 192.168.1.47.53699 > 192.168.1.1.53: 35334+ A? www.smartnews.com. (35)
09:48:36.342106 IP 192.168.1.47.59887 > 192.168.1.1.53: 26778+ A? thumbnail.smartnews-ads.com. (45)
09:48:36.426088 IP 192.168.1.47.2835 > 192.168.1.1.53: 19416+ AAAA? mp.smartnews.com. (34)
09:48:36.573501 IP 192.168.1.1.53 > 192.168.1.47.53699: 35334 3/0/0 CNAME any.smartnews.com.edgekey.net., CNAME e1393.d.akamaiedge.net., A 23.41.23.236 (127)
09:48:36.738275 IP 192.168.1.1.53 > 192.168.1.47.59887: 26778 3/0/0 CNAME any.smartnews-ads.com.edgekey.net., CNAME e802.g.akamaiedge.net., A 23.41.23.121 (140)
09:48:36.758832 IP 192.168.1.1.53 > 192.168.1.47.2835: 19416 4/0/0 CNAME any-dual.smartnews.com.edgekey.net., CNAME e1393.dscksd.akamaiedge.net., AAAA 2600:140b:4800:394::571, AAAA 2600:140b:4800:3a2::571 (176)
09:48:36.759283 IP 192.168.1.47.20694 > 192.168.1.1.53: 5578+ A? mp.smartnews.com. (34)
09:48:36.928482 IP 192.168.1.47.7412 > 192.168.1.1.53: 31103+ A? imasdk.googleapis.com. (39)
09:48:36.970033 IP 192.168.1.1.53 > 192.168.1.47.20694: 5578 3/0/0 CNAME any-dual.smartnews.com.edgekey.net., CNAME e1393.dscksd.akamaiedge.net., A 23.47.133.205 (136)
09:48:37.190502 IP 192.168.1.1.53 > 192.168.1.47.7412: 31103 1/0/0 A 172.217.161.234 (55)
09:48:37.703602 IP 192.168.1.47.64201 > 192.168.1.1.53: 65301+ AAAA? www.googleapis.com. (36)
09:48:37.722921 IP 192.168.1.1.53 > 192.168.1.47.64201: 65301 4/0/0 AAAA 2404:6800:400a:809::200a, AAAA 2404:6800:400a:80c::200a, AAAA 2404:6800:400a:80b::200a, AAAA 2404:6800:400a:808::200a (148)
09:48:37.744633 IP 192.168.1.47.61439 > 192.168.1.1.53: 61508+ AAAA? r4---sn-3pm7sn7k.googlevideo.com. (50)
09:48:37.764935 IP 192.168.1.1.53 > 192.168.1.47.61439: 61508 2/0/0 CNAME r4.sn-3pm7sn7k.googlevideo.com., AAAA 2404:6800:400e:4::a (107)
09:48:37.765776 IP 192.168.1.47.51232 > 192.168.1.1.53: 57935+ A? r4---sn-3pm7sn7k.googlevideo.com. (50)
09:48:37.980047 IP 192.168.1.1.53 > 192.168.1.47.51232: 57935 2/0/0 CNAME r4.sn-3pm7sn7k.googlevideo.com., A 74.125.171.106 (95)
09:48:39.222221 IP 192.168.1.47.52047 > 192.168.1.1.53: 31868+ AAAA? r5---sn-3pm7dn7r.googlevideo.com. (50)
09:48:39.247036 IP 192.168.1.1.53 > 192.168.1.47.52047: 31868 2/0/0 CNAME r5.sn-3pm7dn7r.googlevideo.com., AAAA 2404:6800:400a:19::a (107)
09:48:39.247652 IP 192.168.1.47.24883 > 192.168.1.1.53: 34181+ A? r5---sn-3pm7dn7r.googlevideo.com. (50)
09:48:39.443678 IP 192.168.1.1.53 > 192.168.1.47.24883: 34181 2/0/0 CNAME r5.sn-3pm7dn7r.googlevideo.com., A 74.125.102.202 (95)
09:48:40.359428 IP 192.168.1.47.34298 > 192.168.1.1.53: 12112+ AAAA? play.googleapis.com. (37)
09:48:40.383957 IP 192.168.1.1.53 > 192.168.1.47.34298: 12112 1/0/0 AAAA 2404:6800:400a:806::200a (65)
09:48:40.384632 IP 192.168.1.47.27441 > 192.168.1.1.53: 62063+ A? play.googleapis.com. (37)
09:48:40.607511 IP 192.168.1.1.53 > 192.168.1.47.27441: 62063 1/0/0 A 172.217.161.202 (53)
09:48:45.191301 IP 192.168.1.47.38030 > 192.168.1.1.53: 9923+ A? pagead2.googleadservices.com. (46)
09:48:45.191846 IP 192.168.1.47.45560 > 192.168.1.1.53: 4539+ A? googleads.g.doubleclick.net. (45)
09:48:45.489110 IP 192.168.1.1.53 > 192.168.1.47.38030: 9923 2/0/0 CNAME pagead.l.doubleclick.net., A 172.217.161.194 (100)
09:48:45.589661 IP 192.168.1.1.53 > 192.168.1.47.45560: 4539 2/0/0 CNAME pagead46.l.doubleclick.net., A 172.217.26.98 (86)</code></pre>
<p>192.168.1.1は、ルータアドレス、192.168.1.47はスマホです。</p>
<p>スマートニュース側には広告が表示されています。どれが広告関連の問い合わせかは不明です　しかし、ここではそれはあまり重要ではありません。そこを追うのはやめて、次にプレイベートDNSを設定し、同じようにポート53をキャプチャーしてみます。</p>
<pre class="wp-block-code"><code>$ sudo tcpdump -i wlan0 -nn port 53
：：
パケットが流れません！</code></pre>
<p>はい、このようにプライベートDNSを設定しているとDNS問い合わせであるポート53応答には何もキャプチャーされません。しかし、実際には広告がない状態で表示されています。つまり、名前解決の問い合わせはどこか違う経路でやっていることになります。ちょっと専門的になりますが以下にその説明があります。</p>
<blockquote class="wp-block-quote">
<p>DNS暗号化について</p>
<cite><a href="https://blog.cloudflare.com/jp/dns-encryption-explained-jp/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://blog.cloudflare.com/jp/dns-encryption-explained-jp/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>どうやら、DoT（tcp/853）とDoH（tcp/443）かのどちらかのようですね。</p>
<p>　どこがブロックされたのかは、NextDNSのログに載っています。他にも面白い機能がありますので、いつか紹介してみたいと思います。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・NextDNSは、ちゃんと広告が消える！<br>・仕組みは、DNSの問い合わせを検閲し、ブロックしてくれるようだ<br>・プレイベートDNSは、ポート53ではなく違うポートで通信しているようだ（暗号化については未確認）<br>・DNS over TLS（DoT）または、DNS over HTTPS（DoH）と略されるようだ<br>・ポートはそれぞれ、DoT（tcp/853）とDoH（tcp/443）が使われるようだ<br>・プラットフォームに依存しないので、NextDNSは神アプリ（サービス）だと思う<br>・パケット（今だとギガと表現ですかねw）の消費も節約できる</p>
<h3>あとがき</h3>
<p>ちょっとブラウジングすると、すぐ広告にぶち当たりますよね。でもNextDNSがあれば、かなりこの消耗が少なくなります。今の所、知ってる人だけ使っている機能で、広告業界はこれに対抗する術がまったくありません。今後、どうなるのでしょうかね。</p>
<h3>著者にメッセージ</h3>
<p>記事の間違いや指摘事項など、コメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9758" class="post-9758 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/05/pixel3android11rroot/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-05T05:23:17+09:00">2020年10月5日</time><time class="updated" datetime="2021-07-04T21:17:42+09:00">2021年7月4日</time></a> </span><span class="posted-on">更新日:2021年7月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/05/pixel3android11rroot/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Pixel3・android11(R)正式リリース版でroot化！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>Pixel3をAndroid11でroot化したよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>どんなメリットがあるの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>それは色々ありすぎて、目的によるね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>そんなマニアックなネタ、需要あるの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>はいー！　ぴーちゃんの言う通り、マニアックネタになります。しかし、root化によるメリットは結構あります。もちろんデメリットもありますが、実際にいろいろ触って体験してみましょう。あと自己責任でよろしくね！真似して何か不利益が起きても著者は知りませんよ。</p>
<h3>そもそも、root化ってなに？</h3>
<p>このブログの趣旨としては、なるべく専用用語を使わずわかりやすく一般の人にも理解してもらいたい・そー著者は思っております。</p>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>すべて使わないのは無理があるわね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<blockquote class="wp-block-quote">
<p>root化 (Android OS)<br>出典: フリー百科事典『ウィキペディア（Wikipedia）』</p>
<cite><a href="https://ja.wikipedia.org/wiki/Root%E5%8C%96_(Android_OS)" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://ja.wikipedia.org/wiki/Root%E5%8C%96_(Android_OS)<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>wikiではこのように説明されていますね。一言で言えば、Androidの最高管理権限をゲットするということです。一体、この権限を取得して何をするのか？　ということが、本来大事ですよね。目的があってこそのroot化です。</p>
<h3>root化して何するの・・・？</h3>
<p>今回、スマホ（Pixel3）をroot化したいなと思った１つの大きな目的はtermux です。Termuxは、root化しなくてもいろんなアプリが動作する大変面白い神アプリですが、1024ポート未満は、root権限がないと動作しません。例えば、nginxを80番ポートで動作させようとすると以下のようになります。</p>
<pre class="wp-block-code"><code>$ nginx
nginx: &#091;warn] the "user" directive makes sense only if the master process runs with super-user privileges, ignored in /data/data/com.termux/files/usr/etc/nginx/nginx.conf:3
nginx: &#091;emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)</code></pre>
<p>このようにroot権限がないと、バインドできないんです。WEBサーバ以外にも、例えばDNSの53ポートや、SSLの443など、なるべくそのままのポートで動作させたいものがあります。root化していれば、この制限がなくなります。つまり、今の所、内部向けDNSと、WEB・SSLサーバをスマホで動作させたいのが root化の大きな目的です。</p>
<p>　現在、このブログが動作している Umidigi F2というスマホにもtermuxが動作していて、そこでは8080と8443ポートで動作しているWordPressがあります。現在は外向け用に、グローバルIP＋ポートをプライベートIP＋内部ポートに変換して運用していますが、内部からのアクセスだとUターンNATができないルータの影響で、内部ネットワークからはドメイン名でWordPressにアクセスできないのです。ポート変換がなければ、内部向けDNSを作ればシンプルに解決できますので、ポート53で動作する省電力DNSサーバとWEB/SSLサーバが欲しかったわけです。まだ検討中なので、実運用するかどうかはわかりません。</p>
<p>　というわけで、Pixel3のroot化やってみましょうか。</p>
<h3>ステップ１　概要</h3>
<p>こういうのは、全体像が見えていることが大事です。今回、Pixel3のAndroid11最新バージョンの状態でroot化をどのようにするか、要点をまとめてみます。</p>
<p>・Magiskというツールを使い、twrpは使わない<br>・Magiskを使い、純正ファクトリーイメージに含まれるBootにパッチする<br>・adb純正ツールで、BootをPixelに書き込む<br>・Termuxはroot権限を利用できるようMagiskに設定しておく</p>
<p>root化というのは、Bootプロセスの一部に細工を加えその後に展開されるOSイメージのroot権限を奪取して、永続化できるよう書き換えるというものです。Pixelの場合は、ブートローダは普通にだれでもアンロックできますので boot.imgを程よく書き換えればその後マウントされる中でrootがイキの状態に持っていけるということです。</p>
<p>他にも違うやり方はあると思いますが、Magiskというツールがなかなかよかったので、今回はこれでやることにします。boot中にどのような手法でやっているのか（一部、脆弱性を利用していると思いますが）、その具体的な手法については未調査です。</p>
<h3>ステップ２　必要なツールと準備</h3>
<p>さて、まずは前準備が大切です。</p>
<blockquote class="wp-block-quote">
<p>SDK・プラットフォームツール<br>：：<br>これは最新にしておいてね！</p>
<cite><a href="https://developer.android.com/studio/releases/platform-tools.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://developer.android.com/studio/releases/platform-tools.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>AndroidStudioから、最新にする方法もあります。また入れてあれば上記からDLして、本来入っているところに上書きしておけばOKです。現在の最新は以下のバージョンです。</p>
<pre class="wp-block-code"><code>$ adb --version
Android Debug Bridge version 1.0.41
Version 30.0.4-6686687</code></pre>
<p>次はファクトリーイメージをダウンロードしておきます。</p>
<blockquote class="wp-block-quote">
<p>Factory Image<br>::<br>&#8220;blueline&#8221; for Pixel 3<br>::<br>11.0.0 (RP1A.200720.009, Sep 2020)</p>
<cite><a href="https://developers.google.com/android/images" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://developers.google.com/android/images<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>Pixel3のコードネームは、bluline です。これの現在最新の11.0.0 (RP1A.200720.009, Sep 2020)をダウンロードしておきます。コマンドでやる場合は以下のようになります。著者は、ルート直下にsrcディレクトリ作ってますが、別にどこでやってもいいです。パスが長くなるのが嫌だっただけです。</p>
<pre class="wp-block-code"><code>$ sudo mkdir /src
$ sudo chmod 777 /src
$ cd /src
$ wget https://dl.google.com/dl/android/aosp/blueline-rp1a.200720.009-factory-145e4cc4.zip
$ shasum -a 256 blueline-rp1a.200720.009-factory-145e4cc4.zip

　※ Checksum を確認しておいてね。RP1A.200720.009</code></pre>
<h3>ステップ３　ファクトリーイメージを展開</h3>
<p>ダウンロードしたファイルを展開します。</p>
<pre class="wp-block-code"><code>$ unzip blueline-rp1a.200720.009-factory-145e4cc4.zip 
$ tree blueline-rp1a.200720.009
blueline-rp1a.200720.009
├── bootloader-blueline-b1c1-0.3-6623201.img
├── flash-all.bat
├── flash-all.sh
├── flash-base.sh
├── image-blueline-rp1a.200720.009.zip
└── radio-blueline-g845-00107-200702-b-6648703.img</code></pre>
<p>さらにその中のイメージファイルを展開</p>
<pre class="wp-block-code"><code>$ mv blueline-rp1a.200720.009/*.zip ./
$ mv blueline-rp1a.200720.009/*.img ./
$ unzip image-blueline-rp1a.200720.009.zip -d image-blueline-rp1a.200720.009
$ tree image-blueline-rp1a.200720.009
image-blueline-rp1a.200720.009
├── android-info.txt
├── boot.img
├── dtbo.img
├── product.img
├── super_empty.img
├── system.img
├── system_ext.img
├── system_other.img
├── vbmeta.img
└── vendor.img

$ mv image-blueline-rp1a.200720.009/boot.img ./</code></pre>
<h3>ステップ４　Magisk Managerを入れる</h3>
<p>スマホのアプリなので、スマホから操作です。</p>
<blockquote class="wp-block-quote">
<p>Magisk Manager Canary<br>　※ Magisk Manager Canary から、APKをDLして入れておく</p>
<cite><a href="https://github.com/topjohnwu/Magisk" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://github.com/topjohnwu/Magisk<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="397" height="122" src="/wp-content/uploads/2020/10/MagiskManagerCanary.png" alt="" class="wp-image-9763"></noscript>
<img width="397" height="122" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20397%20122%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/MagiskManagerCanary.png" alt="" class="lazyload wp-image-9763"></figure></div>
<p>Canaryビルドのほうが、現時点ではインターフェイスが新しくなって使いやすかったです。</p>
<h3>ステップ５　boot.img をスマホに転送</h3>
<p>さきほど、ファクトリーイメージの中から取り出した、boot.img をスマホに転送しておきます。adb コマンドでやる場合は以下</p>
<pre class="wp-block-code"><code>$ adb push ./boot.img /sdcard/Download/
./boot.img: 1 file pushed, 0 skipped. 83.1 MB/s (67108864 bytes in 0.770s)</code></pre>
<p>Android File Transfer とか使ってもOKです。何らかの方法でスマホに転送してね。</p>
<h3>ステップ６　Magisk Managerアプリでパッチ</h3>
<p>スマホに転送したboot.imgをMagisk Managerアプリでパッチを当てます。</p>
<blockquote class="wp-block-quote">
<p>追記<br>　Magiskマネージャーはインストール後、設定→更新チャンネルをβ版に変更しておきます。記事執筆時。</p>
<cite>匿名さんからコメントいただきましたので修正、補足しておきます。</cite>
</blockquote>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="887" height="833" src="/wp-content/uploads/2020/10/ss1-magisk-install.png" alt="" class="wp-image-9764" srcset="/wp-content/uploads/2020/10/ss1-magisk-install.png 887w, /wp-content/uploads/2020/10/ss1-magisk-install-768x721.png 768w" sizes="(max-width: 887px) 100vw, 887px"></noscript>
<img width="887" height="833" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20887%20833%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/ss1-magisk-install.png" alt="" class="lazyload wp-image-9764" data-srcset="/wp-content/uploads/2020/10/ss1-magisk-install.png 887w, /wp-content/uploads/2020/10/ss1-magisk-install-768x721.png 768w" data-sizes="(max-width: 887px) 100vw, 887px"></figure></div>
<p>boot.imgを選択して、LET`S GO→　です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="936" height="499" src="/wp-content/uploads/2020/10/boot-img-patch.png" alt="" class="wp-image-9765" srcset="/wp-content/uploads/2020/10/boot-img-patch.png 936w, /wp-content/uploads/2020/10/boot-img-patch-768x409.png 768w" sizes="(max-width: 936px) 100vw, 936px"></noscript>
<img width="936" height="499" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20936%20499%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/boot-img-patch.png" alt="" class="lazyload wp-image-9765" data-srcset="/wp-content/uploads/2020/10/boot-img-patch.png 936w, /wp-content/uploads/2020/10/boot-img-patch-768x409.png 768w" data-sizes="(max-width: 936px) 100vw, 936px"></figure></div>
<p>All done! でパッチ当て成功です。</p>
<h3>ステップ７　magisk_patched.img をPCにダウンロード</h3>
<p>PCから、adbコマンドでパッチしたboot.imgを書き込みますのでさきほどの、magisk_patched.img をPCにダウンロードしておきます。adb コマンドでやる場合は、以下</p>
<pre class="wp-block-code"><code>$ adb pull /sdcard/Download/magisk_patched.img ./
/sdcard/Download/magisk_patched.img: 1 file pulled, 0 skipped. 69.2 MB/s (67108864 bytes in 0.925s)</code></pre>
<h3>ステップ８　OEMロック解除</h3>
<p>開発者オプションから、OEMロック解除をOnにしておきます。あと、USBデバックはONで。</p>
<p>一回、電源を落とします。電源オフの状態から電源＋ボリューム下キーを長押し “Fastboot Mode” を起動。</p>
<pre class="wp-block-code"><code>$ fastboot flashing unlock</code></pre>
<p>スマホ本体よりボリューム↑↓キーで『Unlock the bootloader』を選択、電源キーで確定します。</p>
<pre class="wp-block-code"><code>$ fastboot reboot</code></pre>
<h3>ステップ９　PCからイメージファイルを書込</h3>
<p>PCから、adbコマンドでいろいろ書き込みます。まずは、スマホをFastboot modeにしておきます。</p>
<blockquote class="wp-block-quote"><p>・再起動＞ボリューム下キー<br>　→ Fastboot mode でスマホが起動</p></blockquote>
<p>PCから認識されているか確認しておきます。以下のようにシリアルナンバーが表示されていればOKです。</p>
<pre class="wp-block-code"><code>$ fastboot devices
8*******6	fastboot</code></pre>
<p>ファクトリーイメージに含まれる、以下ファイルを書き込みます。</p>
<pre class="wp-block-code"><code>$ fastboot flash bootloader &lt;以下ファイルをD&amp;D&gt;

 bootloader-blueline-b1c1-0.3-6623201.img</code></pre>
<blockquote class="wp-block-quote">
<p>追記<br>　半角スペース忘れないこと→例：fastboot flash bootloader&lt;半角スペース&gt;&lt;ファイルパス&gt;</p>
<cite>匿名さんから、つまずいた点をご指摘いただきましたので記載しておきますね。</cite>
</blockquote>
<p>実行例は以下です。</p>
<pre class="wp-block-code"><code>$ fastboot flash bootloader ./bootloader-blueline-b1c1-0.3-6623201.img
Sending 'bootloader_b' (8537 KB)                   OKAY &#091;  0.290s]
Writing 'bootloader_b'                             (bootloader) Flashing Pack version b1c1-0.3-6623201
(bootloader) Flashing partition table for Lun = 0
(bootloader) Flashing partition table for Lun = 1
(bootloader) Flashing partition table for Lun = 2
(bootloader) Flashing partition table for Lun = 4
(bootloader) Flashing partition table for Lun = 5
(bootloader) Flashing partition msadp_b
(bootloader) Flashing partition xbl_b
(bootloader) Flashing partition xbl_config_b
(bootloader) Flashing partition aop_b
(bootloader) Flashing partition tz_b
(bootloader) Flashing partition hyp_b
(bootloader) Flashing partition abl_b
(bootloader) Flashing partition keymaster_b
(bootloader) Flashing partition cmnlib_b
(bootloader) Flashing partition cmnlib64_b
(bootloader) Flashing partition devcfg_b
(bootloader) Flashing partition qupfw_b
(bootloader) Flashing partition storsec_b
(bootloader) Flashing partition logfs
OKAY &#091;  0.825s]
Finished. Total time: 1.384s</code></pre>
<p>で、このコマンドをやっておきます。</p>
<pre class="wp-block-code"><code>$ fastboot reboot bootloader</code></pre>
<p>実行例は以下です。</p>
<pre class="wp-block-code"><code>$ fastboot reboot bootloader
Rebooting into bootloader                          OKAY &#091;  0.081s]
Finished. Total time: 0.081s</code></pre>
<p>radioファイルを書き込みます。</p>
<pre class="wp-block-code"><code>$ fastboot flash radio &lt;以下ファイル&gt;

　radio-blueline-g845-00107-200702-b-6648703.img</code></pre>
<p>実行例は以下です。</p>
<pre class="wp-block-code"><code>$ fastboot flash radio ./radio-blueline-g845-00107-200702-b-6648703.img 
Sending 'radio_b' (71436 KB)                       OKAY &#091;  1.670s]
Writing 'radio_b'                                  (bootloader) Flashing Pack version SSD:g845-00107-200702-B-6648703
(bootloader) Flashing partition modem_b
OKAY &#091;  0.555s]
Finished. Total time: 2.495s</code></pre>
<p>で、このコマンドをやっておきます。</p>
<pre class="wp-block-code"><code>$ fastboot reboot bootloader</code></pre>
<p>実行例は先と同じなので省略です。</p>
<p>Android11の本体イメージを書き込みます。</p>
<pre class="wp-block-code"><code>$ fastboot --skip-reboot update &lt;以下ファイル&gt;

　image-blueline-rp1a.200720.009.zip</code></pre>
<p>実行例です。ここは少し時間がかかります。途中リブートしましたがほっとけばOKです。</p>
<pre class="wp-block-code"><code>$ fastboot --skip-reboot update ./image-blueline-rp1a.200720.009.zip 
--------------------------------------------
Bootloader Version...: b1c1-0.3-6623201
Baseband Version.....: g845-00107-200702-B-6648703
Serial Number........: 8*******6
--------------------------------------------
extracting android-info.txt (0 MB) to RAM...
Checking 'product'                                 OKAY &#091;  0.058s]
Checking 'version-bootloader'                      OKAY &#091;  0.060s]
Checking 'version-baseband'                        OKAY &#091;  0.060s]
Setting current slot to 'b'                        OKAY &#091;  0.396s]
extracting boot.img (64 MB) to disk... took 0.503s
archive does not contain 'boot.sig'
Sending 'boot_b' (65536 KB)                        OKAY &#091;  1.531s]
Writing 'boot_b'                                   OKAY &#091;  0.468s]
extracting dtbo.img (8 MB) to disk... took 0.017s
archive does not contain 'dtbo.sig'
Sending 'dtbo_b' (8192 KB)                         OKAY &#091;  0.280s]
Writing 'dtbo_b'                                   OKAY &#091;  0.170s]
archive does not contain 'dt.img'
archive does not contain 'recovery.img'
extracting vbmeta.img (0 MB) to disk... took 0.000s
archive does not contain 'vbmeta.sig'
Sending 'vbmeta_b' (8 KB)                          OKAY &#091;  0.120s]
Writing 'vbmeta_b'                                 OKAY &#091;  0.067s]
archive does not contain 'vbmeta_system.img'
archive does not contain 'vendor_boot.img'
extracting super_empty.img (0 MB) to disk... took 0.000s
Rebooting into fastboot                            OKAY &#091;  0.060s]
&lt; waiting for any device &gt;

　※端末がリブート　＞　もう一度リブート
　　＞fastbootd 画面になる
　　＞さらに、コマンドが流れる

Sending 'system_b' (4 KB)                          OKAY &#091;  0.001s]
Updating super partition                           OKAY &#091;  0.006s]
Deleting 'system_a'                                OKAY &#091;  0.005s]
Deleting 'vendor_a'                                OKAY &#091;  0.005s]
Resizing 'product_b'                               OKAY &#091;  0.005s]
Resizing 'system_b'                                OKAY &#091;  0.005s]
Resizing 'system_ext_b'                            OKAY &#091;  0.006s]
Resizing 'vendor_b'                                OKAY &#091;  0.006s]
archive does not contain 'boot_other.img'
archive does not contain 'odm.img'
extracting product.img (1871 MB) to disk... took 14.110s
archive does not contain 'product.sig'
Resizing 'product_b'                               OKAY &#091;  0.006s]
Sending sparse 'product_b' 1/8 (262140 KB)         OKAY &#091;  6.294s]
Writing 'product_b'                                OKAY &#091;  2.634s]
Sending sparse 'product_b' 2/8 (262140 KB)         OKAY &#091;  6.388s]
Writing 'product_b'                                OKAY &#091;  1.599s]
Sending sparse 'product_b' 3/8 (262140 KB)         OKAY &#091;  6.376s]
Writing 'product_b'                                OKAY &#091;  1.598s]
Sending sparse 'product_b' 4/8 (262140 KB)         OKAY &#091;  6.399s]
Writing 'product_b'                                OKAY &#091;  1.648s]
Sending sparse 'product_b' 5/8 (262140 KB)         OKAY &#091;  6.375s]
Writing 'product_b'                                OKAY &#091;  1.612s]
Sending sparse 'product_b' 6/8 (262140 KB)         OKAY &#091;  6.385s]
Writing 'product_b'                                OKAY &#091;  1.625s]
Sending sparse 'product_b' 7/8 (262140 KB)         OKAY &#091;  6.404s]
Writing 'product_b'                                OKAY &#091;  1.586s]
Sending sparse 'product_b' 8/8 (81204 KB)          OKAY &#091;  2.447s]
Writing 'product_b'                                OKAY &#091;  0.579s]
extracting system.img (784 MB) to disk... took 4.331s
archive does not contain 'system.sig'
Resizing 'system_b'                                OKAY &#091;  0.006s]
Sending sparse 'system_b' 1/4 (262140 KB)          OKAY &#091;  6.089s]
Writing 'system_b'                                 OKAY &#091;  2.647s]
Sending sparse 'system_b' 2/4 (262140 KB)          OKAY &#091;  6.203s]
Writing 'system_b'                                 OKAY &#091;  1.607s]
Sending sparse 'system_b' 3/4 (262140 KB)          OKAY &#091;  6.149s]
Writing 'system_b'                                 OKAY &#091;  1.631s]
Sending sparse 'system_b' 4/4 (16400 KB)           OKAY &#091;  0.806s]
Writing 'system_b'                                 OKAY &#091;  0.171s]
extracting system_ext.img (183 MB) to disk... took 0.944s
archive does not contain 'system_ext.sig'
Resizing 'system_ext_b'                            OKAY &#091;  0.005s]
Sending 'system_ext_b' (187564 KB)                 OKAY &#091;  4.167s]
Writing 'system_ext_b'                             OKAY &#091;  2.209s]
extracting system_other.img (68 MB) to disk... took 0.385s
archive does not contain 'system.sig'
Sending 'system_a' (69880 KB)                      OKAY &#091;  1.558s]
Writing 'system_a'                                 OKAY &#091;  0.420s]
extracting vendor.img (408 MB) to disk... took 2.065s
archive does not contain 'vendor.sig'
Resizing 'vendor_b'                                OKAY &#091;  0.005s]
Sending sparse 'vendor_b' 1/2 (262140 KB)          OKAY &#091;  5.997s]
Writing 'vendor_b'                                 OKAY &#091;  2.631s]
Sending sparse 'vendor_b' 2/2 (156584 KB)          OKAY &#091;  3.825s]
Writing 'vendor_b'                                 OKAY &#091;  1.022s]
archive does not contain 'vendor_dlkm.img'
archive does not contain 'vendor_other.img'
Finished. Total time: 162.157s</code></pre>
<p>最後です。スマホでパッチしたboot.imgを書き込みます。</p>
<pre class="wp-block-code"><code>$ fastboot flash boot &lt;以下パッチしたimgファイル&gt;

　magisk_patched.img</code></pre>
<p>実行例です。</p>
<pre class="wp-block-code"><code>$ fastboot flash boot ./magisk_patched.img 
Sending 'boot_b' (65536 KB)                        OKAY &#091;  1.454s]
Writing 'boot_b'                                   OKAY &#091;  0.392s]
Finished. Total time: 1.855s</code></pre>
<h3>ステップ１０　スマホをリブートする</h3>
<p>スマホの画面は、fastbootd になっていますので、「Reboot system now」が選択された状態で電源ボタンを押します。リブートは40秒くらいして、OSが起動しました。</p>
<h3>ステップ１１　確認</h3>
<p>Magiskアプリは以下のようになっていれば、root化は成功しています。Termuxからrootパッケージを入れて、su　すると許可画面が出るのでOKしておけば以下のようにスーパーユーザーの画面に出てきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="945" height="887" src="/wp-content/uploads/2020/10/magisk-ss.png" alt="" class="wp-image-9767" srcset="/wp-content/uploads/2020/10/magisk-ss.png 945w, /wp-content/uploads/2020/10/magisk-ss-768x721.png 768w" sizes="(max-width: 945px) 100vw, 945px"></noscript>
<img width="945" height="887" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20945%20887%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/magisk-ss.png" alt="" class="lazyload wp-image-9767" data-srcset="/wp-content/uploads/2020/10/magisk-ss.png 945w, /wp-content/uploads/2020/10/magisk-ss-768x721.png 768w" data-sizes="(max-width: 945px) 100vw, 945px"></figure></div>
<p>逆にアプリから隠したい場合は、MagiskHideからアプリを選択しておきます。Termux側からの操作、例えばrootパッケージを入れてどうなったかなどは次回また紹介することにします。あと、<strong>OSの自動アップデートはOff</strong>にしておいてくださいね。ここ、めちゃ大事。開発者オプションから選択できます。</p>
<h3>まとめ</h3>
<p>今回、作業してみての感想やまとめは以下です。</p>
<p>・root化は久しぶりで事情がだいぶ変わっていた<br>・Magiskアプリはよくできている<br>・TWRPは、対応したらやってみる。たぶんUmidigiF2でやることになりそう<br>・日本語で、まとまっているサイトがなかった<br>・今年中にまたOSアップデートが来ると思うが、その時は状況みて導入するか考える</p>
<h3>あとがき</h3>
<p>ステップ９はわけるべきだったか迷いました。まぁ、流れは書き込みなのでいいかな？w　で、root化すると、tcpdump も使い放題、他のアプリ領域のデータも見放題となり、随分いろいろと物色してしまいました。また、当初の目標だった、1024ポート以下のサービス起動も問題なくできていろいろできることが増えそうです。</p>
<p>　あと、termux-root-packagesを見ていると知らないアプリがあって興味津々です。たとえば、tincとかっていうVPNデーモン。これすごく使いやすそうです。</p>
<h3>著者にメッセージ</h3>
<p>コメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9748" class="post-9748 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/03/termux-pixel3-unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-03T04:30:36+09:00">2020年10月3日</time><time class="updated" datetime="2020-10-07T06:54:46+09:00">2020年10月7日</time></a> </span><span class="posted-on">更新日:2020年10月7日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/03/termux-pixel3-unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal">備忘録：Termuxで、Pixel3のUnixBench</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>Pixel3が来たんでUnixBenchとっておきます！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>あ〜、<s>ごみ</s>ジャンクなPixel3が到着したのね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>・・・いちいち、ジャンク〜と言うのね！w</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ごみ、よりいいでしょ？w</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>はい、ジャンクなPixel3が到着しました。メルカリは面白いですね。値下げ文化みたいなのがあって、売り手と買い手のせめぎ合いです。今回、自分はそういうのには参加せず、8500円まで値下げされていた状態で発見しました。さらに、買い手が7500円でどうか？と打診中に、8500円でゲットしたという感じです。ヤフオクはそういうのがないので、なんか新鮮に感じましたが、売り手は慣れないと「まーた、値下げかよ！」みたいな感じになるのかなと。Pixel３は発売価格9．５万円ですからね！</p>
<h3>なぜ、今頃Pixel3なんかゲットしたの？</h3>
<p>え〜っとw。目的は root化した状態の termux で遊びたかったからです。UmidigiF2はこのブログが動作しているので、あれこれできないのです。</p>
<p>で、どうせなら、Umidigi F2 よりも速そうで Androidリファレンス機のPixelシリーズが良いな！　という感じです。Pixelという機種は、知らない人もいるかもしれませんが Google から発売されている機種で、AndroidOSの最新版が最初にリリースされます。つい最近も、Android11がリリースされましたよね！なので、いち早くandroidOSの最新にアップデートできます。</p>
<h3>アプリ開発者とPixel</h3>
<p>　アプリ開発者は、1年に1回9月ごろにAndroidOSのアップデートがあるので、情報調査など春頃から準備しています。9月には新しいOSが出るから、それにアプリを対応させるんです。これは慣例作業なので、大概アプリ開発やってる人や会社は、Pixelシリーズを持っています。iOSもこの時期にOSアップデートがあり、アプリ開発者は新年度〜秋にかけて大忙しです。iosとandroidの両方のアプリが扱っているので結構大変ですが、一番面白い時期でもあります。</p>
<p>　また、秋〜春にかけては新しいOSが実装した新機能にアプリをどう対応させるのか、またその機能を実装するのか？など様々な検討が繰り広げられています。つまり、1年中あれこれやることが嫌でもあるわけです。</p>
<h3>まずはAntutu8 でベンチマーク</h3>
<p>Antutuの情報はたくさんあるんですが、意図的にPixel3で OS10とOS11でベンチマークした結果はほぼ無いと思うので、載せておきます。なお、Antutuは何も意識しないと常駐するのでOS初期化後に入れて計測したら速攻、消したほうがいいです。そのうち、この指標も違うものがスタンダードになると思うのですが、今は antutuスコアがピンときますよね。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="796" height="741" src="/wp-content/uploads/2020/10/antutu_bench.png" alt="" class="wp-image-9750" srcset="/wp-content/uploads/2020/10/antutu_bench.png 796w, /wp-content/uploads/2020/10/antutu_bench-768x715.png 768w" sizes="(max-width: 796px) 100vw, 796px"></noscript>
<img width="796" height="741" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20796%20741%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/antutu_bench.png" alt="" class="lazyload wp-image-9750" data-srcset="/wp-content/uploads/2020/10/antutu_bench.png 796w, /wp-content/uploads/2020/10/antutu_bench-768x715.png 768w" data-sizes="(max-width: 796px) 100vw, 796px"></figure></div>
<p>約、２５マン〜２７マンで今ではミドルクラスの上位というスコアです。計測の誤差なのか、少しAndroid11で計測したときの方が速くなっていますね。Kernel周りの影響か、チューニングを変えて来たのかそのあたりは不明です。</p>
<p>計測時のKernelバージョンは以下となります。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="791" height="735" src="/wp-content/uploads/2020/10/pixel10-11.png" alt="" class="wp-image-9751" srcset="/wp-content/uploads/2020/10/pixel10-11.png 791w, /wp-content/uploads/2020/10/pixel10-11-768x714.png 768w" sizes="(max-width: 791px) 100vw, 791px"></noscript>
<img width="791" height="735" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20791%20735%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/pixel10-11.png" alt="" class="lazyload wp-image-9751" data-srcset="/wp-content/uploads/2020/10/pixel10-11.png 791w, /wp-content/uploads/2020/10/pixel10-11-768x714.png 768w" data-sizes="(max-width: 791px) 100vw, 791px"></figure></div>
<h3>Termux入れて、設定</h3>
<p>termuxを入れて、アプリが良い状態で動作するよう以下の設定をやっておきます。</p>
<p>・Wakelockを有効にしておく。</p>
<p>画面右の状態にしておきます。wakelockとは何か知りたい人は以下を参照してね。Termuxは、wakelockしておくか、しないか選択できるようになっています。</p>
<blockquote class="wp-block-quote">
<p>デバイスの起動状態を維持する</p>
<cite><a href="https://developer.android.com/training/scheduling/wakelock?hl=ja" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://developer.android.com/training/scheduling/wakelock?hl=ja<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="794" height="739" src="/wp-content/uploads/2020/10/8.png" alt="" class="wp-image-9752" srcset="/wp-content/uploads/2020/10/8.png 794w, /wp-content/uploads/2020/10/8-768x715.png 768w" sizes="(max-width: 794px) 100vw, 794px"></noscript>
<img width="794" height="739" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20794%20739%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/8.png" alt="" class="lazyload wp-image-9752" data-srcset="/wp-content/uploads/2020/10/8.png 794w, /wp-content/uploads/2020/10/8-768x715.png 768w" data-sizes="(max-width: 794px) 100vw, 794px"></figure></div>
<p>・電池の最適化をしない　設定にしておく</p>
<p>この表現、紛らわしいですよね！　つまり、標準ではシステム関連のプリイン・アプリの一部以外、つまりストアから入れたアプリは、最適化していて電池消費を抑える仕組みです。これを意図的に、「最適化しない」状態にしておきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="430" height="864" src="/wp-content/uploads/2020/10/7.png" alt="" class="wp-image-9753"></noscript>
<img width="430" height="864" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20430%20864%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/7.png" alt="" class="lazyload wp-image-9753"></figure></div>
<h3>UnixBenchiを計測！</h3>
<p>結果から。どちらも1回限りの結果ですので計測誤差の範囲かと思います。</p>
<p>・Pixel3 Android10の場合<br>　CPU：Snapdragon 845<br>　Hardware : Qualcomm Technologies, Inc SDM845</p>
<blockquote class="wp-block-quote"><p>シングル：546.9<br>8CPU：1396.4</p></blockquote>
<p>・Pixel3 Android11の場合</p>
<blockquote class="wp-block-quote"><p>シングル：520.0<br>8CPU：1343.3</p></blockquote>
<p>・Pixel3 Android11　<strong>再計測</strong></p>
<blockquote class="wp-block-quote"><p>シングル：590.1<br>8CPU：1732.6</p></blockquote>
<p>UmidigiF2や、Redmi Note 9S より速いですね。比較のため、スコアを載せておきます。</p>
<p>・UmidigiF2 Android10の場合<br>　CPU MediaTek Helio P70<br>　Hardware : MT6771V/CT</p>
<blockquote class="wp-block-quote"><p>シングルCPU・・・スコア406.2<br>8CPU・・・・・・スコア1312.3</p></blockquote>
<p>・Redmi Note 9S Android10の場合<br>　CPU:Qualcomm&nbsp;Snapdragon 720G<br>　Hardware : Qualcomm Technologies, Inc SM7125</p>
<blockquote class="wp-block-quote"><p>シングルCPU・・・スコア571.9<br>8CPU・・・・・・スコア1127.1</p></blockquote>
<p>詳細は以下に載せておきます。インストール方法は、以下参照してね。</p>
<blockquote class="wp-block-quote"><p><a href="/2020/08/29/%e8%a1%9d%e6%92%83%e4%be%a1%e6%a0%bc7500%e5%86%86%e3%81%a7%e3%82%b2%e3%83%83%e3%83%88%e3%81%97%e3%81%9fredmi-note-9s%e3%81%ablinux%e5%85%a5%e3%82%8c%e3%81%a6unixbench%e3%82%92%e8%a8%88%e6%b8%ac/" data-type="post" data-id="5786" data-wpel-link="internal" rel="noopener noreferrer">衝撃価格7500円でゲットしたRedmi Note 9SにLinux入れてUnixBenchを計測</a></p></blockquote>
<p>・Android10の場合</p>
<pre class="wp-block-code"><code>$ cat /proc/cpuinfo | head
Processor	: AArch64 Processor rev 13 (aarch64)
processor	: 0
BogoMIPS	: 38.00
Features	: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp
CPU implementer	: 0x51
CPU architecture: 8
CPU variant	: 0x7
CPU part	: 0x803
CPU revision	: 12

========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.9.210-g28c696160049-ab6386370 -- #0 SMP PREEMPT Fri Apr 10 23:00:22 UTC 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   13:25:54 up  1:07,  load average: 6.94, 6.06, 4.72; runlevel 

------------------------------------------------------------------------
Benchmark Run: Fri Oct 02 2020 13:25:54 - 13:54:01
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       29151129.2 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6277.5 MWIPS (9.9 s, 7 samples)
Execl Throughput                                308.0 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        425891.2 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          167742.2 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1012005.2 KBps  (30.0 s, 2 samples)
Pipe Throughput                             1057618.2 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  49668.9 lps   (10.0 s, 7 samples)
Process Creation                               1233.6 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1388.6 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    478.6 lpm   (60.1 s, 2 samples)
System Call Overhead                        1024417.8 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   29151129.2   2498.0
Double-Precision Whetstone                       55.0       6277.5   1141.4
Execl Throughput                                 43.0        308.0     71.6
File Copy 1024 bufsize 2000 maxblocks          3960.0     425891.2   1075.5
File Copy 256 bufsize 500 maxblocks            1655.0     167742.2   1013.5
File Copy 4096 bufsize 8000 maxblocks          5800.0    1012005.2   1744.8
Pipe Throughput                               12440.0    1057618.2    850.2
Pipe-based Context Switching                   4000.0      49668.9    124.2
Process Creation                                126.0       1233.6     97.9
Shell Scripts (1 concurrent)                     42.4       1388.6    327.5
Shell Scripts (8 concurrent)                      6.0        478.6    797.7
System Call Overhead                          15000.0    1024417.8    682.9
                                                                   ========
System Benchmarks Index Score                                         546.9

------------------------------------------------------------------------
Benchmark Run: Fri Oct 02 2020 13:54:01 - 14:22:44
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables       91224897.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    23800.2 MWIPS (9.6 s, 7 samples)
Execl Throughput                               1057.6 lps   (29.6 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        401385.2 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          139250.6 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1389559.4 KBps  (30.0 s, 2 samples)
Pipe Throughput                             3891494.8 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 249526.0 lps   (10.0 s, 7 samples)
Process Creation                              11033.1 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   4638.3 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    475.1 lpm   (60.7 s, 2 samples)
System Call Overhead                        3275443.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   91224897.9   7817.0
Double-Precision Whetstone                       55.0      23800.2   4327.3
Execl Throughput                                 43.0       1057.6    246.0
File Copy 1024 bufsize 2000 maxblocks          3960.0     401385.2   1013.6
File Copy 256 bufsize 500 maxblocks            1655.0     139250.6    841.4
File Copy 4096 bufsize 8000 maxblocks          5800.0    1389559.4   2395.8
Pipe Throughput                               12440.0    3891494.8   3128.2
Pipe-based Context Switching                   4000.0     249526.0    623.8
Process Creation                                126.0      11033.1    875.6
Shell Scripts (1 concurrent)                     42.4       4638.3   1093.9
Shell Scripts (8 concurrent)                      6.0        475.1    791.9
System Call Overhead                          15000.0    3275443.3   2183.6
                                                                   ========
System Benchmarks Index Score                                        1396.4</code></pre>
<p>・Android11の場合</p>
<pre class="wp-block-code"><code>========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.9.223-g5bded8e40b62-ab6647920 -- #0 SMP PREEMPT Thu Jul 2 03:22:48 UTC 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   19:02:02 up 18 min,  load average: 2.42, 2.89, 2.08; runlevel 

------------------------------------------------------------------------
Benchmark Run: Fri Oct 02 2020 19:02:02 - 19:30:09
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       27896830.6 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6039.7 MWIPS (10.0 s, 7 samples)
Execl Throughput                                281.0 lps   (29.6 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        401241.9 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          139431.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1020201.2 KBps  (30.0 s, 2 samples)
Pipe Throughput                              826721.2 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  48668.2 lps   (10.0 s, 7 samples)
Process Creation                               1540.1 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1008.3 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    514.6 lpm   (60.1 s, 2 samples)
System Call Overhead                        1128058.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   27896830.6   2390.5
Double-Precision Whetstone                       55.0       6039.7   1098.1
Execl Throughput                                 43.0        281.0     65.4
File Copy 1024 bufsize 2000 maxblocks          3960.0     401241.9   1013.2
File Copy 256 bufsize 500 maxblocks            1655.0     139431.4    842.5
File Copy 4096 bufsize 8000 maxblocks          5800.0    1020201.2   1759.0
Pipe Throughput                               12440.0     826721.2    664.6
Pipe-based Context Switching                   4000.0      48668.2    121.7
Process Creation                                126.0       1540.1    122.2
Shell Scripts (1 concurrent)                     42.4       1008.3    237.8
Shell Scripts (8 concurrent)                      6.0        514.6    857.6
System Call Overhead                          15000.0    1128058.3    752.0
                                                                   ========
System Benchmarks Index Score                                         520.0

------------------------------------------------------------------------
Benchmark Run: Fri Oct 02 2020 19:30:09 - 19:58:33
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables       95077365.5 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    24278.9 MWIPS (10.0 s, 7 samples)
Execl Throughput                               1177.7 lps   (30.0 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        428589.2 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          124505.1 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1293287.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                             3825103.0 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 299481.8 lps   (10.0 s, 7 samples)
Process Creation                              10720.9 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   3892.1 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    386.7 lpm   (60.7 s, 2 samples)
System Call Overhead                        2499234.1 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   95077365.5   8147.2
Double-Precision Whetstone                       55.0      24278.9   4414.3
Execl Throughput                                 43.0       1177.7    273.9
File Copy 1024 bufsize 2000 maxblocks          3960.0     428589.2   1082.3
File Copy 256 bufsize 500 maxblocks            1655.0     124505.1    752.3
File Copy 4096 bufsize 8000 maxblocks          5800.0    1293287.0   2229.8
Pipe Throughput                               12440.0    3825103.0   3074.8
Pipe-based Context Switching                   4000.0     299481.8    748.7
Process Creation                                126.0      10720.9    850.9
Shell Scripts (1 concurrent)                     42.4       3892.1    917.9
Shell Scripts (8 concurrent)                      6.0        386.7    644.6
System Call Overhead                          15000.0    2499234.1   1666.2
                                                                   ========
System Benchmarks Index Score                                        1343.3</code></pre>
<h3>追記：10/07</h3>
<p>再度、ベンチマーク測っていたらもっと良いスコアが出た。気温とか関係あるのかな？　室温24度でちょっと肌寒くなってきたときに計測したもの。</p>
<p>・Pixel3 Android11　再計測</p>
<blockquote class="wp-block-quote"><p>シングル：590.1<br>8CPU：1732.6</p></blockquote>
<p>この時、CPUのクロックは以下となっていました。6881と、1766400と、2803200</p>
<pre class="wp-block-code"><code># cat /sys/devices/platform/soc/soc:qcom,mincpubw/devfreq/soc:qcom,mincpubw/cur_freq
6881
# cat  /sys/devices/system/cpu/cpufreq/policy0/cpuinfo_cur_freq
1766400
# cat  /sys/devices/system/cpu/cpufreq/policy/cpuinfo_cur_freq
policy0/ policy4/ 
# cat  /sys/devices/system/cpu/cpufreq/policy4/cpuinfo_cur_freq
2803200</code></pre>
<p>平常時には、この値は以下。762と、748800と、825600</p>
<pre class="wp-block-code"><code># cat /sys/devices/platform/soc/soc:qcom,mincpubw/devfreq/soc:qcom,mincpubw/cur_freq
762
# cat  /sys/devices/system/cpu/cpufreq/policy0/cpuinfo_cur_freq
748800
# cat  /sys/devices/system/cpu/cpufreq/policy4/cpuinfo_cur_freq
825600</code></pre>
<p>これが、良い値が出た時です。計測誤差の範囲を超えているのでメモっておきます。冷蔵庫とか冷凍庫とかに入れて計測したらもう少しよくなるのかも。</p>
<pre class="wp-block-code"><code>========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.9.223-g5bded8e40b62-ab6647920 -- #0 SMP PREEMPT Thu Jul 2 03:22:48 UTC 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   05:38:19 up 2 days, 19:49,  load average: 0.50, 0.43, 0.44; runlevel 

------------------------------------------------------------------------
Benchmark Run: Wed Oct 07 2020 05:38:19 - 06:06:26
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       29316819.1 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6350.0 MWIPS (10.0 s, 7 samples)
Execl Throughput                                364.2 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        442024.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          190751.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1076696.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                             1154520.1 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  56229.7 lps   (10.0 s, 7 samples)
Process Creation                               1221.6 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1494.6 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    519.6 lpm   (60.1 s, 2 samples)
System Call Overhead                        1181160.9 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   29316819.1   2512.2
Double-Precision Whetstone                       55.0       6350.0   1154.6
Execl Throughput                                 43.0        364.2     84.7
File Copy 1024 bufsize 2000 maxblocks          3960.0     442024.5   1116.2
File Copy 256 bufsize 500 maxblocks            1655.0     190751.4   1152.6
File Copy 4096 bufsize 8000 maxblocks          5800.0    1076696.0   1856.4
Pipe Throughput                               12440.0    1154520.1    928.1
Pipe-based Context Switching                   4000.0      56229.7    140.6
Process Creation                                126.0       1221.6     97.0
Shell Scripts (1 concurrent)                     42.4       1494.6    352.5
Shell Scripts (8 concurrent)                      6.0        519.6    866.0
System Call Overhead                          15000.0    1181160.9    787.4
                                                                   ========
System Benchmarks Index Score                                         590.1

------------------------------------------------------------------------
Benchmark Run: Wed Oct 07 2020 06:06:26 - 06:34:46
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables      117327891.2 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    31178.6 MWIPS (10.1 s, 7 samples)
Execl Throughput                               1466.5 lps   (29.8 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        667533.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          204691.5 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1852436.2 KBps  (30.0 s, 2 samples)
Pipe Throughput                             5170382.3 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 181908.1 lps   (10.0 s, 7 samples)
Process Creation                              12532.5 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   5742.0 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    734.3 lpm   (60.2 s, 2 samples)
System Call Overhead                        2722146.3 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0  117327891.2  10053.8
Double-Precision Whetstone                       55.0      31178.6   5668.8
Execl Throughput                                 43.0       1466.5    341.0
File Copy 1024 bufsize 2000 maxblocks          3960.0     667533.5   1685.7
File Copy 256 bufsize 500 maxblocks            1655.0     204691.5   1236.8
File Copy 4096 bufsize 8000 maxblocks          5800.0    1852436.2   3193.9
Pipe Throughput                               12440.0    5170382.3   4156.3
Pipe-based Context Switching                   4000.0     181908.1    454.8
Process Creation                                126.0      12532.5    994.6
Shell Scripts (1 concurrent)                     42.4       5742.0   1354.2
Shell Scripts (8 concurrent)                      6.0        734.3   1223.8
System Call Overhead                          15000.0    2722146.3   1814.8
                                                                   ========
System Benchmarks Index Score                                        1732.6</code></pre>
<h3>まとめ</h3>
<p>まとめるほどの記事ではないですが、要点を書いておきます。</p>
<p>・Pixel3は、シングル約550、マルチ8coreで1400くらいのUnixBenchスコア<br>・手持ちのスマホの中では一番速い<br>・antutuは、27マンくらいだが、GPUは使わないのでTermuxではもったいない<br>・今後、root化してtermuxで遊んでみようと思う<br>・再計測したら、1700超えていた。温度が関係しているくさい。</p>
<h3>あとがき</h3>
<p>あともう少しで、1400に届きそうでしたが2年前のハイエンドクラスなので検討していますよね。UnixBenchの結果にはグラフィックス性能が含まれないので、UmidigiF2や、Redmi Note 9S&nbsp;と比べてもさほど変わらない感じですね。</p>
<p>　安くて、CPU性能が高いのはいろいろ検討した結果、MediaTek Dimensity 1000+　がいいんじゃないかなーと。このチップは、vivo iqoo z1とかに乗っていて antutuは、CPUで１８万、トータルで５０万を超えています。</p>
<p>　これ、Termux上のUnixBenchだと2500は超えてきそうですよね！いつか、入手して確認してみたいなと思います。中古ではあまり出回っていないので、画面割れとかジャンクが出るまでは無理ですが。アリエクから新品で買っても3.4万くらいなんでさほど高くはないです。しかし遊びどきは、５Gが普及するあと１、２年後〜が中古市場に出回る時期かなと思います。</p>
<p>別の見方をすれば、あと１、２年すればUnixBench2000〜3000で動作するスマホが、5000円とか１万未満の中古で買えちゃうってことです！</p>
<p>　ARMチップが乗ったスマホの活用の夢が膨らみます！</p>
<p>あと、画面割れのPixel3ですがもし画面を修理するならアリエクで9500円くらいで部品は入りそうです。まぁ、しかしそれほどひどい割れでもないですから、このまま使うかなと。なんか、直したら負けな気がします。w</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9705" class="post-9705 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/09/30/termux-smtp-client/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-09-30T21:32:00+09:00">2020年9月30日</time><time class="updated" datetime="2020-10-01T04:49:14+09:00">2020年10月1日</time></a> </span><span class="posted-on">更新日:2020年10月1日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/09/30/termux-smtp-client/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxからメールを送れるようにするには？</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>コマンドラインからメールを送れるようにしたいね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>え？メール送れないの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今のところはね。よさげなアプリを物色中〜！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>てか、最近Lineばっかりでメールあんまりしてないな。</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>さて、今回はメールを取り扱います。ですが、別にメールサーバを作るわけではないです。やりたい事は、こんな感じ。</p>
<p>・コマンドラインからメールを送れるようにしたい<br>・WordPressのプラグインからメールを送れるにしたい<br>・Cronとかの結果をメールできるようにしたい<br>・配送先はgmail！</p>
<h3>Termux環境でお手軽にメールを送るには？</h3>
<p>メールを取り扱うってことは、いろいろ用意する必要がありますが、今回はメールを他のサーバに送るだけです。Termuxでメールを受信したり、imapのメールを読み書きして送受信したり、あるいは他のサーバからリレーしたりということは今回はしません。内部配送もtermux は１ユーザしかいないのでしません。このあたり、MTAとかMUAとかMDAとか用語がありますが、興味のあるかたはここがわかりやすいです。</p>
<blockquote class="wp-block-quote">
<p>メール転送エージェント (MTA)</p>
<cite><a href="https://wa3.i-3-i.info/word11120.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://wa3.i-3-i.info/word11120.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>そんなこたぁーわかっとる！　っていうベテランも改めてどうぞw</p>
<blockquote class="wp-block-quote">
<p>メール設定で最初につまずく『SMTP』『POP』『IMAP』 その意味＆設定方法は？</p>
<cite><a href="https://time-space.kddi.com/ict-keywords/kaisetsu/20170824/2081" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://time-space.kddi.com/ict-keywords/kaisetsu/20170824/2081<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>つまりは、SMTPクライアントだけあればいいんです。</p>
<h3>お手軽なSMTPクライアント！msmtp</h3>
<p>一般的なLinuxなら、postfixとかsendmailとかありますよね。でもTermuxのバイナリにはありません。でも、SMTPクライアントならあります。</p>
<blockquote class="wp-block-quote">
<p>msmtp</p>
<cite><a href="https://marlam.de/msmtp/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://marlam.de/msmtp/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>これ、実は今まで知りませんでした！　一応、メールサーバ関連はsendmailや、qmailや、postfixはさわった事があるのですが msmtpってのは取り扱う機会もなくて、こんなのがあったのかという印象です。機能は、こんな感じ！</p>
<ul>
<li>Sendmail互換インターフェイス（コマンドラインオプションと終了コード）</li>
<li>複数のアカウントのサポート</li>
<li>クライアント証明書を含むTLS / SSLサポート</li>
<li>国際化ドメイン名（IDN）のサポート</li>
<li>多くの認証方法</li>
<li>コマンドパイプラインを使用した高速SMTP実装</li>
<li>DSN（配信ステータス通知）のサポート</li>
<li>SOCKSプロキシサポート</li>
</ul>
<h3>ステップ１　とにかく入れてみる！</h3>
<p>まずは、使ってみましょう。インストールは簡単です。</p>
<pre class="wp-block-code"><code>$ pkg install msmtp</code></pre>
<p>このあたりに入るようです。</p>
<pre class="wp-block-code"><code>$ find $PREFIX -name *msmtp*
/data/data/com.termux/files/usr/bin/msmtpd
/data/data/com.termux/files/usr/bin/msmtp
/data/data/com.termux/files/usr/var/lib/dpkg/info/msmtp.list
/data/data/com.termux/files/usr/var/lib/dpkg/info/msmtp.md5sums
/data/data/com.termux/files/usr/share/doc/msmtp
/data/data/com.termux/files/usr/share/info/msmtp.info
/data/data/com.termux/files/usr/share/man/man1/msmtp.1.gz
/data/data/com.termux/files/usr/share/man/man1/msmtpd.1.gz</code></pre>
<h3>ステップ２　設定</h3>
<p>ここの説明がわかりやすかったです。参考にしました。</p>
<blockquote class="wp-block-quote">
<p>msmtp &#8211; ArchWiki</p>
<cite><a href="https://wiki.archlinux.jp/index.php/Msmtp" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://wiki.archlinux.jp/index.php/Msmtp<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>つまりは、以下の設定ファイルを書けばOKです。システム全体は etc 配下に書きますが、今回はホームディレクトリ直下です。gmailのsmtpを使います。</p>
<pre class="wp-block-code"><code>~/.msmtprc
------------------
# Set default values for all following accounts.
defaults
auth           on
tls            on
tls_trust_file /data/data/com.termux/files/usr/etc/tls/cert.pem
logfile        ~/.msmtp.log

# Gmail
account        gmail
host           smtp.gmail.com
port           587
from           username@gmail.com
user           username
password       plain-text-password

# Set a default account
account default : gmail</code></pre>
<p>デフォルトのCA証明書は、opensslがどっかに持っていると思い、どこにあるかわからなかったので以下のように調べました。直接ダウンロードしてどこかに保存しておいても良いのですが。</p>
<pre class="wp-block-code"><code>$ which openssl
/data/data/com.termux/files/usr/bin/openssl
$ ldd /data/data/com.termux/files/usr/bin/openssl
libssl.so.1.1
libcrypto.so.1.1
libc.so

$ find $PREFIX -name libcrypto.so
/data/data/com.termux/files/usr/lib/libcrypto.so
$ ls -l /data/data/com.termux/files/usr/lib/libcrypto.so
lrwxrwxrwx 1 u0_a364 u0_a364 18 Sep 30 05:12 /data/data/com.termux/files/usr/lib/libcrypto.so -> libcrypto.so.1.1

$ cd $PREFIX/lib
$ strings libssl.so | grep -P '^/\w+/'
/data/data/com.termux/files/usr/lib

$ strings libcrypto.so | grep -P '^/\w+/'
/data/data/com.termux/files/usr/lib
/data/data/com.termux/files/usr/etc/tls/ct_log_list.cnf
/data/data/com.termux/files/usr/lib/engines-1.1
/dev/urandom
/dev/random
/dev/hwrng
/dev/srandom
/dev/tty
/data/data/com.termux/files/usr/etc/tls/private
/data/data/com.termux/files/usr/etc/tls
/data/data/com.termux/files/usr/etc/tls/certs
/data/data/com.termux/files/usr/etc/tls/cert.pem

$ tree -N /data/data/com.termux/files/usr/etc/tls
/data/data/com.termux/files/usr/etc/tls
　├── cert.pem
　└── openssl.cnf</code></pre>
<p>今回必須ではないですが、このサーバのIPをSPFテキストレコードに追加しておきました。MTAをビルドしてテストするかもしれません。この機会に書いておきます。</p>
<pre class="wp-block-code"><code>$ dig -t txt gpl.jp
::
;; ANSWER SECTION:
gpl.jp.			3599	IN	TXT	"v=spf1 +ip4:124.41.83.243 +ip4:106.185.159.254 +ip4:116.58.181.140 +a:www.gpl.jp +a:mail.gpl.jp include:aspmx.googlemail.com include:_spf.google.com ~all"</code></pre>
<h3>ステップ３　送信テスト</h3>
<p>とりあえず、送信テストです。</p>
<pre class="wp-block-code"><code>$ msmtp -t
To: who@example.jp
Subject: Hello World.

Hi.
これはテストメールです。</code></pre>
<p>認証でエラーが出る場合は、Gmailの以下を確認してみてください。</p>
<blockquote class="wp-block-quote">
<p>安全性の低いアプリのアクセス</p>
<cite><a href="https://myaccount.google.com/lesssecureapps" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://myaccount.google.com/lesssecureapps<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>これをOnにすれば、認証に通りメール送信できます。ちゃんと届いていました！gmailはUTF-8でも文字化けしませんね。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="517" height="350" src="/wp-content/uploads/2020/09/msmtp-mail.png" alt="" class="wp-image-9710"></noscript>
<img width="517" height="350" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20517%20350%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/msmtp-mail.png" alt="" class="lazyload wp-image-9710"></figure></div>
<p>SPFもパスしていて、問題ないようでした。</p>
<figure class="wp-block-image size-large"><noscript><img width="680" height="327" src="/wp-content/uploads/2020/09/spf.png" alt="" class="wp-image-9711"></noscript>
<img width="680" height="327" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20680%20327%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/spf.png" alt="" class="lazyload wp-image-9711"></figure><p>DKIMは、googleのやつです。</p>
<h3>ステップ４　コマンドラインでメール！</h3>
<p>当初やりたかったことの１つです。コマンドラインの結果などをメールしたかったんです。例えば、lsの結果をメールしておきたい場合とか、</p>
<pre class="wp-block-code"><code>$ ls -l /system/etc | msmtp junkhack@gpl.jp</code></pre>
<p>topの結果を送っておきたいとか、</p>
<pre class="wp-block-code"><code>$ top -b -d 1 -n 30 | msmtp junkhack@gpl.jp</code></pre>
<p>なにかの設定ファイルを送っておきたいとか、</p>
<pre class="wp-block-code"><code>$ cat php-fpm.conf | msmtp junkhack@gpl.jp</code></pre>
<p>こんな感じです。題名のないメールですが送れます。同じようにcrontab にもパイプしておけばメールが飛んできます。cronをシステムワイドに設定する方法は詳細を省きますが、いろいろ試してうまく行きませんでした。</p>
<h3>ステップ５　PHP でメールを送信</h3>
<p>自作のメールフォームを作ることはないかもしれませんが、PHPの設定をしておくと何かと便利かなと。php.ini に以下を記載。termux のphp.ini は自分で作成です。</p>
<p>パスは、/data/data/com.termux/files/usr/lib/php.ini</p>
<pre class="wp-block-code"><code>&#091;mail function]
sendmail_path = "/data/data/com.termux/files/usr/bin/msmtp -C /data/data/com.termux/files/home/.msmtprc -t"</code></pre>
<p>php-fpm を再起動して、テスト用のphpで確認しておきます。</p>
<pre class="wp-block-code"><code>&lt;?php
     mail("hoge@example.jp", "Test email from PHP", "msmtp as sendmail for PHP");
?></code></pre>
<p>ブラウザーから、このPHPを叩くとメールが送られるはずです。届いたメールヘッダーは、SPFもDKIMもPASSです。</p>
<figure class="wp-block-image size-large"><noscript><img width="682" height="325" src="/wp-content/uploads/2020/09/phpmail.png" alt="" class="wp-image-9720"></noscript>
<img width="682" height="325" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20682%20325%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/phpmail.png" alt="" class="lazyload wp-image-9720"></figure><p>他、以下のサンプルコード（mb_send_mail関数）とかも問題なく動作します。</p>
<blockquote class="wp-block-quote">
<p>誰でも実装できる！PHPでメール送信を行う方法【初心者向け】</p>
<cite><a href="https://techacademy.jp/magazine/11629" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://techacademy.jp/magazine/11629<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<h3>ステップ６　WordPress でメールを送信</h3>
<p>WordPressのプラグインからメールするっていうことはPHPの設定をそのまま引き継ぐと思っていたのですが、実際にやってみるとWordPressは、PHPMailerを使って、直接MXへ配送しているようです。</p>
<pre class="wp-block-code"><code>PHPMailer 6.1.6 (https://github.com/PHPMailer/PHPMailer) </code></pre>
<p>なので、php.ini の<strong>sendmail_path</strong>を使った配送にはならないのがデフォルトの挙動のようです。ヘッダーには、SPFもDKIMもありません。これだと、迷惑メールフォルダに分類されてしまいます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="858" height="240" src="/wp-content/uploads/2020/09/wp-phpmailer.png" alt="" class="wp-image-9721" srcset="/wp-content/uploads/2020/09/wp-phpmailer.png 858w, /wp-content/uploads/2020/09/wp-phpmailer-768x215.png 768w" sizes="(max-width: 858px) 100vw, 858px"></noscript>
<img width="858" height="240" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20858%20240%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/wp-phpmailer.png" alt="" class="lazyload wp-image-9721" data-srcset="/wp-content/uploads/2020/09/wp-phpmailer.png 858w, /wp-content/uploads/2020/09/wp-phpmailer-768x215.png 768w" data-sizes="(max-width: 858px) 100vw, 858px"></figure></div>
<p>なので、<strong>WP Mail SMTP</strong>プラグインを使った方法でやっておきます。これは、SMTPクライアントの機能を持っています。つまりは、msmtpと同じようなことができます。この辺りはいくらでも情報があるので省略です。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・msmtpは、お手軽でスマホで作るサーバにはぴったりのSMTPクライアント<br>・gmailにTLSで送れる<br>・コマンドラインからパイプでメールが送れるようになった<br>・cron にも、パイプしておけばメールは飛んでくる<br>・php.ini のsendmail_path にmsmtpを指定しておけばPHPプログラムのmail関数から配送可能<br>・しかし、WordPressは、PHPMailerを使って直接MXへ配送しているようだ<br>・なので、とりあえず<strong>WP Mail SMTP</strong>プラグインを使う<br>・直接、WordPressからphp.ini のsendmail_path に配送するにはどうしたらいいだろう？<br>・機会があれば、wp_mail()を上書きするプラグインを作ってみる</p>
<h3>あとがき</h3>
<p>とりあえず、やりたいことはほぼ満たせました。msmtpは、スマホで動作するTermux環境にぴったりですね。ただ、配送に失敗した場合などキューにたまらない設計だと思いますので、そのあたりいろいろ考えると面倒です。が、今回は割り切って使うことにします。</p>
<h3>著者にメッセージ</h3>
<p>コメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9696" class="post-9696 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/09/28/termux_huawei_p20_lite_unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-09-28T22:41:36+09:00">2020年9月28日</time><time class="updated" datetime="2020-09-28T22:42:00+09:00">2020年9月28日</time></a> </span><span class="posted-on">更新日:2020年9月28日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/09/28/termux_huawei_p20_lite_unixbench/" rel="bookmark noopener noreferrer" data-wpel-link="internal">備忘録：Termuxで、 HUAWEI P20 liteのUnixBench</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ちょっと備忘録、書いておきます！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>メモ的なものをブログに書くの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>あとで検索して参照できるようにね。それに書いておけば誰かの役に立つかも。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>あ〜、それはあるかもね。</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>ちょっと、手持ちのスマホでTermux入れてUnixBenchを取っておきました。今回は、HUAWEI P20 liteです。</p>
<h3>スコアは？</h3>
<p>結果から。</p>
<blockquote class="wp-block-quote"><p>シングル：260.3<br>マルチ：932.8</p></blockquote>
<p>詳細は以下。インストール方法は、以下参照してね。</p>
<blockquote class="wp-block-quote"><p><a href="/2020/08/29/%e8%a1%9d%e6%92%83%e4%be%a1%e6%a0%bc7500%e5%86%86%e3%81%a7%e3%82%b2%e3%83%83%e3%83%88%e3%81%97%e3%81%9fredmi-note-9s%e3%81%ablinux%e5%85%a5%e3%82%8c%e3%81%a6unixbench%e3%82%92%e8%a8%88%e6%b8%ac/" data-type="post" data-id="5786" data-wpel-link="internal" rel="noopener noreferrer">衝撃価格7500円でゲットしたRedmi Note 9SにLinux入れてUnixBenchを計測</a></p></blockquote>
<pre class="wp-block-code"><code>$ uname -a
Linux localhost 4.9.148 #1 SMP PREEMPT Wed Jul 1 02:47:50 CST 2020 aarch64 Android
::
$ cat /proc/cpuinfo
Processor	: AArch64 Processor rev 4 (aarch64)
processor	: 0
BogoMIPS	: 3.84
Features	: fp asimd evtstrm aes pmull crc32
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4
::
========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.9.148 -- #1 SMP PREEMPT Wed Jul 1 02:47:50 CST 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   16:18:43 up 10 days, 23:58,  load average: 38.42, 38.42, 38.81; runlevel 

------------------------------------------------------------------------
Benchmark Run: Mon Sep 28 2020 16:18:43 - 16:46:46
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables        8363204.1 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     2047.9 MWIPS (9.8 s, 7 samples)
Execl Throughput                                128.2 lps   (29.8 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        167326.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           50941.4 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        451669.2 KBps  (30.0 s, 2 samples)
Pipe Throughput                              317299.2 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  59343.3 lps   (10.0 s, 7 samples)
Process Creation                               1418.5 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                    762.5 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    305.9 lpm   (60.1 s, 2 samples)
System Call Overhead                         460331.9 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0    8363204.1    716.6
Double-Precision Whetstone                       55.0       2047.9    372.4
Execl Throughput                                 43.0        128.2     29.8
File Copy 1024 bufsize 2000 maxblocks          3960.0     167326.5    422.5
File Copy 256 bufsize 500 maxblocks            1655.0      50941.4    307.8
File Copy 4096 bufsize 8000 maxblocks          5800.0     451669.2    778.7
Pipe Throughput                               12440.0     317299.2    255.1
Pipe-based Context Switching                   4000.0      59343.3    148.4
Process Creation                                126.0       1418.5    112.6
Shell Scripts (1 concurrent)                     42.4        762.5    179.8
Shell Scripts (8 concurrent)                      6.0        305.9    509.8
System Call Overhead                          15000.0     460331.9    306.9
                                                                   ========
System Benchmarks Index Score                                         260.3

------------------------------------------------------------------------
Benchmark Run: Mon Sep 28 2020 16:46:46 - 17:14:54
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables       64563351.9 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    15851.2 MWIPS (9.8 s, 7 samples)
Execl Throughput                                689.2 lps   (29.7 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        285983.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks           80097.8 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks        758680.0 KBps  (30.0 s, 2 samples)
Pipe Throughput                             2020594.4 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 427478.4 lps   (10.0 s, 7 samples)
Process Creation                               4981.4 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   2721.2 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    326.6 lpm   (60.4 s, 2 samples)
System Call Overhead                        2323008.0 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   64563351.9   5532.4
Double-Precision Whetstone                       55.0      15851.2   2882.0
Execl Throughput                                 43.0        689.2    160.3
File Copy 1024 bufsize 2000 maxblocks          3960.0     285983.5    722.2
File Copy 256 bufsize 500 maxblocks            1655.0      80097.8    484.0
File Copy 4096 bufsize 8000 maxblocks          5800.0     758680.0   1308.1
Pipe Throughput                               12440.0    2020594.4   1624.3
Pipe-based Context Switching                   4000.0     427478.4   1068.7
Process Creation                                126.0       4981.4    395.4
Shell Scripts (1 concurrent)                     42.4       2721.2    641.8
Shell Scripts (8 concurrent)                      6.0        326.6    544.3
System Call Overhead                          15000.0    2323008.0   1548.7
                                                                   ========
System Benchmarks Index Score                                         932.8</code></pre>
<h3>あとがき</h3>
<p>結局CPU性能しか使わないから、CPU性能だけ高いスマホって他、何かないですかねー。1500-2000くらい出るやつでお手頃のがあればいいんだけど。電力ほとんど使わないから、結構使い勝手はあると思うんですよね。</p>
<p>あと、HUAWEIはブートローダーのロックが無料で外せないようになったから今後、買うことはないかなー。結構ファンだったんですが。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9681" class="post-9681 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/09/28/termuxwordpress3/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-09-28T05:30:00+09:00">2020年9月28日</time><time class="updated" datetime="2020-09-28T06:22:14+09:00">2020年9月28日</time></a> </span><span class="posted-on">更新日:2020年9月28日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/09/28/termuxwordpress3/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Termuxネイティブ環境でWordPressのバックアップをどうするか考える。その３</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>上書き保存して版数管理のバックアップができました！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>あ〜！あの<s>せこい作戦</s>工夫した方法できたの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>はい！できました〜。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>私も参考にするから、わかりやすくよろしくね。</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>ということで、今回は完結編です。わかりやすくはできないかもですが、要点を記録しておきますね。</p>
<h3>バックアップスクリプトはプラグインで</h3>
<blockquote class="wp-block-quote">
<p><strong>BackWPup – WordPress Backup Plugin</strong></p>
<cite><a href="https://ja.wordpress.org/plugins/backwpup/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://ja.wordpress.org/plugins/backwpup/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>結局、DBのバックアップスクリプトやファイルの指定などシェルで書かずにワードプレスの↑のプラグインでやることにしました。<strong>BackWPup</strong>の操作方法はググって貰えばわかると思うので、省きますが以下のように７つのジョブをつくることにしました。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="638" height="755" src="/wp-content/uploads/2020/09/f238274b6a8f10977f4b07310c208cb6.png" alt="" class="wp-image-9683"></noscript>
<img width="638" height="755" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20638%20755%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/f238274b6a8f10977f4b07310c208cb6.png" alt="" class="lazyload wp-image-9683"></figure></div>
<p><strong>BackWPup</strong>は、ジョブをwp-cliで叩けるようになっています。そして、それをcronで定期実行するという方法です。wp-cliでは、以下のようにコマンド叩くと、ジョブIDがわかります。</p>
<pre class="wp-block-code"><code>$ wp backwpup jobs
+--------+--------------------+
| Job ID | Name               |
+--------+--------------------+
| 1      | hackgpljp_db       |DBのバックアップ
| 2      | hackgpljp_uploads  |uploadsの必要なものだけ
| 3      | hackgpljp_etc      |Termuxのetc配下の設定ファイル
| 4      | hackgpljp_themes   |テーマファイル
| 5      | hackgpljp_plugins  |プラグイン全部
| 6      | hackgpljp_wpconfig |WordPressの設定関連
| 7      | hackgpljp_log      |Termuxのログ全部
+--------+--------------------+</code></pre>
<p>これらのジョブを実行すると、指定したバックアップディレクトリに圧縮されて保存されます。</p>
<h3>スクリプトは最低限</h3>
<p>プラグインでバックアップしたファイル名にはハッシュ文字列が付いています。このハッシュ文字列は、プラグイン中の設定で消すことができなかったので、スクリプトでファイル名を固定します。rcloneでGoogleDriveに同期したときに上書きされるようにして版数が作られるようにするためです。以下のようなファイルツリーを目指します。</p>
<pre class="wp-block-code"><code>├── hackgpljp_db.zip
├── hackgpljp_etc.zip
├── hackgpljp_log.zip
├── hackgpljp_plugins.zip
├── hackgpljp_themes.zip
├── hackgpljp_uploads.zip
├── hackgpljp_wpconfig.zip
├── log
│   └── backwpup_log.html.gz
└── php.ini</code></pre>
<p>手抜きですが、以下のようなスクリプトができました。</p>
<pre class="wp-block-code"><code>#!/bin/bash
PATH=$PATH:/data/data/com.termux/files/usr/bin:/data/data/com.termux/files/home/bin

#バックアップ先
BACKUP_PATH="/backup/dir/path"
LOG_PATH="/backup/dir/path/log"

# GoogleDrive のrcloneドライブ名
DRIVENAME=01bup
# GoogleDrive の保存ディレクトリ
CPATH=hackgpljp

mv  $BACKUP_PATH/hackgpljp_db_* $BACKUP_PATH/hackgpljp_db.zip
mv  $BACKUP_PATH/hackgpljp_etc_* $BACKUP_PATH/hackgpljp_etc.zip
mv  $BACKUP_PATH/hackgpljp_log_* $BACKUP_PATH/hackgpljp_log.zip
mv  $BACKUP_PATH/hackgpljp_plugins_* $BACKUP_PATH/hackgpljp_plugins.zip
mv  $BACKUP_PATH/hackgpljp_themes_* $BACKUP_PATH/hackgpljp_themes.zip
mv  $BACKUP_PATH/hackgpljp_uploads_* $BACKUP_PATH/hackgpljp_uploads.zip
mv  $BACKUP_PATH/hackgpljp_wpconfig_* $BACKUP_PATH/hackgpljp_wpconfig.zip
cp -p /data/data/com.termux/files/usr/lib/php.ini $BACKUP_PATH/php.ini
mv $LOG_PATH/backwpup_log_* $LOG_PATH/backwpup_log.html.gz

tree -N $BACKUP_PATH
echo ''
echo "rclone sync start : "  `date +'%H:%M:%S.%3N'`
rclone sync $BACKUP_PATH/ $DRIVENAME:$CPATH
echo "rclone sync end   : "  `date +'%H:%M:%S.%3N'`</code></pre>
<h3>cronで定期実行</h3>
<p>termuxはcronもちゃんと動くようです。一番、ネットワークが空いている時間帯に動作させます。まず、WordPressのバックアップジョブを動作させ、一番最後の4:00から動くのは、先ほどのスクリプトです。</p>
<pre class="wp-block-code"><code># hackgpljp_db
30 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 1 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_etc
31 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 3 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_themes
31 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 4 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_plugins 5m
32 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 5 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_wpconfig
37 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 6 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_uploads maybe 10m
38 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 2 --path=/data/data/com.termux/files/home/htdocs_nginx/
# hackgpljp_log
48 03 * * * /data/data/com.termux/files/usr/bin/wp backwpup start 7 --path=/data/data/com.termux/files/home/htdocs_nginx/
##
## Sync Google Drive
##
00 04 * * * /data/data/com.termux/files/home/backup/0_bup_to_googledrive.sh</code></pre>
<p>一応、テストはしてきます。ちなみに、このファイルツリー・約1.1GBのファイルをsyncするのにかかった時間は、約2分10秒でした。</p>
<pre class="wp-block-code"><code>rclone sync start :  19:48:41.010
rclone sync end   :  19:50:52.552</code></pre>
<h3>GoogleDrive側は？</h3>
<p>ちゃんと上書きされて、版ができるか確認しておきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="779" height="641" src="/wp-content/uploads/2020/09/hackgpljpgd-2.png" alt="" class="wp-image-9685" srcset="/wp-content/uploads/2020/09/hackgpljpgd-2.png 779w, /wp-content/uploads/2020/09/hackgpljpgd-2-768x632.png 768w" sizes="(max-width: 779px) 100vw, 779px"></noscript>
<img width="779" height="641" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20779%20641%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/hackgpljpgd-2.png" alt="" class="lazyload wp-image-9685" data-srcset="/wp-content/uploads/2020/09/hackgpljpgd-2.png 779w, /wp-content/uploads/2020/09/hackgpljpgd-2-768x632.png 768w" data-sizes="(max-width: 779px) 100vw, 779px"></figure></div>
<p>土曜日にテストしていたのですが、日・月とちゃんと動作しているようですね！　この画像はuploadsの画像フォルダのバックアップですが圧縮しても1GBはあります。現行版を含めて４つファイルはあり、普通にバックアップしていれば４GBになりますが、ディスク消費は1.1GBです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="237" height="148" src="/wp-content/uploads/2020/09/gd.png" alt="" class="wp-image-9686"></noscript>
<img width="237" height="148" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20237%20148%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/gd.png" alt="" class="lazyload wp-image-9686"></figure></div>
<p>版を消さないようにすると、</p>
<figure class="wp-block-image size-large"><noscript><img width="562" height="530" src="/wp-content/uploads/2020/09/gd-1.png" alt="" class="wp-image-9687"></noscript>
<img width="562" height="530" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20562%20530%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/gd-1.png" alt="" class="lazyload wp-image-9687"></figure><p>保存容量にカウントされるようです。（リロード後、容量は変わります）</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="231" height="137" src="/wp-content/uploads/2020/09/gd-2.png" alt="" class="wp-image-9688"></noscript>
<img width="231" height="137" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20231%20137%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/gd-2.png" alt="" class="lazyload wp-image-9688"></figure></div>
<p>なるほど、「この履歴を削除しない」は必要な時だけ使うようにします。</p>
<h3>まとめ</h3>
<p>今後の課題も見つかりましたのでまとめにメモをしておきます。</p>
<p>・GoogleDriveの版は、保存容量を消費しない。<br>・しかし、「この履歴を削除しない」とすると消費される<br>・cronのメールはsendmailが動作してないので、飛んでこない<br>・sendmailの代わりに、msmtpが良さそうかも。<br>・版は100個まで保存されるが、過去30日で消えるそうなので実質、30日前までは戻せる。（たぶん）</p>
<h3>あとがき</h3>
<p>termuxで、cronのメールを飛んでくるようにするには、sendmail相当の何かを入れる必要があります。定番は、msmtpということのようです。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/category/android/page/5/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/category/android/page/3/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><link rel="stylesheet" id="word_balloon_user_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_user.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_skin_talk-css" href="/wp-content/plugins/word-balloon/css/skin/word_balloon_talk.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_inview_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_inview.min.css?ver=4.18.4" type="text/css" media="all"> <script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver" id="polyfill_IntersectionObserver-js"></script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_28a76201e8c516d37ffc311e7dc1a025.js"></script>
</body>
</html>