<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>Android &#8211; ページ 2 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; Android カテゴリーのフィード" href="/category/android/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_923a46d76606f1b43e3f3639ca289d5f.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/8">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> <style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
</head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged category category-android category-8 paged-2 category-paged-2 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">カテゴリー: <span>Android</span>
</h1></header><article id="post-10457" class="post-10457 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/04/22/2021-03-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-04-22T12:55:48+09:00">2021年4月22日</time><time class="updated" datetime="2021-05-18T12:25:41+09:00">2021年5月18日</time></a> </span><span class="posted-on">更新日:2021年5月18日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/04/22/2021-03-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2021/03 site24x7 でのSLA状況・統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>新年度、始まりましたね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>この季節、あったかくて好きだわー</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>リモートで自宅で仕事してるときが一番つらいねw</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>せめて散歩でもして気晴らししないとね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>春ですねー！　めちゃくちゃ暖かくなって外出したいんですが、なかなか世間の事情で旅行とまでは行きませんよね。せめて、散歩くらいはしたいものです。仕事の用事で、東京ー名古屋間をバイクで走ったのですがまだ夜は寒かったです。昼はちょうどいい天気で、めちゃくちゃ気持ちよかったです。</p>
<p>　さて、ちょっと遅れましたが今回も３月のSLA統計データを出しておきます。</p>
<h3>何を目指しているの？</h3>
<blockquote class="wp-block-quote">
<p><em>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</em></p>
<cite><a rel="noreferrer noopener" href="/2020/09/11/wildcard-domain-acme/" target="_blank" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>site24x7の<strong>スターターパック</strong>を2020の10月から始めています。監視サービスでSLAを99.95%目指しています。99.95%とは１ヶ月にダウンタイムが21.6分以内であればOKということですが、１０月から初めて１回しかクリアしていません。今年の２月に達成できたのですが、それ以外はNGINXか、PHPか、何かがメモリーリークしているような現象になります。</p>
<h3>２０２１・０３のSLA</h3>
<p>今月の結果です。障害時間の合計は7 時間 39 分あって、SLAは98.972%となり目標の99.95%には届きませんでした。今月からなのか、site24x7のレポート画面が少し進化したようです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="848" height="669" src="/wp-content/uploads/2021/04/Site24x7.png" alt="" class="wp-image-10458" srcset="/wp-content/uploads/2021/04/Site24x7.png 848w, /wp-content/uploads/2021/04/Site24x7-768x606.png 768w" sizes="(max-width: 848px) 100vw, 848px"></noscript>
<img width="848" height="669" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20848%20669%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/04/Site24x7.png" alt="" class="lazyload wp-image-10458" data-srcset="/wp-content/uploads/2021/04/Site24x7.png 848w, /wp-content/uploads/2021/04/Site24x7-768x606.png 768w" data-sizes="(max-width: 848px) 100vw, 848px"></figure></div>
<p>主な内容はNGINXの「Bad Gateway」問題です。この事象は不定期に発生しますが、必ずOSがフリーズしたような現象になります。おそらくメモリーリークしている感じです。完全にOSが死んでいるわけではなく、かろうじて動作はしています。なぜなら、NGINXはBad Gatewayの応答を出しています。また、thingspeakで、CPU温度や、バッテリー温度をpythonで投げているのですがこれは動作しています。再起動するときに AndroidOSのホームを開こうしても開ません。仕方なく、電源ボタン長押しで強制再起動という感じです。</p>
<h3>どのくらいのアクセス数なの？</h3>
<p>去年の１０月くらいから、pixel3のスマホサーバに引越ししたのですが、アクセス状況はこんな感じです。引越し以前のデータもそれほどかわりません。横ばいといった感じです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="1024" height="411" src="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png" alt="" class="wp-image-10461" srcset="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png 1024w, /wp-content/uploads/2021/04/JunkHack__view-768x308.png 768w, /wp-content/uploads/2021/04/JunkHack__view-984x395.png 984w, /wp-content/uploads/2021/04/JunkHack__view.png 1056w" sizes="(max-width: 1024px) 100vw, 1024px"></noscript>
<img width="1024" height="411" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%201024%20411%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png" alt="" class="lazyload wp-image-10461" data-srcset="/wp-content/uploads/2021/04/JunkHack__view-1024x411.png 1024w, /wp-content/uploads/2021/04/JunkHack__view-768x308.png 768w, /wp-content/uploads/2021/04/JunkHack__view-984x395.png 984w, /wp-content/uploads/2021/04/JunkHack__view.png 1056w" data-sizes="(max-width: 1024px) 100vw, 1024px"></figure></div>
<p>こんなサイトでも3000人くらいのユーザさんが見ているのには驚きです。見ていてくださってる読者さんには感謝ですね。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・時間をなんとか作って、NGINXを新システムに載せ替える<br>・メモリ使用量などOS情報を外部に投げる仕組みを考える</p>
<h3>あとがき</h3>
<p>課題はわかっていて、その調査をするか、代替え策を実行するか、やるべきことはわかっているのですが、腰が重いです。やることが退屈なので、違う面白いことに目がいってしまい、そのうち手をつけたいなと数ヶ月ずっと思っています。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10237" class="post-10237 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-sla category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/03/05/2021-02-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-03-05T00:57:39+09:00">2021年3月5日</time><time class="updated" datetime="2021-07-04T21:12:36+09:00">2021年7月4日</time></a> </span><span class="posted-on">更新日:2021年7月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/sla/" rel="category tag noopener noreferrer" data-wpel-link="internal">SLA</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/03/05/2021-02-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2021/02 site24x7 でのSLA状況・統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ついに99.95%以上を達成したよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>きたー！おめでとうー</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>2月のダウンタイムは3 分 29 秒でした</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>スマホサーバなのにがんばったね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>site24x7の<strong>スターターパック</strong>を2020の10月から始めています。監視サービスでSLAを99.95%目指していましたが、ついに達成できました！</p>
<blockquote class="wp-block-quote">
<p>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</p>
<cite><a href="/2020/09/25/%e7%a8%bc%e5%83%8d%e7%8e%87%e3%83%bbsla99-95%e3%82%92%e3%82%b9%e3%83%9e%e3%83%9b%e8%87%aa%e5%ae%85%e3%82%b5%e3%83%bc%e3%83%90%e3%81%a7%e7%9b%ae%e6%8c%87%e3%81%99%ef%bc%81%e3%81%be%e3%81%9a%e3%81%af/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>ちなみに、先月は97.42%で無理でした。site24x7の監視サービスは強力ですが、まだ自動的に復旧する仕組みを作っていないので、再起動は人力となっています。これができれば常に目標SLAを達成できそうです。</p>
<h3>２０２１・０２のSLA</h3>
<p>さて、今月の結果から！<br>ダウンタイムの3 分 29 秒で、SLAは99.991%となり今月は目標の99.95%に届きました！　やったー！</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="908" height="627" src="/wp-content/uploads/2021/03/image-10.png" alt="" class="wp-image-10238" srcset="/wp-content/uploads/2021/03/image-10.png 908w, /wp-content/uploads/2021/03/image-10-768x530.png 768w" sizes="(max-width: 908px) 100vw, 908px"></noscript>
<img width="908" height="627" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20908%20627%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/03/image-10.png" alt="" class="lazyload wp-image-10238" data-srcset="/wp-content/uploads/2021/03/image-10.png 908w, /wp-content/uploads/2021/03/image-10-768x530.png 768w" data-sizes="(max-width: 908px) 100vw, 908px"></figure></div>
<p>ツイッターで、呟いていたらSite24x7の中の人がうれしいメッセージを送ってくれました。</p>
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">おおーーーッ！<br><br>SLA目標達成おめでとうございます！なんか自分のことのように嬉しいです！笑</p>&mdash; Miya &#8211; SaaS型監視ツールの中の人 (@Miya_Site24x7) <a href="https://twitter.com/Miya_Site24x7/status/1366299786874294272?ref_src=twsrc%5Etfw" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">March 1, 2021<span class="wpel-icon wpel-image wpel-icon-1"></span></a>
</blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> <p>嬉しいツイート、ありがとうございます！</p>
<h3>少しダウンした原因は？</h3>
<p>毎回、いいところでダウンするので今月は意図的に再起動を手動でしておきました。毎回、ある程度時間が経過すると「Bad Gateway」が出てしまうんです。とりあえず、再起動を少し入れて様子見をしてたんですが、それが良かったようです。赤い部分は再起動を入れたので、そのダウンタイムです。</p>
<h3>まとめ</h3>
<p>今回の教訓は以下となります。</p>
<p>・再起動は有効だった<br>・根本原因はまだ未調査。対処療法で再起動して対応<br>・再起動を自動化するには、スマホのリセットを外部から行う仕組み作りが必要<br>・実験用で、UmidigiF2にその仕組みを模索したい<br></p>
<h3>あとがき</h3>
<p>前回から、スマホを意図的に再起動させる仕組みをどうするか考えています。ハードウェア的に再起動を行うには、バッテリーを外して、電源をリモートからコントロールするようにするとか考えていましたが、root化してある端末ですので、他にも方法がありそうです。それにハードウェア的にリブートさせてもandroidシステムのいろいろな問題（例えば再起動後はロック解除しないとホーム画面まで行けないなど）があります。</p>
<p>ソフトウェア的には、以下コマンドでシステムが瞬時にシャットダウンします。</p>
<pre class="wp-block-code"><code>$ tsu
# reboot -p
Done</code></pre>
<p>-pオプションを取れば、リブートします。しかし、このリブートだとWiFi接続に自動的に接続しなかったり、再起動時はロック解除をしないとHOME画面まで行かないのでTermux bootが動作しなかったりと問題があります。</p>
<p>そこで、以下を試しています。</p>
<blockquote class="wp-block-quote">
<p>Google Play : MacroDroid &#8211; デバイス自動化</p>
<cite><a href="https://play.google.com/store/apps/details?id=com.arlosoft.macrodroid" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://play.google.com/store/apps/details?id=com.arlosoft.macrodroid<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>このアプリはよく出来ていて、これを使うことにより、以下のような事ができることがわかりました。</p>
<p>・一定曜日の特定時刻にソフトリブート（要root化必要）<br>・起動時にWiFiの特定APへ接続（ヘルパーアプリ使用）<br>・起動時に特定アプリを強制起動（termuxを起動させる）</p>
<p>このリブートだと、ロック解除しなくても特定アプリが動かせるし、WiFiへの接続も問題なさそうです。</p>
<p>termux が動作すれば termux boot でtermux内部のソフトウェアは起動します。今は、テストでdnsmasqやsshdを自動起動させていますが問題なさそうです。とりあえずは、一定間隔でリブートさせることは出来そうです。</p>
<p>site24x7の障害検知サービスをどのように受けて、このシステムと切り離してトリガーしてリブートできるよう、何か良い方法はないかなと考えているところです。トリガーはいろいろあるので、その方法を模索中です。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10169" class="post-10169 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-diy category-linux"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/02/26/xiao-node-j5/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-02-26T10:07:38+09:00">2021年2月26日</time><time class="updated" datetime="2021-05-02T06:57:08+09:00">2021年5月2日</time></a> </span><span class="posted-on">更新日:2021年5月2日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/diy/" rel="category tag noopener noreferrer" data-wpel-link="internal">DIY</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a></span>
</div>
<h1 class="entry-title"><a href="/2021/02/26/xiao-node-j5/" rel="bookmark noopener noreferrer" data-wpel-link="internal">XIAOとスマホだけでnode.jsのJohnny-Fiveを動かす最短コースをご案内！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>きたきたきたー！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>なんか興奮してますね！w</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>スマホとXIAOだけでNodeのJohnny-Fiveを動かせるようになったよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>NodeとかJohnny-Fiveとか何それ？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>はい、ちょっと興奮気味なんですが今日のネタは、</p>
<p>「XIAOとスマホを接続して、<strong>それだけで</strong>XIAOを制御する！」</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="318" height="448" src="/wp-content/uploads/2021/02/fa41d394f26268f5ebe759f6764d1f4b.png" alt="" class="wp-image-10170"></noscript>
<img width="318" height="448" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20318%20448%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/fa41d394f26268f5ebe759f6764d1f4b.png" alt="" class="lazyload wp-image-10170"></figure></div>
<p>ってことがメインテーマです。物理的な接続イメージは図に書くとこんな感じです。node.js実行環境をtermuxに作り、johnny-fiveというnode環境で動作するものをFirmataプロトコルでXIAOとやりとりします。もっと簡単にいえば、</p>
<p>JavaScriptでXIAOを操る　ですね。</p>
<p>通常、node.js実行環境はPCに作ったりしますので、物理的な接続イメージは以下のようになるかと思います。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="506" height="242" src="/wp-content/uploads/2021/02/pc-to-j5.png" alt="" class="wp-image-10179"></noscript>
<img width="506" height="242" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20506%20242%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/pc-to-j5.png" alt="" class="lazyload wp-image-10179"></figure></div>
<p>JavaScriptでXIAOのGPIOを操作するのですが、まだこの構成のメリットがよくわかっていませんので、触ってみようと思いました。</p>
<h3>物理的に用意するもの</h3>
<p>(1) Androidスマホ<br>(2) Seeed XIAO<br>(3) ケーブル（Type-C x Type-C）</p>
<p>Androidスマホは手持ちのものでも、余ったものでもOKです。XIAOは3個入りで1800円くらいでアマゾンから購入できます。ケーブルは100円ショップですね。</p>
<h3>Androidスマホ の必要アプリ</h3>
<blockquote class="wp-block-quote">
<p>GoogleStore : Termux</p>
<cite><a href="https://play.google.com/store/apps/details?id=com.termux" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://play.google.com/store/apps/details?id=com.termux<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>まず、Androidスマホのアプリを入れておきます。あと、もう一つ有償アプリですが以下を入れておきます。日本円で190円です。</p>
<blockquote class="wp-block-quote">
<p>GoogleStore : BT/USB/TCP Bridge Pro</p>
<cite><a href="https://play.google.com/store/apps/details?id=masar.bluetoothbridge.pro" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://play.google.com/store/apps/details?id=masar.bluetoothbridge.pro<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>これはブリッジアプリで、今回の用途ではXIAOのUSB接続のシリアル通信をTCP上にブリッジする用途で使います。シリアルTCPのブジッジアプリは他にもいろいろありますが、XIAOと接続できた勇逸の神アプリです。</p>
<h3>Termuxのセットアップ</h3>
<p>アプリを入れたら、パッケージをアップデートしておきます。Termuxのコンソールからタイプするのが面倒なら、PCからSSHして作業するといいかもです。</p>
<pre class="wp-block-code"><code>pkg update
pkg upgrade</code></pre>
<p>以下が今回必要なものです。</p>
<pre class="wp-block-code"><code>pkg install nodejs python clang make openssh -y</code></pre>
<p>手持ちの環境、HUAWEI P20 liteでは以下が入りました。</p>
<pre class="wp-block-code"><code>$ dpkg --list | egrep 'node|python|clang|make|openssh' | cut -b 5-50
clang              11.1.0         aarch64     
make               4.3-1          aarch64     
nodejs             14.15.4-1      aarch64     
openssh            8.4p1-1        aarch64     
python             3.9.2          aarch64     
termux-exec        1:0.8          aarch64 </code></pre>
<p>nodejsはもう14なんですね。速すぎる！ぜんぜんついていけないです。</p>
<h3>サンプルソースとインストール</h3>
<p>まず、termuxでの操作です。コピペしやすいよう$ は省いておきます。</p>
<pre class="wp-block-code"><code>cd
mkdir j5
cd j5
wget https://github.com/take-i/j5-termux/archive/main.zip</code></pre>
<p>まだ説明も何も書いていませんがそのうち、簡単に書いておきます。</p>
<blockquote class="wp-block-quote">
<p>サンプルソース</p>
<cite>https://github.com/take-i/j5-termux</cite>
</blockquote>
<h3>サンプルソース解凍しインストール</h3>
<p>example にLEDが光るサンプルソースが入っています。</p>
<pre class="wp-block-code"><code>unzip main.zip 
cd j5-termux-main/example/
npm install</code></pre>
<h3>IPアドレスを修正</h3>
<p>WiFiに接続していると思いますので、termux上でIPを確認しておきます。</p>
<pre class="wp-block-code"><code>ifconfig | grep inet</code></pre>
<p>以下のようなIPv4が出ますので、それをメモしておきます。この場合は、192.168.1.36が自分のスマホのIPですね。</p>
<pre class="wp-block-code"><code>inet 192.168.1.36  netmask 255.255.255.0  broadcast 192.168.1.255</code></pre>
<p>サンプルソースのIPを修正します。portは、あとでブリッジアプリで設定しますので、1024番〜の適当なポートにしておきます。1234でもOKです。</p>
<pre class="wp-block-code"><code>------- example/index.js
::
var options = {
  host: '192.168.1.36',  //host name or IP
  port: 1234  // port
}</code></pre>
<h3>XIAOにFirmataをセットアップ</h3>
<p>この記事を書いている時はまだ、XIAOはFirmataのコードをビルドするとエラーになりますが、以下を適用すればOKです。そのうち、masterにマージされると思うので、ビルドエラーが出なければOKです。</p>
<blockquote class="wp-block-quote">
<p>add seeedunio xiao to boards.h please #475</p>
<cite><a href="https://github.com/firmata/arduino/issues/475" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://github.com/firmata/arduino/issues/475<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>具体的には、以下からFirmataをダウンロードします。</p>
<blockquote class="wp-block-quote">
<p>firmata/arduino Releases<br><a href="https://github.com/firmata/arduino/releases/download/2.5.8/Arduino-1.0.x-Firmata-2.5.8.zip" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Arduino-1.0.x-Firmata-2.5.8.zip<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<cite>https://github.com/firmata/arduino/releases/</cite>
</blockquote>
<p>先ほどのFixをBoards.hに反映し、ArduinoIDEからインポートします。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="564" height="209" src="/wp-content/uploads/2021/02/arduino-ide.png" alt="" class="wp-image-10177"></noscript>
<img width="564" height="209" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20564%20209%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/arduino-ide.png" alt="" class="lazyload wp-image-10177"></figure></div>
<p>スケッチ例＞Firmata＞StandardFirmata のスケッチをXIAOに書込みます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="732" height="606" src="/wp-content/uploads/2021/02/firmata-ex.png" alt="" class="wp-image-10178"></noscript>
<img width="732" height="606" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20732%20606%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/firmata-ex.png" alt="" class="lazyload wp-image-10178"></figure></div>
<p>エラーなく書き込めたらOKです。</p>
<h3>スマホでブリッジアプリを設定</h3>
<p>次はスマホで　<a rel="noreferrer noopener external" href="https://play.google.com/store/apps/details?id=masar.bluetoothbridge.pro" target="_blank" data-wpel-link="external" class="wpel-icon-right">BT/USB/TCP Bridge Pro<span class="wpel-icon wpel-image wpel-icon-1"></span></a>　のアプリを設定します。このアプリはDevceAとBをブリッジしますので画面のように設定します。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="802" height="783" src="/wp-content/uploads/2021/02/ss-b1.png" alt="" class="wp-image-10172" srcset="/wp-content/uploads/2021/02/ss-b1.png 802w, /wp-content/uploads/2021/02/ss-b1-768x750.png 768w" sizes="(max-width: 802px) 100vw, 802px"></noscript>
<img width="802" height="783" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20802%20783%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/ss-b1.png" alt="" class="lazyload wp-image-10172" data-srcset="/wp-content/uploads/2021/02/ss-b1.png 802w, /wp-content/uploads/2021/02/ss-b1-768x750.png 768w" data-sizes="(max-width: 802px) 100vw, 802px"></figure></div>
<p>XIAOをUSB接続するとアクセス許可がでますのでOKします。「このUSBデバイスをデフォルトにする」はチェックしておいたほうがいいですね。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="795" height="785" src="/wp-content/uploads/2021/02/ss-b2.png" alt="" class="wp-image-10173" srcset="/wp-content/uploads/2021/02/ss-b2.png 795w, /wp-content/uploads/2021/02/ss-b2-768x758.png 768w" sizes="(max-width: 795px) 100vw, 795px"></noscript>
<img width="795" height="785" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20795%20785%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/ss-b2.png" alt="" class="lazyload wp-image-10173" data-srcset="/wp-content/uploads/2021/02/ss-b2.png 795w, /wp-content/uploads/2021/02/ss-b2-768x758.png 768w" data-sizes="(max-width: 795px) 100vw, 795px"></figure></div>
<p>USBデバイスに接続（USB connect）し、TCP Serverをスタートさせます。２つ上の画像、右側のようになっていればOKです。</p>
<h3>起動！</h3>
<p>Termuxのindex.jsがある場所で以下のコマンドを実行すると動作します。</p>
<pre class="wp-block-code"><code>node index.js</code></pre>
<p>成功すれば、以下のようにターミナルに表示されているはずです。</p>
<pre class="wp-block-code"><code>Connected to USB2TCP Bridge
IO ready!
1614296838868 Available Firmata  
1614296838874 Connected Firmata  
1614296838882 Repl Initialized  
>> Board connected!</code></pre>
<p>XIAOの青色LEDが光っていれば成功です。写真では青色LEDが光っているタイミングを写せなかったので光っていませんが、チカチカしているはずです。</p>
<figure class="wp-block-image size-large"><noscript><img width="591" height="373" src="/wp-content/uploads/2021/02/01c575643bf8b553884997634c862516.png" alt="" class="wp-image-10174"></noscript>
<img width="591" height="373" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20591%20373%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/01c575643bf8b553884997634c862516.png" alt="" class="lazyload wp-image-10174"></figure><p>お疲れ様です。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・Termux上でJ5を使う時は、USBに接続したボードを認識しないので、別アプリでUSBをTCPにブリッジさせて使う<br>・ブリッジさせるアプリはたくさんあるが、J5からXIAOと通信できたのはこれだけ<br>・実際に開発するときは、スマホ充電しながらUSB接続しないと電池持ちが。<br>・J5の使い所がまだよくわかっていないので、例をこなしながらどんなメリットがあるのか体験してみる</p>
<h3>あとがき</h3>
<p>node.js実行環境をTermuxに作ってそこから有線USB接続したXIAOを操れることがわかりました。まだ、どんなことができるのか、そしてどんなメリットがあるのかまーったく分かっていませんが今後、面白い活用方法などがあれば紹介、DIYしたいなと思います。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-10027" class="post-10027 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-sla category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/02/07/2021-01-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-02-07T19:17:34+09:00">2021年2月7日</time><time class="updated" datetime="2021-02-07T19:17:44+09:00">2021年2月7日</time></a> </span><span class="posted-on">更新日:2021年2月7日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/sla/" rel="category tag noopener noreferrer" data-wpel-link="internal">SLA</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/02/07/2021-01-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2021/01 site24x7 でのSLA状況・統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>もう少しだったのにー！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>また落ちたのね？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>そうなのよー、1月2日にねー。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>正月だから寝てたのね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>site24x7の<strong>スターターパック</strong>を2020の10月から始めています。監視サービスでSLAを99.95%目指していますが、果たしてスマホサーバで達成できるのでしょうか？</p>
<blockquote class="wp-block-quote">
<p>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</p>
<cite><a href="/2020/09/25/%e7%a8%bc%e5%83%8d%e7%8e%87%e3%83%bbsla99-95%e3%82%92%e3%82%b9%e3%83%9e%e3%83%9b%e8%87%aa%e5%ae%85%e3%82%b5%e3%83%bc%e3%83%90%e3%81%a7%e7%9b%ae%e6%8c%87%e3%81%99%ef%bc%81%e3%81%be%e3%81%9a%e3%81%af/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>ちなみに、先月は99.368%で無理でした。かなり惜しかったんですよ！site24x7の監視サービスは強力です。これがなければ、もっとダウンタイムは長かったです。</p>
<h3>２０２１・０１のSLA</h3>
<p>さて、今月の結果から！<br>ダウンタイムの合計19 時間 12 分あって、SLAは97.42%となり今月も目標の99.95%には届きませんでした。先月も書きましたが99.95%とは１ヶ月に21.6分以内のダウンタイムに留めないといけません。正月早々に、監視のお知らせはきていたのですが、寝ていて気がつかず！　この1日がなければ達成していたんですよー。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="759" height="626" src="/wp-content/uploads/2021/02/202101sla.png" alt="" class="wp-image-10028"></noscript>
<img width="759" height="626" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20759%20626%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/02/202101sla.png" alt="" class="lazyload wp-image-10028"></figure></div>
<h3>原因は？</h3>
<p>今月も設定ミスではなく、NGINXがBadGatewayを出して本格的に停止していました。</p>
<p>ちょっと回避が難しいので、運用でカバーしようと思っているんですがやっぱり寝てるときとか無理ですね。</p>
<h3>まとめ</h3>
<p>今回の教訓は以下となります。</p>
<p>・UmidigiF2に載せ替えようとおもっている。<br>・4月から仕事先が変わるんで、再起動が難しいかも。何か作戦を練らねば。<br>・バッテリー無くして電源管理と連動する仕組みとか考えないと。</p>
<h3>あとがき</h3>
<p>現在リモート勤務なので、まぁ気がつけばすぐに再起動かけられますがこの先仕事のライフワークが変わる可能性が大なので、再起動がむずかしくなりそうです。バッテリーを外して、電源をリモートからコントロールするとかちょっと工夫しないといけないですね。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9969" class="post-9969 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-sla category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2021/01/17/2020-11-and-12-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2021-01-17T13:08:20+09:00">2021年1月17日</time><time class="updated" datetime="2021-01-17T13:08:29+09:00">2021年1月17日</time></a> </span><span class="posted-on">更新日:2021年1月17日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/sla/" rel="category tag noopener noreferrer" data-wpel-link="internal">SLA</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2021/01/17/2020-11-and-12-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2020/11と12 site24x7 でのSLA状況・統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>だいぶ遅れましたがSLAデータ報告です！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>99.95%は達成できた？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>・・・</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>また来月がんばりましょう！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>site24x7の<strong>スターターパック</strong>を2020の10月から始めています。監視サービスでSLAを99.95%目指していますが、果たしてスマホサーバで達成できるのでしょうか？</p>
<blockquote class="wp-block-quote">
<p>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</p>
<cite><a href="/2020/09/25/%e7%a8%bc%e5%83%8d%e7%8e%87%e3%83%bbsla99-95%e3%82%92%e3%82%b9%e3%83%9e%e3%83%9b%e8%87%aa%e5%ae%85%e3%82%b5%e3%83%bc%e3%83%90%e3%81%a7%e7%9b%ae%e6%8c%87%e3%81%99%ef%bc%81%e3%81%be%e3%81%9a%e3%81%af/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>先月は、99.567%で無理でした。</p>
<h3>２０２０・１１のSLA</h3>
<p>まずは結果から。ダウンタイムの合計17 時間 30 分あって、SLAは97.565%となり今月も目標の99.95%には届きませんでした。先月も書きましたが99.95%とは１ヶ月に21.6分以内のダウンタイムに留めないといけません。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="860" height="617" src="/wp-content/uploads/2021/01/Site24x7-201011.png" alt="" class="wp-image-9971" srcset="/wp-content/uploads/2021/01/Site24x7-201011.png 860w, /wp-content/uploads/2021/01/Site24x7-201011-768x551.png 768w" sizes="(max-width: 860px) 100vw, 860px"></noscript>
<img width="860" height="617" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20860%20617%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/01/Site24x7-201011.png" alt="" class="lazyload wp-image-9971" data-srcset="/wp-content/uploads/2021/01/Site24x7-201011.png 860w, /wp-content/uploads/2021/01/Site24x7-201011-768x551.png 768w" data-sizes="(max-width: 860px) 100vw, 860px"></figure></div>
<h3>原因は？</h3>
<p>今月のは設定ミスではなく、NGINXがBadGatewayを出して本格的に停止していました。今の所、root化したtermuxでNGINXを動かすとこの現象が発生しています。</p>
<p>ちょっと回避が難しいので、運用でカバーしようと思っていましたが夜間にダウンするともう無理ゲーです。</p>
<h3>まとめ</h3>
<p>今回の教訓は以下となります。</p>
<p>・サーバが１つだとやっぱりきびしい。多重化が必要だがそこまでコストをかけたくない。<br>・root化したNginxだとBadGatewayが出てしまう。なんとか対策しなくとだが根本原因がまだ不明<br>・運用でカバーしようと思ったが、夜間にダウンするともう無理です。</p>
<h3>あとがき</h3>
<p>目標がクリアできなかったので、記事を更新するのも面倒になっていますが記録だけでも採っていこうかと。ちなみに、12月も無理でしたので、この記事にはりつえておきます。99.368%という結果。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="858" height="610" src="/wp-content/uploads/2021/01/Site24x7.png" alt="" class="wp-image-9972" srcset="/wp-content/uploads/2021/01/Site24x7.png 858w, /wp-content/uploads/2021/01/Site24x7-768x546.png 768w" sizes="(max-width: 858px) 100vw, 858px"></noscript>
<img width="858" height="610" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20858%20610%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2021/01/Site24x7.png" alt="" class="lazyload wp-image-9972" data-srcset="/wp-content/uploads/2021/01/Site24x7.png 858w, /wp-content/uploads/2021/01/Site24x7-768x546.png 768w" data-sizes="(max-width: 858px) 100vw, 858px"></figure></div>
<p>かなり惜しかったんすが、今回もNGINXがBadGatewayを出してしまいました。17日の少し止まった部分はSSLの更新に伴うWEB再起動ですのでこれはまぁ許容。19日のがなければクリアしていました。NGINXがBadGatewayを出す根本原因を探らないとなのですが、腰が重いです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9887" class="post-9887 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/11/07/termux-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-11-07T00:43:28+09:00">2020年11月7日</time><time class="updated" datetime="2020-11-07T00:56:31+09:00">2020年11月7日</time></a> </span><span class="posted-on">更新日:2020年11月7日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/11/07/termux-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal">内部DNSをTermuxのDNSMASQで動かす！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>内部ネットワークから参照するDNSを作ったよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>それって、どんなDNSなの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>例えば、example.jpだと192.168.1.1にアクセスできるようにするとかできるよ</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>UターンNAT対策？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>そうなんですよねー。UターンNAT対策で内部DNSが欲しかったんです。</p>
<p>内部DNSを低消費電力サーバのスマホtermuxで動かしたいなと思って、いろいろ格闘していました。先日はOpenWrtというルータ上で動かしていましたが、今回は、root化したスマホ上のtermuxで動かしてみました。53ポートで動かすのでroot化が必要ですが、termuxのrootパッケージの１つ、dnsmasqを使って内部DNSを作ろうと思います。</p>
<h3>dnsmasqとは？</h3>
<blockquote class="wp-block-quote">
<p>公式：Dnsmasq</p>
<cite><a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">http://www.thekelleys.org.uk/dnsmasq/doc.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>比較的、軽量でDHCP、BOOTPやPXEにも対応しているDNSサーバでOpenWrtにも使われていたります。自ドメイン以外は指定のDNSに転送して応答してくれます。内部ネットワーク向けの簡易なDNSとしては十分な機能をもっていますね。</p>
<p>今回は、IPv4で自ドメインの応答とそれ以外は8.8.8.8のDNSにフォワードして応答してもらうだけのシンプル設定です。DHCPなどそれ以外の機能はつかいません。</p>
<h3>Termuxのdnsmasqは？</h3>
<p>ポート53で動かすので、root化したスマホにtermuxを動かしている必要があります。1024番ポート以下はrootじゃないとバインドできません。パッチ内容は以下から参照できます。</p>
<blockquote class="wp-block-quote">
<p>termux-root-packages：dnsmasq</p>
<cite><a href="https://github.com/termux/termux-root-packages/tree/master/packages/dnsmasq" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">URL<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>やってみましょうか！</p>
<h3>ステップ１　インストール</h3>
<p>インストール自体は簡単です。root-repoパッケージを入れてから、dnsmasqを入れるだけです。</p>
<pre class="wp-block-code"><code>$ pkg install root-repo -y
$ pkg install dnsmasq -y</code></pre>
<p>本体とmanなどが入ります。サイズは264Kと小さいですね。</p>
<pre class="wp-block-code"><code>$ ll /data/data/com.termux/files/usr/bin/dnsmasq
-rwx------ 1 u0_a143 u0_a143 264K Aug 17 02:40 /data/data/com.termux/files/usr/bin/dnsmasq*</code></pre>
<h3>ステップ２　設定</h3>
<p>Termuxのdnsmasqだと、設定ファイルはデフォルトで無いので作ります。</p>
<pre class="wp-block-code"><code>$ cd $PREFIX/etc
$ vi dnsmasq.conf </code></pre>
<p>内容は以下です。ほどよく読み替えてください。</p>
<blockquote class="wp-block-quote"><p>ホスト設定：$PREFIX/etc/hosts-dnsmasq<br>ログ：$PREFIX/var/log/dnsmasq.log<br>このホストIP：192.168.1.38<br>Termuxユーザ：u0_a143<br>ドメイン：gpl.jp<br>フォワードするDNS：8.8.8.8</p></blockquote>
<pre class="wp-block-code"><code>listen-address=127.0.0.1,192.168.1.38
port=53
bind-interfaces
user=u0_a143
group=u0_a143
no-poll
# プライベートIPアドレスの逆引きを上位DNSサーバに転送しない
bogus-priv
# ドメインの無いホスト名のみ問い合わせの場合、上位DNSサーバに転送しない
domain-needed
# ローカルエリア内のドメインを指定
local=/gpl.jp/
# ホスト名で問合せされた時、下記のdomain=で指定されたドメイン名を補完
expand-hosts
# 補完するドメイン名
domain=gpl.jp

# LocalDNS
addn-hosts=/data/data/com.termux/files/usr/etc/hosts-dnsmasq
server=/gpl.jp/192.168.1.38
server=/1.168.192.in-addr.arpa/192.168.1.38
log-queries
log-facility=/data/data/com.termux/files/usr/var/log/dnsmasq.log

server=/localnet/192.168.1.38 # change ip for your ip-server
server=8.8.8.8
no-resolv </code></pre>
<p>ホスト設定：$PREFIX/etc/hosts-dnsmasq は以下となります。</p>
<pre class="wp-block-code"><code>192.168.1.38    f2
192.168.1.47    p3
192.168.1.47    hack
192.168.1.47    junkhack</code></pre>
<p>resolvファイルは自サーバを参照するよう以下にしておきます。</p>
<pre class="wp-block-code"><code>$ cat resolv.conf 
#nameserver 8.8.8.8
nameserver 192.168.1.38</code></pre>
<h3>ステップ３　起動</h3>
<p>53ポートでバインドさせるので、rootで起動します。</p>
<pre class="wp-block-code"><code>$sudo dnsmasq -C $PREFIX/etc/dnsmasq.conf</code></pre>
<h3>ステップ４　確認</h3>
<p>確認です。明示的に dig @hostip domain と@でdnsを指定するとより良いです。</p>
<pre class="wp-block-code"><code>$ dig f2 +short
192.168.1.38

$ dig -x 192.168.1.38 +short
f2.gpl.jp.

$ dig hack.gpl.jp +short
192.168.1.47

$ dig yahoo.co.jp +short
182.22.59.229
183.79.135.206</code></pre>
<p>ホスト名のみでも大丈夫ですね。FQDN自ドメインも引けますし、逆引きもできます。管理外はフォワードして応答してきました。</p>
<h3>例えばまったく違うドメインを指定</h3>
<pre class="wp-block-code"><code>$ cat hosts-dnsmasq
192.168.1.38    f2
192.168.1.47    p3
192.168.1.47    hack
192.168.1.47    junkhack
192.168.1.111   test.example.jp</code></pre>
<p>このように、違うドメイン名をFQDNで記載したら参照できるのでしょうか？</p>
<h3>設定変更・再起動</h3>
<pre class="wp-block-code"><code>$ sudo killall dnsmasq
$ sudo dnsmasq -C $PREFIX/etc/dnsmasq.conf</code></pre>
<p>参照できるか引いてみます。</p>
<pre class="wp-block-code"><code>$ dig test.example.jp +short
192.168.1.111

$ dig -x 192.168.1.111 +short
test.example.jp.</code></pre>
<p>参照できますね。これって設定ファイルのserver行でドメイン指定しなくてもいいんですかね？　設定項目はもっとシンプルにできるのかもしれませんが、追求するのはヤメにしておきます。</p>
<h3>まとめ</h3>
<p>同じ設定を、UmidigiF2では動きましたが、Pixel3ではフォワーダーが動かなかったです。</p>
<p>・UmidigiF2では動作し、Pixel3ではフォワーダーが動かない原因は不明<br>・機会があれば、BOOTPやPXEも試してみたい<br>・FQDNで記載すれば違うドメイン名でもOK<br>・MXやテキストレコードなどはどうやって指定するのだろう？</p>
<h3>あとがき</h3>
<p>今の所不具合はなさそうです。もう１週間ほど動かして問題なさそうであれば今のWordPressサーバを統合しようかなと思います。メインPCからもこのDNSを参照していますが速度的にも特に問題はない感じです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/category/android/page/3/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/category/android/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><link rel="stylesheet" id="word_balloon_user_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_user.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_skin_talk-css" href="/wp-content/plugins/word-balloon/css/skin/word_balloon_talk.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_inview_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_inview.min.css?ver=4.18.4" type="text/css" media="all"> <script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver" id="polyfill_IntersectionObserver-js"></script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_28a76201e8c516d37ffc311e7dc1a025.js"></script>
</body>
</html>