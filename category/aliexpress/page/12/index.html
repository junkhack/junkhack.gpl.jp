<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>Aliexpress &#8211; ページ 12 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; Aliexpress カテゴリーのフィード" href="/category/aliexpress/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_bd2482c37d2bc505ed15c848d16adf6d.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/6">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> </head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged category category-aliexpress category-6 paged-12 category-paged-12 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">カテゴリー: <span>Aliexpress</span>
</h1></header><article id="post-1990" class="post-1990 post type-post status-publish format-standard hentry category-aliexpress category-linux category-orangepi category-orangepipc category-parts"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2016/01/03/orangepi-pc-e38292e382afe383ade38383e382afe38380e382a6e383b3/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2016-01-03T23:32:07+09:00">2016年1月3日</time></a> </span><span class="posted-on">更新日:2016年1月3日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/orangepi/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePi</a>, <a href="/category/orangepipc/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePiPC</a>, <a href="/category/parts/" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a></span>
</div>
<h1 class="entry-title"><a href="/2016/01/03/orangepi-pc-e38292e382afe383ade38383e382afe38380e382a6e383b3/" rel="bookmark noopener noreferrer" data-wpel-link="internal">OrangePi PC をクロックダウン</a></h1></header><div class="entry-content">
<p>OPI PC にファンをつけて、ついでに sccript.bin を作り直して1.5MHz から1.2MHz にクロックダウンして運用していますが、CPU 温度は30度から40 度を推移しているようです。</p>
<p></p>
<noscript><img title="h3_temp-day-2" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="h3_temp-day-2" src="/wp-content/uploads/2016/01/h3_tempday2.png" width="497" height="280"></noscript>
<img class="lazyload" title="h3_temp-day-2" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="h3_temp-day-2" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20497%20280%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/h3_tempday2.png" width="497" height="280"><p>この状態でベンチマークがどのくらいいくかテストしてみました。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">   ========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)
   System: OrangePi: GNU/Linux
   OS: GNU/Linux -- 3.4.39-01-lobo -- #1 SMP PREEMPT Sun Oct 25 14:46:41 CET 2015
   Machine: armv7l (armv7l)
   Language: en_US.utf8 (charmap=&quot;UTF-8&quot;, collate=&quot;UTF-8&quot;)
   07:17:03 up 44 min,  2 users,  load average: 1.56, 1.61, 1.56; runlevel 3
   ------------------------------------------------------------------------
   Benchmark Run: Sun Jan 03 2016 07:17:03 - 07:46:42
   0 CPUs in system; running 4 parallel copies of tests
   ::
   System Benchmarks Index Values               BASELINE       RESULT    INDEX
   Dhrystone 2 using register variables         116700.0   17298899.9   1482.3
   Double-Precision Whetstone                       55.0       2969.0    539.8
   Execl Throughput                                 43.0       1464.1    340.5
   File Copy 1024 bufsize 2000 maxblocks          3960.0     149424.6    377.3
   File Copy 256 bufsize 500 maxblocks            1655.0      45277.4    273.6
   File Copy 4096 bufsize 8000 maxblocks          5800.0     380747.9    656.5
   Pipe Throughput                               12440.0     911007.9    732.3
   Pipe-based Context Switching                   4000.0     124699.6    311.7
   Process Creation                                126.0       3414.8    271.0
   Shell Scripts (1 concurrent)                     42.4       1865.6    440.0
   Shell Scripts (8 concurrent)                      6.0        307.0    511.6
   System Call Overhead                          15000.0    2100567.0   1400.4
   ========
   System Benchmarks Index Score                                         516.5</pre>
<p>おおよそ、RasPi2 より少し速い500ポイントちょいのスコアです。クロックダウンする前は、600ちょいだったので、すこし遅くなった感じですね。</p>
<p>&#160;</p>
<p>実際にサーバとして仮運用していますので、レスポンスなど見たい方は以下にアクセスしてみてください。昨年からテストで運用しています。</p>
<blockquote>
<p>Fedora22 OrangePi PC<br> <br><a title="/" href="/" data-wpel-link="internal" rel="noopener noreferrer">/</a></p>
<p>・NGINX + php-fpm + MariaDB</p>
</blockquote>
<p>そこそこ重めのアプリケーションのWordPress が動作しています。ネットワーク的には、サーバからの下りは帯域は絞られていると思いますので差し引いてみてください。今のところ、そこそこストレスなく動作しています。</p>
<p>&#160;</p>
<p>当初、OpenStack として勉強用に使おうと思っていたのですが、何年ぶりかで自宅サーバを運用してみたら面白くてOpenStack の構成の検証に環境を壊したくないなぁという感じです。もう一台ほしいなぁと。</p>
<p>WEBを散歩しているとなにやら、Orange pi Oneという10ドルくらいのものも発売されるということで、すこし様子見をしています。</p>
<blockquote>
<p>CNXSoft<br> <br><a href="http://www.cnx-software.com/2016/01/02/orange-pi-one-is-a-10-quad-core-board-with-ethernet-and-hdmi/" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">Orange Pi One is a $10 Quad Core Board with Ethernet and HDMI<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p></p>
<noscript><img title="Orange_Pi_One" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="Orange_Pi_One" src="/wp-content/uploads/2016/01/orange_pi_one.jpg" width="640" height="421"></noscript>
<img class="lazyload" title="Orange_Pi_One" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="Orange_Pi_One" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20421%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/orange_pi_one.jpg" width="640" height="421">
</blockquote>
<p>どうやら、WIFI 付きモデルと、10/100M Ethernet モデルが出るようです。なかなか面白そうです。比較表は、OSAKANA TARO さんのページにあります。</p>
<blockquote><p>OSAKANA TARO のメモ帳<br> <br><a href="http://blog.osakana.net/archives/6789" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">Orange Pi ONEの詳細が出た！<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>CPU は、今のと同じ 6ドルの H3 （4core）を使うようです。これで、9.99ドルで出せるとはほぼ原価並の価格ですね。メーカ（Shenzhen Xunlong Software）は、かなり大量にパーツを購入しているんでしょう。とにかくこれは出たら買いです。</p>
<p>&#160;</p>
<p>OpenStack Ironic としてベアメタルな構成を考えているのですが、動作に必要な PXE Boot の実験がまだ終わっていません。まだ、OpenStack 自体もあまり良くわかっていないのですが、おそらくベアメタルをコントロールする際に、PXE Boot が必要になると思います。あとIPMI で電源とかなにか操作するようです。このあたりの検証もしないといけません。おそらく、なにか工夫する必要があると思っています。</p>
<p>&#160;</p>
<p>5台くらいの構成で考えているのですが、安いほうがいいよねということで、Orange pi Oneが出てから考えたいなぁと思っています。5000円くらいで、最小構成を目指して OpenStack のベアメタルを勉強してみたいと思っています。</p>
<p>&#160;</p>
<p>まとめ</p>
<p>・クロックを1.2Mhz にダウンさせるとベンチマークは500ちょい</p>
<p>・ヒートシンクと、ファンをつけた状態でアイドル時、温度は30度から40度を推移</p>
<p>・負荷をかけると50度ちょいくらい</p>
<p>・追加購入は、OrangePi PC の15ドルより安い9.99ドルの Orange Pi One というのが出るまで待ち</p>
<p>・U-Boot する仕組みを勉強してみる</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-1984" class="post-1984 post type-post status-publish format-standard hentry category-aliexpress category-linux category-orangepi category-orangepipc category-parts"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2016/01/03/fune381aee58ab9e69e9ce381afe38081-15e5baa6efbc81/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2016-01-03T06:18:48+09:00">2016年1月3日</time></a> </span><span class="posted-on">更新日:2016年1月3日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/orangepi/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePi</a>, <a href="/category/orangepipc/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePiPC</a>, <a href="/category/parts/" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a></span>
</div>
<h1 class="entry-title"><a href="/2016/01/03/fune381aee58ab9e69e9ce381afe38081-15e5baa6efbc81/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Funの効果は、-15度！</a></h1></header><div class="entry-content">
<p>ちょっと、orange pi pc で作業をしようと思い、ファンの電源をONにしました。</p>
<p>すると、やっぱりかなり効果があったようで、15度は下がっています。</p>
<p> </p>
<noscript><img title="h3_temp-day-1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="h3_temp-day-1" src="/wp-content/uploads/2016/01/h3_tempday1.png" width="497" height="280"></noscript>
<img class="lazyload" title="h3_temp-day-1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="h3_temp-day-1" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20497%20280%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/h3_tempday1.png" width="497" height="280"><p align="center">※途中、空白なのはmunin の設定変えたけど再起動してなかった</p>
<p>今、CPUクロックが最高で1.5GHz くらいまであがる設定なので、速いですが温度もあがるようです。</p>
<p> </p>
<noscript><img title="cpuspeed-day" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="cpuspeed-day" src="/wp-content/uploads/2016/01/cpuspeedday.png" width="497" height="316"></noscript>
<img class="lazyload" title="cpuspeed-day" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="cpuspeed-day" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20497%20316%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/cpuspeedday.png" width="497" height="316"><p>途中、コンパイルしていて1.5Ghz まで上がっていますが温度は、50度くらいのようです。これで少し安心して作業ができますね。さすがに、80度とかちょっと心配になるので。上限のクロックを下げるという方法もあるのですが、どうせならぶん回したいので。</p>
<p>&#160;</p>
<p>クロックを下げるには、/sys 配下のscaling_max_freq と scaling_min_freq に起動したら設定を入れておく方法と、ブート領域のパラメータを持っているscrpt.bin で指定する方法があるようです。</p>
<p>以下のページが参考になります。</p>
<blockquote><p>Sunxi Wiki <br>Orange Pi PC <br><a title="http://linux-sunxi.org/Orange_Pi_PC#CPU_clock_speed_limit" href="http://linux-sunxi.org/Orange_Pi_PC#CPU_clock_speed_limit" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">http://linux-sunxi.org/Orange_Pi_PC#CPU_clock_speed_limit<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>当初、まったく意味不明だったのですがどうやら、sdCard のブート領域にあるscript.bin がuImage に渡すパラメータを持っているようです。今、動作させているのは loborisさんが作ったものですが、以下のようになっています。</p>
<p>&#160;</p>
<p>このscript.bin をfex2bin というツールで展開すると見れます。</p>
<blockquote><p>Sunxi-tools <br><a title="http://linux-sunxi.org/Sunxi-tools#bin2fex" href="http://linux-sunxi.org/Sunxi-tools#bin2fex" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://linux-sunxi.org/Sunxi-tools#bin2fex<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>以下のようにして、実機でビルドしました。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;"># dnf install libusbx-devel
$ cd /usr/local/src/BUILD
$ git clone https://github.com/linux-sunxi/sunxi-tools
$ cd sunxi-tools/
$ LANG=C make</pre>
<p>今後も使うと思うので、パスが切れているところに入れておきます。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">sudo cp -pr ./bin2fex /usr/local/bin
sudo cp -pr ./fex2bin /usr/local/bin
sudo cp -pr ./sunxi-* /usr/local/bin

sudo chown root.root /usr/local/bin/bin2fex
sudo chown root.root /usr/local/bin/fex2bin
sudo chown root.root /usr/local/bin/sunxi-*</pre>
<p>で、以下のように使うようです。</p>
<blockquote><p>$ bin2fex script.bin lobo.fex</p></blockquote>
<p>この中はパラメータがたくさん書かれたもので、最大と最小が以下のように指定されていました。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">[dvfs_table]
pmuic_type = 2
pmu_gpio0 = port:PL06&lt;1&gt;&lt;1&gt;&lt;2&gt;&lt;1&gt;
pmu_level0 = 11300
pmu_level1 = 576
extremity_freq = 1536000000
max_freq = 1536000000
min_freq = 480000000
LV_count = 8
LV1_freq = 1536000000
LV1_volt = 1500
LV2_freq = 1200000000
LV2_volt = 1300
LV3_freq = 0
LV3_volt = 1100
LV4_freq = 0
LV4_volt = 1100
LV5_freq = 0
LV5_volt = 1100
LV6_freq = 0
LV6_volt = 1100
LV7_freq = 0
LV7_volt = 1100
LV8_freq = 0
LV8_volt = 1100</pre>
<p>このファイルは、.fex というのが通り名称のようです。sunxi の git リポジトリに昨年の12月22日にリリースされた.fex ファイルは以下にあります。</p>
<blockquote><p>sunxi-boards/sys_config/h3/<br> <br><a title="https://github.com/linux-sunxi/sunxi-boards/tree/master/sys_config/h3" href="https://github.com/linux-sunxi/sunxi-boards/tree/master/sys_config/h3" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">https://github.com/linux-sunxi/sunxi-boards/tree/master/sys_config/h3<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>現在の、script.bin の内容と比較すると以下のようです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">[junkhack@OrangePi BUILD]$ mkdir tmp_boot
[junkhack@OrangePi BUILD]$ cp -pr /media/boot/* tmp_boot/
[junkhack@OrangePi BUILD]$ ll tmp_boot/
::
-rwxr-xr-x 1 501 root    35812 12月 19 14:29 script.bin
-rwxr-xr-x 1 501 root 10917600 12月 19 14:29 uImage
[junkhack@OrangePi BUILD]$ 
[junkhack@OrangePi BUILD]$ cp -p ./sunxi-boards/sys_config/h3/xunlong_orange_pi_pc.fex tmp_boot/
[junkhack@OrangePi BUILD]$ cd tmp_boot/

[junkhack@OrangePi tmp_boot]$ bin2fex script.bin lobo.fex

[junkhack@OrangePi tmp_boot]$ diff -up lobo.fex xunlong_orange_pi_pc.fex &gt; lobo_opipc.patch</pre>
<p>違いは以下のようです。</p>
<p>&#8212;- lobo_opipc.patch</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">--- lobo.fex    2016-01-03 04:30:34.000000000 +0900
+++ xunlong_orange_pi_pc.fex    2016-01-03 04:10:45.000000000 +0900
@@ -8,7 +8,8 @@ eraseflag = 1
 next_work = 2
 
 [target]
-boot_clock = 1536
+#boot_clock = 1008
+boot_clock = 1200
 storage_type = -1
 
 [key_detect_en]
@@ -146,7 +147,7 @@ twi_scl = port:PA11&lt;2&gt;&lt;default&gt;&lt;default&gt;
 twi_sda = port:PA12&lt;2&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
 
 [twi1]
-twi_used = 1
+twi_used = 0
 twi_scl = port:PA18&lt;3&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
 twi_sda = port:PA19&lt;3&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
 
@@ -165,14 +166,14 @@ uart_rx = port:PA05&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;defau
 [uart1]
 uart_used = 0
 uart_port = 1
-uart_type = 2
+uart_type = 4
 uart_tx = port:PG06&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_rx = port:PG07&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_rts = port:PG08&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_cts = port:PG09&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 
 [uart2]
-uart_used = 1
+uart_used = 0
 uart_port = 2
 uart_type = 4
 uart_tx = port:PA00&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
@@ -181,16 +182,16 @@ uart_rts = port:PA02&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;defa
 uart_cts = port:PA03&lt;2&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 
 [uart3]
-uart_used = 1
+uart_used = 0
 uart_port = 3
-uart_type = 2
+uart_type = 4
 uart_tx = port:PA13&lt;3&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_rx = port:PA14&lt;3&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_rts = port:PA15&lt;3&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 uart_cts = port:PA16&lt;3&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 
 [spi0]
-spi_used = 1
+spi_used = 0
 spi_cs_bitmap = 1
 spi_mosi = port:PC00&lt;3&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
 spi_miso = port:PC01&lt;3&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
@@ -209,50 +210,66 @@ spi_miso = port:PA16&lt;2&gt;&lt;default&gt;&lt;default
 spi_dev_num = 1
 
 [spi_board0]
-modalias = &quot;spidev&quot;
+modalias = &quot;m25p32&quot;
 max_speed_hz = 33000000
 bus_num = 0
 chip_select = 0
 mode = 0
-full_duplex = 1
-manual_cs = 0
 
 [gpio_para]
 gpio_used = 1
-gpio_num = 19
-gpio_pin_1 = port:PL10&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_2 = port:PA15&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;1&gt;
-gpio_pin_3 = port:PA06&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_4 = port:PA13&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_5 = port:PA14&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_6 = port:PD14&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_7 = port:PA03&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_8 = port:PC04&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_9 = port:PC07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_10 = port:PC03&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_11 = port:PA21&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_12 = port:PA07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_13 = port:PA08&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_14 = port:PG08&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_15 = port:PA09&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_16 = port:PA10&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_17 = port:PG09&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_18 = port:PG06&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-gpio_pin_19 = port:PG07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
-
-[led_assign]
-normal_led = &quot;gpio_pin_2&quot;
-standby_led = &quot;gpio_pin_1&quot;
+gpio_num = 30
+; gpio_pin_1 = port:PL10&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;1&gt;
+; gpio_pin_2 = port:PA15&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_3 = port:PA12&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_4 = port:PA11&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_5 = port:PA06&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_6 = port:PA13&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_7 = port:PA14&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_8 = port:PA01&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_9 = port:PD14&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_10 = port:PA00&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_11 = port:PA03&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_12 = port:PC04&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_13 = port:PC07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_14 = port:PC00&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_15 = port:PC01&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_16 = port:PA02&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_17 = port:PC02&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_18 = port:PC03&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_19 = port:PA21&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_20 = port:PA19&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_21 = port:PA18&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_22 = port:PA07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_23 = port:PA08&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_24 = port:PG08&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_25 = port:PA09&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_26 = port:PA10&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_27 = port:PG09&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_28 = port:PA20&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_29 = port:PG06&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+gpio_pin_30 = port:PG07&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+
+;[led_assign]
+;normal_led = &quot;gpio_pin_2&quot;
+;standby_led = &quot;gpio_pin_1&quot;
+
+[leds_para]
+leds_used = 1
+green_led = port:PL10&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+green_led_active_low = 0
+red_led = port:PA15&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;
+red_led_active_low = 0
 
 [ths_para]
 ths_used = 1
-ths_trip1_count = 5
-ths_trip1_0 = 75
-ths_trip1_1 = 85
-ths_trip1_2 = 90
-ths_trip1_3 = 100
-ths_trip1_4 = 105
-ths_trip1_5 = 0
+ths_trip1_count = 6
+ths_trip1_0 = 70
+ths_trip1_1 = 80
+ths_trip1_2 = 85
+ths_trip1_3 = 90
+ths_trip1_4 = 95
+ths_trip1_5 = 100
 ths_trip1_6 = 0
 ths_trip1_7 = 0
 ths_trip1_0_min = 0
@@ -264,21 +281,22 @@ ths_trip1_2_max = 3
 ths_trip1_3_min = 3
 ths_trip1_3_max = 4
 ths_trip1_4_min = 4
-ths_trip1_4_max = 4
-ths_trip1_5_min = 0
-ths_trip1_5_max = 0
+ths_trip1_4_max = 5
+ths_trip1_5_min = 5
+ths_trip1_5_max = 5
 ths_trip1_6_min = 0
 ths_trip1_6_max = 0
 ths_trip2_count = 1
 ths_trip2_0 = 105
 
 [cooler_table]
-cooler_count = 5
-cooler0 = &quot;1536000 4 4294967295 0&quot;
+cooler_count = 6
+cooler0 = &quot;1296000 4 4294967295 0&quot;
 cooler1 = &quot;1200000 4 4294967295 0&quot;
 cooler2 = &quot;1008000 4 4294967295 0&quot;
-cooler3 = &quot;816000 3 4294967295 0&quot;
-cooler4 = &quot;504000 1 4294967295 0&quot;
+cooler3 =  &quot;816000 4 4294967295 0&quot;
+cooler4 =  &quot;648000 4 4294967295 0&quot;
+cooler5 =  &quot;480000 1 4294967295 0&quot;
 
 [nand0_para]
 nand_support_2ch = 0
@@ -316,17 +334,15 @@ hdmi_mode_check = 1
 disp_init_enable = 1
 disp_mode = 0
 screen0_output_type = 3
-screen0_output_mode = 10
+screen0_output_mode = 4
 screen1_output_type = 3
-screen1_output_mode = 10
+screen1_output_mode = 4
 fb0_format = 0
 fb0_width = 0
 fb0_height = 0
 fb1_format = 0
 fb1_width = 0
 fb1_height = 0
-fb0_framebuffer_num = 3
-sunxi_fb_mem_reserve = 32
 
 [hdmi_para]
 hdmi_used = 1
@@ -340,6 +356,7 @@ tv_dac_src0 = 0
 [pwm0_para]
 pwm_used = 0
 pwm_positive = port:PA05&lt;3&gt;&lt;0&gt;&lt;default&gt;&lt;default&gt;
+;       If set gamc_phy to use = 2
 
 [gmac0]
 gmac_used = 2
@@ -500,8 +517,8 @@ smc_sda = port:PA08&lt;2&gt;&lt;default&gt;&lt;default&gt;
 
 [usbc0]
 usb_used = 1
-usb_port_type = 1
-usb_detect_type = 0
+usb_port_type = 2
+usb_detect_type = 1
 usb_id_gpio = port:PG12&lt;0&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 usb_det_vbus_gpio = port:PG12&lt;0&gt;&lt;1&gt;&lt;default&gt;&lt;default&gt;
 usb_drv_vbus_gpio = port:PL02&lt;1&gt;&lt;0&gt;&lt;default&gt;&lt;0&gt;
@@ -693,31 +710,54 @@ ir_addr_code12 = 65344
 ir_used = 1
 ir_tx = port:PH07&lt;2&gt;&lt;default&gt;&lt;default&gt;&lt;default&gt;
 
+;----------------------------------------------------------------------------------
+; dvfs voltage-frequency table configuration
+;
+; pmuic_type:0:none, 1:gpio, 2:i2c
+; pmu_gpio0: gpio config.
+; pmu_levelx: 0~9999: voltage(mV), 10000~90000:gpio0 state. voltage form high to low.
+;
+; extremity_freq(Hz): cpu extremity frequency when run benckmark or demo apk
+;                     1536MHz@1500mV with radiator, 1296MHz@1340mV without radiator
+; max_freq: cpu maximum frequency, based on Hz, can not be more than 1200MHz
+; min_freq: cpu minimum frequency, based on Hz, can not be less than 60MHz
+;
+; LV_count: count of LV_freq/LV_volt, must be &lt; 16
+;
+; LV1: core vdd is 1.50v if cpu frequency is (1296Mhz,  1536Mhz]
+; LV2: core vdd is 1.34v if cpu frequency is (1200Mhz,  1296Mhz]
+; LV3: core vdd is 1.32v if cpu frequency is (1008Mhz,  1200Mhz]
+; LV4: core vdd is 1.20v if cpu frequency is (816Mhz,   1008Mhz]
+; LV5: core vdd is 1.10v if cpu frequency is (648Mhz,    816Mhz]
+; LV6: core vdd is 1.04v if cpu frequency is (0Mhz,      648Mhz]
+; LV7: core vdd is 1.04v if cpu frequency is (0Mhz,      648Mhz]
+; LV8: core vdd is 1.04v if cpu frequency is (0Mhz,      648Mhz]
+;
+;----------------------------------------------------------------------------------
 [dvfs_table]
 pmuic_type = 2
 pmu_gpio0 = port:PL06&lt;1&gt;&lt;1&gt;&lt;2&gt;&lt;1&gt;
 pmu_level0 = 11300
-pmu_level1 = 576
-extremity_freq = 1536000000
-max_freq = 1536000000
-min_freq = 480000000
+pmu_level1 = 1100
+max_freq = 1296000000
+min_freq = 648000000
 LV_count = 8
-LV1_freq = 1536000000
-LV1_volt = 1500
+LV1_freq = 1296000000
+LV1_volt = 1340
 LV2_freq = 1200000000
-LV2_volt = 1300
-LV3_freq = 0
-LV3_volt = 1100
-LV4_freq = 0
+LV2_volt = 1320
+LV3_freq = 1008000000
+LV3_volt = 1200
+LV4_freq = 816000000
 LV4_volt = 1100
-LV5_freq = 0
-LV5_volt = 1100
+LV5_freq = 648000000
+LV5_volt = 1040
 LV6_freq = 0
-LV6_volt = 1100
+LV6_volt = 1040
 LV7_freq = 0
-LV7_volt = 1100
+LV7_volt = 1040
 LV8_freq = 0
-LV8_volt = 1100
+LV8_volt = 1040
 
 [gpu_dvfs_table]
 G_LV_count = 3
@@ -797,13 +837,3 @@ din_gpio = port:PD00&lt;1&gt;&lt;default&gt;&lt;default
 clk_gpio = port:PD01&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;1&gt;
 stb_gpio = port:PD02&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;1&gt;
 
-[mali_para]
-mali_used = 1
-mali_clkdiv = 1
-mali_extreme_freq = 600
-mali_extreme_vol = 1400
-
-[w1_para]
-w1_used = 1
-gpio = 20
-</pre>
<p>ファンがなくても、まぁいいようにクロックダウンしたほうが良さそうですね。ということで、fex2bin で作ったscript.bin でリブートしておきました。しばらくこれで様子をみることに。</p>
<p>&#160;</p>
<p>▼まとめ</p>
<p>・script.bin は、bin2fex や fex2bin で取り扱う</p>
<p>・これがブート領域からkernel に引き渡すパラメータを持っている模様</p>
<p>・VDD を1.34vで扱うLV2 が安全の模様</p>
<p>・*.txt から読み込むようにする u-boot イメージはどうやって作るのか？</p>
<p>・あるいは、今でも kernel に渡す方法があるのかも。</p>
<p>・sunxi からのfex ファイルには gpio ピンのマッピングも追加変更されているようだ</p>
<p>・ヒートシンク＋ファンをつければ、40度くらいまでアイドル時になるようで、負荷時は60度くらいかな？</p>
<p>・ファンの効果は絶大だけれども、もう少し設定を下げて運用しようかと思う。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-1980" class="post-1980 post type-post status-publish format-standard hentry category-aliexpress category-linux category-orangepi category-orangepipc category-parts"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2016/01/02/opie381abfan-e38292e381a4e38191e3828be381a8e6b8a9e5baa6e381afe381a9e381aee3818fe38289e38184e4b88be3818ce3828be3818befbc9f/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2016-01-02T19:53:06+09:00">2016年1月2日</time></a> </span><span class="posted-on">更新日:2016年1月2日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/orangepi/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePi</a>, <a href="/category/orangepipc/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePiPC</a>, <a href="/category/parts/" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a></span>
</div>
<h1 class="entry-title"><a href="/2016/01/02/opie381abfan-e38292e381a4e38191e3828be381a8e6b8a9e5baa6e381afe381a9e381aee3818fe38289e38184e4b88be3818ce3828be3818befbc9f/" rel="bookmark noopener noreferrer" data-wpel-link="internal">OPIにFAN をつけると温度はどのくらい下がるか？</a></h1></header><div class="entry-content">
<p>aliexpress からFAN と熱シールが届きましたので、OPI に取り付けました。</p>
<p>&#160;</p>
<p><a href="/wp-content/uploads/2016/01/1.jpg" target="_blank" rel="noopener noreferrer" data-wpel-link="internal"><noscript><img title="1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="1" src="/wp-content/uploads/2016/01/1_thumb.jpg" width="640" height="480"></noscript>
<img class="lazyload" title="1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="1" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/1_thumb.jpg" width="640" height="480"></a></p>
<p>FAN は2個入り、3M の熱伝道シールは3枚で14ｍｍにカットしてあります。1枚に５ｘ７で35枚でした。</p>
<p></p>
<noscript><img title="2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="2" src="/wp-content/uploads/2016/01/2.jpg" width="640" height="480"></noscript>
<img class="lazyload" title="2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="2" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/2.jpg" width="640" height="480"><p>CPU とメモリ部分にシールを取り付け、簡易的にファンもシールで貼り付け。</p>
<p></p>
<noscript><img title="3" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="3" src="/wp-content/uploads/2016/01/3.jpg" width="640" height="480"></noscript>
<img class="lazyload" title="3" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="3" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/3.jpg" width="640" height="480"><p>安い割りには、薄いのでこれで十分ですね。実測で、6.87mm です。</p>
<p>ファンを回す前と、回さない前でCPU 温度をmunin で取得しようと以下を設定。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">[root@opi 19:43:22 plugins]# pwd
/etc/munin/plugins
[root@opi 19:43:23 plugins]# cat h3_temp 
#!/bin/sh

#%# family=auto
#%# capabilities=autoconf

GETNUM=`/bin/cat /sys/class/thermal/thermal_zone0/temp`

if [ &quot;$1&quot; = &quot;autoconf&quot; ]; then
        if [ -n ${GETNUM} ] ; then
                echo yes
                exit 0
        else
                echo no
                exit 0
        fi
fi

if [ &quot;$1&quot; = &quot;config&quot; ]; then
        echo 'graph_title CPU Temp'
        echo 'graph_args -r --lower-limit 0'
        echo 'graph_vlabel Temp'
        echo 'graph_category Apps'
        echo 'total.label CPU0 Temp'
        echo 'total.min 0'
        echo 'total.draw AREA'
        echo 'total.type GAUGE'
        exit 0
fi

echo &quot;total.value $GETNUM&quot;;</pre>
<p>確認は以下を実行。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">[root@opi 19:46:32 plugins]# ./h3_temp autoconf
yes
[root@opi 19:46:37 plugins]# ./h3_temp config
graph_title CPU Temp
graph_args -r --lower-limit 0
graph_vlabel Temp
graph_category Apps
total.label CPU0 Temp
total.min 0
total.draw AREA
total.type GAUGE
[root@opi 19:46:44 plugins]# ./h3_temp 
total.value 57
[root@opi 19:46:52 plugins]# </pre>
<p>で、munin-node を再起動</p>
<blockquote><p># systemctl restart munin-node</p></blockquote>
<p>すると、以下な感じでグラフができます。</p>
<p></p>
<noscript><img title="h3_temp-day" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="h3_temp-day" src="/wp-content/uploads/2016/01/h3_tempday.png" width="497" height="280"></noscript>
<img class="lazyload" title="h3_temp-day" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="h3_temp-day" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20497%20280%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/h3_tempday.png" width="497" height="280"><p>ファンをつける前のデータをとりあえず記録するため、まだ回していません。結構熱そうですね。70 度くらいになっています。</p>
<p>しばらく、このまま記録をとってからファンを回したいと思います。最初、テストで回していたときは、上のグラフの最初の部分で40 度くらいでした。効果はかなり期待できそうです。</p>
<p>&#160;</p>
<p>参考</p>
<blockquote><p>muninプラグインを作成<br> <br><a title="https://www.seeds-std.co.jp/seedsblog/671.html" href="https://www.seeds-std.co.jp/seedsblog/671.html" target="_blank" rel="noopener noreferrer external" data-wpel-link="external" class="wpel-icon-right">https://www.seeds-std.co.jp/seedsblog/671.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-1973" class="post-1973 post type-post status-publish format-standard hentry category-aliexpress category-c category-espeink category-orangepi category-orangepipc"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2016/01/02/1us-le38381e382ab/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2016-01-02T02:56:05+09:00">2016年1月2日</time></a> </span><span class="posted-on">更新日:2016年1月2日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/c/" rel="category tag noopener noreferrer" data-wpel-link="internal">C</a>, <a href="/category/espeink/" rel="category tag noopener noreferrer" data-wpel-link="internal">espeink</a>, <a href="/category/orangepi/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePi</a>, <a href="/category/orangepipc/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePiPC</a></span>
</div>
<h1 class="entry-title"><a href="/2016/01/02/1us-le38381e382ab/" rel="bookmark noopener noreferrer" data-wpel-link="internal">1us Lチカ</a></h1></header><div class="entry-content">
<p>2016年 謹賀新年、あけましておめでとうございます。おせち料理も31日と1日で食べつくしてしまいました。</p>
<p>さて、今年最初のブログですね。0.000001秒のLチカをロジックアナライザーでモニタリングして光らせてみました。</p>
<p>あと、オレンジパイで、8本のGPIO を使って安価なロジックアナライザーで採取できるかも確認してみました。</p>
<p>&#160;</p>
<p>サンプルプログラムを採取したデータが以下です。8本分は取れていますが、速すぎるところは取りこぼしているようです。</p>
<p></p>
<noscript><img title="1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="1" src="/wp-content/uploads/2016/01/1.png" width="640" height="319"></noscript>
<img class="lazyload" title="1" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="1" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20319%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/1.png" width="640" height="319"><p>矢印は500ns で光っている部分で採取に失敗し、取りこぼす事がありました。このあたりが2Mhz の限界なんですね。今のファームウェアとソフトウェアだとこれが限界のようです。</p>
<p></p>
<noscript><img title="2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="2" src="/wp-content/uploads/2016/01/2.png" width="640" height="320"></noscript>
<img class="lazyload" title="2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="2" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20320%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/2.png" width="640" height="320"><p>複数のLED は、blink ファンクションにて光らせていますが、呼び出しと初期化の処理で250us 程度使っているようです。</p>
<p></p>
<noscript><img title="3" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="3" src="/wp-content/uploads/2016/01/3.png" width="640" height="320"></noscript>
<img class="lazyload" title="3" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="3" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20320%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/3.png" width="640" height="320"><p>usleep 関数を使っても思ったより、処理に時間がかかるようです。1us を指定して光らせているんですが、実際は69us 光っています。nanosleep を使っても66us は使われてしまうようで、1us を光らせる為にwhile で調整してみました。</p>
<p></p>
<noscript><img title="4" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="4" src="/wp-content/uploads/2016/01/4.png" width="640" height="319"></noscript>
<img class="lazyload" title="4" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="4" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20319%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2016/01/4.png" width="640" height="319"><p>サンプルのプログラムは以下です。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">/*
 *  +-----+-----+----------+------+---+--OrangePiPC--+---+------+---------+-----+--+
 *  | BCM | wPi |   Name   | Mode | V | Physical | V | Mode | Name     | wPi | BCM |
 *  +-----+-----+----------+------+---+----++----+---+------+----------+-----+-----+
 *  |     |     |     3.3v |      |   |  1 || 2  |   |      | 5v       |     |     |
 *  |   2 |  -1 |    SDA.0 |      |   |  3 || 4  |   |      | 5V       |     |     |
 *  |   3 |  -1 |    SCL.0 |      |   |  5 || 6  |   |      | 0v       |     |     |
 *  |   4 |   6 | IO6 PA06 |  OUT | 0 |  7 || 8  |   |      | TxD3     |     |     |
 *  |     |     |       0v |      |   |  9 || 10 |   |      | RxD3     |     |     |
 *  |  17 |  -1 |     RxD2 |      |   | 11 || 12 | 0 | OUT  | IO1 PD14 | 1   | 18  |
 *  |  27 |  -1 |     TxD2 |      |   | 13 || 14 |   |      | 0v       |     |     |
 *  |  22 |  -1 |     CTS2 |      |   | 15 || 16 | 0 | OUT  | IO4 PC04 | 4   | 23  |
 *  |     |     |     3.3v |      |   | 17 || 18 | 0 | OUT  | IO5 PC07 | 5   | 24  |
 *  |  10 |  -1 |     MOSI |      |   | 19 || 20 |   |      | 0v       |     |     |
 *  |   9 |  -1 |     MISO |      |   | 21 || 22 |   |      | RTS2     |     |     |
 *  |  11 |  -1 |     SCLK |      |   | 23 || 24 |   |      | SPI-CE0  |     |     |
 *  |     |     |       0v |      |   | 25 || 26 |   |      | CE1      |     |     |
 *  |   0 |  -1 |    SDA.1 |      |   | 27 || 28 |   |      | SCL.1    |     |     |
 *  |   5 |   7 |  IO7 PA7 |  OUT | 0 | 29 || 30 |   |      | 0v       |     |     |
 *  |   6 |   8 |  IO8 PA8 |  OUT | 0 | 31 || 32 | 0 | OUT  | IO9 PG08 | 9   | 12  |
 *  |  13 |  10 | IO10 PA9 |  OUT | 0 | 33 || 34 |   |      | 0v       |     |     |
 *  |  19 |  12 | IO12PA10 |  OUT | 0 | 35 || 36 | 0 | OUT  | IO13PG09 | 13  | 16  |
 *  |  26 |  14 | IO14PA20 | ALT3 | 0 | 37 || 38 | 0 | OUT  | IO15PG06 | 15  | 20  |
 *  |     |     |       0v |      |   | 39 || 40 | 0 | OUT  | IO16PG07 | 16  | 21  |
 *  +-----+-----+----------+------+---+----++----+---+------+----------+-----+-----+
 *  | BCM | wPi |   Name   | Mode | V | Physical | V | Mode | Name     | wPi | BCM |
 *  +-----+-----+----------+------+---+--OrangePIPC--+------+----------+-----+-----+
 *         ^^^^ Pin NO                                                   ^^^^ Pin NO
 * 1us LED blink.
 * building ex) gcc -lwiringPi -lpthread -I/usr/local/include -L/usr/local/lib -levent -o 2016blinkall 2016blinkall.c
 * 
 *
*/
#include &lt;sys/time.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;wiringPi.h&gt;

#define MSEC 1
#define USEC 33
#define NANOSEC 1000

int blink2(int led, int delay);

int main (void)
{
  int led;
  int i = 0;

  while (i &lt; 3)
  {
    blink2(16, 1000);
      blink2(15, 1000); //Next blink 250 us
      blink2(13, 1000);
      blink2(9, 1000);
      blink2(5, 1000);
      blink2(4, 1000);
      blink2(1, 1000);
      blink2(6, 1000);

    i++;
  }

  delay (MSEC);
  return 0;
}

int blink2(int led, int delay){
    // unsigned int usecs;
    // usecs = delay;
    // sec = delay;
    led = led;
    int i = 0;

    // nano sec
    struct timespec nano;
    nano.tv_sec = 0;
    nano.tv_nsec = delay;

    wiringPiSetup () ;
    pinMode (led, OUTPUT) ;

    digitalWrite (led, HIGH) ;
    nanosleep(&amp;nano, NULL); // 66us
    // usleep (usecs) ; // 66us
    // delay (delay);
    digitalWrite (led,  LOW) ;
    usleep (1);

    digitalWrite (led, HIGH) ;

    // 1us
    while (i &lt; 100)
    {
        i++;
    }
    digitalWrite (led,  LOW) ;
    usleep (1); // 66us

    digitalWrite (led, HIGH) ;
    // 500 ns
    digitalWrite (led,  LOW) ;
}</pre>
<p>GPIO の8本を同時に処理させるにはどうしたらいいんでしょうかね。マルチスレッド処理ですかね？シフトレジスタに投げて、一括処理とかですかね？</p>
<p>&#160;</p>
<p>前ちょっと触ったイベント処理のlibevent とかを使うとどのくらいの精度になるんでしょうかね。いろいろ疑問がわいてきます。</p>
<p>E-ink を表示するためにはまだまだ超えないといけない山がたくさんあるようです。</p>
<p>なんとか、春までには表示したいんですが。こつこつとやっていきます。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-1966" class="post-1966 post type-post status-publish format-standard hentry category-aliexpress category-c category-osx category-qt"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/12/31/sigrok-e381ae-pulsview-0-3-0-e58b95e3818de381bee38197e3819f/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-12-31T04:47:23+09:00">2015年12月31日</time></a> </span><span class="posted-on">更新日:2015年12月31日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/c/" rel="category tag noopener noreferrer" data-wpel-link="internal">C</a>, <a href="/category/osx/" rel="category tag noopener noreferrer" data-wpel-link="internal">osx</a>, <a href="/category/qt/" rel="category tag noopener noreferrer" data-wpel-link="internal">QT</a></span>
</div>
<h1 class="entry-title"><a href="/2015/12/31/sigrok-e381ae-pulsview-0-3-0-e58b95e3818de381bee38197e3819f/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Sigrok の Pulsview 0.3.0 動きました</a></h1></header><div class="entry-content">
<p>とりあえず、なんとか動かしたいのでソースをコードも見ましたが、特に問題となりそうな部分もなく、ちょっと場を離れてから、brew版のをサイド入れてみることに。とりあえず、動作させることができました。</p>
<p>なんとか、今年中に出来たのですっきり。</p>
<p>&#160;</p>
<p>0.3.0-git-5d73886 では、以下のようにトリガーが設定できて楽になりました。Runを押せばトリガーがでるまで、stop して採取されます。サンプル数を設定しておけば、採取されて停止します。ロジックアナライザーとしては基本機能だと思いますが、手持ちのハードでなんとか動いてよかったです。</p>
<p></p>
<noscript><img title="７" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="７" src="/wp-content/uploads/2015/12/3662338e426b.png" width="640" height="359"></noscript>
<img class="lazyload" title="７" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="７" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20359%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/3662338e426b.png" width="640" height="359"><p>拡大すると、500ns とか取れています。1us 単位くらいまでは見れそうということがわかりました。</p>
<p></p>
<noscript><img title="８" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="８" src="/wp-content/uploads/2015/12/d2bb6fa3e4a8.png" width="640" height="357"></noscript>
<img class="lazyload" title="８" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="８" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20357%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/d2bb6fa3e4a8.png" width="640" height="357"><p>サンプルレートは、2MHz 以上あげるとどうしても採取後にクルクル回って、操作を受け付けないスタック状態のような感じになります。コマンドライン版でドライバを指定してみると、以下のようです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ sigrok-cli --show --driver fx2lafw
Driver functions:
    Logic analyzer
Scan options:
    conn
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
sr: fx2lafw: Failed to get manufacturer string descriptor: LIBUSB_ERROR_OTHER.
fx2lafw:conn=28.2 - Saleae Logic with 8 channels: 0 1 2 3 4 5 6 7
Supported configuration options:
    continuous: 
    limit_samples: 0 (current)
    conn: 28.2 (current)
    samplerate - supported samplerates:
      20 kHz
      25 kHz
      50 kHz
      100 kHz
      200 kHz
      250 kHz
      500 kHz
      1 MHz
      2 MHz
      3 MHz
      4 MHz
      6 MHz
      8 MHz
      12 MHz
      16 MHz
      24 MHz
    Supported triggers: 0 1 r f e 
    captureratio: 0 (current)</pre>
<p>ここに出ているサンプリング周波数は採取できるはずなんですが、なぜか2MHz までしかとれません。</p>
<p>まぁ、最初の一台ですし、これで勉強させてもらって、物足りなければまた考えることにします。</p>
<p>&#160;</p>
<p>automator でシェルスクリプトを実行するものを作り、アイコンをつけて、app 化します。</p>
<p></p>
<noscript><img title="6" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="6" src="/wp-content/uploads/2015/12/61.png" width="632" height="480"></noscript>
<img class="lazyload" title="6" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="6" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20632%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/61.png" width="632" height="480"><p>python の環境変数を一度 unset して消去して、python3.4 とか3.x のをセットしてアプリをバックグランドで呼び出します。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">unset PYTHONPATH
export PYTHONPATH=&quot;/usr/local/lib/python3.4/site-packages/:$PYTHONPATH&quot;

/usr/local/Cellar/pulseview/HEAD/bin/pulseview &gt;/dev/null 2&gt;&amp;1 &amp;</pre>
<p>&#160;</p>
<p>配布用にするには、ライブラリのパスを全部書き換えないといけないので、やめました。このあたりのスキルは、もう少し勉強しないと嵌りそうです。</p>
<p></p>
<noscript><img title="5" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="5" src="/wp-content/uploads/2015/12/51.png" width="276" height="423"></noscript>
<img class="lazyload" title="5" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="5" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20276%20423%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/51.png" width="276" height="423"><p>brew 版のインストールは、wiki に書いてあるとおりで以下のようです。</p>
<blockquote>
<p><a title="https://sigrok.org/wiki/Mac_OS_X" href="https://sigrok.org/wiki/Mac_OS_X" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">https://sigrok.org/wiki/Mac_OS_X<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>$ brew tap rene-dev/sigrok<br> <br>$ brew install python3</p>
<p>$ brew install &#8211;HEAD libserialport</p>
<p>$ brew install &#8211;HEAD &#8211;with-libserialport libsigrok</p>
<p>$ brew install &#8211;HEAD libsigrokdecode</p>
<p>$ brew install &#8211;HEAD &#8211;with-libserialport sigrok-cli</p>
<p>$ brew install &#8211;HEAD pulseview</p>
</blockquote>
<p>ポイントとしては、マニュアルビルドしてソースから入れたものは一度、綺麗に消して、brew docter で問題をクリアにしてからやることと、以下の libsigrokdecode が２つ出てくるのでbrew のを無効にすることくらいです。</p>
<p>$ brew install &#8211;HEAD libsigrokdecode<br> <br>Error: Formulae found in multiple taps:</p>
<p> * homebrew/science/libsigrokdecode</p>
<p> * rene-dev/sigrok/libsigrokdecode</p>
<p>&#160;</p>
<p>$ brew untap homebrew/science</p>
<p>$ brew tap –repair</p>
<p>$ brew update</p>
<p>&#160;</p>
<p>あと、ファームウェアの格納場所は、デフォルトで</p>
<p>/usr/local/share/sigrok-firmware</p>
<p>になるので、ここにディレクトリを作成し、最新のファームウェアを入れておきます。これで最初のデバイスを見つけてファームがなくエラーになるのを迂回できます。エラーでも、落ちはしませんが。前回落ちたのは別の原因で、QT 関連のライブラリのパスが書き換わっていないのが原因でした。ltool で見ると、/usr 配下となっていました。そのほかの原因もあったとは思いますが、ライブラリの依存関係でおそらくは、brew 版のを見に行っていたのかもしれません。まぁ、詳細は不明です。</p>
<p>&#160;</p>
<p>ということで、とりあえずは動いてよかったです。トリガーもかけられるようになったし、インターフェイスは少しよくなった感じ。ボタンの配置とか。</p>
<p>&#160;</p>
<p>▼まとめ</p>
<p>・EZ-USB FX2LP CY7C68013A で、sigrok の pulsview は動作</p>
<p>・このハードは実質6ドルくらいなので、ロジックアナライザーとして最初の一台で遊ぶには十分</p>
<p>・0.3.0-git-f3697d3 は動作した</p>
<p>・トリガーがかけられるようになった</p>
<p>・少しインターフェイスがよくなった</p>
<p>・2Mhz サンプリングまでは出来ることを確認</p>
<p>・１チャンネル採取で500ns は採取できた。1us くらいが精度か？</p>
<p>・8チャンネル同時採取はまだやっていない</p>
<p>・ファームウェア格納場所は、/usr/local/share/sigrok-firmware</p>
<p>・brew 版で HEAD で入れているので、時期によっては動作しない場合もあるかも</p>
<p>・配布用に、ライブラリを書き換えるのはどうすれば楽になるのか？要研究</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-1946" class="post-1946 post type-post status-publish format-standard hentry category-aliexpress category-c category-espeink category-orangepi category-orangepipc category-parts"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2015/12/27/fx2lp-e381a7sigrok-e381aee383ade382b8e38383e382afe382a2e3838ae383a9e382a4e382b6e383bc/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published updated" datetime="2015-12-27T21:26:13+09:00">2015年12月27日</time></a> </span><span class="posted-on">更新日:2015年12月27日</span> <span class="categories"> <a href="/category/aliexpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">Aliexpress</a>, <a href="/category/c/" rel="category tag noopener noreferrer" data-wpel-link="internal">C</a>, <a href="/category/espeink/" rel="category tag noopener noreferrer" data-wpel-link="internal">espeink</a>, <a href="/category/orangepi/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePi</a>, <a href="/category/orangepipc/" rel="category tag noopener noreferrer" data-wpel-link="internal">OrangePiPC</a>, <a href="/category/parts/" rel="category tag noopener noreferrer" data-wpel-link="internal">Parts</a></span>
</div>
<h1 class="entry-title"><a href="/2015/12/27/fx2lp-e381a7sigrok-e381aee383ade382b8e38383e382afe382a2e3838ae383a9e382a4e382b6e383bc/" rel="bookmark noopener noreferrer" data-wpel-link="internal">FX2LP でsigrok のロジックアナライザー</a></h1></header><div class="entry-content">
<p>年末で、何かとイベントごとがあってなかなかブログを更新できずにいました。</p>
<p>Aliexpress からもどんどんお品が届いて、ロジックアナライザーとして使うボードも到着しました。テストがてら、OrangePi PC の GPIO につないだLED のタイミングを計測してみること。</p>
<p>配線は、とりあえず1チャンネルでテスト。全部で8チャンネルいけます。</p>
<p></p>
<noscript><img title="logic2" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="logic2" src="/wp-content/uploads/2015/12/logic2.jpg" width="640" height="480"></noscript>
<img class="lazyload" title="logic2" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="logic2" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/logic2.jpg" width="640" height="480"><p>ちょっとわかりにくいですが、PB0 ～ PB7 までの端子が sigrok でいう0から7 までに対応しています。とりあえず今回はPB0 の端子につないで1チャンネルの表示をしてみました。</p>
<p></p>
<noscript><img title="PulseView1" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="PulseView1" src="/wp-content/uploads/2015/12/pulseview1.png" width="640" height="445"></noscript>
<img class="lazyload" title="PulseView1" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="PulseView1" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20445%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/pulseview1.png" width="640" height="445"><p>全体のテスト配線は以下のような感じです。</p>
<p>&#160;</p>
<p> </p>
<noscript><img title="logic" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="logic" src="/wp-content/uploads/2015/12/logic.jpg" width="640" height="480"></noscript>
<img class="lazyload" title="logic" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="logic" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/logic.jpg" width="640" height="480"><p>osx だと sigrok のソフトウェアの中にファームウェアがあります。最新のファームウェアは、以下にビルド済みのものがあります。</p>
<blockquote><p>fx2lafw (pre-built firmware files の項を参照) <br><a title="http://sigrok.org/wiki/Fx2lafw" href="http://sigrok.org/wiki/Fx2lafw" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://sigrok.org/wiki/Fx2lafw<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>つい先月にリリースされている0.1.3 を使いました。</p>
<blockquote>
<p>sigrok-firmware-fx2lafw-bin-0.1.3.tar.gz</p>
<p><a title="http://sigrok.org/download/binary/sigrok-firmware-fx2lafw/" href="http://sigrok.org/download/binary/sigrok-firmware-fx2lafw/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://sigrok.org/download/binary/sigrok-firmware-fx2lafw/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
</blockquote>
<p>ほどよく、配置。*.fw がファームウェアです。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">HOPE:sigrok-firmware junkhack$ pwd
/Applications/PulseView.app/Contents/share/sigrok-firmware
HOPE:sigrok-firmware junkhack$ ll
total 1088
-rw-r--r--@ 1 junkhack  admin  45268 11  3  2014 asix-sigma-100.fw
-rw-r--r--@ 1 junkhack  admin  45396 11  3  2014 asix-sigma-200.fw
-rw-r--r--@ 1 junkhack  admin  45396 11  3  2014 asix-sigma-50.fw
-rw-r--r--@ 1 junkhack  admin  45360 11  3  2014 asix-sigma-50sync.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-braintechnology-usb-lps.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-cwav-usbeeax.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-cwav-usbeedx.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-cwav-usbeesx.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-cypress-fx2.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-saleae-logic.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-sigrok-fx2-16ch.fw
-rw-r--r--@ 1 junkhack  admin   8120 11 27 09:09 fx2lafw-sigrok-fx2-8ch.fw
-rw-r--r--@ 1 junkhack  admin  81808 11  3  2014 sysclk-lwla1034-extneg.rbf
-rw-r--r--@ 1 junkhack  admin  81808 11  3  2014 sysclk-lwla1034-extpos.rbf
-rw-r--r--@ 1 junkhack  admin  81460 11  3  2014 sysclk-lwla1034-int.rbf
-rw-r--r--@ 1 junkhack  admin  48521 11  3  2014 sysclk-lwla1034-off.rbf
HOPE:sigrok-firmware junkhack$ </pre>
<p>sigrok の PluseView を開きます。</p>
<p>現在、手元でビルドしていないので、ELIAS さんのビルドしたものです。</p>
<blockquote><p>osx PulseView.dmg （0.2.0 : 2014/11/04 build）<br> <br><a title="http://eliasoenal.com/2014/11/04/sigrok-for-os-x/" href="http://eliasoenal.com/2014/11/04/sigrok-for-os-x/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">http://eliasoenal.com/2014/11/04/sigrok-for-os-x/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p></blockquote>
<p>File Menu から Connect to Device を選択して、以下のようにスキャンすると出ました。</p>
<p></p>
<noscript><img title="Connect_to_Device" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="Connect_to_Device" src="/wp-content/uploads/2015/12/connect_to_device.png" width="523" height="395"></noscript>
<img class="lazyload" title="Connect_to_Device" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="Connect_to_Device" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20523%20395%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/connect_to_device.png" width="523" height="395"><p>osx の USB 認識は、以下のようでした。</p>
<p></p>
<noscript><img title="osxusb" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="osxusb" src="/wp-content/uploads/2015/12/osxusb.png" width="354" height="320"></noscript>
<img class="lazyload" title="osxusb" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="osxusb" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20354%20320%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/osxusb.png" width="354" height="320"><p>system_profiler で見ると以下のように出ます。</p>
<p>&#160;</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">$ system_profiler SPUSBDataType
USB:
::

            fx2lafw:

              Product ID: 0x3881
              Vendor ID: 0x0925
              Version:  0.01
              Speed: Up to 480 Mb/sec
              Manufacturer: sigrok
              Location ID: 0x1c120000 / 2
              Current Available (mA): 500
              Current Required (mA): 100</pre>
<p>&#160;</p>
<p>で、LEDをGPIO で光らせるプログラムで、LED を ON するタイミングを以下のように、usleep を使って1ms 光らせてみました。</p>
<p>抜粋箇所だけ載せておきます。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">#include &lt;event.h&gt;
#include &lt;wiringPi.h&gt;
#include &lt;unistd.h&gt;

#define LED 16
#define MSEC 10
#define USEC 1000 // 1000 = 1ms (0.000001 sec = 1 micro second)

int
blink(void){
    wiringPiSetup () ;
    pinMode (LED, OUTPUT) ;

    digitalWrite (LED, HIGH) ;
    // delay (MSEC);
    usleep(USEC);
    digitalWrite (LED,  LOW) ;
}
::</pre>
<p>全体のプログラムは、末尾につけておきます。このプログラムは、libevent を使ってfifo ファイルに read イベントがあったら、上記のblink ファンクションが呼ばれる仕組みです。あとで、書きますが、nginx のログをパイプさせて監視させています。</p>
<p>で、他のホストから ab で web アクセスしてみます。</p>
<blockquote><p>$ ab -n 5 -c 1 <a href="/index.html" data-wpel-link="internal" rel="noopener noreferrer">/index.html</a></p></blockquote>
<p>とりあえず、5回くらいで。nginx のアクセスログには、5回記録されています。</p>
<pre class="brush: cpp; gutter: false; toolbar: false; collapse: true; auto-links: false; smart-tabs: false;">192.168.1.17 - - [27/Dec/2015:20:21:27 +0900] &quot;GET /index.html HTTP/1.0&quot; 200 10798 &quot;-&quot; &quot;ApacheBench/2.3&quot; &quot;-&quot;
192.168.1.17 - - [27/Dec/2015:20:21:27 +0900] &quot;GET /index.html HTTP/1.0&quot; 200 10798 &quot;-&quot; &quot;ApacheBench/2.3&quot; &quot;-&quot;
192.168.1.17 - - [27/Dec/2015:20:21:27 +0900] &quot;GET /index.html HTTP/1.0&quot; 200 10798 &quot;-&quot; &quot;ApacheBench/2.3&quot; &quot;-&quot;
192.168.1.17 - - [27/Dec/2015:20:21:27 +0900] &quot;GET /index.html HTTP/1.0&quot; 200 10798 &quot;-&quot; &quot;ApacheBench/2.3&quot; &quot;-&quot;
192.168.1.17 - - [27/Dec/2015:20:21:27 +0900] &quot;GET /index.html HTTP/1.0&quot; 200 10798 &quot;-&quot; &quot;ApacheBench/2.3&quot; &quot;-&quot;</pre>
<p>そのタイミングを取ると以下のようです。</p>
<p></p>
<noscript><img title="PulseView" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="PulseView" src="/wp-content/uploads/2015/12/pulseview.png" width="640" height="446"></noscript>
<img class="lazyload" title="PulseView" style="float:none;margin-left:auto;display:block;margin-right:auto;border-width:0;" border="0" alt="PulseView" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20446%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/pulseview.png" width="640" height="446"><p>今度は、300us ほどにして、100回アクセスしてみました。ちゃんと100回、凹凸があるか数えたらありました。</p>
<p></p>
<noscript><img title="PulseView_2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="PulseView_2" src="/wp-content/uploads/2015/12/pulseview_2.png" width="640" height="403"></noscript>
<img class="lazyload" title="PulseView_2" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="PulseView_2" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20403%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/pulseview_2.png" width="640" height="403"><p>マウスホイールすると拡大できます。300us より若干大きくなっているのは、イベント処理のプログラムや時計の誤差などの影響ですかね。</p>
<p></p>
<noscript><img title="300us" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="300us" src="/wp-content/uploads/2015/12/300us.png" width="640" height="404"></noscript>
<img class="lazyload" title="300us" style="border-top:0;border-right:0;border-bottom:0;float:none;margin-left:auto;border-left:0;display:block;margin-right:auto;" border="0" alt="300us" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20404%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2015/12/300us.png" width="640" height="404"><p>1ms くらいのものは問題なく見れそうということがわかりました。2Mhz 以上あげると、固まるのはなぜですかね。24Mhz までいけるはずですが？</p>
<p>&#160;</p>
<p>1us 単位の計測が今のところできないです。あと、トリガーをかけようとチャンネルをクリックすると落ちる。うーん、独自にコンパイルしてみるしかなさそうですね。</p>
<p>&#160;</p>
<p>▼まとめ</p>
<p>・EZ-USB FX2LP CY7C68013A というのをゲット（非常に安価だった）</p>
<p>・sigrok の PluseView の osx 版（0.2.0）を使ったが、無事チャンネル0のパルスが取れた</p>
<p>・PCB上のPB0 ～ PB7 までの端子が sigrok でいう0から7 までに対応</p>
<p>・fx2lafw はビルド済みの0.1.3 を使用</p>
<p>・2Mhz までは計測できるが、それ以上でかたまる</p>
<p>・fx2lafw が悪いのか、PluseView が悪いのか切り分ける必要あり</p>
<p>・テストプログラム側のusleep を削除して、単純に点灯消灯をしてタイミングを取ったら、500ns という単位が出たので、1us の単位でも取得できそう。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/category/aliexpress/page/13/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/category/aliexpress/page/11/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_b6c6c7d2c47bd5f86199fb6f5207fc2e.js"></script>
</body>
</html>