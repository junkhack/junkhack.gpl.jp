<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="/xmlrpc.php"> <noscript id="aonoscrcss"></noscript>
<title>WordPress &#8211; ページ 3 &#8211; JunkHack</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//www.google.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; フィード" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; コメントフィード" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="JunkHack &raquo; WordPress カテゴリーのフィード" href="/category/wordpress/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=5.8.3" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_76e12144b6be9bc0a17dd880c5566156.css?ver=5.4.1" type="text/css" media="all">
<link rel="stylesheet" id="contact-form-7-confirm-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c605b424176e2b3541570e9ebd66830b.css?ver=5.1" type="text/css" media="all">
<link rel="stylesheet" id="wpel-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_04d23f0dc44b526ca48d1d564eb7537c.css?ver=2.50" type="text/css" media="all">
<link rel="stylesheet" id="wpfront-scroll-top-css" href="/wp-content/plugins/wpfront-scroll-top/css/wpfront-scroll-top.min.css?ver=2.0.7.08086" type="text/css" media="all">
<link rel="stylesheet" id="related-frontend-css-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_ce8bbdb7cabcf5f0fa8d28d9868b7638.css?ver=0.1.0" type="text/css" media="all">
<link rel="stylesheet" id="hew-fonts-css" href="https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C600%2C700%2C400italic%2C600italic%2C700italic%7CNoto+Serif%3A400%2C700%2C400italic%2C700italic&#038;subset=latin" type="text/css" media="all">
<link rel="stylesheet" id="genericons-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_c14dd6e84e694a66c7e27f11220ed49a.css?ver=3.4.1" type="text/css" media="all">
<link rel="stylesheet" id="hew-style-css" href="/wp-content/cache/autoptimize/css/autoptimize_single_bd2482c37d2bc505ed15c848d16adf6d.css?ver=5.8.3" type="text/css" media="all"> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-3.5.1.min.js" id="jquery-core-js"></script> <script type="text/javascript" src="/wp-content/plugins/jquery-manager/assets/js/jquery-migrate-3.3.0.min.js" id="jquery-migrate-js"></script>  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-199105184-1" id="google_gtagjs-js" async></script> <script type="text/javascript" id="google_gtagjs-js-after">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}
gtag('set', 'linker', {"domains":["hack.gpl.jp"]} );
gtag("js", new Date());
gtag("set", "developer_id.dZTNiMT", true);
gtag("config", "UA-199105184-1", {"anonymize_ip":true});</script> <link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/83">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml">
<meta name="generator" content="WordPress 5.8.3">
<meta name="generator" content="Site Kit by Google 1.48.1">
<meta name="google-adsense-platform-account" content="ca-host-pub-2644536267352236">
<meta name="google-adsense-platform-domain" content="sitekit.withgoogle.com">  <script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2711753458083215" crossorigin="anonymous" type="text/javascript"></script> <style id="uagb-style-conditional-extension">@media (min-width: 1025px){body .uag-hide-desktop.uagb-google-map__wrap,body .uag-hide-desktop{display:none}}@media (min-width: 768px) and (max-width: 1024px){body .uag-hide-tab.uagb-google-map__wrap,body .uag-hide-tab{display:none}}@media (max-width: 767px){body .uag-hide-mob.uagb-google-map__wrap,body .uag-hide-mob{display:none}}</style>
</head>  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161935417-3"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161935417-3');</script> <body class="archive paged category category-wordpress category-83 paged-3 category-paged-3 has-sidebar has-header-image">
<div id="page" class="hfeed site">
<div id="widgets-wrapper" class="hide"><div id="secondary" class="wrap top-widget-area" role="complementary"><div id="sidebar-4" class="widget-area" role="complementary"><aside id="block-2" class="widget widget_block"><script async src="https://cse.google.com/cse.js?cx=df8210082ba786774"></script> <div class="gcse-search"></div></aside></div></div></div> <a class="skip-link screen-reader-text" href="#content">コンテンツへ移動</a><header id="masthead" class="site-header" role="banner"> <a class="site-logo" href="/" title="JunkHack" rel="home noopener noreferrer" data-wpel-link="internal"> <noscript><img src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="no-grav header-image"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2080%2080%22%3E%3C/svg%3E" data-src="https://secure.gravatar.com/avatar/997681319c3cbb0bdcca95770d5edaa6/?s=80&#038;d=mm" width="80" height="80" alt="" class="lazyload no-grav header-image"> </a><div class="site-branding">
<h1 class="site-title"><a href="/" rel="home noopener noreferrer" data-wpel-link="internal">JunkHack</a></h1>
<h2 class="site-description">アリエクでポチった JUNKHACK</h2>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation"> <button class="menu-toggle toggle-button"><span class="screen-reader-text">メインメニュー</span></button><div class="menu-new-menu-container"><ul id="menu-new-menu" class="menu">
<li id="menu-item-10686" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10686"><a href="/list/" data-wpel-link="internal" rel="noopener noreferrer">List</a></li>
<li id="menu-item-11016" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-11016"><a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">CONTACT</a></li>
<li id="menu-item-10671" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10671"><a href="https://jh.gpl.jp/" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">Mirror Netlify<span class="wpel-icon wpel-image wpel-icon-1"></span></a></li>
</ul></div></nav><div class="toggle-wrapper"> <a href="#" class="widgets-toggle toggle-button" title="ウィジェット"> <span class="screen-reader-text">ウィジェット</span> </a>
</div></header><div id="content" class="site-content"><section id="primary" class="content-area"><main id="main" class="site-main" role="main"><header class="page-header"><h1 class="page-title">カテゴリー: <span>WordPress</span>
</h1></header><article id="post-9887" class="post-9887 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/11/07/termux-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-11-07T00:43:28+09:00">2020年11月7日</time><time class="updated" datetime="2020-11-07T00:56:31+09:00">2020年11月7日</time></a> </span><span class="posted-on">更新日:2020年11月7日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/11/07/termux-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal">内部DNSをTermuxのDNSMASQで動かす！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>内部ネットワークから参照するDNSを作ったよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>それって、どんなDNSなの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>例えば、example.jpだと192.168.1.1にアクセスできるようにするとかできるよ</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>UターンNAT対策？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>そうなんですよねー。UターンNAT対策で内部DNSが欲しかったんです。</p>
<p>内部DNSを低消費電力サーバのスマホtermuxで動かしたいなと思って、いろいろ格闘していました。先日はOpenWrtというルータ上で動かしていましたが、今回は、root化したスマホ上のtermuxで動かしてみました。53ポートで動かすのでroot化が必要ですが、termuxのrootパッケージの１つ、dnsmasqを使って内部DNSを作ろうと思います。</p>
<h3>dnsmasqとは？</h3>
<blockquote class="wp-block-quote">
<p>公式：Dnsmasq</p>
<cite><a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">http://www.thekelleys.org.uk/dnsmasq/doc.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>比較的、軽量でDHCP、BOOTPやPXEにも対応しているDNSサーバでOpenWrtにも使われていたります。自ドメイン以外は指定のDNSに転送して応答してくれます。内部ネットワーク向けの簡易なDNSとしては十分な機能をもっていますね。</p>
<p>今回は、IPv4で自ドメインの応答とそれ以外は8.8.8.8のDNSにフォワードして応答してもらうだけのシンプル設定です。DHCPなどそれ以外の機能はつかいません。</p>
<h3>Termuxのdnsmasqは？</h3>
<p>ポート53で動かすので、root化したスマホにtermuxを動かしている必要があります。1024番ポート以下はrootじゃないとバインドできません。パッチ内容は以下から参照できます。</p>
<blockquote class="wp-block-quote">
<p>termux-root-packages：dnsmasq</p>
<cite><a href="https://github.com/termux/termux-root-packages/tree/master/packages/dnsmasq" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">URL<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>やってみましょうか！</p>
<h3>ステップ１　インストール</h3>
<p>インストール自体は簡単です。root-repoパッケージを入れてから、dnsmasqを入れるだけです。</p>
<pre class="wp-block-code"><code>$ pkg install root-repo -y
$ pkg install dnsmasq -y</code></pre>
<p>本体とmanなどが入ります。サイズは264Kと小さいですね。</p>
<pre class="wp-block-code"><code>$ ll /data/data/com.termux/files/usr/bin/dnsmasq
-rwx------ 1 u0_a143 u0_a143 264K Aug 17 02:40 /data/data/com.termux/files/usr/bin/dnsmasq*</code></pre>
<h3>ステップ２　設定</h3>
<p>Termuxのdnsmasqだと、設定ファイルはデフォルトで無いので作ります。</p>
<pre class="wp-block-code"><code>$ cd $PREFIX/etc
$ vi dnsmasq.conf </code></pre>
<p>内容は以下です。ほどよく読み替えてください。</p>
<blockquote class="wp-block-quote"><p>ホスト設定：$PREFIX/etc/hosts-dnsmasq<br>ログ：$PREFIX/var/log/dnsmasq.log<br>このホストIP：192.168.1.38<br>Termuxユーザ：u0_a143<br>ドメイン：gpl.jp<br>フォワードするDNS：8.8.8.8</p></blockquote>
<pre class="wp-block-code"><code>listen-address=127.0.0.1,192.168.1.38
port=53
bind-interfaces
user=u0_a143
group=u0_a143
no-poll
# プライベートIPアドレスの逆引きを上位DNSサーバに転送しない
bogus-priv
# ドメインの無いホスト名のみ問い合わせの場合、上位DNSサーバに転送しない
domain-needed
# ローカルエリア内のドメインを指定
local=/gpl.jp/
# ホスト名で問合せされた時、下記のdomain=で指定されたドメイン名を補完
expand-hosts
# 補完するドメイン名
domain=gpl.jp

# LocalDNS
addn-hosts=/data/data/com.termux/files/usr/etc/hosts-dnsmasq
server=/gpl.jp/192.168.1.38
server=/1.168.192.in-addr.arpa/192.168.1.38
log-queries
log-facility=/data/data/com.termux/files/usr/var/log/dnsmasq.log

server=/localnet/192.168.1.38 # change ip for your ip-server
server=8.8.8.8
no-resolv </code></pre>
<p>ホスト設定：$PREFIX/etc/hosts-dnsmasq は以下となります。</p>
<pre class="wp-block-code"><code>192.168.1.38    f2
192.168.1.47    p3
192.168.1.47    hack
192.168.1.47    junkhack</code></pre>
<p>resolvファイルは自サーバを参照するよう以下にしておきます。</p>
<pre class="wp-block-code"><code>$ cat resolv.conf 
#nameserver 8.8.8.8
nameserver 192.168.1.38</code></pre>
<h3>ステップ３　起動</h3>
<p>53ポートでバインドさせるので、rootで起動します。</p>
<pre class="wp-block-code"><code>$sudo dnsmasq -C $PREFIX/etc/dnsmasq.conf</code></pre>
<h3>ステップ４　確認</h3>
<p>確認です。明示的に dig @hostip domain と@でdnsを指定するとより良いです。</p>
<pre class="wp-block-code"><code>$ dig f2 +short
192.168.1.38

$ dig -x 192.168.1.38 +short
f2.gpl.jp.

$ dig hack.gpl.jp +short
192.168.1.47

$ dig yahoo.co.jp +short
182.22.59.229
183.79.135.206</code></pre>
<p>ホスト名のみでも大丈夫ですね。FQDN自ドメインも引けますし、逆引きもできます。管理外はフォワードして応答してきました。</p>
<h3>例えばまったく違うドメインを指定</h3>
<pre class="wp-block-code"><code>$ cat hosts-dnsmasq
192.168.1.38    f2
192.168.1.47    p3
192.168.1.47    hack
192.168.1.47    junkhack
192.168.1.111   test.example.jp</code></pre>
<p>このように、違うドメイン名をFQDNで記載したら参照できるのでしょうか？</p>
<h3>設定変更・再起動</h3>
<pre class="wp-block-code"><code>$ sudo killall dnsmasq
$ sudo dnsmasq -C $PREFIX/etc/dnsmasq.conf</code></pre>
<p>参照できるか引いてみます。</p>
<pre class="wp-block-code"><code>$ dig test.example.jp +short
192.168.1.111

$ dig -x 192.168.1.111 +short
test.example.jp.</code></pre>
<p>参照できますね。これって設定ファイルのserver行でドメイン指定しなくてもいいんですかね？　設定項目はもっとシンプルにできるのかもしれませんが、追求するのはヤメにしておきます。</p>
<h3>まとめ</h3>
<p>同じ設定を、UmidigiF2では動きましたが、Pixel3ではフォワーダーが動かなかったです。</p>
<p>・UmidigiF2では動作し、Pixel3ではフォワーダーが動かない原因は不明<br>・機会があれば、BOOTPやPXEも試してみたい<br>・FQDNで記載すれば違うドメイン名でもOK<br>・MXやテキストレコードなどはどうやって指定するのだろう？</p>
<h3>あとがき</h3>
<p>今の所不具合はなさそうです。もう１週間ほど動かして問題なさそうであれば今のWordPressサーバを統合しようかなと思います。メインPCからもこのDNSを参照していますが速度的にも特に問題はない感じです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9877" class="post-9877 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-sla category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/11/04/2020-10-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-11-04T18:30:50+09:00">2020年11月4日</time><time class="updated" datetime="2020-11-04T12:24:19+09:00">2020年11月4日</time></a> </span><span class="posted-on">更新日:2020年11月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/sla/" rel="category tag noopener noreferrer" data-wpel-link="internal">SLA</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/11/04/2020-10-site24x7-sla/" rel="bookmark noopener noreferrer" data-wpel-link="internal">2020/10 site24x7 でのSLA状況など統計データ</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>引っ越ししてからのSLAデータ報告です！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>site24x7のレポート？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>そうそう。有料会員になったんでとりあえず使っています！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>99.95% って難しそうだね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>site24x7の<strong>スターターパック</strong>というのを10月から始めてみました。いわゆる監視サービスなんですが10ドルで契約できるので、ちょっと使い始めています。</p>
<blockquote class="wp-block-quote">
<p>稼働率・SLA99.95%をスマホ自宅サーバで目指せ！まずは１ヶ月間</p>
<cite><a href="/2020/09/25/%e7%a8%bc%e5%83%8d%e7%8e%87%e3%83%bbsla99-95%e3%82%92%e3%82%b9%e3%83%9e%e3%83%9b%e8%87%aa%e5%ae%85%e3%82%b5%e3%83%bc%e3%83%90%e3%81%a7%e7%9b%ae%e6%8c%87%e3%81%99%ef%bc%81%e3%81%be%e3%81%9a%e3%81%af/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">LINK</a></cite>
</blockquote>
<p>とりあえず、SLAレポートが出せるのでこれを月末に出していこうかなと思います。</p>
<h3>２０２０・１０のSLA</h3>
<p>まずは結果から。ダウンタイムの合計3 時間 5 分あって、SLAは99.567%となり目標の99.95%には届きませんでした。99.95%とは１ヶ月に21.6分以内のダウンタイムに留めないといけません。しかし、３時間も止めてしましました。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="842" height="621" src="/wp-content/uploads/2020/11/Site24x7.png" alt="" class="wp-image-9878" srcset="/wp-content/uploads/2020/11/Site24x7.png 842w, /wp-content/uploads/2020/11/Site24x7-768x566.png 768w" sizes="(max-width: 842px) 100vw, 842px"></noscript>
<img width="842" height="621" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20842%20621%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/11/Site24x7.png" alt="" class="lazyload wp-image-9878" data-srcset="/wp-content/uploads/2020/11/Site24x7.png 842w, /wp-content/uploads/2020/11/Site24x7-768x566.png 768w" data-sizes="(max-width: 842px) 100vw, 842px"></figure></div>
<h3>原因は？</h3>
<p>5日の停止はDNSの設定ミスです。27日と28日は内部ネットワークを少し変更してその影響で少し止まってしまいました。30日は、NGINXがBadGatewayを出して本格的に停止していました。今の所、root化したtermuxでNGINXを動かすとこの現象が発生しています。これはなんとかしないとだめですね。設定関連での停止は、今後以下のように対策しようと思います。</p>
<p>・設定変更後、5分は監視レポートが飛んでくるか確認する。</p>
<p>なかなか設定ミスの間違いには気がつきにくいです。とりあえず何か変更したら、5分は監視サービスの動きを見ることで対応しようと思います。</p>
<h3>まとめ</h3>
<p>今回の教訓は以下となります。</p>
<p>・引っ越し当初なんで設定することがたくさんあった<br>・設定変更後は、監視サービスの動きを5分は見て見ることにする<br>・サーバ１つだとやっぱりきびしい。多重化が必要。<br>・root化したNginxだとBadGatewayが出てしまう。なんとか対策しなくとだが根本原因がまだ不明</p>
<h3>あとがき</h3>
<p>UmidigiF2をroot化したので、とりあえずこっちに戻して様子を見ようと思いますが、めんどくさいのでちょっと作業は中断。スマホサーバを安定して動かすのは難しいです。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9863" class="post-9863 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/31/umidigi-f2-rooted/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-31T03:33:13+09:00">2020年10月31日</time><time class="updated" datetime="2021-07-04T21:17:34+09:00">2021年7月4日</time></a> </span><span class="posted-on">更新日:2021年7月4日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/31/umidigi-f2-rooted/" rel="bookmark noopener noreferrer" data-wpel-link="internal">Umidigi F2 をroot化したよ！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>Termuxを1024ポート以下でデーモン起動できるから、やっぱりroot化はやっておきたいよね。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>今までサーバ利用していたUmidigiF2をroot化するのね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>そうそう！　UmidigiF2の公式ファームウェアを使ってroot化です。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ちょっと検索してみたけど、まとまってる日本語記事ってないですね！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>さてさて、今日から４連休です！　初日の本日は今までこのブログのWordPressサーバとして約１ヶ月利用していたUmidigiF2をroot化してみましたので、忘れないうちにその方法を書いておきます。日本語でまとまっている情報はなかったので、どこかで役に立つかもしれませんね。</p>
<h3>root化とは？そのメリットは？</h3>
<blockquote class="wp-block-quote">
<p>Pixel3・android11(R)正式リリース版でroot化！</p>
<cite><a href="/2020/10/05/pixel3android11rroot/" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">/2020/10/05/pixel3android11rroot/</a></cite>
</blockquote>
<p>以前、Pixel3のroot化したときも書きましたが、簡単にいえばAndroidの最高管理権限をゲットして普通では出来ないことをやれるようします。なお、同じことをされる場合は、bootを純正以外にしますので自己責任でお願いしますね。</p>
<p>　で、root化する今回の目的も前回と同じで　termuxを動かした時rootパッケージを使えるし、1024ポート番号以下のデーモンを起動できます。例えば、WEBサーバの80番ポートや、SSLの443番ポートです。</p>
<p>　というわけで、UmidigiF2のroot化やってみましょうか。</p>
<h3>ステップ１　概要</h3>
<p>こういうのは、まず全体像が見えていることが大事です。UmidigiF2をroot化するにあたり、概要は以下となります。</p>
<p>・UmidigiF2のBootローダーのロック解除をする<br>・Magiskというツールを使い、twrpは使わない<br>・Magisk Managerを使い、純正ファクトリーイメージに含まれるBootにパッチする<br>・adb純正ツールで、パッチしたBootをUmidigiF2に書き込む<br>・Termuxはroot権限を利用できるようMagiskに設定しておく</p>
<p>今回も、Pixel3の時と同じように、Magiskというツールで行いました。TWRPのオフィシャルに行ってきたんですが、てっきりUmidigiF2はTWRP公式ビルドにあると思っていたんですよね。残念ながら、公式ビルドにはないようでした。</p>
<blockquote class="wp-block-quote">
<p>TeamWin &#8211; TWRP Devices</p>
<cite><a href="https://twrp.me/Devices/" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://twrp.me/Devices/<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>一方、MagiskはAndroidパーティションスキームに準拠していれば使えるはずです。オフィシャルサイトであるソース配布元のGitは以下になります。</p>
<blockquote class="wp-block-quote">
<p>Magisk</p>
<cite><a href="https://github.com/topjohnwu/Magisk" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://github.com/topjohnwu/Magisk<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>さぁ、やってみましょうか！</p>
<h3>ステップ２　必要なツールと準備</h3>
<p>まずは前準備です。今回もosxでやっていますがLinuxでもWindowsでもChromeBookでもできると思います。オフィシャルのマニュアルも参照してね。</p>
<blockquote class="wp-block-quote">
<p>Magiskオフィシャルインストール手順</p>
<cite><a href="https://github.com/topjohnwu/Magisk/blob/master/docs/install.md" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://github.com/topjohnwu/Magisk/blob/master/docs/install.md<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>上記だけでは、全体がまだ見えてきませんね。つまり、ざっくりと以下が必要です。</p>
<p>（１）fastbootとadbコマンドが動作する環境<br>　これは、SDK Platform-Toolsを入れればOKです。Googleからリリースされていますので最新を入れておきます。AndroidStudioを入れてある環境ならばすでに入っていますが、ツールだけであれば以下からダウンロードできます。現在の最新は、Version 30.0.4です。</p>
<blockquote class="wp-block-quote">
<p>SDK Platform-Tools　</p>
<cite><a href="https://developer.android.com/studio/releases/platform-tools.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://developer.android.com/studio/releases/platform-tools.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>（２）UmidigiF2のファクトリーイメージ（StockROM）<br>　今手元のUmidigiF2で動いているバージョンを確認してください。筆者の場合は最新の<strong>UMIDIGI_F2_V1.0_20200402_20200506-1120</strong>が入っていたので以下をダウンロードしておきました。これはワイヤレスアップデート画面から現在のバージョンを確認できます。あとから、Boot.imgを取り出してMagiskでパッチします。</p>
<blockquote class="wp-block-quote">
<p>StockROM　UMIDIGI F2<br>　UMIDIGI_F2_V1.0_20200506.V3.17.rar</p>
<cite><a href="https://community.umidigi.com/forum.php?mod=forumdisplay&amp;fid=228" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://community.umidigi.com/forum.php?mod=forumdisplay&amp;fid=228<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>（３）MagiskManagerのアプリ<br>　これは以下のオフィシャルサイト（GitHub）からダウンロードできます。筆者はCanaryビルドを使いました。安定番は、MagiskManagerv8.0.2です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://github.com/topjohnwu/Magisk" data-wpel-link="external" target="_blank" rel="external noopener noreferrer"><noscript><img width="328" height="115" src="/wp-content/uploads/2020/10/magisk-download.png" alt="" class="wp-image-9864"></noscript>
<img width="328" height="115" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20328%20115%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/magisk-download.png" alt="" class="lazyload wp-image-9864"></a></figure></div>
<p>純正に戻す場合はこれ以外にも必要ですが、今のバージョンをroot化するだけなら以上でOKです。</p>
<h3>ステップ3 ファクトリーイメージを展開</h3>
<p>オフィシャルサイトからダウンロードした、UMIDIGI_F2_V1.0_20200506.V3.17.rar を展開しておきます。rarファイルを展開するといろいろありますが、今回使うのは boot.img と、vbmeta.img です。わかりやすいよう１つ上の階層にでもコピーしておきましょう。</p>
<pre class="wp-block-code"><code>.
└── UMIDIGI_F2_V1.0_20200506.V3.17
：：
    ├── boot.img
：：
    ├── vbmeta.img
：：</code></pre>
<h3>ステップ4 Bootローダーのロック解除</h3>
<p>通常であれば、開発者向けオプションの「OEMロック解除」項目はこのようにグレーアウトした状態となっていますが、これをONにしておきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="323" height="88" src="/wp-content/uploads/2020/10/ss.png" alt="" class="wp-image-9865"></noscript>
<img width="323" height="88" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20323%2088%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/ss.png" alt="" class="lazyload wp-image-9865"></figure></div>
<p>まず、ここにたどり着くには開発者向けオプションを有効にして、次にOEMロック解除をONにします。</p>
<p>[設定]> [端末情報]> [ビルド番号]を複数回タップして[開発者向けオプション]を有効にしておきます。</p>
<p>[設定]> [システム]> [詳細設定]で[開発者向けオプション]を開き「OEMロック解除」を有効にし、確認のためにパスワードを入力します。「USBデバッグ」も有効にしておきます。</p>
<p>次に、USBケーブルでPCと接続し、「adb reboot bootloader」とターミナルからタイプします。</p>
<pre class="wp-block-code"><code>$ adb reboot bootloader</code></pre>
<p>すると、スマホはfastbootモードで再起動します。</p>
<p>再起動したら黒い画面でスマホは止まりますので、以下から認識しているか確認しておきます。</p>
<pre class="wp-block-code"><code>$ fastboot devices
F2xxxxxxxxxxxx3	fastboot</code></pre>
<p class="has-text-align-center"><strong>ここから先は、スマホが初期化されますので注意を！</strong></p>
<p>スマホは黒い画面で左下に少し文字が見える状態だと思います。以下をタイプしてボリュームの+ボタンを押しブートローダーのロックを解除します。</p>
<pre class="wp-block-code"><code>$ fastboot flashing unlock</code></pre>
<p>次に以下をタイプしてボリュームの+ボタンを押しセキュアパーティションのロックを解除します。</p>
<pre class="wp-block-code"><code>$ fastboot flashing unlock_critical</code></pre>
<p>続けて以下で再起動させます。</p>
<pre class="wp-block-code"><code>$ fastboot reboot</code></pre>
<p>起動は5秒くらい遅れますが、ホーム画面がでればOKです。これで先ほどの「OEMロック解除」は以下のようになっているはずです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="329" height="97" src="/wp-content/uploads/2020/10/ss-1.png" alt="" class="wp-image-9866"></noscript>
<img width="329" height="97" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20329%2097%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/ss-1.png" alt="" class="lazyload wp-image-9866"></figure></div>
<p>fastbootモード中、スマホの画面に表示される文字が小さくてみずらいですが、上記のように操作すれば問題ないはずです。</p>
<h3>ステップ5 Boot.imgのパッチ</h3>
<p>boot.imgをスマホに転送し、Magisk Managerを使用してパッチを適用します。</p>
<p>まずは、MagiskManagerのアプリを入れておきます。<br>　<a href="https://github.com/topjohnwu/Magisk" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right">https://github.com/topjohnwu/Magisk<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://github.com/topjohnwu/Magisk" data-wpel-link="external" target="_blank" rel="external noopener noreferrer"><noscript><img width="328" height="115" src="/wp-content/uploads/2020/10/magisk-download.png" alt="" class="wp-image-9864"></noscript>
<img width="328" height="115" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20328%20115%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/magisk-download.png" alt="" class="lazyload wp-image-9864"></a></figure></div>
<p>アプリを入れたら、起動させ「Magiskのインストール」からboot.imgを選択してパッチを当てます。以下のようになれば成功です。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="393" height="275" src="/wp-content/uploads/2020/10/ss-patching.png" alt="" class="wp-image-9867"></noscript>
<img width="393" height="275" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20393%20275%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/ss-patching.png" alt="" class="lazyload wp-image-9867"></figure></div>
<p>パッチしたboot.imgファイル（magisk_patched.img）はPCにダウンロードしておきます。</p>
<h3>ステップ6 パッチしたBoot.imgを書込</h3>
<p>引き続き、USB接続したPCから操作です。以下をタイプでリブートします。</p>
<pre class="wp-block-code"><code>$ adb reboot bootloader</code></pre>
<p>再起動したら黒い画面でスマホは止まりますので、以下から認識しているか確認しておきます。</p>
<pre class="wp-block-code"><code>$ fastboot devices
F2xxxxxxxxxxxx3	fastboot</code></pre>
<p>カレントディレクトリに、magisk_patched.img　があるとしたら以下のコマンドで書込みます。verityしないオプションはつけなくても大丈夫とは思いますが、まだ試していません。</p>
<pre class="wp-block-code"><code>$ fastboot --disable-verity --disable-verification flash boot ./magisk_patched.img</code></pre>
<p>以下、実行例です。</p>
<pre class="wp-block-code"><code>    $ fastboot --disable-verity --disable-verification flash boot ./magisk_patched.img 
    Sending 'boot' (32768 KB)                          OKAY &#091;  0.721s]
    Writing 'boot'                                     OKAY &#091;  0.731s]
    Finished. Total time: 1.455s</code></pre>
<p>オフィシャルのストックロムから取り出した、vbmeta.imgを書込みます。</p>
<pre class="wp-block-code"><code>$ fastboot --disable-verity --disable-verification flash vbmeta ./vbmeta.img</code></pre>
<p>実行例は以下です。</p>
<pre class="wp-block-code"><code>    $ fastboot --disable-verity --disable-verification flash vbmeta ./vbmeta.img 
    Rewriting vbmeta struct at offset: 0
    Sending 'vbmeta' (4 KB)                            OKAY &#091;  0.013s]
    Writing 'vbmeta'                                   OKAY &#091;  0.001s]
    Finished. Total time: 0.016s</code></pre>
<p>最後にリブートです。</p>
<pre class="wp-block-code"><code>$ fastboot reboot</code></pre>
<h3>root化の確認</h3>
<p>リブート後、MagiskManagerを起動するとこのようになっていると思います。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="393" height="852" src="/wp-content/uploads/2020/10/magisk-root.png" alt="" class="wp-image-9868"></noscript>
<img width="393" height="852" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20393%20852%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/magisk-root.png" alt="" class="lazyload wp-image-9868"></figure></div>
<p>例えば、Termuxからrootパッケージを入れて、rootになれるか確認です。</p>
<pre class="wp-block-code"><code>$ tsu
# whoami
root
# id
uid=0(root) gid=0(root) groups=0(root)
# </code></pre>
<p>tsuコマンドはtermuxのsuコマンドです。これを行うとmagiskにroot権限を許可するか聞かれますのでOKとしておきます。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・スマホに入っているバージョンと同じROMをパッチすることでSP Flash Toolを使わなくてもOKだ。<br>・SP Flash Toolは、WindowsとLinuxしかない。<br>・元の状態に戻したい場合は、SP Flash Toolが必要。<br>・今のところ問題なさそう。もう少し遊びながら様子見。</p>
<h3>あとがき</h3>
<p>これでPixel3で試せなかったことが実験できます。本来、Pixel3は、手元であれこれアプリのテストに使いたいので、UmidigiF2がこのブログのメインマシンになる予定です。そのうち、また入れ替えたいと思います。</p>
<h3>著者にメッセージ</h3>
<p>間違いの指摘などコメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9841" class="post-9841 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/26/openwrt-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-26T04:57:02+09:00">2020年10月26日</time><time class="updated" datetime="2020-10-26T04:57:07+09:00">2020年10月26日</time></a> </span><span class="posted-on">更新日:2020年10月26日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/26/openwrt-dnsmasq/" rel="bookmark noopener noreferrer" data-wpel-link="internal">メルカリ８８０円のルータに組み込みLINUXのOpenWrtで内部DNSを動かす！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>やっとPixel3に引っ越しできたよ！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>おめでとー！　何をそんなに苦労してたの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>いやー、ローカルにDNSを立ち上げようとあれこれとね！</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>結局、どうやってローカルDNS立ち上げたの？</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>ということで、今見ているこのWordPressブログはUMIDIGI F2から Google Pixel3のスマホに引っ越ししました！</p>
<p>　一番嬉しいのは、ローカルからブログを書く時、もうVPNを繋げて書かなくてもよくなった点ですね！　今まではUターンNATの問題で内部ネットワークからはこのブログにアクセスできなかったのです。ブログ記事を書く時もVPN経由で外からアクセスしていたので、記事を書くのが少し面倒だったんです。今回は、Pixel3に引っ越ししてローカルDNSを立ち上げた事を記事にしようかなと思います。</p>
<h3>ローカルDNSを立ち上げろ！</h3>
<p>なぜローカルDNSを立ち上げる必要があったかは、このあたりを見ていただくとその経緯がわかるかなと思います。</p>
<blockquote class="wp-block-quote">
<p>ポートフォワードの経路で、Uターン NATとかヘアピンNATが使えないルータの場合のあれこれ</p>
<cite>Link</cite>
</blockquote>
<p>ローカルにDNSを立ち上げれば、UターンNATがダメなルータを使っていても迂回した経路が作れます。そして、Termuxの1024以下ポートが使えない問題は、root化した Pixel3を使って回避しました。つまり、今動いているNGINXは、port80とport443で動作しています。こんな感じ！</p>
<pre class="wp-block-code"><code># ps axu | grep nginx
root     12762  0.0  0.0 10868580 2144 ?       Ss   02:14   0:00 nginx: master process nginx
u0_a218  12763  0.0  0.1 10869584 3912 ?       S    02:14   0:00 nginx: worker process
::
u0_a218  12771  0.0  0.0 10868708 2312 ?       S    02:14   0:00 nginx: cache manager process

# netstat -an | egrep ':80 |:443 ' | grep LISTEN
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN     
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN  </code></pre>
<p>当初は、このroot化したPixel3にDNSを起動させる予定だったんですが、思いの外うまく動かなくて結局、安いルータをメルカリでゲットしました。なんとお値段、送料込み８８０円！</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="640" height="480" src="/wp-content/uploads/2020/10/12dh9400001w5a9w.jpg" alt="" class="wp-image-9846"></noscript>
<img width="640" height="480" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20640%20480%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/12dh9400001w5a9w.jpg" alt="" class="lazyload wp-image-9846"><figcaption>I-O DATA WN-AC1167GR</figcaption></figure></div>
<blockquote class="wp-block-quote">
<p>11ac対応867Mbps（規格値）Wi-Fiルーター<br>WN-AC1167GR</p>
<cite><a href="https://www.iodata.jp/product/network/wnlan/wn-ac1167gr/index.htm" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://www.iodata.jp/product/network/wnlan/wn-ac1167gr/index.htm<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>このルータに、OpenWrtというオープンソースな組み込み用Linuxがあって、このI-Oデータのルータにも適合したファームウェアがあります。これを使って、dnsmasqというDNSが使えるので、ローカルDNSとして活用してみました。</p>
<h3>I-O DATA WN-AC1167GRにOpenWrtを！</h3>
<p>まずは、OpenWrtを入れます。このファームウェアは以下にあります。</p>
<blockquote class="wp-block-quote">
<p>OpenWrt Project　Techdata: I-O Data WN-AC1167GR</p>
<cite><a rel="noreferrer noopener external" href="https://openwrt.org/toh/hwdata/i-o_data/i-o_data_wn-ac1167gr" target="_blank" data-wpel-link="external" class="wpel-icon-right">https://openwrt.org/toh/hwdata/i-o_data/i-o_data_wn-ac1167gr<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>Firmware OpenWrt Install URL　から、ファクトリーイメージがあるので、これを純正のファームウェアアップデートから書き込みするだけです。LANポートは、デフォルトで192.168.1.1/24　のネットワークになっていてDHCPサーバも動いています。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="641" height="703" src="/wp-content/uploads/2020/10/OpenWrt.png" alt="" class="wp-image-9847"></noscript>
<img width="641" height="703" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20641%20703%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/OpenWrt.png" alt="" class="lazyload wp-image-9847"></figure></div>
<p>このCPUは、MediaTek MT7620Aが載っているようですね。32bitのarmで1coreのようです。</p>
<blockquote class="wp-block-quote">
<p>MediaTek　<strong>MT7620N/A</strong></p>
<cite><a href="https://www.mediatek.jp/products/mt7620n-a" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://www.mediatek.jp/products/mt7620n-a<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>詳細な設定は、省きますがLAN側のネットワークに上位ルーター側で使っているネットワークを割り振っているだけです。DHCPはこのルータでは止めてあります。WAN側の青いLANは使っていません。FireWallも全部外してあります。うまく設定すれば、WAN側とLAN側をブリッジさせて同一ネットワークで使うこともできると思いますが、なぜかうまくいかず結局、シンプルな設定にしました。</p>
<p>　あと、とりあえず、いろいろ試して5Ghz帯の無線LANは安定しなかったので、２GHZの無線LANにしています。何か設定の勘所があるのかもですが、ちょっと追うのはヤメておきます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="655" height="266" src="/wp-content/uploads/2020/10/OpenWrt-1.png" alt="" class="wp-image-9848"></noscript>
<img width="655" height="266" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20655%20266%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/OpenWrt-1.png" alt="" class="lazyload wp-image-9848"></figure></div>
<p>このようにインターフェイスはLAN側のポートだけ使って、あとは無線LANの設定をLANに紐づけているだけです。いわゆるブリッジ接続（アクセスポイント的な）で使っている感じですね。</p>
<h3>OpenWrtで、DNSMASQの設定を！</h3>
<p>OpenWrtルータは、SSHも出来ますのでログインしてdnsmasqがどの設定ファイルを見ているか確認してみます。管理画面からも設定はできるんですが、どの設定項目がどのパラメータなのかわかりにくいので、直接設定ファイルを見てみました。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="473" height="394" src="/wp-content/uploads/2020/10/root_OpenWrt.png" alt="" class="wp-image-9849"></noscript>
<img width="473" height="394" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20473%20394%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/root_OpenWrt.png" alt="" class="lazyload wp-image-9849"></figure></div>
<p>psコマンドは、BusyBoxのやつを使っているようですね。オプションは効きませんでした。こんな感じでdnsmasqの起動オプションを確認。</p>
<pre class="wp-block-code"><code>root@OpenWrt:~# ps | grep dnsmasq
  847 dnsmasq   1344 S    /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf.cfg01411c -k -x /var/run/dnsmasq/dnsmasq.cfg01411c.pid</code></pre>
<p>-C オプションが設定ファイルです。このファイルの中は、こんな感じです。</p>
<pre class="wp-block-code"><code># auto-generated config file from /etc/config/dhcp
conf-file=/etc/dnsmasq.conf
filterwin2k
no-negcache
strict-order
localise-queries
read-ethers
enable-ubus
expand-hosts
bind-dynamic
quiet-dhcp
domain=gpl.jp
server=/gpl.jp/
server=8.8.8.8
server=192.168.1.1
dhcp-leasefile=/tmp/dhcp.leases
resolv-file=/etc/resolv.conf
stop-dns-rebind
rebind-localhost-ok
dhcp-broadcast=tag:needs-broadcast
addn-hosts=/tmp/hosts
conf-dir=/tmp/dnsmasq.d
user=dnsmasq
group=dnsmasq


dhcp-ignore-names=tag:dhcp_bogus_hostname
conf-file=/usr/share/dnsmasq/dhcpbogushostname.conf


bogus-priv
conf-file=/usr/share/dnsmasq/rfc6761.conf</code></pre>
<p>あとは、hostsの内容はWEB GUI画面から管理できます。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="655" height="275" src="/wp-content/uploads/2020/10/OpenWrt-2.png" alt="" class="wp-image-9850"></noscript>
<img width="655" height="275" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20655%20275%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/OpenWrt-2.png" alt="" class="lazyload wp-image-9850"></figure></div>
<p>リモートのmacから、digで確認してみます。</p>
<pre class="wp-block-code"><code>$ dig @192.168.1.100 hack.gpl.jp

; &lt;&lt;>> DiG 9.10.6 &lt;&lt;>> @192.168.1.100 hack.gpl.jp
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 2575
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;hack.gpl.jp.			IN	A

;; ANSWER SECTION:
hack.gpl.jp.		0	IN	A	192.168.1.47

;; Query time: 0 msec
;; SERVER: 192.168.1.100#53(192.168.1.100)
;; WHEN: Mon Oct 26 03:55:29 JST 2020
;; MSG SIZE  rcvd: 56</code></pre>
<p>管理外のドメインも引いてくれるか確認しておきます。なんとか大丈夫そうなので、設定はよしとします。ハマった点としては５Ghz帯の無線LANだとどうしても、接続が切れてしまうようでした。何か、設定があるのかもですが解決できなかったので2Ghz帯のにしています。無線LANとスマホは近くに置いてあるのでまぁ実質問題ないでしょう。Pixel3からスピードテストすると以下のようです。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="357" height="313" src="/wp-content/uploads/2020/10/speedtest.png" alt="" class="wp-image-9851"></noscript>
<img width="357" height="313" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20357%20313%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/speedtest.png" alt="" class="lazyload wp-image-9851"></figure></div>
<p>監視サイトからの読み込みも　２秒くらいなのでまぁ良いかなと。</p>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・OpenWrtは、iptablesも設定できるようなのでうまく応用すればいろいろ使えそう<br>・今回は、5Ghzの無線LANは通信が切れてしまう現象が起きた<br>・なので、2Ghzの無線LANで運用することに<br>・DNSMASQは、それなりに動いているようだ<br>・無線LANの機器なので消費電力は5Wくらい。省電力<br>・違う無線LAN配下からは、pingが通らない。これはなぜか？<br>・上位ルータからはPingは通る<br>・引っ越ししたroot化したpixel3は今の所、調子良さそう</p>
<h3>あとがき</h3>
<p>無線LANがぶつぶつ切れて、設定がぜんぜん進まず、どうしようかと思ったんですが2Ghzにしてなんとか安定しているように見えます。組み込みのLinuxと無線LANドライバーは、弄れる知識がないのでいつかチャレンジしてみようとは思いますが、今はもうお腹いっぱいです。設定疲れました！でも、なんとか当初の目標がクリアできてよかったです。たかが、内部DNSですが、消費電力が少なくて今のところ便利に使えています。あとは、そのくらい安定して動作するか検証ですね。</p>
<h3>著者にメッセージ</h3>
<p>コメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9827" class="post-9827 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/22/d-j-b-daemontools-termux/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-22T17:33:26+09:00">2020年10月22日</time><time class="updated" datetime="2020-10-22T17:33:39+09:00">2020年10月22日</time></a> </span><span class="posted-on">更新日:2020年10月22日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/22/d-j-b-daemontools-termux/" rel="bookmark noopener noreferrer" data-wpel-link="internal">D.J.BツールのdaemontoolsをTermuxで動かしてみたよ！</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>ぴーちゃん、DJBのdaemontoolsって知ってる？</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>・・・まったく知りません！</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>デーモンを起動管理させるツールなんだけど、これがTermuxで動かせないかな？ってチャレンジしてみたよ。</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>またマニアックなネタですね！w</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>はいな！　またマニアックネタかもしれませんので需要はあまり無いかもしれませんね。w</p>
<h3>daemontoolsとは？</h3>
<p>　このツールは、DJBことダニエル・ジュリアス・バーンスタインさん（<a rel="noreferrer noopener external" href="https://ja.wikipedia.org/wiki/%E3%83%80%E3%83%8B%E3%82%A8%E3%83%AB%E3%83%BB%E3%83%90%E3%83%BC%E3%83%B3%E3%82%B9%E3%82%BF%E3%82%A4%E3%83%B3" target="_blank" data-wpel-link="external" class="wpel-icon-right">WIKI<span class="wpel-icon wpel-image wpel-icon-1"></span></a>参照）が作ったツール群です。DJBさんは、qmailやdjbdnsというメールやDNSも作っています。<a href="https://ja.wikipedia.org/wiki/Daemontools" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">daemontools<span class="wpel-icon wpel-image wpel-icon-1"></span></a>は、全部で17個の単体プログラムで作られている常駐するプログラムを起動管理するものです。</p>
<p>　DJBツールは、設定や取り扱いがよくわからんという人もいて好き嫌いの別れるツールです。しかし、驚異的にバグが少なく非常に興味深い作りになっています。</p>
<p>その昔、sendmailやbindに嫌気がさしてqmailやdjbdnsを使っていた時期があったのですが、rpmやdebパッケージなどがないので設定はそれなりにしないと動きません。作者がバイナリ配布を認めていないんです。その為、RedHatはqmailのサポートを明示的に切り捨てています。ちなみに、無償で登録できるRedHatの開発者アカウントがあれば、ナレッジも読めますよ。</p>
<blockquote class="wp-block-quote">
<p>Red Hat は、Red Hat Enterprise Linux で qmail SMTP サーバーの使用をサポートしていますか?</p>
<cite><a href="https://access.redhat.com/ja/articles/2540051" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://access.redhat.com/ja/articles/2540051<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>そんな感じでDJB作のソフトウェアを10年ぶりくらいに使ってみました。あまりに久しぶりすぎて、だいぶ使い方とか忘れていましたがなんとか動いているように見えますのでちょっとメモしておきます。</p>
<h3>daemontoolsの概略</h3>
<p>daemontools とは、デーモンを監視するツールのことで、qmail の作者 D.J.B. によるツールの事。メリットは、daemontools によって監視させておけば、 自動的に再起動してくれます。注意事項は以下。</p>
<ul>
<li>バックグラウンドになるデーモンは管理できない。</li>
<li>この為、run から動作させるプロセスは、 &amp; を付けてバックグラウンドにしないこと。</li>
</ul>
<p>詳細は、オフィシャルサイトを参照。<a href="https://cr.yp.to/daemontools.html" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://cr.yp.to/daemontools.html<span class="wpel-icon wpel-image wpel-icon-1"></span></a></p>
<p>今回は、Androidで動作するTermuxでdaemontoolsを動作させるように修正をしました。</p>
<h3>インストール</h3>
<p>daemontoolsは、展開したソースディレクトリにコマンドがシンボリック・リンクされます。</p>
<p>このインストール例では、ホームディレクトリに&nbsp;<code>bin</code>&nbsp;を作成し、そこに展開してインストールします。</p>
<pre class="wp-block-code"><code>$ mkdir bin
$ cd bin

$ git clone https://github.com/take-i/termux-daemontools.git
$ cd termux-daemontools/admin/daemontools-0.76/
$ package/install</code></pre>
<p>インストールは以上で終了です！　ビルドツールが入れてなくてmakeできない場合は、このように入れておいてください。</p>
<pre class="wp-block-code"><code>$ pkg install autoconf automake bison bzip2 \
              clang cmake coreutils diffutils \
              flex gawk git grep gzip libtool \
              make patch perl sed silversearcher-ag \
              tar termux-exec wget -y</code></pre>
<h3>コマンドはどこにあるの？</h3>
<p>コマンドは、termux配下の&nbsp;<code>$PREFIX/bin</code>&nbsp;ディレクトリ以下にありますが、これはシンボリック・リンクです。</p>
<pre class="wp-block-code"><code>$ which svscan
/data/data/com.termux/files/usr/bin/svscan</code></pre>
<p>また、このシンボリック・リンク先は、<code>$PREFIX/command/</code>&nbsp;になります。</p>
<pre class="wp-block-code"><code>$ ls -l /data/data/com.termux/files/usr/bin/svscan
lrwxrwxrwx 1 u0_a257 u0_a257 46 Oct 21 15:10 /data/data/com.termux/files/usr/bin/svscan -> /data/data/com.termux/files/usr/command/svscan</code></pre>
<p>つまり、コマンドの本体はビルドしたディレクトリ以下にあります。ビルドしたディレクトリを削除するときは注意しましょう。</p>
<pre class="wp-block-code"><code>$ tree $PREFIX/command/
├── envdir -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/envdir
├── envuidgid -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/envuidgid
├── fghack -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/fghack
├── multilog -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/multilog
├── pgrphack -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/pgrphack
├── readproctitle -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/readproctitle
├── setlock -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/setlock
├── setuidgid -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/setuidgid
├── softlimit -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/softlimit
├── supervise -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/supervise
├── svc -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/svc
├── svok -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/svok
├── svscan -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/svscan
├── svscanboot -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/svscanboot
├── svstat -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/svstat
├── tai64n -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/tai64n
└── tai64nlocal -> /data/data/com.termux/files/home/bin/termux-daemontools/admin/daemontools/command/tai64nlocal</code></pre>
<h3>daemontoolsの起動</h3>
<p>必須ではありませんが、明示的にPATHを記載したい場合は以下のように追記しておきます。</p>
<p>~/.bashrc</p>
<pre class="wp-block-code"><code>::
#djb tool daemontools
export PATH=$PATH:$PREFIX/command</code></pre>
<p>リモートシェルから、Daemontools の起動は、スマートフォンのroot化を行なっている場合は root で起動できます。その場合は、</p>
<pre class="wp-block-code"><code>$ nohup sudo svscan $PREFIX/service/ &amp;</code></pre>
<p>一般ユーザーで起動する場合は、</p>
<pre class="wp-block-code"><code>$ nohup svscan $PREFIX/service/ &amp;</code></pre>
<p>どちらかの方法で起動してください。なお、<a href="/category/wordpress/page/3/Boot" target="_blank" rel="noreferrer noopener" data-wpel-link="internal">Termux:Boot</a> の有償アプリを入れている場合は、~/.termux/boot/　以下に以下のような起動スクリプトを記載しておくとスマホを再起動してホーム画面まで行った時に自動的に起動します。</p>
<pre class="wp-block-code"><code>#!/data/data/com.termux/files/usr/bin/sh

export PATH=$PATH:$HOME/bin
export PATH=$PATH:$PREFIX/command
export PREFIX=/data/data/com.termux/files/usr

sudo svscan $PREFIX/service/ &amp;</code></pre>
<h3>設定のサンプル</h3>
<p>例えば、crondをdaemontoolsで起動させるサンプルです。ホームディレクトリにbootディレクトリを作成して後から $PREFIX/service/ にシンボリック・リンクを張って起動させます。以下の例では、実態のディレクトリは$HOME/boot/ですが、どこでもOKです。$PREFIX/var/boot/ とか好きなところにディレクトリを作成してください。</p>
<pre class="wp-block-code"><code>$ cd
$ mkdir -p boot/crond
$ cd boot/crond

$ vi run</code></pre>
<pre class="wp-block-code"><code>#!/bin/sh

export PATH=$PATH:$HOME/bin
export PATH=$PATH:$PREFIX/command
export PREFIX=/data/data/com.termux/files/usr

exec 2>&amp;1
exec > /dev/null

# start up script example.
# need pkg install cronie
exec crond -n</code></pre>
<p>デーモン起動しないように、crond を -n オプションでフォアグランドで起動しています。</p>
<pre class="wp-block-code"><code>$ cd ../
$ chmod +t crond</code></pre>
<p>このように<a href="https://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AD%E3%83%BC%E3%83%93%E3%83%83%E3%83%88" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">スティッキービット<span class="wpel-icon wpel-image wpel-icon-1"></span></a>をディレクトリに付けておきます。</p>
<h3>起動</h3>
<p>シンボリック・リンクを張ると起動します。</p>
<pre class="wp-block-code"><code>$ ln -s $HOME/boot/crond $PREFIX/service/</code></pre>
<h3>起動確認</h3>
<p>ルートで、svscan を動作させている場合は以下のようにすれば svstatコマンドで確認できます。</p>
<pre class="wp-block-code"><code>$ tsu
# svstat $PREFIX/service/crond
/data/data/com.termux/files/usr/service/crond: up (pid 8704) 191 seconds</code></pre>
<p>rootで動作させている場合は、プロセスツリーが以下のようになっています。</p>
<pre class="wp-block-code"><code>init─┬
　　　::
     ├─magiskd─┬─logcat
     │         ├─sh───svscan─┬─supervise───run───sleep
     │         │             └─supervise───crond</code></pre>
<p>つまり、Termuxを完全に落としてもcronは動き続けてくれます！</p>
<h3>サービスの一時的な停止</h3>
<pre class="wp-block-code"><code>$ svc -d $PREFIX/service/crond</code></pre>
<h3>
<a href="https://github.com/take-i/termux-daemontools/blob/master/readme-jp.md#%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%86%8D%E9%96%8B" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right"><span class="wpel-icon wpel-image wpel-icon-1"></span></a>サービスの再開</h3>
<pre class="wp-block-code"><code>$ svc -u $PREFIX/service/crond</code></pre>
<h3>
<a href="https://github.com/take-i/termux-daemontools/blob/master/readme-jp.md#%E6%B0%B8%E7%B6%9A%E7%9A%84%E3%81%AA%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%89%8A%E9%99%A4" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right"><span class="wpel-icon wpel-image wpel-icon-1"></span></a>永続的なサービスの削除</h3>
<p>監視ディレクトリからシンボリック・リンクを削除します。</p>
<pre class="wp-block-code"><code>$ cd $PREFIX/service/
$ unlink crond</code></pre>
<h3>
<a href="https://github.com/take-i/termux-daemontools/blob/master/readme-jp.md#%E6%B0%B8%E7%B6%9A%E7%9A%84%E3%81%AA%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E5%89%8A%E9%99%A4" data-wpel-link="external" target="_blank" rel="external noopener noreferrer" class="wpel-icon-right"><span class="wpel-icon wpel-image wpel-icon-1"></span></a>注意事項</h3>
<p>setuidgidなど、一般ユーザ（termuxをインストールしたユーザ）では動作しないと思います。また、すべてのコマンドをテストしていませんので、動作無保証です。テスト済みのコマンドは以下から確認できます。</p>
<blockquote class="wp-block-quote">
<p>Github：termux-daemontools</p>
<cite><a href="https://github.com/take-i/termux-daemontools/blob/master/readme-jp.md" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://github.com/take-i/termux-daemontools/blob/master/readme-jp.md<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<h3>まとめ</h3>
<p>今回の要点は以下となります。</p>
<p>・daemontoolsは、Termuxでもなんとか動作させることができた<br>・root化されていないTermuxでも動作する<br>・root化されているスマホだと、Termuxをタスクから完全に落としても動作するデーモンを管理できる<br>・メリットとしては、root化されていない端末の場合、サービス起動管理が一元化できそう。<br>・setlockは、いろいろ使えそうなのでちゃんと動くか確認してみたい。</p>
<h3>あとがき</h3>
<p>一応、djbdnsもtermuxで動作させようとあれこれ弄っていたのですが、どうやらうまく動作させることができませんでした。Androidの起動管理がよくわかっていなくて、djbdnsを起動させるとメモリーがどんどん膨らみ、swapも使い果たして再起動してしまいます。これは、djbdnsの問題ではなく、おそらくandroidの起動するシステムが関連している感じですがよくわかっていません。</p>
<p>　当初の目的では、DNSを動作させることだったんですがこれは当分、違う方法でやることにします。</p>
<h3>著者にメッセージ</h3>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><article id="post-9815" class="post-9815 post type-post status-publish format-standard has-post-thumbnail hentry category-android category-linux category-wordpress"><div class="entry-wrapper">
<header class="entry-header"> <span class="entry-format theme-genericon"></span><div class="entry-meta"> <span class="posted-on">投稿日: <a href="/2020/10/09/smartphone-in-the-fridge/" rel="bookmark noopener noreferrer" data-wpel-link="internal"><time class="entry-date published" datetime="2020-10-09T05:00:14+09:00">2020年10月9日</time><time class="updated" datetime="2020-10-09T05:18:31+09:00">2020年10月9日</time></a> </span><span class="posted-on">更新日:2020年10月9日</span> <span class="categories"> <a href="/category/android/" rel="category tag noopener noreferrer" data-wpel-link="internal">Android</a>, <a href="/category/linux/" rel="category tag noopener noreferrer" data-wpel-link="internal">Linux</a>, <a href="/category/wordpress/" rel="category tag noopener noreferrer" data-wpel-link="internal">WordPress</a></span>
</div>
<h1 class="entry-title"><a href="/2020/10/09/smartphone-in-the-fridge/" rel="bookmark noopener noreferrer" data-wpel-link="internal">スマホを冷蔵庫に入れて冷え冷え状態でベンチマークしたらどうなる？</a></h1></header><div class="entry-content">
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>冷蔵庫に入れて冷やしてベンチ測ると、どうなるんだろう？</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>なんかググると、スマホは冷蔵庫に入れちゃだめ！ってあるよ。</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex"><div class="w_b_wrap w_b_wrap_talk w_b_L w_b_flex w_b_div">
<div class="w_b_ava_box w_b_relative w_b_ava_L w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_L w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/abata.png" width="96" height="96" alt="じゃんくはっく" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">じゃんくはっく</div>
</div>
<div class="w_b_bal_box w_b_bal_L w_b_relative w_b_direction_L w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_L w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_L w_b_shadow_L w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>冷蔵庫は約10度くらいなんで、寒冷地の温度とそう変わらないよね？</p></div></div></div></div>
</div>
</div></div></div>
<div class="wp-block-word-balloon-word-balloon-block"><div class="w_b_box w_b_w100 w_b_flex w_b_mla w_b_jc_fe"><div class="w_b_wrap w_b_wrap_talk w_b_R w_b_flex w_b_jc_fe w_b_div">
<div class="w_b_bal_box w_b_bal_R w_b_relative w_b_direction_R w_b_w100 w_b_div">
<div class="w_b_space w_b_mp0 w_b_div"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1" height="38" viewbox="0 0 1 1" fill="transparent" stroke="transparent" stroke-miterlimit="10" class="w_b_db w_b_mp0"><polygon fill="transparent" stroke="transparent" points="0,1 0,1 0,1 0,1 "></polygon></svg></div>
<div class="w_b_bal_outer w_b_flex w_b_mp0 w_b_relative w_b_div"><div class="w_b_bal_wrap w_b_bal_wrap_R w_b_div"><div class="w_b_bal w_b_relative w_b_talk w_b_talk_R w_b_shadow_R w_b_ta_L w_b_div"><div class="w_b_quote w_b_div"><p>まぁ、気の済むまで実験してくださいw</p></div></div></div></div>
</div>
<div class="w_b_ava_box w_b_relative w_b_ava_R w_b_col w_b_f_n w_b_div">
<div class="w_b_icon_wrap w_b_relative w_b_div"><div class="w_b_ava_wrap w_b_direction_R w_b_mp0 w_b_div"><div class="w_b_ava_effect w_b_relative w_b_oh w_b_radius w_b_size_M w_b_div"> <noscript><img src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img"></noscript>
<img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%2096%2096%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/09/pi-.png" width="96" height="96" alt="ぴー" class="lazyload w_b_ava_img w_b_w100 w_b_h100  w_b_mp0 w_b_img">
</div></div></div>
<div class="w_b_name w_b_w100 w_b_lh w_b_name_C w_b_ta_C w_b_mp0 w_b_div">ぴー</div>
</div>
</div></div></div>
<p>以前、Pixel3のベンチマークを計り直したとき、良いスコアが出たので「温度？」が関係しているのかなと思ったんですよね。今回は、冷蔵庫にPixel３をぶっこんでUnixBenchを計測してみたいと思います。</p>
<h3>まず結果から</h3>
<blockquote class="wp-block-quote">
<p><strong>スマホはどの程度低温に弱いのか実験！</strong></p>
<cite><a href="https://www.yamareco.com/modules/yamanote/detail.php?nid=1497" target="_blank" rel="noreferrer noopener external" data-wpel-link="external" class="wpel-icon-right">https://www.yamareco.com/modules/yamanote/detail.php?nid=1497<span class="wpel-icon wpel-image wpel-icon-1"></span></a></cite>
</blockquote>
<p>先人がやはりいました。この方は冷凍して実験したようです。人柱ですね！なので、冷蔵庫くらいでは問題なさそうなんじゃないかと思います。</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><noscript><img width="1024" height="768" src="/wp-content/uploads/2020/10/IMG_20201008_131649-1024x768.jpg" alt="" class="wp-image-9818" srcset="/wp-content/uploads/2020/10/IMG_20201008_131649-1024x768.jpg 1024w, /wp-content/uploads/2020/10/IMG_20201008_131649-768x576.jpg 768w, /wp-content/uploads/2020/10/IMG_20201008_131649-1536x1151.jpg 1536w, /wp-content/uploads/2020/10/IMG_20201008_131649-2048x1535.jpg 2048w, /wp-content/uploads/2020/10/IMG_20201008_131649-984x738.jpg 984w" sizes="(max-width: 1024px) 100vw, 1024px"></noscript>
<img width="1024" height="768" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%201024%20768%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/IMG_20201008_131649-1024x768.jpg" alt="" class="lazyload wp-image-9818" data-srcset="/wp-content/uploads/2020/10/IMG_20201008_131649-1024x768.jpg 1024w, /wp-content/uploads/2020/10/IMG_20201008_131649-768x576.jpg 768w, /wp-content/uploads/2020/10/IMG_20201008_131649-1536x1151.jpg 1536w, /wp-content/uploads/2020/10/IMG_20201008_131649-2048x1535.jpg 2048w, /wp-content/uploads/2020/10/IMG_20201008_131649-984x738.jpg 984w" data-sizes="(max-width: 1024px) 100vw, 1024px"></figure></div>
<p>スマホはこんな感じで冷蔵庫に入っています。猫カンがあるのは突っ込まないでね！　まず、結果からご報告です。</p>
<p>・Pixel3 Android11　冷蔵庫に入れて計測</p>
<blockquote class="wp-block-quote"><p>シングル：583.3<br>8CPU：1833.7</p></blockquote>
<p>なんと過去最高です！</p>
<div class="wp-block-image"><figure class="aligncenter size-large"><a href="https://thingspeak.com/channels/123997" data-wpel-link="external" target="_blank" rel="external noopener noreferrer"><noscript><img width="945" height="668" src="/wp-content/uploads/2020/10/10.png" alt="" class="wp-image-9817" srcset="/wp-content/uploads/2020/10/10.png 945w, /wp-content/uploads/2020/10/10-768x543.png 768w" sizes="(max-width: 945px) 100vw, 945px"></noscript>
<img width="945" height="668" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20945%20668%22%3E%3C/svg%3E" data-src="/wp-content/uploads/2020/10/10.png" alt="" class="lazyload wp-image-9817" data-srcset="/wp-content/uploads/2020/10/10.png 945w, /wp-content/uploads/2020/10/10-768x543.png 768w" data-sizes="(max-width: 945px) 100vw, 945px"></a></figure></div>
<p>今回は、CPU温度の他、バッテリー温度もグラフ化しました。ベンチマーク中はこのように上昇しました。冷やした状態からだと、CPU温度は過去最高87度まで上昇したようですね。</p>
<p>　冷やせば速く動作するってことは実験からわかったので、筐体を分解してファンを取り付けて運用するのはアリかもしれません。</p>
<h3>詳細ベンチを・・</h3>
<p>詳細についてはこちらに貼り付けておきます。</p>
<pre class="wp-block-code"><code>========================================================================
   BYTE UNIX Benchmarks (Version 5.1.3)

   System: localhost: Android
   OS: Android -- 4.9.223-g5bded8e40b62-ab6647920 -- #0 SMP PREEMPT Thu Jul 2 03:22:48 UTC 2020
   Machine: aarch64 (unknown)
   Language: en_US.utf8 (charmap=, collate=)
   13:07:43 up 4 days,  3:18,  load average: 0.22, 0.20, 0.18; runlevel 

------------------------------------------------------------------------
Benchmark Run: Thu Oct 08 2020 13:07:43 - 13:35:50
8 CPUs in system; running 1 parallel copy of tests

Dhrystone 2 using register variables       29344957.6 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                     6364.3 MWIPS (10.0 s, 7 samples)
Execl Throughput                                353.6 lps   (29.9 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        448563.7 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          177698.8 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1080251.9 KBps  (30.0 s, 2 samples)
Pipe Throughput                             1151314.0 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                  53273.4 lps   (10.0 s, 7 samples)
Process Creation                               1031.2 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   1522.3 lpm   (60.0 s, 2 samples)
Shell Scripts (8 concurrent)                    599.3 lpm   (60.1 s, 2 samples)
System Call Overhead                        1186164.4 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0   29344957.6   2514.6
Double-Precision Whetstone                       55.0       6364.3   1157.1
Execl Throughput                                 43.0        353.6     82.2
File Copy 1024 bufsize 2000 maxblocks          3960.0     448563.7   1132.7
File Copy 256 bufsize 500 maxblocks            1655.0     177698.8   1073.7
File Copy 4096 bufsize 8000 maxblocks          5800.0    1080251.9   1862.5
Pipe Throughput                               12440.0    1151314.0    925.5
Pipe-based Context Switching                   4000.0      53273.4    133.2
Process Creation                                126.0       1031.2     81.8
Shell Scripts (1 concurrent)                     42.4       1522.3    359.0
Shell Scripts (8 concurrent)                      6.0        599.3    998.9
System Call Overhead                          15000.0    1186164.4    790.8
                                                                   ========
System Benchmarks Index Score                                         583.3

------------------------------------------------------------------------
Benchmark Run: Thu Oct 08 2020 13:35:50 - 14:04:03
8 CPUs in system; running 8 parallel copies of tests

Dhrystone 2 using register variables      133676583.1 lps   (10.0 s, 7 samples)
Double-Precision Whetstone                    32433.5 MWIPS (10.2 s, 7 samples)
Execl Throughput                               1466.7 lps   (29.6 s, 2 samples)
File Copy 1024 bufsize 2000 maxblocks        672443.5 KBps  (30.0 s, 2 samples)
File Copy 256 bufsize 500 maxblocks          202034.3 KBps  (30.0 s, 2 samples)
File Copy 4096 bufsize 8000 maxblocks       1920062.6 KBps  (30.0 s, 2 samples)
Pipe Throughput                             4980247.5 lps   (10.0 s, 7 samples)
Pipe-based Context Switching                 324913.7 lps   (10.0 s, 7 samples)
Process Creation                              12358.3 lps   (30.0 s, 2 samples)
Shell Scripts (1 concurrent)                   5728.2 lpm   (60.1 s, 2 samples)
Shell Scripts (8 concurrent)                    698.4 lpm   (60.4 s, 2 samples)
System Call Overhead                        2734159.8 lps   (10.0 s, 7 samples)

System Benchmarks Index Values               BASELINE       RESULT    INDEX
Dhrystone 2 using register variables         116700.0  133676583.1  11454.7
Double-Precision Whetstone                       55.0      32433.5   5897.0
Execl Throughput                                 43.0       1466.7    341.1
File Copy 1024 bufsize 2000 maxblocks          3960.0     672443.5   1698.1
File Copy 256 bufsize 500 maxblocks            1655.0     202034.3   1220.8
File Copy 4096 bufsize 8000 maxblocks          5800.0    1920062.6   3310.5
Pipe Throughput                               12440.0    4980247.5   4003.4
Pipe-based Context Switching                   4000.0     324913.7    812.3
Process Creation                                126.0      12358.3    980.8
Shell Scripts (1 concurrent)                     42.4       5728.2   1351.0
Shell Scripts (8 concurrent)                      6.0        698.4   1164.1
System Call Overhead                          15000.0    2734159.8   1822.8
                                                                   ========
System Benchmarks Index Score                                        1833.7</code></pre>
<h3>ソースコード</h3>
<p>計測に使ったソースです。</p>
<pre class="wp-block-code"><code>#!/data/data/com.termux/files/usr/bin/python3
# coding: utf-8

import requests
import time
api_key='Write API Key'

def sender():
    # CPU Temp
    f = open("/sys/class/thermal/thermal_zone0/temp","r")
    t = f.read()
    f.close()
    cpu_temp = float(t) / 1000
    # Battery Temp
    f = open("/sys/devices/platform/soc/c440000.qcom,spmi/spmi-0/spmi0-02/c440000.qcom,spmi:qcom,pmi8998@2:qcom,qpnp-smb2/power_supply/battery/temp","r")
    t2 = f.read()
    f.close()
    battery_temp = float(t2) / 10
    # USB Temp
    f = open("/sys/devices/platform/soc/c440000.qcom,spmi/spmi-0/spmi0-02/c440000.qcom,spmi:qcom,pmi8998@2:qcom,qpnp-smb2/power_supply/usb/temp","r")
    t3 = f.read()
    f.close()
    usb_temp = float(t3) / 10
    # BMS Temp
    f = open("/sys/devices/platform/soc/c440000.qcom,spmi/spmi-0/spmi0-02/c440000.qcom,spmi:qcom,pmi8998@2:qpnp,fg/power_supply/bms/temp","r")
    t4 = f.read()
    f.close()
    bms_temp = float(t4) / 10

    payload = {'api_key': api_key, 'field1': float(cpu_temp), 'field2': float(battery_temp), 'field3': float(usb_temp), 'field4': float(bms_temp)}
    print("CPU Temp is:%s"%cpu_temp, end=' ')
    print("Battery_temp Temp is:%s"%battery_temp, end=' ')
    print("USB_temp Temp is:%s"%usb_temp, end=' ')
    print("BMS_temp Temp is:%s"%bms_temp, end=' ')
    r = requests.get('http://api.thingspeak.com/update', params=payload)
    print("Result: ", r.text)
    time.sleep(1.0)

def main():
    sender()

if __name__ == '__main__':
  main()</code></pre>
<h3>まとめ</h3>
<p>今回、なんとなくわかったのは以下となります。</p>
<p>・冷蔵庫に入れれば冷えてベンチマークは良い結果となる。<br>・UnixBenchは過去最高、マルチで１８００を超えた！<br>・バッテリー温度は、13.5度くらいまで下がった<br>・ベンチ中はCPU温度は87度まで上昇した！<br>・今の所、壊れていない。壊れてもいい人以外、真似しないように。<br>・スマホサーバとするなら、分解してヒートシンク＋ファンをつけるのが良さそう。</p>
<h3>あとがき</h3>
<p>WiFiアクセスポイントを冷蔵庫付近まで持ってきて電波強度を最強にして夏場は過ごすのもありかもしれません。まぁ、もう暑い季節はすぎてしまったのでやるなら来年、2021年度の夏ですかね！</p>
<p>　あと、root化していると、オーバークロックもできるようですがまだ試していません。</p>
<h3>著者にメッセージ</h3>
<p>コメントじゃなくて、個人的にやりとりしたい場合はこちらからどうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
<p>間違いのご指摘など、コメントじゃなくて、個人的にやりとりしたい場合は<a class="c-link-text" href="/mail/" target="_blank" rel="noopener noreferrer" data-wpel-link="internal">こちらから</a>どうぞ。お返事が遅くなるときもありますが、ご了承を。</p>
</div>
<footer class="entry-footer"></footer>
</div></article><nav class="navigation posts-navigation" role="navigation" aria-label="投稿"><h2 class="screen-reader-text">投稿ナビゲーション</h2>
<div class="nav-links">
<div class="nav-previous"><a href="/category/wordpress/page/4/" data-wpel-link="internal" rel="noopener noreferrer">過去の投稿</a></div>
<div class="nav-next"><a href="/category/wordpress/page/2/" data-wpel-link="internal" rel="noopener noreferrer">新しい投稿</a></div>
</div></nav></main></section></div>
<footer id="colophon" class="site-footer wrap" role="contentinfo"><div class="site-info"> Copyleft - all rights reversed. <span class="sep"> | </span> JunkHack 2011 - 2022 <span class="sep"> | </span> <a href="/about-junkhack/" data-wpel-link="internal" rel="noopener noreferrer">運営者情報<span class="gf"></span></a><span class="sep"> | </span> <a href="/mail/" data-wpel-link="internal" rel="noopener noreferrer">お問い合わせ<span class="gf"></span></a><span class="sep"> | </span> <a href="/privacy/" data-wpel-link="internal" rel="noopener noreferrer">プライバシーポリシー<span class="gf"></span></a>
</div></footer>
</div>
<div id="wpfront-scroll-top-container"> <noscript><img src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt=""></noscript>
<img class="lazyload" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20210%20140%22%3E%3C/svg%3E" data-src="/wp-content/plugins/wpfront-scroll-top/images/icons/1.png" alt="">
</div> <script type="text/javascript">function wpfront_scroll_top_init() {
                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {
                    wpfront_scroll_top({"scroll_offset":100,"button_width":0,"button_height":0,"button_opacity":0.8,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":20,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});
                } else {
                    setTimeout(wpfront_scroll_top_init, 100);
                }
            }
            wpfront_scroll_top_init();</script> <noscript><style>.lazyload{display:none;}</style></noscript>
<script data-noptimize="1">window.lazySizesConfig=window.lazySizesConfig||{};window.lazySizesConfig.loadMode=1;</script><script async data-noptimize="1" src="/wp-content/plugins/autoptimize/classes/external/js/lazysizes.min.js?ao_version=2.9.5"></script><link rel="stylesheet" id="word_balloon_user_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_user.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_skin_talk-css" href="/wp-content/plugins/word-balloon/css/skin/word_balloon_talk.min.css?ver=4.18.4" type="text/css" media="all">
<link rel="stylesheet" id="word_balloon_inview_style-css" href="/wp-content/plugins/word-balloon/css/word_balloon_inview.min.css?ver=4.18.4" type="text/css" media="all"> <script type="text/javascript" src="/wp-includes/js/dist/vendor/regenerator-runtime.min.js?ver=0.13.7" id="regenerator-runtime-js"></script> <script type="text/javascript" src="/wp-includes/js/dist/vendor/wp-polyfill.min.js?ver=3.15.0" id="wp-polyfill-js"></script> <script type="text/javascript" id="contact-form-7-js-extra">var wpcf7 = {"api":{"root":"\/wp-json\/","namespace":"contact-form-7\/v1"},"cached":"1"};</script> <script type="text/javascript" id="google-invisible-recaptcha-js-before">var renderInvisibleReCaptcha = function() {

    for (var i = 0; i < document.forms.length; ++i) {
        var form = document.forms[i];
        var holder = form.querySelector('.inv-recaptcha-holder');

        if (null === holder) continue;
		holder.innerHTML = '';

         (function(frm){
			var cf7SubmitElm = frm.querySelector('.wpcf7-submit');
            var holderId = grecaptcha.render(holder,{
                'sitekey': '6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS', 'size': 'invisible', 'badge' : 'inline',
                'callback' : function (recaptchaToken) {
					if((null !== cf7SubmitElm) && (typeof jQuery != 'undefined')){jQuery(frm).submit();grecaptcha.reset(holderId);return;}
					 HTMLFormElement.prototype.submit.call(frm);
                },
                'expired-callback' : function(){grecaptcha.reset(holderId);}
            });

			if(null !== cf7SubmitElm && (typeof jQuery != 'undefined') ){
				jQuery(cf7SubmitElm).off('click').on('click', function(clickEvt){
					clickEvt.preventDefault();
					grecaptcha.execute(holderId);
				});
			}
			else
			{
				frm.onsubmit = function (evt){evt.preventDefault();grecaptcha.execute(holderId);};
			}


        })(form);
    }
};</script> <script type="text/javascript" async defer src="https://www.google.com/recaptcha/api.js?onload=renderInvisibleReCaptcha&#038;render=explicit&#038;hl=ja" id="google-invisible-recaptcha-js"></script> <script type="text/javascript" src="/wp-content/themes/hew-wpcom/js/contact.js?ver=20210612" id="sendmail-js"></script> <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS&#038;ver=3.0" id="google-recaptcha-js"></script> <script type="text/javascript" id="wpcf7-recaptcha-js-extra">var wpcf7_recaptcha = {"sitekey":"6Lf2z80ZAAAAAJpiFOn2Cix-QJQkaiC7uBA6NCkS","actions":{"homepage":"homepage","contactform":"contactform"}};</script> <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver" id="polyfill_IntersectionObserver-js"></script> <script defer src="/wp-content/cache/autoptimize/js/autoptimize_28a76201e8c516d37ffc311e7dc1a025.js"></script>
</body>
</html>